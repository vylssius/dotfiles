/*! For license information please see background-9a8b795a.js.LICENSE.txt */
(self.webpackChunk_dashlane_amphora=self.webpackChunk_dashlane_amphora||[]).push([[394],{32750:(e,t,r)=>{"use strict";var n;r.d(t,{O:()=>n}),function(e){e.PopupCarbon="Popup",e.PopupCarbonLoader="PopupCarbonLoader",e.OptionsCarbon="OptionsCarbon",e.WebappCarbon="leeloo"}(n||(n={}))},18001:(e,t,r)=>{"use strict";r.d(t,{P:()=>u,y:()=>c});r(86847),r(4473),r(68126),r(41437),r(24814),r(71632),r(75815),r(73636),r(55566),r(72029),r(2165),r(83746),r(37944),r(55402),r(22250),r(92665),r(88737);function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,o=s(e);if(t){var i=s(this).constructor;r=Reflect.construct(o,arguments,i)}else r=o.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(c,e);var t,r,n,s=a(c);function c(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=s.call.apply(s,[this].concat(r))).isConnected=!1,e.onMessage=null,e}return t=c,(r=[{key:"connect",value:function(e){this.onMessage=function(t){e.receive(t)},this.isConnected=!0,this._connected()}},{key:"receive",value:function(e){this._messageReceived(e)}},{key:"send",value:function(e){if(!this.isConnected)throw new Error("Channel not connected");if(!this.onMessage)throw new Error("onMessage handler not set");this.onMessage(e)}}])&&o(t.prototype,r),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(r(71796).GenericChannel),u=function(e,t){e.connect(t),t.connect(e)}},81199:(e,t,r)=>{"use strict";r.d(t,{Y:()=>d});r(37391),r(38298),r(4473),r(68126),r(22250),r(26589),r(75815),r(92665),r(88737),r(2191),r(75986),r(41437),r(24814),r(71632),r(73636),r(55566),r(72029),r(2165),r(83746),r(37944),r(55402);var n=r(71796),o=r(95582),i=r(20500);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=l(e);if(t){var o=l(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===a(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(l,e);var t,r,n,a=u(l);function l(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this,r)).name=void 0,t.currentPorts=void 0,t.onConnectListener=function(e){if(e.name.startsWith(t.name)){if(t.currentPorts.has(e.name))throw new Error("Port already connected");if(!(0,o.k)(e))throw new Error("Sender origin not trusted");t.setup(e)}},t.onDisconnectListener=function(e){i.b.removeListener(t.onConnectListener);var r=t.currentPorts.get(e.name);if(r&&(r.onMessage.removeListener(t.onMessageListener),r.onDisconnect.removeListener(t.onDisconnectListener),t.currentPorts.delete(e.name)),t._disconnected(),chrome.runtime.lastError){var n,o=null!=(n=chrome.runtime.lastError.message)?n:"Unknown chrome.runtime.lastError";throw new Error(o)}},t.onMessageListener=function(e){t._messageReceived(e)},t.name=e,t.currentPorts=new Map,t}return t=l,(r=[{key:"connect",value:function(){i.b.addListener(this.onConnectListener)}},{key:"autoReconnect",value:function(){this.connect()}},{key:"send",value:function(e){if(!this.currentPorts.size)throw new Error("No port to send message");this.currentPorts.forEach((function(t){return t.postMessage(e)}))}},{key:"setup",value:function(e){var t=this.currentPorts.get(e.name);t&&(t.disconnect(),this.onDisconnectListener(t)),e.onMessage.addListener(this.onMessageListener),e.onDisconnect.addListener(this.onDisconnectListener),this.currentPorts.set(e.name,e),this._connected()}}])&&s(t.prototype,r),n&&s(t,n),Object.defineProperty(t,"prototype",{writable:!1}),l}(n.GenericChannel)},31729:(e,t,r)=>{"use strict";r.d(t,{s:()=>d});r(37391),r(4473),r(68126),r(41437),r(24814),r(71632),r(75815),r(73636),r(55566),r(72029),r(2165),r(83746),r(37944),r(55402),r(22250),r(92665),r(88737);var n=r(71796),o=r(95582),i=r(20500);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=l(e);if(t){var o=l(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===a(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(l,e);var t,r,n,a=u(l);function l(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this,r)).name=void 0,t.port=void 0,t.onConnectListener=function(e){if(e.name===t.name){if(!(0,o.k)(e))throw new Error("Sender origin not trusted");t.setup(e)}},t.onDisconnectListener=function(){if(i.b.removeListener(t.onConnectListener),t.port&&(t.port.onMessage.removeListener(t.onMessageListener),t.port.onDisconnect.removeListener(t.onDisconnectListener),t.port=void 0),t._disconnected(),chrome.runtime.lastError){var e,r=null!=(e=chrome.runtime.lastError.message)?e:"Unknown chrome.runtime.lastError";throw new Error(r)}},t.onMessageListener=function(e){t._messageReceived(e)},t.name=e,t}return t=l,(r=[{key:"connect",value:function(){this.port&&(this.port.disconnect(),this.onDisconnectListener()),i.b.addListener(this.onConnectListener)}},{key:"autoReconnect",value:function(){this.connect()}},{key:"send",value:function(e){if(!this.port)throw new Error("No port to send message");this.port.postMessage(e)}},{key:"setup",value:function(e){this.port=e,this.port.onMessage.addListener(this.onMessageListener),this.port.onDisconnect.addListener(this.onDisconnectListener),this._connected()}}])&&s(t.prototype,r),n&&s(t,n),Object.defineProperty(t,"prototype",{writable:!1}),l}(n.GenericChannel)},95582:(e,t,r)=>{"use strict";r.d(t,{k:()=>a});r(22250),r(75815),r(92665),r(88737),r(23389),r(21675),r(37853),r(35758),r(82312);var n=r(92204),o=["safari-mv2-converted","5P72E3GC48"];function i(e){var t=function(e){var t,r,n,o,i,a,s;return null!=(t=null===(r=e.sender)||void 0===r?void 0:r.origin)?t:new URL(null!=(n=null!=(o=null===(i=e.sender)||void 0===i?void 0:i.url)?o:null===(a=e.sender)||void 0===a||null===(s=a.tab)||void 0===s?void 0:s.url)?n:"").origin}(e);return new URL((0,n.A)("")).origin===t}function a(e){return!!function(e){var t,r,n=null!=(t=null===(r=e.sender)||void 0===r?void 0:r.id)?t:"";return o.some((function(e){return n.includes(e)}))}(e)||!!i(e)}},16103:(e,t,r)=>{"use strict";r.d(t,{D:()=>m});r(75815),r(45749),r(23041),r(22250),r(92665),r(88737),r(83746),r(37944),r(55402),r(97979),r(38509),r(95665),r(41533),r(2165),r(72029),r(4473),r(68126),r(71632),r(2191),r(75986),r(37391),r(41437),r(5744),r(18549),r(15442);var n=r(30754),o=r(82324),i=r(81805);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function s(){s=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",c=n.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o=t&&t.prototype instanceof f?t:f,i=Object.create(o.prototype),a=new C(n||[]);return i._invoke=function(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return A()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=R(a,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=d(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,a),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var p={};function f(){}function h(){}function m(){}var y={};u(y,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(P([])));v&&v!==t&&r.call(v,o)&&(y=v);var b=m.prototype=f.prototype=Object.create(y);function w(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function n(o,i,s,c){var u=d(e[o],e,i);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==a(p)&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var o;this._invoke=function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}}function R(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,R(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=d(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,p;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function P(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:A}}function A(){return{value:void 0,done:!0}}return h.prototype=m,u(b,"constructor",m),u(m,"constructor",h),h.displayName=u(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,u(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(S.prototype),u(S.prototype,i,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(b),u(b,c,"Generator"),u(b,o,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=P,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}function c(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}var u=" ";function l(e,t){return d.apply(this,arguments)}function d(){var e;return e=s().mark((function e(t,r){var a,c,l,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,n.U)(t);case 3:if(a=e.sent,"controllable_by_this_extension"===(c=a.levelOfControl)||"controlled_by_this_extension"===c){e.next=8;break}throw l=["Impossible to change browser setting: ".concat(t,"."),"Extension prevented from changing: ".concat(c)].join(u),new Error(l);case 8:e.next=18;break;case 10:if(e.prev=10,e.t0=e.catch(0),!(0,o.b)(e.t0)){e.next=15;break}throw d="Browser setting not supported: ".concat(t),new Error(d);case 15:if(!(0,o.I)(e.t0)){e.next=17;break}throw e.t0.runtimeError;case 17:throw e.t0;case 18:return e.prev=18,e.next=21,(0,i.t)(t,r);case 21:e.next=27;break;case 23:throw e.prev=23,e.t1=e.catch(18),(0,o.I)(e.t1)?e.t1.runtimeError:e.t1;case 27:case"end":return e.stop()}}),e,null,[[0,10],[18,23]])})),d=function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){c(i,n,o,a,s,"next",e)}function s(e){c(i,n,o,a,s,"throw",e)}a(void 0)}))},d.apply(this,arguments)}function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function f(){f=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof d?t:d,i=Object.create(o.prototype),a=new C(n||[]);return i._invoke=function(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return A()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=R(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,a),i}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function d(){}function h(){}function m(){}var y={};s(y,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(P([])));v&&v!==t&&r.call(v,o)&&(y=v);var b=m.prototype=d.prototype=Object.create(y);function w(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function n(o,i,a,s){var c=u(e[o],e,i);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==p(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(d).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}var o;this._invoke=function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}}function R(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,R(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function P(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:A}}function A(){return{value:void 0,done:!0}}return h.prototype=m,s(b,"constructor",m),s(m,"constructor",h),h.displayName=s(m,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,s(e,a,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(S.prototype),s(S.prototype,i,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(b),s(b,a,"Generator"),s(b,o,(function(){return this})),s(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=P,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function h(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function m(){return y.apply(this,arguments)}function y(){var e;return e=f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=["autofillAddressEnabled","autofillCreditCardEnabled","passwordSavingEnabled"].map((function(e){return l(e,!1)})),e.next=4,Promise.all(t);case 4:case"end":return e.stop()}}),e)})),y=function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){h(i,n,o,a,s,"next",e)}function s(e){h(i,n,o,a,s,"throw",e)}a(void 0)}))},y.apply(this,arguments)}},73384:(e,t,r)=>{"use strict";r.d(t,{F:()=>l});r(35758),r(82312),r(37391),r(75815),r(45749),r(83746),r(37944),r(55402),r(22250),r(92665),r(88737),r(97979),r(38509),r(95665),r(41533),r(2165),r(72029),r(4473),r(68126),r(71632),r(2191),r(75986),r(41437),r(5744),r(18549);var n=r(84318),o=r(16241);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(){a=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",c=n.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o=t&&t.prototype instanceof f?t:f,i=Object.create(o.prototype),a=new C(n||[]);return i._invoke=function(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return A()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=R(a,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=d(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,a),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var p={};function f(){}function h(){}function m(){}var y={};u(y,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(P([])));v&&v!==t&&r.call(v,o)&&(y=v);var b=m.prototype=f.prototype=Object.create(y);function w(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function n(o,a,s,c){var u=d(e[o],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==i(p)&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var o;this._invoke=function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}}function R(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,R(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=d(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,p;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function P(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:A}}function A(){return{value:void 0,done:!0}}return h.prototype=m,u(b,"constructor",m),u(m,"constructor",h),h.displayName=u(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,u(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(S.prototype),u(S.prototype,s,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(b),u(b,c,"Generator"),u(b,o,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=P,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}function s(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}var c={nightly:"icon_nightly_auth",mv2:"icon_auth",mv3:"icon_mv3_auth"},u="icon_not_auth";function l(e){return d.apply(this,arguments)}function d(){var e;return e=a().mark((function e(t){var r,i,s,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.isUserAuthenticated,i=r?(a=void 0,(a=(0,n.W)()).name.includes("Nightly")?c.nightly:a.name.includes("Beta")||3===a.manifest_version?c.mv3:c.mv2):u,s="icons/action/".concat(i),l={16:"".concat(s,".png"),32:"".concat(s,"@2x.png")},e.next=6,(0,o.B)(l);case 6:case"end":return e.stop()}var a}),e)})),d=function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){s(i,n,o,a,c,"next",e)}function c(e){s(i,n,o,a,c,"throw",e)}a(void 0)}))},d.apply(this,arguments)}},89962:(e,t,r)=>{"use strict";r.d(t,{$:()=>u});r(38298),r(86847),r(22250),r(75815),r(45749),r(92665),r(88737),r(23041),r(37391),r(83746),r(37944),r(55402),r(97979),r(38509),r(95665),r(41533),r(2165),r(72029),r(4473),r(68126),r(71632),r(2191),r(75986),r(41437),r(5744),r(18549);var n=r(329),o=r(98641);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(){a=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",c=n.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o=t&&t.prototype instanceof f?t:f,i=Object.create(o.prototype),a=new C(n||[]);return i._invoke=function(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return A()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=R(a,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=d(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,a),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var p={};function f(){}function h(){}function m(){}var y={};u(y,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(P([])));v&&v!==t&&r.call(v,o)&&(y=v);var b=m.prototype=f.prototype=Object.create(y);function w(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function n(o,a,s,c){var u=d(e[o],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==i(p)&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var o;this._invoke=function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}}function R(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,R(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=d(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,p;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function P(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:A}}function A(){return{value:void 0,done:!0}}return h.prototype=m,u(b,"constructor",m),u(m,"constructor",h),h.displayName=u(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,u(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(S.prototype),u(S.prototype,s,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(b),u(b,c,"Generator"),u(b,o,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=P,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}function s(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function c(e){var t="http".concat(e.secure?"s":""),r=e.domain.startsWith(".")?e.domain.substring(1):e.domain;return"".concat(t,"://").concat(r).concat(e.path)}function u(e){return l.apply(this,arguments)}function l(){var e;return e=a().mark((function e(t){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,n.g)({domain:t});case 2:return r=e.sent,e.abrupt("return",Promise.all(r.map((function(e){return(0,o.O)({url:c(e),name:e.name})}))));case 4:case"end":return e.stop()}}),e)})),l=function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){s(i,n,o,a,c,"next",e)}function c(e){s(i,n,o,a,c,"throw",e)}a(void 0)}))},l.apply(this,arguments)}},41305:(e,t,r)=>{"use strict";r.d(t,{j:()=>c});r(75815),r(45749),r(83746),r(37944),r(55402),r(22250),r(92665),r(88737),r(97979),r(38509),r(95665),r(41533),r(2165),r(72029),r(4473),r(68126),r(71632),r(2191),r(75986),r(37391),r(41437),r(5744),r(18549);var n=r(39680),o=r(41808);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(){a=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",c=n.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o=t&&t.prototype instanceof f?t:f,i=Object.create(o.prototype),a=new C(n||[]);return i._invoke=function(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return A()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=R(a,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=d(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,a),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var p={};function f(){}function h(){}function m(){}var y={};u(y,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(P([])));v&&v!==t&&r.call(v,o)&&(y=v);var b=m.prototype=f.prototype=Object.create(y);function w(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function n(o,a,s,c){var u=d(e[o],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==i(p)&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var o;this._invoke=function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}}function R(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,R(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=d(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,p;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function P(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:A}}function A(){return{value:void 0,done:!0}}return h.prototype=m,u(b,"constructor",m),u(m,"constructor",h),h.displayName=u(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,u(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(S.prototype),u(S.prototype,s,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(b),u(b,c,"Generator"),u(b,o,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=P,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}function s(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function c(e){return u.apply(this,arguments)}function u(){var e;return e=a().mark((function e(t){var r,i,s,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,n.G)()){e.next=5;break}return e.next=3,(0,n.y)(t);case 3:return r=e.sent,e.abrupt("return",r>0);case 5:return e.next=7,(0,o.U)(t);case 7:return i=e.sent,s=void 0===i[t],c=null===i[t],e.abrupt("return",!s&&!c);case 11:case"end":return e.stop()}}),e)})),u=function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){s(i,n,o,a,c,"next",e)}function c(e){s(i,n,o,a,c,"throw",e)}a(void 0)}))},u.apply(this,arguments)}},79159:(e,t,r)=>{"use strict";r.d(t,{b:()=>_});r(86847),r(72424),r(23041),r(15442),r(37391),r(32202),r(75815),r(68585),r(45749),r(83746),r(37944),r(55402),r(22250),r(92665),r(88737),r(97979),r(38509),r(95665),r(41533),r(2165),r(72029),r(4473),r(68126),r(71632),r(2191),r(75986),r(41437),r(5744),r(18549),r(7541),r(22440),r(94973);var n=r(92204),o=r(24715),i=r(72733),a=r(57306),s=r(31460),c=(r(38298),r(61222));function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function l(){l=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof f?t:f,i=Object.create(o.prototype),a=new C(n||[]);return i._invoke=function(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return A()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=R(a,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=d(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,a),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var p={};function f(){}function h(){}function m(){}var y={};s(y,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(P([])));v&&v!==t&&r.call(v,o)&&(y=v);var b=m.prototype=f.prototype=Object.create(y);function w(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function n(o,i,a,s){var c=d(e[o],e,i);if("throw"!==c.type){var l=c.arg,p=l.value;return p&&"object"==u(p)&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(p).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}var o;this._invoke=function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}}function R(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,R(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=d(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,p;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function P(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:A}}function A(){return{value:void 0,done:!0}}return h.prototype=m,s(b,"constructor",m),s(m,"constructor",h),h.displayName=s(m,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,s(e,a,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(S.prototype),s(S.prototype,i,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(b),s(b,a,"Generator"),s(b,o,(function(){return this})),s(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=P,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}function d(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function p(){return f.apply(this,arguments)}function f(){var e;return e=l().mark((function e(){var t,r,o,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.I)({});case 2:return t=e.sent,r=(0,n.A)(""),o=function(e){return"string"==typeof e.url&&e.url.startsWith(r)},i=function(e){return""!==e.url},e.abrupt("return",t.filter(o).filter(i));case 7:case"end":return e.stop()}}),e)})),f=function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){d(i,n,o,a,s,"next",e)}function s(e){d(i,n,o,a,s,"throw",e)}a(void 0)}))},f.apply(this,arguments)}function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){g(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function v(){v=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof d?t:d,i=Object.create(o.prototype),a=new C(n||[]);return i._invoke=function(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return A()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=R(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,a),i}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function d(){}function p(){}function f(){}var m={};s(m,o,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(P([])));g&&g!==t&&r.call(g,o)&&(m=g);var b=f.prototype=d.prototype=Object.create(m);function w(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function n(o,i,a,s){var c=u(e[o],e,i);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==h(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(d).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}var o;this._invoke=function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}}function R(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,R(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function P(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:A}}function A(){return{value:void 0,done:!0}}return p.prototype=f,s(b,"constructor",f),s(f,"constructor",p),p.displayName=s(f,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,a,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(S.prototype),s(S.prototype,i,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(b),s(b,a,"Generator"),s(b,o,(function(){return this})),s(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=P,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function b(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function w(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){b(i,n,o,a,s,"next",e)}function s(e){b(i,n,o,a,s,"throw",e)}a(void 0)}))}}var S="index.html";function R(){var e=(0,n.A)("");return"".concat(e).concat(S)}function E(e){var t=e.identifier,r=e.queryInfo,n=e.name,o=R();if(!n)return o;var i=t?"#".concat(n,"/").concat(t):"#".concat(n),a=r?"?".concat(function(e){return Object.keys(e).map((function(t){return"".concat(t,"=").concat(e[t])})).join("&")}(r)):"";return encodeURI("".concat(o).concat(i).concat(a))}function O(e){return C.apply(this,arguments)}function C(){return(C=w(v().mark((function e(t){var r;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={url:t},e.next=3,(0,o.U)(r);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){var t,r=e.existingTabs,n=e.focusedWindow,o=r.filter((function(e){return e.active})),i=o.find((function(e){return e.windowId===n.id})),a=o.pop(),s=r.pop();return null!=(t=null!=i?i:a)?t:s}function A(e){return j.apply(this,arguments)}function j(){return(j=w(v().mark((function e(t){var r,n,o,c,u,l;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.path,n=t.tabs,e.next=3,(0,i.T)();case 3:if(o=e.sent,c=P({existingTabs:n,focusedWindow:o})){e.next=7;break}return e.abrupt("return");case 7:if(c.windowId!==o.id&&(0,a.V)(c.windowId,{focused:!0}),c.id){e.next=10;break}return e.abrupt("return");case 10:return u=r===R()?{}:{url:r},l=y({active:!0},u),e.next=14,(0,s.V)(c.id,l);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e){return T.apply(this,arguments)}function T(){return T=w(v().mark((function e(t){var r,n,o,i,a;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id,n=t.query,o=t.route,i=E({identifier:r,queryInfo:n,name:o}),e.next=4,p();case 4:if(!(a=e.sent).length){e.next=9;break}return e.next=8,A({path:i,tabs:a});case 8:return e.abrupt("return");case 9:return e.next=11,O(i);case 11:case"end":return e.stop()}}),e)}))),T.apply(this,arguments)}},3524:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enclaveSdkApi=void 0;const n=r(68224),o=r(70737),i=r(85421);t.enclaveSdkApi=(0,n.defineModuleApi)({name:"enclaveSdkApi",commands:{CheckDNSValidationCommand:o.CheckDNSValidationCommand,ClearSettingsCommand:o.ClearSettingsCommand,CreateTeamCommand:o.CreateTeamCommand,DeleteDomainCommand:o.DeleteDomainCommand,EnableSsoCommand:o.EnableSsoCommand,InitSsoProvisioningCommand:o.InitSsoProvisioningCommand,LoginUserWithEnclaveSSOCommand:o.LoginUserWithEnclaveSSOCommand,ProvisionDomainCommand:o.ProvisionDomainCommand,TestLoginUserWithEnclaveSSOCommand:o.TestLoginUserWithEnclaveSSOCommand,UpdateMetadataCommand:o.UpdateMetadataCommand,ValidateMetadataCommand:o.ValidateMetadataCommand},events:{},queries:{SsoProvisioningQuery:i.SsoProvisioningQuery}})},72346:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CheckDNSValidationCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.CheckDNSValidationCommand=o},20530:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClearSettingsCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.ClearSettingsCommand=o},64631:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreateTeamCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.CreateTeamCommand=o},87756:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeleteDomainCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.DeleteDomainCommand=o},90209:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnableSsoCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.EnableSsoCommand=o},70737:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(72346),t),o(r(64631),t),o(r(96330),t),o(r(58761),t),o(r(6089),t),o(r(87756),t),o(r(79393),t),o(r(77274),t),o(r(33126),t),o(r(90209),t),o(r(20530),t)},79393:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InitSsoProvisioningCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.InitSsoProvisioningCommand=o},96330:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoginUserWithEnclaveSSOCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.LoginUserWithEnclaveSSOCommand=o},58761:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProvisionDomainCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.ProvisionDomainCommand=o},6089:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TestLoginUserWithEnclaveSSOCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.TestLoginUserWithEnclaveSSOCommand=o},77274:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateMetadataCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.UpdateMetadataCommand=o},33126:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ValidateMetadataCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.ValidateMetadataCommand=o},29465:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(3524),t),o(r(70737),t),o(r(85421),t),o(r(78521),t)},85421:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(10271),t)},10271:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SsoProvisioningQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.SsoProvisioningQuery=o},78521:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SsoProvisioning=t.InferredSsoState=t.Domain=t.DomainPendingReason=t.DomainVerificationStatus=void 0;const n=r(10295);t.DomainVerificationStatus=n.z.enum(["valid","pending","expired","invalid"]),t.DomainPendingReason=n.z.enum(["tokenNotFound","invalidToken"]),t.Domain=n.z.object({domainName:n.z.string(),status:t.DomainVerificationStatus.nullable(),verificationToken:n.z.string(),lastCheckDateUnix:n.z.number(),pendingReason:t.DomainPendingReason.nullable()}),t.InferredSsoState=n.z.enum(["NitroComplete","NitroIncomplete","SelfHostedComplete","SelfHostedIncomplete","SsoConnectorIncomplete","SsoConnectorComplete","None","Unknown"]),t.SsoProvisioning=n.z.object({global:n.z.object({adminProvisioningKey:n.z.string().nullable(),isTeamProvisionedInNitro:n.z.boolean().nullable(),inferredSsoState:t.InferredSsoState,teamUuid:n.z.string().nullable(),ssoCapable:n.z.boolean().nullable()}),idpApplication:n.z.object({entityId:n.z.string().nullable(),acsUrl:n.z.string().nullable(),signOnUrl:n.z.string().nullable()}),idpMetadata:n.z.object({metadataValue:n.z.string().nullable()}),domainSetup:n.z.array(n.z.object({domainName:n.z.string().url(),verificationStatus:t.DomainVerificationStatus})),domainVerificationInfo:n.z.record(n.z.string().url(),n.z.object({subdomainValue:n.z.string().nullable(),txtValue:n.z.string().nullable(),verificationStatus:t.DomainVerificationStatus.nullable(),tokenFound:n.z.string().nullable(),pendingReason:t.DomainPendingReason.nullable()})),enableSSO:n.z.object({ssoEnabled:n.z.boolean().nullable()})})},70027:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(29465),t)},93935:(e,t,r)=>{"use strict";r.d(t,{N6:()=>i,Em:()=>$e,xp:()=>o});const n=["local","staging","prod"];function o(e){return n.includes(e)}class i{constructor(e,t,r){this.cloudflareHeaders=e,this.enclaveUrl=t,this.environment=r}}var a=r(27606),s=r(11103),c=r(70027);class u{}var l=r(87279),d=r(7165),p=r(56695),f=r(60399);const h=e=>{const t=e.match(/[\da-f]{2}/gi);return t?new Uint8Array(t.map((e=>parseInt(e,16)))).buffer:(new Uint8Array).buffer},m=d.z.object({data:d.z.object({attestation:d.z.string()}),requestId:d.z.string()});class y{decode(e){const t=m.safeParse(e);if(!t.success)throw new Error("Invalid response format");return{attestation:h(t.data.data.attestation)}}}const g=async(e,t)=>{const{headers:r,httpClient:n,publicKey:o}=t,i=await(async e=>(await p.ready,{clientPublicKey:p.to_hex(e)}))(o),a=await(0,f.z)(n.post(e,i,{observe:"body",responseType:"json",responseBodyDecoder:new y,withCredentials:!0,headers:r}));if((0,l.hx)(a))throw new Error("string"==typeof a.error?a.error:"HTTP Error");return a.data},v=d.z.object({requestId:d.z.string(),errors:d.z.array(d.z.object({status:d.z.string(),code:d.z.string(),message:d.z.string()}))});class b{assertData(e){if(!e)throw new Error("toDecode expected to be truthy");if("[object Object]"!=`${e}`||Array.isArray(e))throw new Error("toDecode expected to be object");if(!Object.prototype.hasOwnProperty.call(e,"data"))throw new Error('toDecode expected to contain a "data" property');const t=e;if("string"!=typeof t.data)throw new Error("toDecode.data expected to be type string but was "+typeof t.data)}decode(e){return this.assertData(e),e.data}}var w=r(76465);function S(e){return(0,w.Jx)(new Uint8Array(e))}var R=r(89685),E=r(7502);const O=d.z.object({module_id:d.z.string(),timestamp:d.z.bigint(),digest:d.z.string(),pcrs:d.z.record(d.z.string(),d.z.instanceof(Uint8Array)),certificate:d.z.instanceof(Uint8Array),cabundle:d.z.array(d.z.instanceof(Uint8Array)),user_data:d.z.instanceof(Uint8Array),nonce:d.z.instanceof(Uint8Array).nullable()}),C=d.z.object({header:d.z.string(),publicKey:d.z.string()}),P=e=>{const t=S(new Uint8Array(e)),r=(n=t,Array.isArray(n)?n:n.value);var n;const[o,,i,a]=r;if(!o)throw new Error("parseSignedMessage: no protected header field");if(!i)throw new Error("parseSignedMessage: no payload field");if(!a)throw new Error("parseSignedMessage: no signature field");return{payload:new Uint8Array(i).buffer,protectedHeaders:new Uint8Array(o).buffer,signature:new Uint8Array(a).buffer}};var A=r(71833);var j=r(96303);const _=e=>(0,j.k)((e=>new Uint8Array(e).buffer)(e)),T=(e,t)=>{switch(t){case"local":return(e=>{if("9e33eca6497ec3b68ae13735cd28b1a9be1235d3440f10121327150495de4a4f854eb902a62991b366757f3d87ce57e4"!==_(e[0]))throw new Error("Enclave image invalid");return!0})(e);case"staging":return(e=>{if("90528150e0f0537fa9e96b067137f6494d525f2fcfd15b478ce28ab2cfaf38dd4e24ad73f9d9d6f238a7f39f2d1956b7"!==_(e[3]))throw new Error("Unexpected IAM role on parent instance");return!0})(e);case"prod":return(e=>{const t=_(e[3]),r=_(e[8]);if("dfb6428f132530b8c021bea8cbdba2c87c96308ba7e81c7aff0655ec71228122a9297fd31fe5db7927a7322e396e4c16"!==t||"4dbb92401207e019e132d86677857081d8e4d21f946f3561b264b7389c6982d3a86bcf9560cef4a2327eac5c5c6ab820"!==r)throw new Error("Unexpected IAM role on parent instance");return!0})(e)}};const I=async(e,t,r,n)=>{const o=A.KBB.fromBER(n),i=await o.getPublicKey(),a=["Signature1",t,new ArrayBuffer(0),r],s=(c=a,(0,w.cv)(c));var c;return await crypto.subtle.verify({name:"ECDSA",hash:"SHA-384"},i,e,s)},D=async e=>{const{attestation:t,environment:r}=e,{protectedHeaders:n,payload:o,signature:i}=P(t),a=(e=>{const t=S(e),r=O.safeParse(t);if(!r.success)throw new Error("failed to parse attestation document");const n=r.data,o=(0,R.v)(n.user_data),i=JSON.parse(o),a=C.safeParse(i);if(!a.success)throw new Error("failed to parse server crypto info");const s=a.data;return{moduleId:n.module_id,timestamp:n.timestamp,digest:n.digest,pcrs:n.pcrs,certificate:new Uint8Array(n.certificate).buffer,cabundle:(c=n.cabundle,c.map((e=>new Uint8Array(e).buffer))),serverHeader:(0,E.R)(s.header),serverPublicKey:(0,E.R)(s.publicKey),nonce:null!==n.nonce?new Uint8Array(n.nonce).buffer:null};var c})(o),s=await(async(e,t,r)=>{const n=(e=>"local"===e?"MIICqzCCAjKgAwIBAgIUGdKnU0kGWeXtXL7BK1VpIbnjXZkwCgYIKoZIzj0EAwMwgYQxCzAJBgNVBAYTAkZSMQ8wDQYDVQQIDAZGcmFuY2UxDjAMBgNVBAcMBVBhcmlzMQswCQYDVQQKDAJETDELMAkGA1UECwwCREwxFjAUBgNVBAMMDU5pdHJvIFRlc3QgQ0ExIjAgBgkqhkiG9w0BCQEWE3NlcnZlckBkYXNobGFuZS5jb20wHhcNMjIwNDI3MTI0NTQ5WhcNNDIwNDIyMTI0NTQ5WjCBhDELMAkGA1UEBhMCRlIxDzANBgNVBAgMBkZyYW5jZTEOMAwGA1UEBwwFUGFyaXMxCzAJBgNVBAoMAkRMMQswCQYDVQQLDAJETDEWMBQGA1UEAwwNTml0cm8gVGVzdCBDQTEiMCAGCSqGSIb3DQEJARYTc2VydmVyQGRhc2hsYW5lLmNvbTB2MBAGByqGSM49AgEGBSuBBAAiA2IABLeu4raurW6XA9/c13rzPwzbk1aYAR/fPj49YoaZI+K0PFfo75rKUr0m7LawW/jpwkAqWad44SXxj2fF+REDz4ii8tUjVl8Ijp1ohrQEAvDZLcxS98bQV+NFmoyx6QxbQKNjMGEwHQYDVR0OBBYEFM5p3QEkzjDGWRntWRdqC0aWiGiaMB8GA1UdIwQYMBaAFM5p3QEkzjDGWRntWRdqC0aWiGiaMA8GA1UdEwEB/wQFMAMBAf8wDgYDVR0PAQH/BAQDAgGGMAoGCCqGSM49BAMDA2cAMGQCMGdird9+5r9vw9vt2x4q86nMJwu2eGXbcOE6sVRSQ92nWYHk2VX2NZix1tBX3nMGiQIwRHALNGgnkUofNBOoxZ/Pntk14Djv5Kt3/fKd6NWFRhyFZ97jho4c+slS7u9LrttE":"MIICETCCAZagAwIBAgIRAPkxdWgbkK/hHUbMtOTn+FYwCgYIKoZIzj0EAwMwSTELMAkGA1UEBhMCVVMxDzANBgNVBAoMBkFtYXpvbjEMMAoGA1UECwwDQVdTMRswGQYDVQQDDBJhd3Mubml0cm8tZW5jbGF2ZXMwHhcNMTkxMDI4MTMyODA1WhcNNDkxMDI4MTQyODA1WjBJMQswCQYDVQQGEwJVUzEPMA0GA1UECgwGQW1hem9uMQwwCgYDVQQLDANBV1MxGzAZBgNVBAMMEmF3cy5uaXRyby1lbmNsYXZlczB2MBAGByqGSM49AgEGBSuBBAAiA2IABPwCVOumCMHzaHDimtqQvkY4MpJzbolL//Zy2YlES1BR5TSksfbb48C8WBoyt7F2Bw7eEtaaP+ohG2bnUs990d0JX28TcPQXCEPZ3BABIeTPYwEoCWZEh8l5YoQwTcU/9KNCMEAwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUkCW1DdkFR+eWw5b6cp3PmanfS5YwDgYDVR0PAQH/BAQDAgGGMAoGCCqGSM49BAMDA2kAMGYCMQCjfy+Rocm9Xue4YnwWmNJVA44fA0P5W2OpYow9OYCVRaEevL8uO1XYru5xtMPWrfMCMQCi85sWBbJwKKXdS6BptQFuZbT73o/gBh1qUxl/nNr12UO8Yfwr6wPLb+6NIwLz3/Y=")(r),o=A.KBB.fromBER(e),i=t.map((e=>A.KBB.fromBER(e)));i.push(o);const a=[A.KBB.fromBER((0,E.R)(n))],s=new A.DMg({trustedCerts:a,certs:i});return(await s.verify()).result})(a.certificate,a.cabundle,r);if(!s)throw new Error("Invalid cert chain!");if(!await I(i,n,o,a.certificate))throw new Error("Invalid signature!");return T(a.pcrs,r),{serverPublicKey:a.serverPublicKey,serverHeader:a.serverHeader}};var x,U;!function(e){e.CLIENT_HELLO="api/tunnel/ClientHello",e.TERMINATE_HELLO="api/tunnel/TerminateHello"}(x||(x={})),function(e){e.AUTH_CONFIRM_LOGIN="api/authentication/ConfirmLogin",e.AUTH_REQUEST_LOGIN="api/authentication/RequestLogin",e.AUTH_REQUEST_TEST_LOGIN="api/authentication/RequestTestLogin",e.AUTH_CONFIRM_TEST_LOGIN="api/authentication/ConfirmTestLogin",e.DOMAINS_CHECK_DNS_VALIDATION="api/domains/CheckDNSValidation",e.DOMAINS_DELETE_DOMAIN="api/domains/DeleteDomain",e.DOMAINS_PROVISION_DOMAIN="api/domains/ProvisionDomain",e.DOMAINS_UPDATE_DOMAIN="api/domains/UpdateDomain",e.TEAMS_CREATE_TEAM="api/teams/CreateTeam",e.TEAMS_GET_TEAM_STATUS="api/teams/GetTeamStatus",e.TEAMS_DELETE_TEAM="api/teams/DeleteTeam"}(U||(U={}));const M=async(e,t)=>{await p.ready;const{enclaveApiSettings:{cloudflareHeaders:r,enclaveUrl:n,environment:o},httpClient:i,platformInfo:s,data:c}=t,u={};u["dashlane-client-agent"]=JSON.stringify({platform:s.platformName,osversion:s.osVersion,version:s.appVersion}),r.accessKey&&r.secretKey&&(u["CF-Access-Client-Id"]=r.accessKey,u["CF-Access-Client-Secret"]=r.secretKey);const d=p.crypto_kx_keypair(),{clientHelloUrl:h,terminateHelloUrl:m,secureContentUrl:y}=((e,t)=>({clientHelloUrl:`${e}${x.CLIENT_HELLO}`,terminateHelloUrl:`${e}${x.TERMINATE_HELLO}`,secureContentUrl:`${e}${t}`}))(n,e),w=await g(h,{headers:u,httpClient:i,publicKey:d.publicKey}),{serverPublicKey:S,serverHeader:R}=await D({attestation:w.attestation,environment:o}),E=await(async(e,t)=>{const{headers:r,clientKeyPair:n,httpClient:o,serverPublicKey:i}=t;await p.ready;const a=p.crypto_kx_client_session_keys(n.publicKey,n.privateKey,new Uint8Array(i)),s=p.crypto_secretstream_xchacha20poly1305_init_push(a.sharedRx),c=s.state,u=s.header,d={clientHeader:p.to_hex(u)},h=await(0,f.z)(o.post(e,d,{observe:"response",responseType:"json",withCredentials:!0,headers:r}));if((0,l.hx)(h))throw new Error("HTTP error");return{clientStateOut:c,sessionKeys:a}})(m,{headers:u,httpClient:i,clientKeyPair:d,serverPublicKey:S});return await(async(e,t)=>{const{clientStateOut:r,serverHeader:n,sessionKeys:o,headers:i,httpClient:s}=t;await p.ready;const c=p.crypto_secretstream_xchacha20poly1305_push(r,p.from_string(t.data),null,p.crypto_secretstream_xchacha20poly1305_TAG_MESSAGE),u={data:p.to_hex(c)},d=await(0,f.z)(s.post(e,u,{observe:"body",responseType:"json",responseBodyDecoder:new b,withCredentials:!0,headers:i}));if((0,l.hx)(d)){if(d.error instanceof a.BadStatus){const e=await JSON.parse(await d.error.response.text()),t=v.safeParse(e);if(t.success){const e=t.data.errors[0];throw new Error(e.code)}}throw new Error("HTTP error")}const h=p.crypto_secretstream_xchacha20poly1305_init_pull(new Uint8Array(n),o.sharedTx),m=p.crypto_secretstream_xchacha20poly1305_pull(h,p.from_hex(d.data)).message;return{decryptedResponse:p.to_string(m)}})(y,{data:c,headers:u,httpClient:i,clientStateOut:E.clientStateOut,sessionKeys:E.sessionKeys,serverHeader:R})};var L=r(68224);const N=e=>c.SsoProvisioning.safeParse(e).success,k={global:{adminProvisioningKey:null,teamUuid:null,isTeamProvisionedInNitro:null,inferredSsoState:c.InferredSsoState.enum.Unknown,ssoCapable:null},idpApplication:{entityId:null,acsUrl:null,signOnUrl:null},idpMetadata:{metadataValue:null},domainSetup:[],domainVerificationInfo:{},enableSSO:{ssoEnabled:null}};class F extends((0,a.defineStore)({persist:!1,capacity:a.StoreCapacity._010KB,initialValue:k,scope:L.UseCaseScope.User,storeName:"nitro-sso-provisioning-state",storeTypeGuard:N})){}var V=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},q=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const G="_dashlane-challenge";let B=class{constructor(e){this.store=e}async reset(){await this.store.init({global:{adminProvisioningKey:null,teamUuid:null,isTeamProvisionedInNitro:null,inferredSsoState:c.InferredSsoState.enum.Unknown,ssoCapable:null},idpApplication:{entityId:null,acsUrl:null,signOnUrl:null},idpMetadata:{metadataValue:null},domainSetup:[],domainVerificationInfo:{},enableSSO:{ssoEnabled:null}})}async update(e,t){const r=await this.store.getState(),n=((e,t)=>({...e,...t}))(r,{[t]:{...r[t],...e}});await this.store.set(n)}set(e){return this.store.set(e)}};B=V([(0,a.Injectable)(),q("design:paramtypes",[F])],B);var H=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},W=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const K=d.z.object({previousStatus:d.z.string(),status:d.z.enum(["valid","pending","expired","invalid"]),verificationToken:d.z.string(),lastCheckDateUnix:d.z.number(),pendingReason:d.z.enum(["tokenNotFound","invalidToken"]).nullable(),tokenFound:d.z.ostring()});let z=class{constructor(e,t,r,n,o){this.httpClient=e,this.enclaveApiSettings=t,this.platformInfoService=r,this.ssoProvisioningStoreUpdater=n,this.ssoProvisioningStore=o}async execute(e){const t=await this.ssoProvisioningStore.getState(),{global:{adminProvisioningKey:r},domainVerificationInfo:n}=t,o=e.body.domainName;if(!r)throw new Error("Admin Provisioning Key is not available. Is state initialized and has the team been provisioned in the enclave?");if(!o)throw new Error("Missing domain name. Is state initialized and has a domain been provisioned in the enclave?");const i={adminProvisioningKey:r,domainName:o},a=await this.platformInfoService.getPlatformInfo(),s=JSON.stringify(i),{decryptedResponse:c}=await M(U.DOMAINS_CHECK_DNS_VALIDATION,{data:s,httpClient:this.httpClient,enclaveApiSettings:this.enclaveApiSettings,platformInfo:a});try{const e=K.parse(JSON.parse(c)),t=n[o];t.txtValue=e.verificationToken,t.verificationStatus=e.status,t.tokenFound=e.tokenFound??null,await this.ssoProvisioningStoreUpdater.update(n,"domainVerificationInfo")}catch(e){return(0,l.Rn)({tag:"failed to parse response"})}return(0,l.Vp)(void 0)}};z=H([(0,a.CommandHandler)(c.CheckDNSValidationCommand),W("design:paramtypes",[a.HttpClient,i,s.tu,B,F])],z);var $=r(53576);const Q=d.z.object({data:d.z.object({deviceAccessKey:d.z.string(),deviceSecretKey:d.z.string()})}),Y=d.z.object({data:d.z.object({devicePrivateKey:d.z.string(),devicePublicKey:d.z.string()})}),J=async(e,t)=>{await e({name:"updateTeamSettings",args:[{...t}]})};var X=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Z=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ee=class{constructor(e,t,r,n,o,i){this.httpClient=e,this.enclaveApiSettings=t,this.platformInfoService=r,this.ssoProvisioningStoreUpdater=n,this.ssoProvisioningStore=o,this.carbonLegacy=i.getClient($.carbonLegacyApi)}async execute(){const{commands:{carbon:e}}=this.carbonLegacy,t=(await this.ssoProvisioningStore.getState()).global.teamUuid;if(!t)throw new Error("Team UUID not available. Are you logged in?");const{deviceAccessKey:r,devicePublicKey:n,deviceSecretKey:o,devicePrivateKey:i}=await(async e=>{const t=await e({name:"registerTeamDevice",args:[{platform:"nitro_encryption_service",deviceName:"Nitro Encryption Service"}]});if("success"!==t.tag)throw new Error("Failed to register a team device during team provisioning");const{data:{deviceAccessKey:r,deviceSecretKey:n}}=Q.parse(t.data.carbonResult),o=await e({name:"registerTeamDeviceAccount",args:[{deviceAccessKey:r,shouldGenerateDeviceKeyPair:!0}]});if("success"!==o.tag)throw new Error("Failed to register a team device account during team provisioning");const{data:{devicePrivateKey:i,devicePublicKey:a}}=Y.parse(o.data.carbonResult);return{deviceAccessKey:r,deviceSecretKey:n,devicePrivateKey:i,devicePublicKey:a}})(e),a=new URL(this.enclaveApiSettings.enclaveUrl).origin;await J(e,{ssoServiceProviderUrl:a}),await this.ssoProvisioningStoreUpdater.update({inferredSsoState:c.InferredSsoState.enum.NitroIncomplete},"global");const s={teamDeviceCredentials:{teamUuid:t,accessKey:r,secretKey:o,sharingPublicKey:n,sharingPrivateKey:i}},u=JSON.stringify(s);let d;try{const e=await this.platformInfoService.getPlatformInfo();d=(await M(U.TEAMS_CREATE_TEAM,{data:u,httpClient:this.httpClient,enclaveApiSettings:this.enclaveApiSettings,platformInfo:e})).decryptedResponse}catch(t){return await J(e,{ssoServiceProviderUrl:null}),await e({name:"deactivateTeamDevice",args:[{teamDeviceAccessKey:r}]}),await this.ssoProvisioningStoreUpdater.update({inferredSsoState:c.InferredSsoState.enum.None},"global"),(0,l.Rn)({tag:t instanceof Error?t.message:"HTTP Error"})}let p=null;try{p=JSON.parse(d)?.adminProvisioningKey??null}catch{return(0,l.Rn)({tag:"Unable to parse response to get the provisioning key"})}return p?(await e({name:"persistAdminProvisioningKey",args:[{adminProvisioningKey:p}]}),await this.ssoProvisioningStoreUpdater.update({adminProvisioningKey:p,isTeamProvisionedInNitro:!0},"global"),(0,l.Vp)(void 0)):(0,l.Rn)({tag:"parsed result does not have a provisioning key"})}};ee=X([(0,a.CommandHandler)(c.CreateTeamCommand),Z("design:paramtypes",[a.HttpClient,i,s.tu,B,F,a.CqrsClient])],ee);const te=d.z.object({idpAuthorizeUrl:d.z.string()});var re=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ne=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let oe=class{constructor(e,t,r,n,o){this.httpClient=e,this.enclaveApiSettings=t,this.enclaveLoginContext=r,this.platformInfoService=n,this.cqrsClient=o}async execute(e){const t=e.body.userEmailAddress,r=t.slice(t.indexOf("@")+1);try{const t=await this.platformInfoService.getPlatformInfo(),n=await(async(e,t,r,n)=>{const o={enclaveApiSettings:t,httpClient:e,platformInfo:n,data:JSON.stringify({domainName:r})},i=await M(U.AUTH_REQUEST_LOGIN,o);return JSON.parse(i.decryptedResponse)})(this.httpClient,this.enclaveApiSettings,r,t),{samlToken:o}=await this.enclaveLoginContext.getSamlFromLogin(n.idpAuthorizeUrl,!0),i=await(async(e,t,r,n,o)=>{const i=btoa(atob(n).replace(/\n/g,"")),a={httpClient:e,enclaveApiSettings:t,platformInfo:o,data:JSON.stringify({domainName:r,samlResponse:i})},s=await M(U.AUTH_CONFIRM_LOGIN,a);return JSON.parse(s.decryptedResponse)})(this.httpClient,this.enclaveApiSettings,r,o,t),a={...i,login:e.body.userEmailAddress};return await this.enclaveLoginContext.redirectUserIntoLoginFlow(a),(0,l.Vp)(void 0)}catch{const{carbon:e}=this.cqrsClient.getClient($.carbonLegacyApi).commands;return e({name:"addLoginNotification",args:[{type:"UNKNOWN_ERROR",message:"Login failed."}]}),await this.enclaveLoginContext.redirectUserToLoginPage(),(0,l.Rn)({tag:"Failure",errorMessage:"Failed to login"})}}};oe=re([(0,a.CommandHandler)(c.LoginUserWithEnclaveSSOCommand),ne("design:paramtypes",[a.HttpClient,i,u,s.tu,a.CqrsClient])],oe);const ie=d.z.object({error:d.z.string()}),ae=d.z.object({data:d.z.object({samlIdpEntryPoint:d.z.string(),samlIdpCertificate:d.z.string()})}),se=async(e,t)=>{if(null===t)return{samlIdpEntryPoint:"",samlIdpCertificate:""};const r=await e({name:"parseMetadataFields",args:[{ssoIdpMetadata:t}]});if((0,l.d6)(r))return ae.parse(r.data.carbonResult).data;throw new Error("failed to parse metadata, please validate first.")},ce=d.z.object({dnsVerificationToken:d.z.string()});var ue=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},le=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let de=class{constructor(e,t,r,n,o,i){this.httpClient=e,this.enclaveApiSettings=t,this.platformInfoService=r,this.ssoProvisioningStoreUpdater=n,this.ssoProvisioningStore=o,this.carbonLegacy=i.getClient($.carbonLegacyApi)}async execute({body:e}){const{commands:{carbon:t}}=this.carbonLegacy,r=await this.ssoProvisioningStore.getState();if(!r.global.teamUuid)return(0,l.Rn)({tag:"Missing team UUID. Are you logged in?"});if(!r.global.adminProvisioningKey)return(0,l.Rn)({tag:"Missing provisioning key. Has the team been provisioned in the enclave environment?"});if(!e.domainName)return(0,l.Rn)({tag:"Domain name was not provided."});const n=r.idpMetadata.metadataValue?await se(t,r.idpMetadata.metadataValue):null,o={domainName:e.domainName,adminProvisioningKey:r.global.adminProvisioningKey,idpMetadata:n?{certificate:n.samlIdpCertificate,entrypoint:n.samlIdpEntryPoint}:void 0,teamUuid:r.global.teamUuid};try{const{dnsVerificationToken:t}=await(async(e,t,r,n)=>{const o=JSON.stringify(n),i=await e.getPlatformInfo(),{decryptedResponse:a}=await M(U.DOMAINS_PROVISION_DOMAIN,{data:o,httpClient:t,enclaveApiSettings:r,platformInfo:i});return ce.parse(JSON.parse(a))})(this.platformInfoService,this.httpClient,this.enclaveApiSettings,o);return r.domainSetup.push({domainName:e.domainName,verificationStatus:c.DomainVerificationStatus.enum.pending}),r.domainVerificationInfo[e.domainName]={txtValue:t,verificationStatus:c.DomainVerificationStatus.enum.pending,subdomainValue:G,pendingReason:null,tokenFound:null},await this.ssoProvisioningStoreUpdater.set(r),(0,l.Vp)(void 0)}catch(e){return Promise.resolve((0,l.Rn)({tag:e instanceof Error?e.message:"Unable to provision domain"}))}}};de=ue([(0,a.CommandHandler)(c.ProvisionDomainCommand),le("design:paramtypes",[a.HttpClient,i,s.tu,B,F,a.CqrsClient])],de);var pe=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},fe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let he=class{constructor(e,t,r,n,o){this.httpClient=e,this.enclaveLoginContext=t,this.enclaveApiSettings=r,this.platformInfoService=n,this.ssoProvisioningStore=o}async execute(e){const t=await this.ssoProvisioningStore.getState(),{global:{adminProvisioningKey:r}}=t,n=e.body.domainName;if(!r||!n)return(0,l.Rn)({tag:"error",errorMessage:""});try{const e=await this.platformInfoService.getPlatformInfo(),t=await(async(e,t,r,n,o)=>{const i={httpClient:e,enclaveApiSettings:t,platformInfo:o,data:JSON.stringify({domainName:r,adminProvisioningKey:n})},a=await M(U.AUTH_REQUEST_TEST_LOGIN,i);return te.parse(JSON.parse(a.decryptedResponse))})(this.httpClient,this.enclaveApiSettings,n,r,e),{samlToken:o}=await this.enclaveLoginContext.getSamlFromLogin(t.idpAuthorizeUrl,!1);return await(async(e,t,r,n,o,i)=>{const a={httpClient:e,enclaveApiSettings:t,platformInfo:i,data:JSON.stringify({domainName:r,samlResponse:n,adminProvisioningKey:o})};return await M(U.AUTH_CONFIRM_TEST_LOGIN,a),{successful:!0}})(this.httpClient,this.enclaveApiSettings,n,o,r,e),await this.enclaveLoginContext.cleanupTestLogin(),(0,l.Vp)(void 0)}catch{return(0,l.Rn)({tag:"Failure",errorMessage:"Failed to login"})}}};he=pe([(0,a.CommandHandler)(c.TestLoginUserWithEnclaveSSOCommand),fe("design:paramtypes",[a.HttpClient,u,i,s.tu,F])],he);d.z.object({domainName:d.z.string(),teamUuid:d.z.string(),adminProvisioningKey:d.z.string()});var me=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ye=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ge=class{constructor(e,t,r,n,o){this.httpClient=e,this.enclaveApiSettings=t,this.platformInfoService=r,this.ssoProvisioningStoreUpdater=n,this.ssoProvisioningStore=o}async execute({body:e}){const t=await this.ssoProvisioningStore.getState();if(!t.global.teamUuid)return(0,l.Rn)({tag:"Missing team UUID. Are you logged in?"});if(!t.global.adminProvisioningKey)return(0,l.Rn)({tag:"Missing provisioning key. Has the team been provisioned in the enclave environment?"});if(!e.domainName)return(0,l.Rn)({tag:"Missing domain name. Nothing to delete."});const r={domainName:e.domainName,teamUuid:t.global.teamUuid,adminProvisioningKey:t.global.adminProvisioningKey};try{return await(async(e,t,r,n)=>{const o=JSON.stringify(n),i=await e.getPlatformInfo();await M(U.DOMAINS_DELETE_DOMAIN,{data:o,httpClient:t,enclaveApiSettings:r,platformInfo:i})})(this.platformInfoService,this.httpClient,this.enclaveApiSettings,r),t.domainSetup=t.domainSetup.filter((t=>t.domainName!==e.domainName)),delete t.domainVerificationInfo[e.domainName],await this.ssoProvisioningStoreUpdater.set(t),(0,l.Vp)(void 0)}catch(e){const t=e instanceof Error?e.message:"Unable to delete domain.";return Promise.resolve((0,l.Rn)({tag:t}))}}};ge=me([(0,a.CommandHandler)(c.DeleteDomainCommand),ye("design:paramtypes",[a.HttpClient,i,s.tu,B,F])],ge);var ve=r(48844);const be=d.z.object({adminProvisioningKey:d.z.object({adminProvisioningKey:d.z.ostring().nullable(),itemId:d.z.ostring().nullable()}).optional().nullable()}),we=async(e,t)=>{const r=t({path:`userSession.teamAdminData.teams.${e}`}).pipe((0,ve.nb)({success:e=>{const t=be.safeParse(e);return t.success?{success:!0,value:t.data.adminProvisioningKey?.adminProvisioningKey??null}:{success:!1}},failure:()=>({success:!1})}));return await(0,f.z)(r)},Se=d.z.object({enabled:d.z.boolean()}).optional(),Re=d.z.object({data:d.z.object({teamInfo:d.z.object({uuid:d.z.ostring().nullable(),ssoServiceProviderUrl:d.z.ostring().nullable(),ssoIdpMetadata:d.z.ostring().nullable(),ssoIdpEntrypoint:d.z.ostring().nullable(),ssoEnabled:d.z.oboolean().nullable()}),capabilities:d.z.object({sso:Se})})}),Ee=async e=>{const t=await e({name:"getTeamInfo",args:[]});if("success"!==t.tag)throw new Error("failed to get team info");const{data:{teamInfo:r,capabilities:n}}=Re.parse(t.data.carbonResult);return{teamInfo:r,capabilities:n}},Oe=d.z.object({domains:d.z.array(c.Domain),updateDateUnix:d.z.number()});var Ce;!function(e){e.SsoConnector="SsoConnector",e.EncryptionService="EncryptionService"}(Ce||(Ce={}));var Pe=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Ae=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const je=(e,t,r,n)=>{if(null===e)return c.InferredSsoState.enum.Unknown;if(e){if(t)return c.InferredSsoState.enum.NitroComplete;if(n===Ce.EncryptionService)return c.InferredSsoState.enum.SelfHostedComplete;if(n===Ce.SsoConnector)return c.InferredSsoState.enum.SsoConnectorComplete}if(r){if(t)return c.InferredSsoState.enum.NitroIncomplete;if(n===Ce.EncryptionService)return c.InferredSsoState.enum.SelfHostedIncomplete;if(n===Ce.SsoConnector)return c.InferredSsoState.enum.SsoConnectorIncomplete}return c.InferredSsoState.enum.None};let _e=class{constructor(e,t,r,n,o){this.httpClient=e,this.enclaveApiSettings=t,this.platformInfoService=r,this.ssoProvisioningStoreUpdater=n,this.carbonLegacy=o.getClient($.carbonLegacyApi)}getGlobalState(e,t,r,n,o,i){const a=!!t;return{adminProvisioningKey:t,isTeamProvisionedInNitro:a,inferredSsoState:je(r,a,o,e),ssoCapable:i.sso.enabled,teamUuid:n}}getIdPApplicationState(){return{acsUrl:(e=this.enclaveApiSettings.enclaveUrl,e?`${new URL(e).origin}/saml/callback`:""),entityId:"dashlane-nitro-sso",signOnUrl:"https://app.dashlane.com"};var e}getIdPMetadataState(e){return{metadataValue:e??null}}getDomainSetupState(e){return e.map((e=>({domainName:e.domainName,verificationStatus:e.status??"pending"})))}getDomainVerificationInfo(e){return e.reduce(((e,t)=>(e[t.domainName]={txtValue:t.verificationToken,verificationStatus:c.DomainVerificationStatus.parse(t.status),subdomainValue:G,pendingReason:t.pendingReason,tokenFound:null},e)),{})}getEnableSSOState(e){return{ssoEnabled:e??null}}async fetchInitialStateInfo(e){const{queries:{carbonState:t},commands:{carbon:r}}=this.carbonLegacy,n=[we(e,t),Ee(r)],[o,{teamInfo:i,capabilities:a}]=await Promise.all(n);let s={domains:[],updateDateUnix:0},c=null;o.success&&o.value&&i.uuid&&(c=o.value,s=await(async(e,t,r,n)=>{if(!n.teamUuid||!n.adminProvisioningKey)return{domains:[],updateDateUnix:0};const o=JSON.stringify(n),i=await e.getPlatformInfo(),{decryptedResponse:a}=await M(U.TEAMS_GET_TEAM_STATUS,{data:o,httpClient:t,enclaveApiSettings:r,platformInfo:i});return Oe.parse(JSON.parse(a))})(this.platformInfoService,this.httpClient,this.enclaveApiSettings,{adminProvisioningKey:c,teamUuid:i.uuid}));const u=c?null:await(async e=>{const t=await e({name:"getEncryptionServiceConfig",args:[]});return(0,l.d6)(t)?Ce.EncryptionService:Ce.SsoConnector})(r);return{inferredLegacySsoType:u,provisioningKey:c,teamInfo:i,teamStatus:s,capabilities:a}}async execute({body:{teamId:e}}){if(!e)return(0,l.Rn)({tag:"No teamId provided. Are you logged in?"});try{await this.ssoProvisioningStoreUpdater.reset();const{inferredLegacySsoType:t,teamStatus:r,teamInfo:n,provisioningKey:o,capabilities:i}=await this.fetchInitialStateInfo(e);return n.uuid?(await this.ssoProvisioningStoreUpdater.set({global:this.getGlobalState(t,o,n.ssoEnabled??null,n.uuid,n.ssoServiceProviderUrl??"",i),idpApplication:this.getIdPApplicationState(),idpMetadata:this.getIdPMetadataState(n.ssoIdpMetadata),domainSetup:this.getDomainSetupState(r.domains),domainVerificationInfo:this.getDomainVerificationInfo(r.domains),enableSSO:this.getEnableSSOState(n.ssoEnabled)}),(0,l.Vp)(void 0)):(0,l.Rn)({tag:"No teamUUID. Are you logged in?"})}catch(e){return(0,l.Rn)({tag:e instanceof Error?e.message:"Error initializing SSO Provisioning state."})}}};_e=Pe([(0,a.CommandHandler)(c.InitSsoProvisioningCommand),Ae("design:paramtypes",[a.HttpClient,i,s.tu,B,a.CqrsClient])],_e);d.z.object({domainName:d.z.string(),teamUuid:d.z.string(),adminProvisioningKey:d.z.string(),idpMetadata:d.z.object({certificate:d.z.string().optional(),entrypoint:d.z.string().optional()})});var Te=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Ie=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let De=class{constructor(e,t,r,n,o,i){this.httpClient=e,this.enclaveApiSettings=t,this.platformInfoService=r,this.ssoProvisioningStoreUpdater=n,this.ssoProvisioningStore=o,this.carbonLegacy=i.getClient($.carbonLegacyApi)}async execute({body:e}){const t=await this.ssoProvisioningStore.getState();if(!t.global.adminProvisioningKey||!t.global.teamUuid)return(0,l.Rn)({tag:"State not yet initialized"});const{commands:{carbon:r}}=this.carbonLegacy;let n="",o="";try{const t=await se(r,e.metadata);o=t.samlIdpEntryPoint,n=t.samlIdpCertificate}catch(e){return(0,l.Rn)({tag:`Error parsing metadata. ${e instanceof Error?e.message:""}`})}try{await(async(e,{metadata:t,entrypoint:r})=>{const n={ssoIdpMetadata:t||null,ssoIdpEntrypoint:t?r:""};await e({name:"updateTeamSettings",args:[n]})})(r,{metadata:e.metadata,entrypoint:o})}catch(e){return(0,l.Rn)({tag:`Error saving metadata. ${e instanceof Error?e.message:""}`})}try{const e=t.domainSetup.map((e=>{const r=e.domainName,i={adminProvisioningKey:t.global.adminProvisioningKey??"",domainName:r,teamUuid:t.global.teamUuid??"",idpMetadata:{certificate:n,entrypoint:o}};return(async(e,t,r,n)=>{const o=JSON.stringify(n),i=await e.getPlatformInfo();await M(U.DOMAINS_UPDATE_DOMAIN,{data:o,httpClient:t,enclaveApiSettings:r,platformInfo:i})})(this.platformInfoService,this.httpClient,this.enclaveApiSettings,i)}));await Promise.all(e)}catch(e){return(0,l.Rn)({tag:`failed updating team domain in Enclave environment. ${e instanceof Error?e.message:""}`})}return await this.ssoProvisioningStoreUpdater.update({metadataValue:e.metadata},"idpMetadata"),(0,l.Vp)(void 0)}};De=Te([(0,a.CommandHandler)(c.UpdateMetadataCommand),Ie("design:paramtypes",[a.HttpClient,i,s.tu,B,F,a.CqrsClient])],De);var xe=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Ue=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Me=class{constructor(e){this.carbonLegacy=e.getClient($.carbonLegacyApi)}async execute({body:e}){const{commands:{carbon:t}}=this.carbonLegacy,r=await(async(e,t)=>{if(null===t)return;const r=await e({name:"parseMetadataFields",args:[{ssoIdpMetadata:t}]});return(0,l.d6)(r)?void 0:ie.parse(r.error).error})(t,e.metadata);return r?(0,l.Rn)({tag:r}):(0,l.Vp)(void 0)}};Me=xe([(0,a.CommandHandler)(c.ValidateMetadataCommand),Ue("design:paramtypes",[a.CqrsClient])],Me);var Le=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Ne=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ke=class{constructor(e,t,r){this.ssoProvisioningStoreUpdater=e,this.ssoProvisioningStore=t,this.carbonLegacy=r.getClient($.carbonLegacyApi)}async execute(){if((await this.ssoProvisioningStore.getState()).enableSSO.ssoEnabled)return(0,l.Rn)({tag:"SSO is already enabled"});try{const{commands:{carbon:e}}=this.carbonLegacy,t=await(async(e,{ssoEnabled:t})=>{const r=await e({name:"updateTeamSettings",args:[{ssoEnabled:t}]});return!(0,l.hx)(r)})(e,{ssoEnabled:!0});if(!t)return(0,l.Rn)({tag:"Something went wrong. Please contact our Customer Support."});await this.ssoProvisioningStoreUpdater.update({inferredSsoState:c.InferredSsoState.enum.NitroComplete},"global"),await this.ssoProvisioningStoreUpdater.update({ssoEnabled:!0},"enableSSO")}catch(e){return(0,l.Rn)({tag:"Unknown error"+(e instanceof Error?`: ${e.message}`:".")})}return(0,l.Vp)(void 0)}};ke=Le([(0,a.CommandHandler)(c.EnableSsoCommand),Ne("design:paramtypes",[B,F,a.CqrsClient])],ke);const Fe=d.z.object({});var Ve=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},qe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ge=class{constructor(e,t,r,n,o,i){this.httpClient=e,this.enclaveApiSettings=t,this.platformInfoService=r,this.ssoProvisioningStoreUpdater=n,this.ssoProvisioningStore=o,this.carbonLegacy=i.getClient($.carbonLegacyApi)}async execute(){const{global:e,enableSSO:t}=await this.ssoProvisioningStore.getState(),{carbon:r}=this.carbonLegacy.commands;if(t.ssoEnabled)return(0,l.Rn)({tag:"SSO Already enabled"});if(!e.teamUuid)return(0,l.Rn)({tag:"Missing team UUID. Are you logged in?"});if(!e.adminProvisioningKey)return(0,l.Rn)({tag:"Missing provisioning key. Has the team been provisioned in the enclave environment?"});if(e.isTeamProvisionedInNitro){const t={teamUuid:e.teamUuid,adminProvisioningKey:e.adminProvisioningKey};try{await(async(e,t,r,n)=>{const o=JSON.stringify(n),i=await e.getPlatformInfo(),{decryptedResponse:a}=await M(U.TEAMS_DELETE_TEAM,{data:o,httpClient:t,enclaveApiSettings:r,platformInfo:i});return Fe.parse(JSON.parse(a))})(this.platformInfoService,this.httpClient,this.enclaveApiSettings,t)}catch(e){return(0,l.Rn)({tag:e instanceof Error?e.message:"Error deleting team in Nitro."})}try{await J(r,{ssoServiceProviderUrl:null,ssoIdpMetadata:null,ssoIdpEntrypoint:null})}catch(e){return(0,l.Rn)({tag:e instanceof Error?e.message:"Error updating team settings."})}}if(e.adminProvisioningKey)try{await r({name:"removeAdminProvisioningKey",args:[]})}catch(e){return(0,l.Rn)({tag:e instanceof Error?e.message:"Error removing provisioning key."})}return await this.ssoProvisioningStoreUpdater.reset(),(0,l.Vp)(void 0)}};Ge=Ve([(0,a.CommandHandler)(c.ClearSettingsCommand),qe("design:paramtypes",[a.HttpClient,i,s.tu,B,F,a.CqrsClient])],Ge);var Be=r(87065),He=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},We=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ke=class{constructor(e,t,r){this.httpClient=e,this.enclaveApiSettings=t,this.ssoProvisioningStore=r}execute(){return this.ssoProvisioningStore.state$.pipe((0,Be.U)((e=>(0,l.Vp)(e))))}};Ke=He([(0,a.QueryHandler)(c.SsoProvisioningQuery),We("design:paramtypes",[a.HttpClient,i,F])],Ke);var ze=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let $e=class{};$e=ze([(0,a.Module)({api:c.enclaveSdkApi,handlers:{commands:{loginUserWithEnclaveSSO:oe,provisionDomain:de,createTeam:ee,deleteDomain:ge,testLoginUserWithEnclaveSSO:he,initSsoProvisioning:_e,validateMetadata:Me,updateMetadata:De,checkDNSValidation:z,enableSso:ke,clearSettings:Ge},events:{},queries:{ssoProvisioning:Ke}},configurations:{enclaveApiSettings:{token:i},enclaveLoginContextInfrastructure:{token:u}},imports:[a.HttpModule,s.iT],stores:[F],providers:[B]})],$e)},70630:(e,t,r)=>{"use strict";r.d(t,{X:()=>m});var n=r(7165),o=r(21763),i=r(839);const a={addListener:function(e){if(!(0,i.Ez)("tabs.onUpdated.addListener"))throw new Error("No tabs.onUpdated.addListener support");const t=(t,r,n)=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`tabs/onUpdated: ${e}`)}return e(t,r,n)};return chrome.tabs.onUpdated.addListener(t),t},removeListener:function(e){if(!(0,i.Ez)("tabs.onUpdated.removeListener"))throw new Error("No tabs.onUpdated.removeListener support");chrome.tabs.onUpdated.removeListener(e)}};const s={addListener:function(e){if(!(0,i.Ez)("tabs.onRemoved.addListener"))throw new Error("No tabs.onRemoved.addListener support");const t=(t,r)=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`tabs/onRemoved: ${e}`)}return e(t,r)};return chrome.tabs.onRemoved.addListener(t),t},removeListener:function(e){if(!(0,i.Ez)("tabs.onRemoved.removeListener"))throw new Error("No tabs.onRemoved.removeListener support");chrome.tabs.onRemoved.removeListener(e)}};const c={addListener:function(e){const t=(t,r,n)=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`runtime/onMessage: ${e}`)}return e(t,r,n)};if(!(0,i.Ez)("runtime.onMessage.addListener"))throw new Error("No runtime.onMessage.addListener support");return chrome.runtime.onMessage.addListener(t),t},removeListener:function(e){chrome.runtime.onMessage.removeListener(e)}};var u=r(31460),l=r(72733),d=r(24715),p=r(61222),f=r(92204),h=r(49259);class m{constructor(){this.interceptedTabId=void 0,this.originalTabId=void 0,this.samlReceived=!1}interceptSamlFromTab(e,t,r){const i=n.z.object({type:n.z.string(),saml:n.z.string()}),u=a.addListener(((t,r)=>{t===e.id&&r.url&&e.id&&(0,o.k)({target:{tabId:e.id,allFrames:!0},files:["content/contentScripts/dashlane_saml_intercept_script.js"],injectImmediately:!0})})),l=s.addListener((t=>{t===e.id&&(a.removeListener(u),s.removeListener(l),c.removeListener(d),r("Intercepting SAML - tab closed unexpectedly"))})),d=c.addListener((e=>{if(this.samlReceived)return!1;const r=i.safeParse(e);return!(!r.success||"SamlAssertionIntercepted"!==r.data.type)&&(this.samlReceived=!0,a.removeListener(u),s.removeListener(l),c.removeListener(d),t({samlToken:r.data.saml}),!0)}))}async redirectTabToUrl(e){if(this.interceptedTabId)return await(0,u.V)(this.interceptedTabId,{url:e});{const t=(await(0,l.T)({windowTypes:["normal"]})).id;return await(0,d.U)({windowId:t,url:e})}}async getActiveExtensionTabId(){const e=await(0,p.I)({currentWindow:!0,active:!0}),t=e.length>0?e[0]:null,r=(0,f.A)("");if(t?.id&&t.url?.includes(r))return t.id}getSamlFromLogin(e,t){return this.samlReceived=!1,this.originalTabId=void 0,new Promise(((r,n)=>{const o=()=>{(0,d.U)({url:e}).then((e=>{this.interceptedTabId=e.id,this.interceptSamlFromTab(e,r,n)}))},i=t=>{(0,u.V)(t,{url:e}).then((e=>{if(!e)throw new Error("Tab disappeared during nitro login");this.interceptedTabId=e.id,this.interceptSamlFromTab(e,r,n)}))};t?this.getActiveExtensionTabId().then((e=>{e?i(e):o()})):this.getActiveExtensionTabId().then((e=>{this.originalTabId=e,o()}))}))}async redirectUserIntoLoginFlow(e){const t={ssoToken:e.ssoToken,exists:e.exists,currentAuths:e.currentAuthenticationMethods,expectedAuths:e.expectedAuthenticationMethods,key:e.userServiceProviderKey,login:e.login},r=Object.entries(t).map((e=>`${e[0]}=${encodeURIComponent(e[1].toString())}`)).join("&"),n=(0,f.A)(`index.html#/sso?${r}`);await this.redirectTabToUrl(n)}async redirectUserToLoginPage(){const e=(0,f.A)("index.html#/login");await this.redirectTabToUrl(e)}async cleanupTestLogin(){this.interceptedTabId&&await(0,h.O)([this.interceptedTabId]),this.originalTabId&&(0,u.V)(this.originalTabId,{active:!0})}}},71511:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.antiphishingApi=void 0;const n=r(68224),o=r(5548),i=r(45337);t.antiphishingApi=(0,n.defineModuleApi)({name:"antiphishing",commands:{addAutoRedirectedDomain:i.AddAutoRedirectedDomainCommand},events:{},queries:{isAutoRedirectedDomain:o.IsAutoRedirectedDomainQuery}})},92556:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AddAutoRedirectedDomainCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.AddAutoRedirectedDomainCommand=o},45337:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(92556),t)},63248:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(71511),t),o(r(5548),t),o(r(45337),t)},5548:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(36385),t)},36385:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IsAutoRedirectedDomainQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)()){}t.IsAutoRedirectedDomainQuery=o},99863:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.breachesApi=void 0;const n=r(68224),o=r(46368),i=r(57371);t.breachesApi=(0,n.defineModuleApi)({name:"breaches",commands:{dismissBreach:o.DismissBreachCommand,markBreachAsSeen:o.MarkBreachAsSeenCommand},events:{},queries:{breach:i.BreachQuery}})},27232:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BreachLeakedDataType=t.BreachState=void 0,function(e){e.PENDING="PENDING",e.VIEWED="VIEWED",e.ACKNOWLEDGED="ACKNOWLEDGED"}(t.BreachState||(t.BreachState={})),function(e){e.Username="username",e.Password="password",e.Email="email",e.CreditCard="creditcard",e.Phone="phone",e.Address="address",e.SSN="ssn",e.IP="ip",e.Location="geolocation",e.PersonalInfo="personalinfo",e.SocialNetwork="social"}(t.BreachLeakedDataType||(t.BreachLeakedDataType={}))},57991:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DismissBreachCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.DismissBreachCommand=o},46368:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(57991),t),o(r(41010),t)},41010:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MarkBreachAsSeenCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.MarkBreachAsSeenCommand=o},91132:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(99863),t),o(r(46368),t),o(r(57371),t),o(r(27232),t)},77587:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BreachQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.BreachQuery=o},57371:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(77587),t)},36573:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.emailMonitoringApi=void 0;const n=r(68224),o=r(91931),i=r(64036);t.emailMonitoringApi=(0,n.defineModuleApi)({name:"emailMonitoring",commands:{dismissOnboardingNotification:o.DismissOnboardingNotificationCommand,optinEmail:o.OptinEmailCommand,optoutEmail:o.OptoutEmailCommand},events:{},queries:{emailList:i.EmailsListQuery,onboardingNotificationState:i.OnboardingNotificationStateQuery,domainIcon:i.DomainIconQuery}})},43710:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DismissOnboardingNotificationCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.DismissOnboardingNotificationCommand=o},91931:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(43710),t),o(r(6503),t),o(r(43123),t)},6503:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OptinEmailCommand=t.OptinGenericError=t.OptinTooManySubscriptionsError=t.OptinAlreadySubscribedError=t.OptinInvalidEmailError=t.OptinDataLeaksResultErrorCode=t.OptinDataLeaksResultOkCode=void 0;const n=r(68224),o=r(58807);var i;t.OptinDataLeaksResultOkCode="OK",function(e){e.INVALID_EMAIL="EMAIL_IS_INVALID",e.ALREADY_SUBSCRIBED="USER_HAS_ALREADY_AN_ACTIVE_SUBSCRIPTION",e.TOO_MANY_SUBSCRIPTIONS="USER_HAS_TOO_MANY_SUBSCRIPTIONS",e.GENERIC_ERROR="GENERIC_ERROR"}(i=t.OptinDataLeaksResultErrorCode||(t.OptinDataLeaksResultErrorCode={}));class a extends((0,o.FunctionalError)(i.INVALID_EMAIL,"")){}t.OptinInvalidEmailError=a;class s extends((0,o.FunctionalError)(i.ALREADY_SUBSCRIBED,"")){}t.OptinAlreadySubscribedError=s;class c extends((0,o.FunctionalError)(i.TOO_MANY_SUBSCRIPTIONS,"")){}t.OptinTooManySubscriptionsError=c;class u extends((0,o.FunctionalError)(i.GENERIC_ERROR,"")){}t.OptinGenericError=u;class l extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.OptinEmailCommand=l},43123:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OptoutEmailCommand=t.OptoutGenericError=t.OptoutNoSubscriptionError=t.OptoutInvalidEmailError=t.OptoutDataLeaksResultErrorCode=t.OptoutDataLeaksResultOkCode=void 0;const n=r(68224),o=r(58807);var i;t.OptoutDataLeaksResultOkCode="OK",function(e){e.INVALID_EMAIL="EMAIL_IS_INVALID",e.NO_SUBSCRIPTION="USER_HAS_NO_SUBSCRIPTION",e.GENERIC_ERROR="GENERIC_ERROR"}(i=t.OptoutDataLeaksResultErrorCode||(t.OptoutDataLeaksResultErrorCode={}));class a extends((0,o.FunctionalError)(i.INVALID_EMAIL,"")){}t.OptoutInvalidEmailError=a;class s extends((0,o.FunctionalError)(i.NO_SUBSCRIPTION,"")){}t.OptoutNoSubscriptionError=s;class c extends((0,o.FunctionalError)(i.GENERIC_ERROR,"")){}t.OptoutGenericError=c;class u extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.OptoutEmailCommand=u},47725:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconMapSchema=t.IconSchema=void 0;const n=r(10295),o=["crawled","xs","sm","sm@2x","md","md.tiff","xmd","xmd@2x","l","l@2x","xl","xl@2x","46x30","46x30@2x","50x33","50x33@2x","56x56","56x56@2x","118x98","118x98@2x","160x106","160x106@2x"],i=(n.z.enum(o),o.reduce(((e,t)=>e.setKey(t,n.z.string().optional().nullable())),n.z.object({})));t.IconSchema=n.z.object({backgroundColor:n.z.string(),mainColor:n.z.string(),urls:i}),t.IconMapSchema=n.z.map(n.z.string(),t.IconSchema)},39469:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDarkWebOnboardingState=t.DarkWebOnboardingState=void 0,function(e){e.UNKNOWN="UNKNOWN",e.SEEN="SEEN",e.NOT_SEEN="NOT_SEEN"}(t.DarkWebOnboardingState||(t.DarkWebOnboardingState={})),t.isDarkWebOnboardingState=function(e){return"UNKNOWN"===e||"SEEN"===e||"NOT_SEEN"===e}},80649:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(36573),t),o(r(91931),t),o(r(64036),t),o(r(39469),t),o(r(47725),t)},90793:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DomainIconQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.DomainIconQuery=o},66339:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmailsListQuery=t.isDataLeaksEmailStatus=t.DataLeaksEmailStatus=void 0;const n=r(68224);!function(e){e.PENDING="pending",e.ACTIVE="active",e.DISABLED="disabled"}(t.DataLeaksEmailStatus||(t.DataLeaksEmailStatus={})),t.isDataLeaksEmailStatus=function(e){return"pending"===e||"active"===e||"disabled"===e};class o extends((0,n.defineQuery)()){}t.EmailsListQuery=o},64036:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(66339),t),o(r(28478),t),o(r(90793),t)},28478:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OnboardingNotificationStateQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.OnboardingNotificationStateQuery=o},51465:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(80649),t),o(r(91132),t),o(r(95789),t),o(r(64197),t),o(r(63248),t),o(r(15632),t),o(r(11216),t)},26328:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.masterPasswordSecurityApi=void 0;const n=r(68224),o=r(31883),i=r(40495);t.masterPasswordSecurityApi=(0,n.defineModuleApi)({name:"masterPasswordSecurity",commands:{dismissMasterPasswordLeakedNotification:o.DismissMasterPasswordLeakedNotificationCommand,temporaryCheckMasterPassword:o.TemporaryCheckMasterPasswordCommand,temporaryResetMasterPasswordLeaked:o.TemporaryResetMasterPasswordLeakedCommand},events:{},queries:{isMasterPasswordLeaked:i.IsMasterPasswordLeakedQuery,isMasterPasswordLeakedNotificationDismissed:i.IsMasterPasswordLeakedNotificationDismissedQuery,lastCheckTimestamp:i.LastCheckTimestampQuery}})},21651:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DismissMasterPasswordLeakedNotificationCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.DismissMasterPasswordLeakedNotificationCommand=o},31883:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(21651),t),o(r(33750),t),o(r(93122),t)},33750:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TemporaryCheckMasterPasswordCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.TemporaryCheckMasterPasswordCommand=o},93122:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TemporaryResetMasterPasswordLeakedCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.TemporaryResetMasterPasswordLeakedCommand=o},11216:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(26328),t),o(r(40495),t),o(r(31883),t)},40495:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(21621),t),o(r(56507),t),o(r(70905),t)},56507:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IsMasterPasswordLeakedNotificationDismissedQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)()){}t.IsMasterPasswordLeakedNotificationDismissedQuery=o},21621:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IsMasterPasswordLeakedQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)()){}t.IsMasterPasswordLeakedQuery=o},70905:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LastCheckTimestampQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)()){}t.LastCheckTimestampQuery=o},38054:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.otpApi=void 0;const n=r(68224),o=r(71940);t.otpApi=(0,n.defineModuleApi)({name:"otp",commands:{},events:{},queries:{otpCode:o.OtpCodeQuery}})},15632:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(38054),t),o(r(71940),t)},71940:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(73542),t)},73542:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OtpCodeQuery=t.OtpCodeGenerationError=void 0;const n=r(68224),o=r(58807);class i extends((0,o.FunctionalError)("Cannot generate OTP code due to no OtpSecret or OtpUrl found","")){}t.OtpCodeGenerationError=i;class a extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.OtpCodeQuery=a},35592:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.passwordHealthApi=void 0;const n=r(68224),o=r(33898),i=r(24581),a=r(92776);t.passwordHealthApi=(0,n.defineModuleApi)({name:"passwordHealth",commands:{updateIsCredentialExcluded:o.UpdateIsCredentialExcludedCommand,recalculatePasswordHealth:o.RecalculatePasswordHealthCommand},events:{passwordHealthComputationFinished:i.PasswordHealthComputationFinishedEvent},queries:{credentialHealthData:a.CredentialHealthDataQuery,filterCredentials:a.FilterCredentialsQuery,score:a.ScoreQuery,compromisedCredentials:a.CompromisedCredentialsQuery,passwordHealthReport:a.PasswordHealthReportQuery}})},35297:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateIsCredentialExcludedCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.UpdateIsCredentialExcludedCommand=o},33898:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(35297),t),o(r(929),t)},929:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RecalculatePasswordHealthCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.RecalculatePasswordHealthCommand=o},24581:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(41016),t)},41016:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordHealthComputationFinishedEvent=void 0;const n=r(68224);class o extends((0,n.defineEvent)({scope:n.UseCaseScope.User})){}t.PasswordHealthComputationFinishedEvent=o},95789:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(35592),t),o(r(92776),t),o(r(33898),t),o(r(24581),t),o(r(24316),t)},24316:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CorruptionDataSeverity=t.CorruptionDataStrength=t.HealthFilter=t.RiskType=void 0,function(e){e.Weak="weak",e.Reused="reused",e.Compromised="compromised",e.Excluded="excluded"}(t.RiskType||(t.RiskType={})),function(e){e.All="all",e.Weak="weak",e.Reused="reused",e.Compromised="compromised",e.Excluded="excluded"}(t.HealthFilter||(t.HealthFilter={})),function(e){e.WEAK="weak",e.EXTREMELY_WEAK="extremely_weak"}(t.CorruptionDataStrength||(t.CorruptionDataStrength={})),function(e){e.COMMON="common",e.STRONG="strong"}(t.CorruptionDataSeverity||(t.CorruptionDataSeverity={}))},22234:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CompromisedCredentialsQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.CompromisedCredentialsQuery=o},25737:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CredentialHealthDataQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.CredentialHealthDataQuery=o},40938:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilterCredentialsQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.FilterCredentialsQuery=o},92776:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(25737),t),o(r(50270),t),o(r(40938),t),o(r(22234),t),o(r(74848),t)},74848:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordHealthReportQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.PasswordHealthReportQuery=o},50270:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScoreQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.ScoreQuery=o},74355:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vaultReportApi=void 0;const n=r(68224);t.vaultReportApi=(0,n.defineModuleApi)({name:"vaultReport",commands:{},events:{},queries:{}})},64197:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(74355),t)},83917:(e,t,r)=>{"use strict";r.d(t,{v5:()=>on,tQ:()=>Se,Ss:()=>J,fI:()=>po,fj:()=>xn,Cg:()=>Pr,E0:()=>zr});var n=r(27606),o=r(51465),i=r(87065),a=r(6136),s=r(43978),c=r(90171),u=r(69885),l=r(87279);function d(e){return{...e,onboardingStatus:o.DarkWebOnboardingState.SEEN}}var p=r(68224),f=r(45059);const h=e=>(e=>!(!e||"object"!=typeof e)&&"onboardingStatus"in e&&"emails"in e)(e)&&(0,o.isDarkWebOnboardingState)(e.onboardingStatus)&&Array.isArray(e.emails);class m extends((0,n.defineStore)({persist:!0,storage:{schemaVersion:1,initialValue:{onboardingStatus:o.DarkWebOnboardingState.NOT_SEEN,emails:[]},typeGuard:h},scope:p.UseCaseScope.User,storeName:"email-monitoring-state",storeTypeGuard:h,codec:f.Eu})){}var y=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},g=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let v=class{constructor(e){this.store=e}async execute(){await this.store.update(d)}};v=y([(0,n.Injectable)(),g("design:paramtypes",[m])],v);var b=r(48844),w=r(11103),S=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},R=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let E=class{constructor(e,t){this.serverApiClient=e,this.store=t,this.execute=()=>{this.serverApiClient.v1.darkwebmonitoring.listRegistrations({}).pipe((0,b.Qn)((({data:e})=>e.emails.map((e=>({email:e.email,state:(0,o.isDataLeaksEmailStatus)(e.state)?e.state:o.DataLeaksEmailStatus.PENDING}))))),(0,b.Qn)((e=>{this.store.update((t=>({...t,emails:e})))})),(0,b.DZ)((e=>{throw e}))).subscribe()}}};E=S([(0,n.Injectable)(),R("design:paramtypes",[w.lX,m])],E);var O=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},C=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let P=class{constructor(e,t){this.syncMonitoredEmails=e,this.store=t}execute(){this.syncMonitoredEmails.execute();return this.store.state$.pipe((0,i.U)((e=>e.emails)),(0,a.x)(((e,t)=>JSON.stringify(e)===JSON.stringify(t))),(0,i.U)((e=>(0,l.Vp)(e)))).pipe((0,s.w)((e=>{const t=()=>(this.syncMonitoredEmails.execute(),e),r=e=>(0,c.H)(0,e).pipe((0,s.w)((()=>(0,u.of)(t()))));return(0,l.hx)(e)||e.data.some((e=>e.state===o.DataLeaksEmailStatus.PENDING))?r(3e4):(0,u.of)(e)})))}};P=O([(0,n.QueryHandler)(o.EmailsListQuery),C("design:paramtypes",[E,m])],P);var A=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},j=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let _=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,i.U)((e=>(0,l.Vp)(e.onboardingStatus))))}};_=A([(0,n.QueryHandler)(o.OnboardingNotificationStateQuery),j("design:paramtypes",[m])],_);var T=r(96303),I=r(54066),D=r(53576);var x=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},U=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let M=class{constructor(e){this.client=e}get(){const{queries:{carbonState:e}}=this.client.getClient(D.carbonLegacyApi);return e({path:"userSession.iconsCache.domains"}).pipe((0,b.Qn)((e=>{if(!(e=>o.IconMapSchema.safeParse(e).success)(e))throw new Error("Bad domain icons cache format ");return e})))}};M=x([(0,n.Injectable)(),U("design:paramtypes",[n.CqrsClient])],M);var L=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},N=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let k=class{constructor(e,t){this.domainIconsGetter=e,this.md5Hasher=t}execute({body:{domain:e}}){return this.domainIconsGetter.get().pipe((0,b.Qn)((t=>t.get((0,T.k)(this.md5Hasher.compute((0,I.u)(e)))))))}};k=L([(0,n.QueryHandler)(o.DomainIconQuery),N("design:paramtypes",[M,w.ft])],k);var F=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},V=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let q=class{constructor(e){this.dismissOnboardingNotificationService=e}async execute(){return await this.dismissOnboardingNotificationService.execute(),Promise.resolve((0,l.Vp)(void 0))}};q=F([(0,n.CommandHandler)(o.DismissOnboardingNotificationCommand),V("design:paramtypes",[v])],q);var G=r(60399),B=r(82567),H=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},W=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let K=class{constructor(e,t){this.serverApiClient=e,this.store=t}async execute({body:{email:e}}){return await(0,G.z)(this.serverApiClient.v1.darkwebmonitoring.registerEmail({email:e}).pipe((0,b.DZ)((e=>{throw new Error(e.message)})),(0,b.lk)((e=>e.data.result===o.OptinDataLeaksResultOkCode?(0,l.Vp)(void 0):(0,l.Rn)((e=>{switch(e){case o.OptinDataLeaksResultErrorCode.INVALID_EMAIL:return new o.OptinInvalidEmailError;case o.OptinDataLeaksResultErrorCode.ALREADY_SUBSCRIBED:return new o.OptinAlreadySubscribedError;case o.OptinDataLeaksResultErrorCode.TOO_MANY_SUBSCRIPTIONS:return new o.OptinTooManySubscriptionsError;default:return new o.OptinGenericError}})(e.data.result)))),(0,B.b)((async t=>{(0,l.d6)(t)&&await this.store.update((t=>({...t,emails:[...t.emails,{email:e,state:o.DataLeaksEmailStatus.PENDING}]})))}))))}};K=H([(0,n.CommandHandler)(o.OptinEmailCommand),W("design:paramtypes",[w.lX,m])],K);var z=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},$=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Q=class{constructor(e,t){this.serverApiClient=e,this.store=t,this.getFunctionalError=e=>{switch(e){case o.OptoutDataLeaksResultErrorCode.NO_SUBSCRIPTION:return new o.OptoutNoSubscriptionError;case o.OptoutDataLeaksResultErrorCode.INVALID_EMAIL:return new o.OptoutInvalidEmailError;case o.OptoutDataLeaksResultErrorCode.GENERIC_ERROR:default:return new o.OptoutGenericError}}}async execute({body:{email:e}}){return await(0,G.z)(this.serverApiClient.v1.darkwebmonitoring.deregisterEmail({email:e}).pipe((0,b.DZ)((e=>{throw new Error(e.message)})),(0,b.lk)((e=>e.data.result===o.OptoutDataLeaksResultOkCode?(0,l.Vp)(void 0):(0,l.Rn)(this.getFunctionalError(e.data.result)))),(0,B.b)((async t=>{(0,l.d6)(t)&&await this.store.update((t=>({...t,emails:[...t.emails.filter((t=>t.email!==e))]})))}))))}};Q=z([(0,n.CommandHandler)(o.OptoutEmailCommand),$("design:paramtypes",[w.lX,m])],Q);var Y=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let J=class{};J=Y([(0,n.Module)({api:o.emailMonitoringApi,stores:[m],handlers:{commands:{dismissOnboardingNotification:q,optinEmail:K,optoutEmail:Q},events:{},queries:{emailList:P,onboardingNotificationState:_,domainIcon:k}},imports:[w.nr,w.Dq],providers:[v,E,M]})],J);var X=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Z=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ee=class{constructor(e){this.client=e}async execute({body:e}){const{commands:{carbon:t}}=this.client.getClient(D.carbonLegacyApi);return await t({name:"updateBreachStatus",args:[{id:e.id,status:o.BreachState.ACKNOWLEDGED}]}),Promise.resolve((0,l.Vp)(void 0))}};ee=X([(0,n.CommandHandler)(o.DismissBreachCommand),Z("design:paramtypes",[n.CqrsClient])],ee);var te=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},re=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ne=class{constructor(e){this.client=e}async execute({body:e}){const{commands:{carbon:t}}=this.client.getClient(D.carbonLegacyApi);return await t({name:"updateBreachStatus",args:[{id:e.id,status:o.BreachState.VIEWED}]}),Promise.resolve((0,l.Vp)(void 0))}};ne=te([(0,n.CommandHandler)(o.MarkBreachAsSeenCommand),re("design:paramtypes",[n.CqrsClient])],ne);var oe=r(61076);const ie=e=>"object"==typeof e,ae=e=>(e=>ie(e)&&"breachModelVersion"in e&&"number"==typeof e.breachModelVersion)(e)&&1===e.breachModelVersion&&"domains"in e&&Array.isArray(e.domains)&&"eventDate"in e&&"string"==typeof e.eventDate&&"id"in e&&"string"==typeof e.id,se=e=>{return ie(t=e)&&"kwType"in t&&"string"==typeof t.kwType&&"KWSecurityBreach"===t.kwType&&ae(e.Content);var t},ce=e=>(e=>{const t=e;return"impactedEmails"in t&&Array.isArray(t.impactedEmails)})(e)&&e.impactedEmails.length>0,ue=e=>se(e)&&ce(e.Content),le=({name:e,domains:t})=>{if(e)return e;if(t.length>0){const[e]=t;return e}return""},de=e=>ue(e)?"private":"public",pe=e=>[...e.reduce(((e,t)=>{const r=e.get(t.BreachId);return(!r||r.LastBackupTime&&t.LastBackupTime&&r.LastBackupTime<t.LastBackupTime)&&e.set(t.BreachId,t),e}),new Map).values()],fe=(e,t,r)=>{const n=pe(e.filter(se)).find((e=>e.Id===t));if(!n)throw new Error("Breach not found");return(0,l.Vp)(((e,t)=>{const r=e.Content,n=ue(e)?e.Content.impactedEmails:[],i=new Set;for(const r in t.credentialsHealth)t.credentialsHealth[r].credentialBreachIds.includes(e.BreachId)&&i.add(r);return{anonId:e.AnonId??"",breachId:e.BreachId,breachType:de(e),domains:r.domains,eventDate:r.eventDate,id:e.Id,impactedEmails:n,kwType:e.kwType??"KWSecurityBreach",leakedData:r.leakedData??[],leakedPasswords:e.LeakedPasswords??[],name:le(r),status:e.Status??o.BreachState.PENDING,compromisedCredentialIds:[...i]}})(n,r))},he=e=>void 0===e||"string"==typeof e,me=e=>void 0===e||"number"==typeof e,ye=e=>{if(!e||!Array.isArray(e))return!1;if(0===e.length)return!0;const t=e[0];return"string"==typeof t.Id&&me(t.LastBackupTime)&&he(t.kwType)&&he(t.AnonId)&&he(t.BreachId)&&me(t.ContentRevision)};var ge=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ve=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let be=class{constructor(e){this.client=e}execute({body:e}){const{id:t}=e,{queries:{carbonState:r}}=this.client.getClient(D.carbonLegacyApi),n=r({path:"userSession.health"}).pipe((0,b.Qn)((e=>{if(!(e=>{if("object"!=typeof e||null===e)return!1;const t=e;return!!t.breachedPasswords&&!!t.credentialsHealth&&!!t.similarPasswords})(e))throw new Error("Bad health format");return e})));return r({path:"userSession.personalData.securityBreaches"}).pipe((0,b.Qn)((e=>{if(!ye(e))throw new Error("Bad Breaches format");return e})),(0,oe.V)(n),(0,i.U)((([e,r])=>{if((0,l.hx)(e)||(0,l.hx)(r))throw new Error("Error while fetching data");return fe(e.data,t,r.data)})))}};be=ge([(0,n.QueryHandler)(o.BreachQuery),ve("design:paramtypes",[n.CqrsClient])],be);var we=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let Se=class{};Se=we([(0,n.Module)({api:o.breachesApi,handlers:{commands:{dismissBreach:ee,markBreachAsSeen:ne},events:{},queries:{breach:be}}})],Se);var Re=r(28489);const Ee=e=>"object"==typeof e&&null!==e&&(0,Re.l$)(e,"credentialsAtRisk")&&(0,Re.l$)(e,"index")&&"object"==typeof e.credentialsAtRisk&&"object"==typeof e.index;class Oe extends((0,n.defineStore)({persist:!0,storage:{initialValue:{credentialsAtRisk:{},index:{}},typeGuard:Ee,schemaVersion:1},scope:p.UseCaseScope.User,storeName:"password-health-state",storeTypeGuard:Ee,codec:f.Eu,isCache:!0})){}const Ce=e=>{const t={};if(!Object.keys(e).length)return t;for(const r in e){if(!e[r])continue;const n=e[r]?.spaceId??"";void 0===t[n]&&(t[n]={[o.RiskType.Reused]:[],[o.RiskType.Weak]:[],[o.RiskType.Compromised]:[],[o.RiskType.Excluded]:[],corruptedCount:0,importantCorruptedCount:0}),e[r]?.excluded?t[n][o.RiskType.Excluded].push(r):(t[n].corruptedCount++,e[r]?.isImportant&&t[n].importantCorruptedCount++,e[r]?.risks.forEach((e=>t[n][e.riskType].push(r))))}return t};var Pe=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Ae=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let je=class{constructor(e,t){this.store=e,this.client=t}async execute({body:e}){const{commands:{carbon:t}}=this.client.getClient(D.carbonLegacyApi);return await t({name:"updateCredential",args:[{id:e.credentialId,update:{isExcludedFromHealth:e.excluded}}]}),this.store.update((t=>{const r={...t.credentialsAtRisk[e.credentialId],excluded:e.excluded},n={...t};return n.credentialsAtRisk[e.credentialId]=r,n.index=Ce(t.credentialsAtRisk),n})),Promise.resolve((0,l.Vp)(void 0))}};je=Pe([(0,n.CommandHandler)(o.UpdateIsCredentialExcludedCommand),Ae("design:paramtypes",[Oe,n.CqrsClient])],je);var _e=r(7165);const Te=_e.z.object({isOutdated:_e.z.literal(!0),lastUpdateTimestamp:_e.z.number(),updatedCredentialIds:_e.z.record(_e.z.string()),deletedCredentialIds:_e.z.record(_e.z.string()),hasUpdatedBreaches:_e.z.boolean()}),Ie=_e.z.object({isOutdated:_e.z.literal(!1),lastUpdateTimestamp:_e.z.number()}),De=_e.z.discriminatedUnion("isOutdated",[Te,Ie]),xe=e=>De.safeParse(e).success;class Ue extends((0,n.defineStore)({persist:!0,storage:{initialValue:{isOutdated:!1,lastUpdateTimestamp:0},typeGuard:xe,schemaVersion:1},scope:p.UseCaseScope.User,storeName:"health-cache-state",storeTypeGuard:xe,codec:f.Eu,isCache:!0})){}var Me=r(64987);var Le=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Ne=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ke=class{constructor(e){this.client=e}getSupportedBreaches(){const{queries:{carbonState:e}}=this.client.getClient(D.carbonLegacyApi);return e({path:"userSession.personalData.securityBreaches"}).pipe((0,b.Qn)((e=>{if(!ye(e))throw new Error("Bad Breaches format");return e})),(0,b.Qn)((e=>e.filter(se))))}get(){const{queries:{carbonState:e}}=this.client.getClient(D.carbonLegacyApi);return e({path:"userSession.personalData.securityBreaches"}).pipe((0,b.Qn)((e=>{if(!ye(e))throw new Error("Bad Breaches format");return e})),(0,b.Qn)((e=>pe(e.filter(se)))))}};ke=Le([(0,n.Injectable)(),Ne("design:paramtypes",[n.CqrsClient])],ke);var Fe=r(92210);const Ve=e=>void 0===e||"string"==typeof e,qe=e=>void 0===e||"string"==typeof e||"boolean"==typeof e;var Ge=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Be=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let He=class{constructor(e){this.client=e}vaultBooleanFormatter(e,t=!1){return void 0===e?t:"string"==typeof e?"true"===e.toLocaleLowerCase():e}get(){const{queries:{carbonState:e}}=this.client.getClient(D.carbonLegacyApi),t=e({path:"state.userSession.spaceData.spaces"}).pipe((0,b.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.teamId&&"object"==typeof t.details&&"string"==typeof t.details.status}))))(e))throw new Error("Bad space item format");return new Set(e.filter((e=>"accepted"===e.details.status)).map((e=>e.teamId)))}))),r=e({path:"userSession.sharingData.items"}).pipe((0,b.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.content&&"string"==typeof t.itemId&&"number"==typeof t.timestamp}))))(e))throw new Error("Bad shared items format");return e.map((e=>e.itemId))})));return e({path:"state.userSession.personalData.credentials"}).pipe((0,b.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.Id&&qe(t.AutoLogin)&&qe(t.AutoProtected)&&Ve(t.Email)&&Ve(t.Login)&&Ve(t.OtpSecret)&&Ve(t.OtpUrl)&&Ve(t.Password)&&Ve(t.Title)&&Ve(t.Url)&&Ve(t.SpaceId)&&qe(t.Checked)}))))(e))throw new Error("Bad credential format");return e})),(0,oe.V)(r,t),(0,i.U)((([e,t,r])=>{const n={};return(0,l.hx)(e)||(0,l.hx)(r)||e.data.forEach((e=>{const o=new Fe.ParsedURL(e.Url).getRootDomain();var i;e.SpaceId&&""!==e.SpaceId&&!r.data.has(e.SpaceId)||(n[e.Id]={domains:o?[o]:[],autoLogin:this.vaultBooleanFormatter(e.AutoLogin),autoProtected:this.vaultBooleanFormatter(e.AutoProtected),email:e.Email??"",excluded:this.vaultBooleanFormatter(e.Checked),id:e.Id,login:e.Login??"",otpSecret:e.OtpSecret??"",otpUrl:e.OtpUrl??"",password:e.Password??"",spaceId:e.SpaceId??"",shared:(i=e.Id,!(0,l.hx)(t)&&t.data.includes(i)),title:e.Title??""})})),(0,l.Vp)(n)})))}};He=Ge([(0,n.Injectable)(),Be("design:paramtypes",[n.CqrsClient])],He);var We=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let Ke=class extends n.BaseEventEmitter{};Ke=We([(0,n.Injectable)()],Ke);const ze=e=>{const t=e.risks.filter((e=>e.riskType===o.RiskType.Reused));return 1===t.length?t[0]:void 0},$e=(e,t)=>e?.risks.find((e=>e.riskType===t)),Qe=(e,t)=>e.risks.filter((e=>e.riskType!==t)),Ye=(e,t,r)=>[...r,{riskType:o.RiskType.Reused,credentialIds:[...t.credentialIds].filter((t=>e!==t))}],Je=(e,t)=>{const r=ze(t);return{...t,risks:Qe(t,o.RiskType.Reused).concat([{riskType:o.RiskType.Reused,credentialIds:r?[...r.credentialIds].concat(e.id):[e.id]}])}},Xe=e=>({id:e.id,title:e.title,email:e.email,excluded:e.excluded,login:e.login,autoLogin:e.autoLogin,autoProtected:e.autoProtected,otpSecret:e.otpSecret,otpUrl:e.otpUrl,spaceId:e.spaceId,shared:e.shared,domains:e.domains}),Ze=e=>({...Xe(e),risks:[],isImportant:!1}),et=(e,t,r)=>{const n=Qe(t,o.RiskType.Reused),i=r&&r.length>0,a=n.length>0;return i||a?{...Ze(e),risks:i?n.concat([{riskType:o.RiskType.Reused,credentialIds:r}]):n}:void 0},tt=3,rt=5;function nt(e,t,r=tt,n=rt){if(!e||!t)return!1;const o=e.length,i=t.length;if(Math.abs(o-i)>r)return!1;if(o<n||i<n)return e===t;if(e===t)return!0;let a=new Array(i+1),s=new Array(i+1),c=!1;for(let e=0;e<i+1;e++)a[e]=e;for(let n=0;n<o;n++){s[0]=n+1,c=s[0]>r;for(let o=0;o<i;o++){const i=a[o+1]+1,u=s[o]+1;let l=a[o];e[n]!==t[o]&&l++,s[o+1]=Math.min(i,Math.min(u,l)),c=c&&s[o+1]>r}const o=a;if(a=s,s=o,c)break}return a[i]<=r}const ot=(e,t,r)=>{const n=((e,t)=>Object.keys(t).reduce(((r,n)=>nt(n,e.password)?[...r,...t[n]]:r),[]))(e,r);if(!t&&0===n.length)return{};const i=(e=>{if(0!==e.length)return{riskType:o.RiskType.Compromised,breaches:e}})(n),a=t?Qe(t,o.RiskType.Compromised):[],s={...Ze(e),risks:i?a.concat(i):a};return{[e.id]:0===s.risks.length?void 0:s}},it=(e,t,r)=>{if(!r)return Promise.resolve({});const n=t[e.id]??Ze(e),i=n.risks.length>0,a=((e,t)=>Object.keys(t).map((e=>t[e])).filter((t=>t.id!==e.id&&nt(t.password,e.password))).map((e=>e.id)))(e,r);if(0===a.length&&!i)return Promise.resolve({});const s=ze(n)?.credentialIds??[],c=((e,t,r,n)=>{const i=r.filter((e=>!t.includes(e)));if(0===i.length)return{};const a={};for(const t of i){const r=n[t];if(!r)continue;const i=ze(r);if(!i)continue;const s=Qe(r,o.RiskType.Reused);1===i.credentialIds.length&&0===s.length?a[t]=void 0:a[t]={...r,risks:1===i.credentialIds.length?s:Ye(e,i,s)}}return a})(e.id,a,s,t),u=((e,t,r,n,i)=>{const a=t.filter((e=>!r.includes(e)));if(0===a.length)return{};const s={};for(const t of a){const r=n[t];if(r)s[t]=Je(e,r);else{const r=i[t];s[t]={...Ze(r),risks:[{riskType:o.RiskType.Reused,credentialIds:[e.id]}]}}}return s})(e,a,s,t,r),l=et(e,n,a);return Promise.resolve({...c,...u,[e.id]:l})};var at=r(85465);const st=async e=>{if(e)return await(async e=>(await(0,at.evaluate)(e)).score)(e)/25},ct=async(e,t)=>{const r=await st(e.password),n=t??Ze(e),i=Qe(n,o.RiskType.Weak),a=void 0!==r&&r<2;return a||0!==i.length?{[e.id]:{...n,...Xe(e),risks:a?i.concat([{riskType:o.RiskType.Weak,strength:r}]):i}}:{[e.id]:void 0}},ut=(e,t,r)=>{if(!t)return{};const n=e.domains.some((e=>r.has(e))),o={...t,isImportant:n};return{[t.id]:o}},lt=e=>{const t={};return Object.keys(e).forEach((r=>{const n=e[r];n&&(t[r]=n)})),t},dt=async({credentialUpdates:e,allCredentials:t,breaches:r,importantDomains:n,hasUpdatedBreaches:i,healthState:a,deletedCredentialIds:s})=>{const c=(e=>{const t={};return e.forEach((e=>{e.LeakedPasswords&&e.LeakedPasswords.forEach((r=>{Object.prototype.hasOwnProperty.call(t,r)?t[r].push({breachId:e.BreachId,date:e.Content.eventDate,domains:e.Content.domains}):t[r]=[{breachId:e.BreachId,date:e.Content.eventDate,domains:e.Content.domains}]}))})),t})(r),u=0===e.length&&0===s.length&&!i,l={...a?.credentialsAtRisk??{}},d=e=>Object.keys(e).forEach((t=>l[t]=e[t]));s.length>0&&d(((e=[])=>e.reduce(((e,t)=>({...e,[t]:void 0})),{}))(s));const p={},f={};for(const e of Object.keys(t))t[e].excluded?p[e]=Ze(t[e]):f[e]=t[e];const h=[],m=[];for(const t of e)t.excluded?m.push(t):s.includes(t.id)||h.push(t);d(((e,t)=>{const r={};for(const n of Object.values(t)){if(!n)continue;const t=ze(n);if(!t)continue;const i=t.credentialIds.filter((t=>!e.includes(t)));if(i.length!==t.credentialIds.length){const e=Qe(n,o.RiskType.Reused);0===i.length&&0===e.length?r[n.id]=void 0:r[n.id]={...n,risks:0===i.length?e:[...e,{...t,credentialIds:i}]}}}return r})([...Object.values(m).map((e=>e.id)),...s],l)),u&&d((e=>{const t={};for(let r=0;r<e.length;r++){const n=e[r],i=n.password,a=n.id,s=[];for(let c=r+1;c<e.length;c++){const r=e[c].id,u=e[c].password,l=e[c];if(nt(i,u)){const e=t[r]??Ze(l),i=$e(e,o.RiskType.Reused),c=i?.credentialIds??[];t[r]=et(n,e,c.concat(a)),s.push(r)}}const c=t[a]??Ze(n),u=$e(c,o.RiskType.Reused),l=u?.credentialIds??[];t[a]=et(n,c,s.concat(l))}return t})(Object.values(f)));const y=u?Object.values(f):h;if(i)for await(const e of Object.values(f)){d(ot(e,l[e.id],c))}for await(const e of y){if(!i){d(ot(e,l[e.id],c))}if(!u){d(await it(e,l,f))}d(await ct(e,l[e.id])),d(ut(e,l[e.id],n))}return d(p),{credentialsAtRisk:lt(l),index:Ce(l)}};var pt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ft=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ht=class extends n.JsonApplicationResourceLoader{constructor(e){super("assets/domains/importantDomains.json",e)}loadResource(e){if(!(t=e)||!Array.isArray(t))throw new Error("Important domains file corrupted");var t;return new Set(e)}};ht=pt([(0,n.Injectable)(),ft("design:paramtypes",[n.JsonApplicationResourceFetcher])],ht);var mt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},yt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let gt=class{constructor(e,t,r,n,o){this.store=e,this.credentialsGetter=t,this.breachesGetter=r,this.importantDomains=n,this.eventEmitter=o}async run({updatedCredentialIds:e,deletedCredentialIds:t,hasUpdatedBreaches:r=!1}){const n=await this.store.getState(),o=await(0,G.z)(this.credentialsGetter.get()),i=await(0,G.z)(this.breachesGetter.get()),a=await this.importantDomains.get();if((0,l.hx)(o)||(0,l.hx)(i))throw new Error("Failure getting vault data");const s=e?.length??0,c=t?.length??0,u=s>0||c>0||r,d=s+c<=50,p=u&&d?n:void 0,f=u?((e,t)=>e.reduce(((e,r)=>void 0===t[r]?e:[...e,t[r]]),[]))(e??[],o.data):[],h=await dt({hasUpdatedBreaches:r,credentialUpdates:d?f:[],allCredentials:o.data,breaches:i.data,importantDomains:a,healthState:p,deletedCredentialIds:d?[...t??[]]:[]});await this.store.set({...h}),this.eventEmitter.sendEvent("passwordHealthComputationFinished",null)}};gt=mt([(0,n.Injectable)(),yt("design:paramtypes",[Oe,He,ke,ht,Ke])],gt);var vt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},bt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const wt=new Me.WU;let St=class{constructor(e,t){this.store=e,this.passwordHealthCalculationService=t}update(e){wt.runExclusive((async()=>{const t=await this.store.getState();this.store.set(((e,t)=>{const{isOutdated:r}=t;if(!r)return{isOutdated:!1,lastUpdateTimestamp:e.lastUpdateTimestamp};const{updatedCredentialIds:n,deletedCredentialIds:o,hasUpdatedBreaches:i}=t,a=e.isOutdated?{...e}:{isOutdated:!0,lastUpdateTimestamp:e.lastUpdateTimestamp,updatedCredentialIds:{},deletedCredentialIds:{},hasUpdatedBreaches:!1};return n&&(a.updatedCredentialIds={...a.updatedCredentialIds,...n.reduce(((e,t)=>({...e,[t]:t})),{})}),o&&(a.deletedCredentialIds={...a.deletedCredentialIds,...o.reduce(((e,t)=>({...e,[t]:t})),{})}),i&&(a.hasUpdatedBreaches=i),a})(t,e))}))}async updateHealthState(){await wt.runExclusive((async()=>{const e=await this.store.getState();(e.isOutdated||0===e.lastUpdateTimestamp||e.lastUpdateTimestamp+864e5<Date.now())&&(await this.passwordHealthCalculationService.run(this.prepCacheStateProps(e)),await this.markAsUpToDate())}))}prepCacheStateProps(e){return e.isOutdated?{updatedCredentialIds:Object.keys(e.updatedCredentialIds),deletedCredentialIds:Object.keys(e.deletedCredentialIds),hasUpdatedBreaches:e.hasUpdatedBreaches}:{}}async markAsUpToDate(){await this.store.set({isOutdated:!1,lastUpdateTimestamp:(new Date).getTime()})}};St=vt([(0,n.Injectable)(),bt("design:paramtypes",[Ue,gt])],St);var Rt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Et=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ot=class{constructor(e){this.healthCacheUpdaterService=e}execute(){return this.healthCacheUpdaterService.update({isOutdated:!0}),Promise.resolve((0,l.Vp)(void 0))}};Ot=Rt([(0,n.CommandHandler)(o.RecalculatePasswordHealthCommand),Et("design:paramtypes",[St])],Ot);const Ct=(e,t)=>{const r=((e,t)=>{if(0!==t.length)switch(e){case o.HealthFilter.All:{const e={[o.RiskType.Compromised]:3,[o.RiskType.Weak]:2,[o.RiskType.Reused]:1,[o.RiskType.Excluded]:0};return t.reduce(((t,r)=>t?e[r.riskType]>e[t.riskType]?r:t:r),void 0)}case o.HealthFilter.Compromised:return t.find((e=>e.riskType===o.RiskType.Compromised));case o.HealthFilter.Weak:return t.find((e=>e.riskType===o.RiskType.Weak));case o.HealthFilter.Reused:return t.find((e=>e.riskType===o.RiskType.Reused));default:return}})(e,t);if(!r)return;const n={severity:o.CorruptionDataSeverity.COMMON};switch(r.riskType){case o.RiskType.Compromised:{const e=[...r.breaches].sort(((e,t)=>{const r=parseInt(e.date,10),n=parseInt(t.date,10);return r===n?0:r<n?1:-1}))[0];return{...n,riskType:o.RiskType.Compromised,date:e.date,domain:e.domains[0]??null,severity:o.CorruptionDataSeverity.STRONG}}case o.RiskType.Weak:return{...n,riskType:o.RiskType.Weak,strength:r.strength>=1?o.CorruptionDataStrength.WEAK:o.CorruptionDataStrength.EXTREMELY_WEAK};case o.RiskType.Reused:return{...n,riskType:o.RiskType.Reused,reuseCount:r.credentialIds.length}}};var Pt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},At=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let jt=class{constructor(e,t,r){this.store=e,this.cacheStore=t,this.healthCacheUpdater=r,this.state$=this.cacheStore.state$.pipe((0,oe.V)(this.store.state$),(0,B.b)((()=>{this.healthCacheUpdater.updateHealthState()})),(0,i.U)((([e,t])=>t)))}};jt=Pt([(0,n.Injectable)(),At("design:paramtypes",[Oe,Ue,St])],jt);var _t=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Tt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let It=class{constructor(e){this.store=e}execute({body:e}){const{credentialId:t}=e;return this.store.state$.pipe((0,i.U)((e=>e.credentialsAtRisk[t]?(0,l.Vp)((e=>{const{excluded:t,risks:r}=e;return{excluded:t,corruptionData:Ct(o.HealthFilter.All,r)}})(e.credentialsAtRisk[t])):(0,l.Vp)(null))))}};It=_t([(0,n.QueryHandler)(o.CredentialHealthDataQuery),Tt("design:paramtypes",[jt])],It);const Dt=5,xt=.6,Ut=1,Mt=1,Lt=.2;function Nt(e,t,r){if(r<Dt)return null;const n=xt*Math.pow(1-t/r,Ut),o=(1-xt)*Math.pow(1-e/r,Mt);return Lt+(1-Lt)*(n+o)}const kt=e=>null===e?null:Math.round(100*e),Ft=(e,t)=>({total:t,compromised:e.compromised.length,reused:e.reused.length,weak:e.weak.length,score:kt(Nt(e.corruptedCount,e.importantCorruptedCount,t-e.excluded.length))}),Vt=(e,t)=>{const{compromised:r,reused:n,weak:o,corruptedCount:i,excludedCount:a,importantCorruptedCount:s}=Object.keys(e).reduce(((t,r)=>({compromised:t.compromised+e[r].compromised.length,reused:t.reused+e[r].reused.length,weak:t.weak+e[r].weak.length,corruptedCount:t.corruptedCount+e[r].corruptedCount,importantCorruptedCount:t.importantCorruptedCount+e[r].importantCorruptedCount,excludedCount:t.excludedCount+e[r].excluded.length})),{compromised:0,reused:0,weak:0,corruptedCount:0,importantCorruptedCount:0,excludedCount:0}),c=Nt(i,s,t-a);return{compromised:r,reused:n,total:t,weak:o,score:kt(c)}};function qt(e,t){return(0,l.hx)(e)?0:Object.keys(e.data).filter((r=>e.data[r].spaceId===t)).length}var Gt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Bt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ht=class{constructor(e,t,r){this.cacheStateStore=e,this.credentialsGetter=t,this.store=r}execute({body:e}){const{spaceId:t=null}=e;return this.store.state$.pipe((0,oe.V)(this.credentialsGetter.get(),this.cacheStateStore.state$),(0,i.U)((([e,r,n])=>{if(t&&void 0===e.index[t]){const e=qt(r,t);return(0,l.Vp)({counters:{compromised:0,reused:0,score:100,total:e,weak:0},isInitialized:n.lastUpdateTimestamp>0})}if(null===t){const t=(0,l.hx)(r)?0:Object.keys(r.data).length;return(0,l.Vp)({counters:Vt(e.index,t),isInitialized:n.lastUpdateTimestamp>0})}const o=qt(r,t);return(0,l.Vp)({counters:Ft(e.index[t],o),isInitialized:n.lastUpdateTimestamp>0})})))}};Ht=Gt([(0,n.QueryHandler)(o.ScoreQuery),Bt("design:paramtypes",[Ue,He,jt])],Ht);const Wt=(e,t)=>t===o.HealthFilter.All?[o.RiskType.Compromised,o.RiskType.Weak,o.RiskType.Reused,o.RiskType.Excluded].reduce(((t,r)=>[...new Set([...t,...e[r]])]),[]):e[t],Kt=(e,t,r,n)=>{let o;return o=null!==e?Wt(t[e],r):Object.keys(t).reduce(((e,n)=>[...e,...Wt(t[n],r)]),[]),o.map((e=>((e,t)=>{const{id:r,title:n,login:o,email:i,autoProtected:a,shared:s,excluded:c,domains:u,risks:l}=e;return{id:r,title:n,login:o,email:i,autoProtected:a,shared:s,excluded:c,domainIcon:void 0,corruptionData:Ct(t,l),domain:u[0]}})(n[e],r)))};var zt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},$t=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Qt=class{constructor(e){this.store=e}execute({body:e}){const{healthFilter:t,spaceId:r}=e;return this.store.state$.pipe((0,i.U)((e=>r&&void 0===e.index[r]?(0,l.Vp)([]):(0,l.Vp)(Kt(r,e.index,t||o.HealthFilter.All,e.credentialsAtRisk)))))}};Qt=zt([(0,n.QueryHandler)(o.FilterCredentialsQuery),$t("design:paramtypes",[jt])],Qt);var Yt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Jt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Xt=class{constructor(e){this.store=e}execute({body:e}){const{credentialIds:t}=e;return this.store.state$.pipe((0,i.U)((e=>(0,l.Vp)(((e,t)=>Object.keys(e).reduce(((t,r)=>[...t,...e[r].compromised]),[]).filter((e=>t.includes(e))))(e.index,t)))))}};function Zt(e){const t={};return Object.keys(e).forEach((r=>{const n=e[r].spaceId;void 0===t[n]?t[n]=1:t[n]++})),t}Xt=Yt([(0,n.QueryHandler)(o.CompromisedCredentialsQuery),Jt("design:paramtypes",[jt])],Xt);var er=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},tr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let rr=class{constructor(e,t){this.store=e,this.credentialsGetter=t}execute(){return this.store.state$.pipe((0,oe.V)(this.credentialsGetter.get()),(0,i.U)((([e,t])=>{const r={};if(!(0,l.d6)(t))throw new Error("Error while retrieving credentials");const n=Zt(t.data),i=Object.keys(t.data).length,a=function(e){const t={};return Object.keys(e).forEach((r=>{const n=$e(e[r],o.RiskType.Compromised),i=e[r].spaceId;if(void 0===n)return;void 0===t[i]&&(t[i]={breaches:new Set,compromisedByBreaches:{}});const a=n.breaches.map((e=>e.breachId));t[i].breaches=new Set([...t[i].breaches,...a]),t[i].compromisedByBreaches[r]=new Set(a)})),t}(e.credentialsAtRisk);let s=new Set([]),c={},u=0,d=0;return Object.keys(e.index).forEach((t=>{const o=e.index[t],i=Ft(o,n[t]);r[t]={...i,breaches:a[t]?.breaches??new Set,compromisedByBreach:a[t]?.compromisedByBreaches??{},corrupted:o.corruptedCount,excluded:o.excluded.length},s=new Set([...s,...a[t]?.breaches??new Set]),c={...c,...a[t]?.compromisedByBreaches??{}},u+=o.corruptedCount,d+=o.excluded.length})),r.global={...Vt(e.index,i),breaches:s,compromisedByBreach:c,corrupted:u,excluded:d},(0,l.Vp)(r)})))}};rr=er([(0,n.QueryHandler)(o.PasswordHealthReportQuery),tr("design:paramtypes",[Oe,He])],rr);const nr=e=>!(!e||"object"!=typeof e)&&((0,Re.l$)(e,"lastSentDate")&&"number"==typeof e.lastSentDate);class or extends((0,n.defineStore)({persist:!0,storage:{initialValue:{lastSentDate:0},typeGuard:nr,schemaVersion:1},scope:p.UseCaseScope.User,storeName:"user-activity-state",storeTypeGuard:nr,codec:f.Eu,capacity:n.StoreCapacity._001KB})){}var ir=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ar=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let sr=class{constructor(e,t){this.client=e,this.healthCacheUpdater=t}async run(){await this.healthCacheUpdater.updateHealthState()}async hasPHMV3FFEnabled(){const e="ims_web_ph_mv3_dev",{userFeatureFlips:t}=this.client.getClient(p.requestContextApi).queries,r=await(0,G.z)(t({requiredFeatureFlips:[e]}));return(0,l.d6)(r)&&r.data[e]}async isRunnable(){return await this.hasPHMV3FFEnabled()}};sr=ir([(0,n.Injectable)(),ar("design:paramtypes",[n.CqrsClient,St])],sr);var cr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ur=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const lr=e=>Math.floor(e/1e3);let dr=class{constructor(e,t,r,n,o){this.serverApiClient=e,this.userActivityStore=t,this.credentialsGetter=r,this.client=n,this.store=o}async send(){const e=await this.store.getState(),t=await this.userActivityStore.getState(),r=await(0,G.z)(this.credentialsGetter.get()),n=Date.now(),o=lr(n),i=lr(t.lastSentDate||n);if(!(0,l.d6)(r))return Promise.reject(new Error("Error while retrieving credentials"));const a=Zt(r.data),s=function(e,t){const r={};return Object.keys(e).forEach((n=>{const o=t[n]||0,i=e[n];r[n]={checkedPasswords:i.excluded.length,compromisedPasswords:i.compromised.length,nbrPasswords:o,reused:i.reused.length,safePasswords:o-i.corruptedCount,securityIndex:kt(Nt(i.corruptedCount,i.importantCorruptedCount,o-i.excluded.length))??void 0,weakPasswords:i.weak.length}})),r}(e.index,a),c=Object.keys(s).find((e=>""!==e));return await(0,G.z)(this.serverApiClient.v1.useractivity.create({userActivity:{securityIndex:0},teamActivity:c?{teamId:parseInt(c,10),activity:s[c]}:void 0,relativeEnd:o,relativeStart:i})),this.userActivityStore.set({lastSentDate:n}),Promise.resolve()}async shouldBeSent(){return(await(0,G.z)(this.userActivityStore.state$)).lastSentDate+864e5<Date.now()}};dr=cr([(0,n.Injectable)(),ur("design:paramtypes",[w.lX,or,He,n.CqrsClient,Oe])],dr);var pr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},fr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let hr=class{constructor(e){this.userActivitySender=e}async handle(){await this.userActivitySender.shouldBeSent()&&this.userActivitySender.send()}};hr=pr([(0,n.EventHandler)(o.PasswordHealthComputationFinishedEvent),fr("design:paramtypes",[dr])],hr);var mr=r(16530),yr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},gr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let vr=class{constructor(e){this.healthCacheUpdater=e}handle({body:e}){const{ids:t,vaultItemType:r}=e;return r===mr.VaultItemType.Credential&&this.healthCacheUpdater.update({isOutdated:!0,updatedCredentialIds:t}),Promise.resolve(void 0)}};vr=yr([(0,n.EventHandler)(mr.UpdatedEvent),gr("design:paramtypes",[St])],vr);var br=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},wr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Sr=class{constructor(e){this.healthCacheUpdater=e}handle({body:e}){const{ids:t,vaultItemType:r}=e;return r===mr.VaultItemType.Credential&&this.healthCacheUpdater.update({isOutdated:!0,updatedCredentialIds:t}),Promise.resolve(void 0)}};Sr=br([(0,n.EventHandler)(mr.CreatedEvent),wr("design:paramtypes",[St])],Sr);var Rr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Er=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Or=class{constructor(e){this.healthCacheUpdater=e}handle({body:e}){const{ids:t,vaultItemType:r}=e;return r===mr.VaultItemType.Credential&&this.healthCacheUpdater.update({isOutdated:!0,deletedCredentialIds:t}),Promise.resolve(void 0)}};Or=Rr([(0,n.EventHandler)(mr.DeletedEvent),Er("design:paramtypes",[St])],Or);var Cr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let Pr=class{};Pr=Cr([(0,n.Module)({api:o.passwordHealthApi,crons:[{handler:sr,name:"health-cache",periodInMinutes:15,scope:p.UseCaseScope.User}],handlers:{commands:{updateIsCredentialExcluded:je,recalculatePasswordHealth:Ot},events:{...(0,n.useEventsOfModule)(o.passwordHealthApi,{passwordHealthComputationFinished:hr}),...(0,n.useEventsOfModule)(mr.vaultItemsCrudApi,{updated:vr,created:Sr,deleted:Or})},queries:{credentialHealthData:It,score:Ht,filterCredentials:Qt,compromisedCredentials:Xt,passwordHealthReport:rr}},imports:[w.nr],stores:[Oe,or,Ue],providers:[He,ke,ht,gt,St,sr,Ke,dr,jt]})],Pr);var Ar=r(10203);const jr=_e.z.object({Id:_e.z.string(),VaultItems:_e.z.array(_e.z.object({Id:_e.z.string()}))}),_r=_e.z.array(jr);var Tr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Ir=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Dr=class{constructor(e){this.client=e}get(){const{queries:{carbonState:e}}=this.client.getClient(D.carbonLegacyApi);return e({path:"userSession.personalData.collections"}).pipe((0,b.Qn)((e=>{if(!(e=>_r.safeParse(e).success)(e))throw new Error("Collection array has a wrong format");return e})))}};Dr=Tr([(0,n.Injectable)(),Ir("design:paramtypes",[n.CqrsClient])],Dr);const xr=e=>!(!e||"object"!=typeof e)&&((0,Re.l$)(e,"lastSentDate")&&"number"==typeof e.lastSentDate);class Ur extends((0,n.defineStore)({codec:f.Eu,persist:!0,storage:{initialValue:{lastSentDate:0},schemaVersion:1,typeGuard:xr},scope:p.UseCaseScope.User,storeName:"vault-report",storeTypeGuard:xr,capacity:n.StoreCapacity._001KB})){}const Mr={collections_count:-1,collections_shared_count:-1,multiple_collections_count:-1,multiple_collections_shared_count:-1,single_collection_count:-1,single_collection_shared_count:-1,shared_count:-1,total_count:-1};function Lr(e){if(0===e.length)return 0;const t=e.flatMap((e=>e.VaultItems)),r=new Set(t.map((e=>e.Id))).size;return Math.round(t.length/r)}function Nr(e){if(0===e.length)return 0;let t=0,r=0;for(const n of e)n.VaultItems.length>0&&(r+=n.VaultItems.length,t++);return Math.round(r/t)}function kr(e,t){let r=0,n=0;const o=e.map((e=>e.VaultItems)).reduce(((e,t)=>(t.forEach((t=>{const r=t.Id;e[r]?e[r]+=1:e[r]=1})),e)),{});return Object.values(o).forEach((e=>{e>1?r++:n++})),{collections_count:e.length,collections_shared_count:-1,multiple_collections_count:r,multiple_collections_shared_count:-1,single_collection_count:-1,single_collection_shared_count:n,shared_count:-1,total_count:t}}function Fr(e,t){return{itemsTotalCount:-1,itemsSharedCount:-1,collectionsTotalCount:e.length,collectionsSharedCount:-1,itemsPerCollectionAverageCount:Nr(e),collectionsPerItemAverageCount:Lr(e),ids:Mr,passwords:kr(e,t),payments:Mr,personalInfo:Mr,secureNotes:Mr}}var Vr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},qr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Gr=class{constructor(e,t,r,n,o,i){this.breachesGetter=e,this.credentialGetter=t,this.vaultCollectionGetter=r,this.client=n,this.store=o,this.cqrsClient=i}getSpaceScope(e){switch(e){case"":return Ar.Scope.Personal;case"global":return Ar.Scope.Global;default:return Ar.Scope.Team}}async send(){const{queries:e}=this.client.getClient(o.passwordHealthApi),t=await(0,G.z)(e.passwordHealthReport()),r=await(0,G.z)(this.credentialGetter.get()),n=await(0,G.z)(this.vaultCollectionGetter.get()),i=await(0,G.z)(this.breachesGetter.getSupportedBreaches()),{commands:{logEvent:a}}=this.cqrsClient.getClient(w.Yu);if(!((0,l.d6)(r)&&(0,l.d6)(i)&&(0,l.d6)(t)&&(0,l.d6)(n)))return Promise.reject(new Error("Error while retrieving credentials/breaches/health/collections"));const s=function(e){const t={global:{domainsWithoutAutofill:0,nbrPasswords:0,passwordsWithOtpCount:0,protectedPasswords:0}};return Object.keys(e).forEach((r=>{const n=e[r].spaceId;void 0===t[n]&&(t[n]={domainsWithoutAutofill:0,nbrPasswords:0,passwordsWithOtpCount:0,protectedPasswords:0}),t[n].nbrPasswords++,t.global.nbrPasswords++,e[r].autoLogin||(t[n].domainsWithoutAutofill++,t.global.domainsWithoutAutofill++),(e[r].otpSecret||e[r].otpUrl)&&(t[n].passwordsWithOtpCount++,t.global.passwordsWithOtpCount++),e[r].autoProtected&&(t[n].protectedPasswords++,t.global.protectedPasswords++)})),t}(r.data),c=function(e,t){const r=new Set,n=new Set;e.forEach((e=>{ce(e.Content)?n.add(e.BreachId):r.add(e.BreachId)}));const o=new Set,i=new Set,a={global:{activePrivateBreachAlerts:0,activePublicBreachAlerts:0,passwordsCompromisedThroughPrivateBreaches:0,privateBreachAlerts:n.size,publicBreachAlerts:r.size}};return Object.keys(t).forEach((e=>{if("global"===e)return;const s=t[e];void 0===a[e]&&(a[e]={activePrivateBreachAlerts:0,activePublicBreachAlerts:0,passwordsCompromisedThroughPrivateBreaches:0,privateBreachAlerts:n.size,publicBreachAlerts:r.size}),[...s.breaches].forEach((t=>{r.has(t)?(a[e].activePublicBreachAlerts++,o.add(t)):n.has(t)&&(a[e].activePrivateBreachAlerts++,i.add(t))})),Object.keys(s.compromisedByBreach).forEach((t=>{[...s.compromisedByBreach[t]].some((e=>n.has(e)))&&a[e].passwordsCompromisedThroughPrivateBreaches++})),a.global.passwordsCompromisedThroughPrivateBreaches+=a[e].passwordsCompromisedThroughPrivateBreaches})),a.global.activePrivateBreachAlerts=i.size,a.global.activePublicBreachAlerts=o.size,a}(i.data,t.data);return Object.keys(s).forEach((e=>{const r=t.data[e],o={scope:this.getSpaceScope(e),...Fr(n.data,s[e].nbrPasswords),...s[e],...c[e],passwordsSafeCount:s[e].nbrPasswords-r.corrupted,passwordsExcludedCount:r.excluded,passwordsCompromisedCount:r.compromised,passwordsReusedCount:r.reused,securityScore:r.score??void 0,passwordsWeakCount:r.weak};a({event:new Ar.UserVaultReportEvent(o)})})),this.store.set({lastSentDate:Date.now()}),Promise.resolve()}async shouldBeSent(){return(await(0,G.z)(this.store.state$)).lastSentDate+864e5<Date.now()}};Gr=Vr([(0,n.Injectable)(),qr("design:paramtypes",[ke,He,Dr,n.CqrsClient,Ur,n.CqrsClient])],Gr);var Br=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Hr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Wr=class{constructor(e){this.vaultReportSender=e}async handle(){await this.vaultReportSender.shouldBeSent()&&this.vaultReportSender.send()}};Wr=Br([(0,n.EventHandler)(o.PasswordHealthComputationFinishedEvent),Hr("design:paramtypes",[Gr])],Wr);var Kr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let zr=class{};zr=Kr([(0,n.Module)({api:o.vaultReportApi,handlers:{commands:{},events:{...(0,n.useEventsOfModule)(o.passwordHealthApi,{passwordHealthComputationFinished:Wr})},queries:{}},providers:[ke,He,Gr,Dr],stores:[Ur]})],zr);const $r=_e.z.object({autoredirection:_e.z.record(_e.z.boolean())}),Qr=e=>$r.safeParse(e).success;class Yr extends((0,n.defineStore)({persist:!0,storage:{initialValue:{autoredirection:{}},typeGuard:Qr,schemaVersion:1},scope:p.UseCaseScope.Device,storeName:"antiphishing",codec:f.Eu,capacity:n.StoreCapacity._001KB})){}var Jr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Xr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Zr=class{constructor(e){this.antiphishingStore=e}execute({body:e}){return this.antiphishingStore.state$.pipe((0,i.U)((t=>(0,l.Vp)(!!e.domain&&!!t.autoredirection[e.domain]))))}};Zr=Jr([(0,n.QueryHandler)(o.IsAutoRedirectedDomainQuery),Xr("design:paramtypes",[Yr])],Zr);var en=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},tn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let rn=class{constructor(e){this.antiphishingStore=e}async execute({body:e}){const{domain:t}=e;if(t){const e=await this.antiphishingStore.getState();await this.antiphishingStore.set({...e,autoredirection:{...e.autoredirection,[t]:!0}})}return Promise.resolve((0,l.Vp)(void 0))}};rn=en([(0,n.CommandHandler)(o.AddAutoRedirectedDomainCommand),tn("design:paramtypes",[Yr])],rn);var nn=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let on=class{};on=nn([(0,n.Module)({api:o.antiphishingApi,handlers:{commands:{addAutoRedirectedDomain:rn},events:{},queries:{isAutoRedirectedDomain:Zr}},stores:[Yr]})],on);var an=r(30523);const sn=e=>void 0===e||"string"==typeof e;var cn=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},un=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ln=class{constructor(e){this.client=e}getById(e){const{queries:{carbonState:t}}=this.client.getClient(D.carbonLegacyApi);return t({path:"state.userSession.personalData.credentials"}).pipe((0,b.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.Id&&sn(t.OtpSecret)&&sn(t.OtpUrl)}))))(e))throw new Error("Bad credential format");return e})),(0,i.U)((t=>{if((0,l.hx)(t))return(0,l.Vp)(null);const r=t.data.reduce(((t,r)=>r.Id===e?{Id:r.Id,OtpSecret:r.OtpSecret,OtpUrl:r.OtpUrl}:t),null);return(0,l.Vp)(r)})))}};var dn;ln=cn([(0,n.Injectable)(),un("design:paramtypes",[n.CqrsClient])],ln),function(e){e.SHA1="SHA-1",e.SHA256="SHA-256",e.SHA384="SHA-384",e.SHA512="SHA-512"}(dn||(dn={}));const pn=["totp","hotp"],fn=e=>{const t=new URL(e),r=(e=>{const t=e.hostname?e.hostname:/\/\/([th]otp)\//.exec(e.pathname)?.[1]??"";return pn.includes(t)?t:null})(t),n=t.searchParams.get("secret")?.toUpperCase();if(!r||!n)throw new Error("Corrupted OTP url");const o=t.searchParams.get("digits"),i=t.searchParams.get("counter"),a=t.searchParams.get("period"),s=t.searchParams.get("algorithm");return{secret:n,algorithm:s?dn[s]:dn.SHA1,counter:i?Number.parseInt(i,10):0,digits:o?Number.parseInt(o,10):6,period:a?Number.parseInt(a,10):30}},hn=e=>{const{OtpSecret:t,OtpUrl:r}=e;if(!t&&!r)throw new Error("Otp config missing for this credential");return r?fn(r):{secret:(t??"").toUpperCase(),algorithm:dn.SHA1,counter:0,digits:6,period:30}},mn="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".split("").reduce(((e,t,r)=>({...e,[t]:r})),{}),yn=e=>{const t=mn[e];if(void 0===t)throw new Error("Invalid character found: "+e);return t},gn=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9],vn=async(e,t,r)=>{const n=(e=>{const t=new Uint8Array(e),r=15&t[t.length-1],n=t.slice(r,r+4).reduce(((e,t)=>e.concat(t.toString(16).toString().padStart(2,"0"))),"");return 2147483647&Number.parseInt(n,16)})(await e((e=>{const t=new ArrayBuffer(8);return new DataView(t).setBigUint64(0,BigInt(e)),t})(t)));return(n%(r<=9?gn[r]:Math.pow(10,r))).toString().padStart(r,"0")};class bn{constructor(e,t){this.signer=e,this.getStep=t}async computeOtpCode({counter:e,digits:t,period:r}){const n=this.getStep(e,r);try{return await vn(this.signer,n,t)}catch(e){return""}}}class wn{constructor(e){this.hmacSigner=e}createCodeGenerator({secret:e,algorithm:t}){try{const r=(e=>{const t=e.replaceAll("=","").trim().length;let r=0,n=0,o=0;const i=new Uint8Array(5*t/8|0);for(let a=0;a<t;a++)n=n<<5|yn(e[a]),r+=5,r>=8&&(i[o++]=n>>>r-8&255,r-=8);return i.buffer})(e);return new bn((e=>this.hmacSigner.sign(r,e,t)),this.getStep)}catch(e){return null}}getNextOtpRefreshTimestamp(e,t){if(e){const e=1e3*t,r=Math.floor(Date.now()/e)*e;return new Date(r+e).getTime()}throw new Error("Not supported for non time based OTP type")}}var Sn=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Rn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let En=class extends wn{constructor(e){super(e)}getStep(e,t){return((e,t)=>Math.floor(e/t))(e||(new Date).getTime(),1e3*t)}};En=Sn([(0,n.Injectable)(),Rn("design:paramtypes",[w.qn])],En);var On=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Cn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Pn=class{constructor(e,t){this.credentialOTPGetter=e,this.otpGeneratorService=t}async withGeneratedCodeAndValidity(e,t){const r=await(t?.computeOtpCode(e))??"",n=this.otpGeneratorService.getNextOtpRefreshTimestamp(!0,e.period);return(0,l.Vp)({code:r,validityEndDate:n,validityTime:1e3*e.period})}withCodeGenerator(e){return{codeGenerator:this.otpGeneratorService.createCodeGenerator(e),params:e}}execute({body:e}){const{credentialId:t}=e;return this.credentialOTPGetter.getById(t).pipe((0,i.U)((e=>{if((0,l.hx)(e)||!e.data)throw new Error("Credential not found");return e.data})),(0,i.U)((e=>{if(!e.OtpUrl&&!e.OtpSecret)return{params:null,codeGenerator:null};const t=hn(e);return this.withCodeGenerator(t)})),(0,s.w)((({params:e,codeGenerator:t})=>null===e||null===t?(0,u.of)((0,l.Rn)(new o.OtpCodeGenerationError)):(0,c.H)(0,1e3).pipe((0,an.h)((t=>{if(0===t)return!0;return((e,t)=>e-Date.now()>=1e3*t-1e3)(this.otpGeneratorService.getNextOtpRefreshTimestamp(!0,e.period),e.period)})),(0,s.w)((()=>this.withGeneratedCodeAndValidity(e,t)))))))}};Pn=On([(0,n.QueryHandler)(o.OtpCodeQuery),Cn("design:paramtypes",[ln,En])],Pn);var An=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},jn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let _n=class extends wn{constructor(e){super(e)}getStep(e,t){return e}};_n=An([(0,n.Injectable)(),jn("design:paramtypes",[w.qn])],_n);var Tn=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let In=class{};In=Tn([(0,n.Module)({sharedModuleName:"otp-generator",providers:[En,_n],exports:[En,_n],imports:[w.Dq]})],In);var Dn=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let xn=class{};xn=Dn([(0,n.Module)({api:o.otpApi,handlers:{commands:{},events:{},queries:{otpCode:Pn}},imports:[In],providers:[ln]})],xn);const Un=_e.z.object({isMasterPasswordLeaked:_e.z.boolean(),isMasterPasswordLeakedNotificationDismissed:_e.z.boolean(),lastCheckTimestamp:_e.z.number()}),Mn=e=>Un.safeParse(e).success;class Ln extends((0,n.defineStore)({persist:!0,storage:{initialValue:{isMasterPasswordLeaked:!1,isMasterPasswordLeakedNotificationDismissed:!1,lastCheckTimestamp:0},typeGuard:Mn,schemaVersion:1},scope:p.UseCaseScope.User,isCache:!0,storeName:"master-password-security",codec:f.Eu,capacity:n.StoreCapacity._001KB})){}var Nn=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},kn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Fn=class{constructor(e){this.masterPasswordSecurityStore=e}execute(){return this.masterPasswordSecurityStore.state$.pipe((0,i.U)((e=>(0,l.Vp)(e.isMasterPasswordLeaked))))}};Fn=Nn([(0,n.QueryHandler)(o.IsMasterPasswordLeakedQuery),kn("design:paramtypes",[Ln])],Fn);var Vn=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},qn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Gn=class{constructor(e){this.masterPasswordSecurityStore=e}execute(){return this.masterPasswordSecurityStore.state$.pipe((0,i.U)((e=>(0,l.Vp)(e.isMasterPasswordLeakedNotificationDismissed))))}};Gn=Vn([(0,n.QueryHandler)(o.IsMasterPasswordLeakedNotificationDismissedQuery),qn("design:paramtypes",[Ln])],Gn);var Bn=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Hn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Wn=class{constructor(e){this.masterPasswordSecurityStore=e}execute(){return this.masterPasswordSecurityStore.state$.pipe((0,i.U)((e=>(0,l.Vp)(e.lastCheckTimestamp))))}};Wn=Bn([(0,n.QueryHandler)(o.LastCheckTimestampQuery),Hn("design:paramtypes",[Ln])],Wn);var Kn=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},zn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let $n=class{constructor(e){this.masterPasswordSecurityStore=e}async execute(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,isMasterPasswordLeakedNotificationDismissed:!0}),Promise.resolve((0,l.Vp)(void 0))}};$n=Kn([(0,n.CommandHandler)(o.DismissMasterPasswordLeakedNotificationCommand),zn("design:paramtypes",[Ln])],$n);var Qn=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Yn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Jn=class{constructor(e){this.argon2dDeriver=e}async hash(e){return(0,T.k)(await this.argon2dDeriver.derive((0,I.u)(e),(0,I.u)("z8CXohryCcGAa7CESNHYnedqbDyp"),{tCost:3,mCost:32768,parallelism:2}))}};Jn=Qn([(0,n.Injectable)(),Yn("design:paramtypes",[w.yQ])],Jn);var Xn=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Zn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let eo=class{constructor(e,t,r){this.serverApiClient=e,this.masterPasswordSecurityStore=t,this.passwordHasher=r}shouldBeChecked(){return(0,G.z)(this.masterPasswordSecurityStore.state$.pipe((0,i.U)((e=>!e.isMasterPasswordLeaked&&e.lastCheckTimestamp+864e5<=Date.now()))))}async check(e){const t=await this.passwordHasher.hash(e),r=await(0,G.z)(this.serverApiClient.v1.pwleak.getHashes({hashPrefix:t.substring(0,6)}));if((0,l.hx)(r))throw new Error("Error while retrieving list of hashes for MP checking");const n=r.data.data.includes(t);return await this.masterPasswordSecurityStore.set({isMasterPasswordLeaked:n,isMasterPasswordLeakedNotificationDismissed:!1,lastCheckTimestamp:Date.now()})}};eo=Xn([(0,n.Injectable)(),Zn("design:paramtypes",[w.lX,Ln,Jn])],eo);var to=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ro=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let no=class{constructor(e){this.masterPasswordSecurityStore=e}async reset(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,isMasterPasswordLeakedNotificationDismissed:!1})}};no=to([(0,n.Injectable)(),ro("design:paramtypes",[Ln])],no);var oo=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},io=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ao=class{constructor(e,t,r){this.masterPasswordSecurityStore=e,this.checkMasterPasswordService=t,this.resetMasterPasswordLeakedNotification=r}async execute({body:e}){return this.resetMasterPasswordLeakedNotification.reset(),await this.checkMasterPasswordService.shouldBeChecked()?(await this.checkMasterPasswordService.check(e.password),Promise.resolve((0,l.Vp)(void 0))):Promise.resolve((0,l.Vp)(void 0))}};ao=oo([(0,n.CommandHandler)(o.TemporaryCheckMasterPasswordCommand),io("design:paramtypes",[Ln,eo,no])],ao);var so=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},co=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let uo=class{constructor(e){this.masterPasswordSecurityStore=e}async execute(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,lastCheckTimestamp:0,isMasterPasswordLeaked:!1,isMasterPasswordLeakedNotificationDismissed:!1}),Promise.resolve((0,l.Vp)(void 0))}};uo=so([(0,n.CommandHandler)(o.TemporaryResetMasterPasswordLeakedCommand),co("design:paramtypes",[Ln])],uo);var lo=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let po=class{};po=lo([(0,n.Module)({api:o.masterPasswordSecurityApi,handlers:{commands:{dismissMasterPasswordLeakedNotification:$n,temporaryCheckMasterPassword:ao,temporaryResetMasterPasswordLeaked:uo},events:{},queries:{isMasterPasswordLeaked:Fn,isMasterPasswordLeakedNotificationDismissed:Gn,lastCheckTimestamp:Wn}},providers:[eo,Jn,no],imports:[w.Dq,w.nr],stores:[Ln]})],po)},35818:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(91478),t)},41342:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.permissionsApi=void 0;const n=r(68224),o=r(37392),i=r(35174);t.permissionsApi=(0,n.defineModuleApi)({name:"permissions",commands:{addGroupManager:o.AddGroupManager,removeGroupManager:o.RemoveGroupManager},events:{},queries:{userPermissions:i.UserPermissionsQuery}})},41015:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AddGroupManager=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.AddGroupManager=o},37392:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(41015),t),o(r(42763),t)},42763:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoveGroupManager=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.RemoveGroupManager=o},91478:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(41342),t),o(r(37392),t),o(r(35174),t),o(r(45073),t)},35174:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(71367),t)},71367:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserPermissionsQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.Device})){}t.UserPermissionsQuery=o},45073:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PermissionSchema=void 0;const n=r(10295);t.PermissionSchema=n.z.enum(["GROUP_CREATE","GROUP_DELETE","GROUP_EDIT","GROUP_READ"])},89858:(e,t,r)=>{"use strict";r.d(t,{B:()=>A});var n,o=r(27606),i=r(35818),a=r(11103),s=r(60399),c=r(53576),u=r(87279),l=r(48844),d=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},p=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};!function(e){e[e.GroupManager=0]="GroupManager"}(n||(n={}));let f=class{constructor(e,t){this.serverApiClient=e,this.client=t}async addRole({role:e,params:t}){if(e===n.GroupManager)return await this.addGroupManager(t)}async removeRole({role:e,params:t}){if(e===n.GroupManager)return await this.removeGroupManager(t)}async getSpecialUserGroupRevision(e){const{commands:{carbon:t}}=this.client.getClient(c.carbonLegacyApi),r=await t({name:"getSpecialUserGroupRevision",args:[{teamId:e}]});let n;if(!(0,u.d6)(r))throw r.error.error;{const{carbonResult:e}=r.data,{specialUserGroupRevision:t}=e;n=t}return n}async removeGroupManager({memberLogin:e,teamId:t}){const r=await this.getSpecialUserGroupRevision(t);return await(0,s.z)(this.serverApiClient.v1.teams.removeGroupManager({memberLogin:e,userGroupRevision:r}).pipe((0,l.DZ)((e=>{throw new Error(e.message)})),(0,l.lk)((e=>{if(e.data)return(0,u.Vp)(void 0);throw new Error("Unknown server error occurred while attempting to remove group manager")}))))}async addGroupManager({memberLogin:e,teamId:t}){const r=await this.getSpecialUserGroupRevision(t),{commands:{carbon:n}}=this.client.getClient(c.carbonLegacyApi),o=await n({name:"getSpecialUserGroupInviteValuesForMemberInTeam",args:[{memberLogin:e,teamId:t}]});let i="",a="";if(!(0,u.d6)(o))throw o.error.error;{const{carbonResult:e}=o.data,{groupKey:t,proposeSignature:r}=e;i=t,a=r}return await(0,s.z)(this.serverApiClient.v1.teams.addGroupManager({memberLogin:e,groupKey:i,proposeSignature:a,userGroupRevision:r}).pipe((0,l.DZ)((e=>{throw new Error(e.message)})),(0,l.lk)((e=>{if(e.data)return(0,u.Vp)(void 0);throw new Error("Unknown server error occurred while attempting to add group manager")}))))}};f=d([(0,o.Injectable)(),p("design:paramtypes",[a.lX,o.CqrsClient])],f);var h=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},m=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let y=class{constructor(e){this.roleService=e}async execute({body:e}){return await this.roleService.addRole({role:n.GroupManager,params:e})}};y=h([(0,o.CommandHandler)(i.AddGroupManager),m("design:paramtypes",[f])],y);var g=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},v=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let b=class{constructor(e){this.roleService=e}async execute({body:e}){return await this.roleService.removeRole({role:n.GroupManager,params:e})}};b=g([(0,o.CommandHandler)(i.RemoveGroupManager),v("design:paramtypes",[f])],b);var w=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},S=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let R=class{constructor(e){this.serverApiClient=e}getActiveUserPermissions(){return this.serverApiClient.v1.teams.getUserPermissions().pipe((0,l.DZ)((e=>{throw new Error(`getUserPermissions failed with error: ${e}`)})),(0,l.lk)((e=>(0,u.Vp)(this.serverToDomainPermissionsMapper(e.data.permissions)))))}serverToDomainPermissionsMapper(e){return e.filter((e=>i.PermissionSchema.safeParse(e).success))}};R=w([(0,o.Injectable)(),S("design:paramtypes",[a.lX])],R);var E=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},O=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let C=class{constructor(e){this.permissionsService=e}execute(){return this.permissionsService.getActiveUserPermissions()}};C=E([(0,o.QueryHandler)(i.UserPermissionsQuery),O("design:paramtypes",[R])],C);var P=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let A=class{};A=P([(0,o.Module)({api:i.permissionsApi,imports:[a.nr],providers:[R,f],handlers:{commands:{addGroupManager:y,removeGroupManager:b},events:{},queries:{userPermissions:C}}})],A)},70430:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.accountRecoveryKeyApi=void 0;const n=r(68224),o=r(83550),i=r(88522);t.accountRecoveryKeyApi=(0,n.defineModuleApi)({name:"accountRecoveryKey",commands:{goToNextStep:o.GoToNextStepCommand,goToPrevStep:o.GoToPrevStepCommand,requestActivation:o.RequestActivationCommand,cancelActivation:o.CancelActivationCommand,confirmActivation:o.ConfirmActivationCommand},queries:{activationFlowStatus:i.ActivationFlowStatusQuery,accountRecoveryKeyStatus:i.AccountRecoveryKeyStatusQuery},events:{}})},78589:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CancelActivationCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.CancelActivationCommand=o},58661:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfirmActivationCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.ConfirmActivationCommand=o},44387:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoToNextStepCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.GoToNextStepCommand=o},26546:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoToPrevStepCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.GoToPrevStepCommand=o},83550:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(44387),t),o(r(26546),t),o(r(31614),t),o(r(58661),t),o(r(78589),t)},31614:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RequestActivationCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.RequestActivationCommand=o},8532:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(70430),t),o(r(83550),t),o(r(88522),t),o(r(16143),t)},30530:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AccountRecoveryKeyStatusQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.AccountRecoveryKeyStatusQuery=o},76870:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActivationFlowStatusQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.ActivationFlowStatusQuery=o},88522:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(30530),t),o(r(76870),t)},16143:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActivationFlowViewStep=void 0,function(e){e[e.InitActivation=0]="InitActivation",e[e.DisplayKey=1]="DisplayKey",e[e.ConfirmKey=2]="ConfirmKey",e[e.ActivationDone=3]="ActivationDone",e[e.ShowError=4]="ShowError"}(t.ActivationFlowViewStep||(t.ActivationFlowViewStep={}))},31628:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(8532),t)},76683:(e,t,r)=>{"use strict";r.d(t,{D:()=>je});var n=r(27606),o=r(11103),i=r(31628),a=r(87279),s=r(31948),c=r(5331),u=r(53576),l=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},d=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let p=class{constructor(e){this.carbonLegacy=e.getClient(u.carbonLegacyApi)}execute(){try{return Promise.resolve({recoveryKey:"",recoveryId:"",encryptedVaultKey:""})}catch(e){return Promise.reject(new Error("Unable to retrieve initialization data"))}}};p=l([(0,n.Injectable)(),d("design:paramtypes",[n.CqrsClient])],p);var f=r(54066),h=r(89685),m=r(60399),y=r(87065),g=r(30523),v=r(48844),b=r(68224);const w=e=>!(!e||"object"!=typeof e)&&"isEnabled"in e;class S extends((0,n.defineStore)({initialValue:{isEnabled:!1},persist:!1,scope:b.UseCaseScope.User,storeName:"account-recovery-key",storeTypeGuard:w,capacity:n.StoreCapacity._001KB})){}const R="Something went wrong. Check your connection and retry, contact support if you still have issue";var E=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},O=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let C=class{constructor(e,t,r,n){this.store=e,this.serverApiClient=t,this.cqrsClient=r,this.context=n}getCurrentUserLogin(){return this.context.userName}async getCurrentPersonalSettings(){const{carbonStateList:e}=this.cqrsClient.getClient(u.carbonLegacyApi).queries;return await(0,m.z)(e({paths:["userSession.personalSettings.AccountRecoveryKey","userSession.personalSettings.AccountRecoveryKeyId"]}).pipe((0,v.nb)({success:([e,t])=>({AccountRecoveryKey:e,AccountRecoveryKeyId:t}),failure:()=>{throw new Error("Failure getting state list")}})))}getStatus(){return this.store.state$.pipe((0,y.U)((e=>e.isEnabled)))}updateStatus(){const e=this.getCurrentUserLogin();if(!e)throw new Error("No user login provided");this.serverApiClient.v1.accountrecovery.getStatus({login:e}).pipe((0,g.h)(a.d6),(0,v.Qn)((e=>{this.store.set({isEnabled:e.data.enabled})})),(0,v.DZ)((e=>{throw e}))).subscribe()}async generateRecoveryKey(){const{carbon:e}=this.cqrsClient.getClient(u.carbonLegacyApi).commands,t={length:28,digits:!0,letters:!0,avoidAmbiguous:!0,symbols:!1};return await e({name:"generatePassword",args:[{settings:t}]})}async setPersonalSettings(e){const{carbon:t}=this.cqrsClient.getClient(u.carbonLegacyApi).commands;return await t({name:"updateAccountRecoveryKeyPersonalSettings",args:[e]})}async requestActivation(e){try{return await(0,m.z)(this.serverApiClient.v1.accountrecovery.requestActivation({encryptedVaultKey:e}).pipe((0,v.DZ)((e=>{throw new Error(e.message)})),(0,v.lk)((e=>{if(e.data.recoveryId)return(0,a.Vp)(e.data.recoveryId);throw new Error(R)}))))}catch(e){return(0,a.Rn)({tag:"failure",error:R})}}async confirmActivation(e){try{return await(0,m.z)(this.serverApiClient.v1.accountrecovery.confirmActivation({recoveryId:e}).pipe((0,v.DZ)((e=>{throw new Error(e.message)})),(0,v.lk)((()=>(0,a.Vp)(void 0)))))}catch(e){return(0,a.Rn)({tag:"failure",error:R})}}};C=E([(0,n.Injectable)(),O("design:paramtypes",[S,o.lX,n.CqrsClient,n.RequestContext])],C);var P=r(45059),A=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},j=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let _=class{constructor(e,t){this.cqrsClient=e,this.flexibleEncryptor=t}makeDerivationConfig(e){const[,,t]=e.split("$");return"pbkdf2"===t?P.E1:P.mr}async getUserCryptoConfig(){const{carbonStateList:e}=this.cqrsClient.getClient(u.carbonLegacyApi).queries;return await(0,m.z)(e({paths:["userSession.personalSettings.CryptoFixedSalt","userSession.personalSettings.CryptoUserPayload"]}).pipe((0,v.nb)({success:([e,t])=>{if("string"!=typeof e)throw new Error("Fixed salt is not a string");if("string"!=typeof t)throw new Error("Marker is not a string");return{fixedSalt:e,derivationConfig:this.makeDerivationConfig(t)}},failure:()=>{throw new Error("Failure getting state list")}})))}async getUserMasterPassword(){const{carbonState:e}=this.cqrsClient.getClient(u.carbonLegacyApi).queries;return await(0,m.z)(e({path:"userSession.session.masterPassword"}).pipe((0,y.U)((e=>{if(!(0,a.d6)(e))throw new Error("Error when fetching master password from session");const t=e.data;if("string"!=typeof t)throw new Error("Result data is not a string");return(0,f.u)(t)}))))}async encrypt(e){const t=await this.getUserMasterPassword(),{derivationConfig:r,fixedSalt:n}=await this.getUserCryptoConfig();return await this.flexibleEncryptor.encrypt(e,t,r,P.Nw,{salt:(0,f.u)(n)})}};_=A([(0,n.Injectable)(),j("design:paramtypes",[n.CqrsClient,o._M])],_);var T=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},I=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let D=class{constructor(e,t){this.accountRecoveryKeyService=e,this.recoveryKeyEncryptor=t}async executeWithParams(e){if(e.recoveryKey)return{recoveryKey:e.recoveryKey,encryptedVaultKey:e.encryptedVaultKey,recoveryId:e.recoveryId};const t=await this.accountRecoveryKeyService.generateRecoveryKey();if((0,a.hx)(t))throw new Error("Failed to generate a recovery key");const r=(0,f.u)(t.data.carbonResult.password.toUpperCase()),n=await this.recoveryKeyEncryptor.encrypt(r),o=(0,h.v)(n),i=await this.accountRecoveryKeyService.requestActivation(o);if((0,a.hx)(i))throw new Error(`${i.error.error}`);return{recoveryKey:(0,h.v)(r),encryptedVaultKey:o,recoveryId:i.data}}};D=T([(0,n.Injectable)(),I("design:paramtypes",[C,_])],D);var x=r(10203),U=r(66179),M=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},L=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let N=class{constructor(e,t){this.accountRecoveryKeyService=e,this.cqrsClient=t}async sync(e){let t=!1;try{const e=await this.cqrsClient.getClient(U.syncApi).commands.sync({trigger:x.Trigger.Save});if((0,a.hx)(e))throw new Error("Could not sync after activating ARK");t=!0}finally{t||await this.accountRecoveryKeyService.setPersonalSettings(e)}}async executeWithParams(e,t){const r=await this.accountRecoveryKeyService.getCurrentPersonalSettings(),n={AccountRecoveryKey:e,AccountRecoveryKeyId:t};await this.accountRecoveryKeyService.setPersonalSettings(n),this.sync(r);const o=await this.accountRecoveryKeyService.confirmActivation(t);if((0,a.hx)(o))throw this.accountRecoveryKeyService.setPersonalSettings(r),this.sync(r),new Error("Could not confirm ARK activation");return this.accountRecoveryKeyService.updateStatus(),Promise.resolve()}};N=M([(0,n.Injectable)(),L("design:paramtypes",[C,n.CqrsClient])],N);var k=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},F=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let V=class{constructor(e,t,r){this.initializeMachineService=e,this.requestActivationService=t,this.confirmActivationService=r}create(){return(0,s.C)({predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Starting",id:"ActivationFlowMachine",context:{recoveryKey:"",recoveryId:"",encryptedVaultKey:""},states:{Starting:{invoke:{src:"initializeMachine",onDone:{actions:["assignInitialContext"],target:"InitAccountRecoveryKeyActivation"}}},InitAccountRecoveryKeyActivation:{on:{REQUEST_ACTIVATION:{target:"DisplayAccountRecoveryKey"},CANCEL_ACTIVATION:{actions:["clearContext"],target:"Starting"}}},DisplayAccountRecoveryKey:{invoke:{src:"requestActivation",onDone:{actions:["assignKeys"]},onError:{actions:["assignError"],target:"AccountRecoveryKeyActivationError"}},on:{GO_TO_NEXT_STEP:{target:"ConfirmAccountRecoveryKey"},CANCEL_ACTIVATION:{actions:["clearContext"],target:"Starting"}}},ConfirmAccountRecoveryKey:{on:{GO_TO_NEXT_STEP:{target:"AccountRecoveryKeyActivationDone"},GO_TO_PREV_STEP:{target:"DisplayAccountRecoveryKey"},CANCEL_ACTIVATION:{actions:["clearContext"],target:"Starting"}}},AccountRecoveryKeyActivationDone:{invoke:{src:"confirmActivation",onError:{actions:["assignError"],target:"AccountRecoveryKeyActivationError"}},on:{CANCEL_ACTIVATION:{actions:["clearContext"],target:"Starting"}}},AccountRecoveryKeyActivationError:{type:"final"}},on:{CLEAR_ERROR:{actions:["clearError"]}}},{actions:{assignInitialContext:(0,c.f0)({encryptedVaultKey:(e,t)=>t.data.encryptedVaultKey,recoveryKey:(e,t)=>t.data.recoveryKey,recoveryId:(e,t)=>t.data.recoveryId}),assignKeys:(0,c.f0)({recoveryKey:(e,t)=>t.data.recoveryKey,encryptedVaultKey:(e,t)=>t.data.encryptedVaultKey,recoveryId:(e,t)=>t.data.recoveryId}),assignError:(0,c.f0)({error:(e,t)=>t.data}),clearContext:(0,c.f0)({encryptedVaultKey:()=>"",recoveryKey:()=>"",recoveryId:()=>"",error:()=>{}}),clearError:(0,c.f0)({error:()=>{}})},services:{initializeMachine:()=>this.initializeMachineService.execute(),requestActivation:e=>this.requestActivationService.executeWithParams(e),confirmActivation:e=>this.confirmActivationService.executeWithParams(e.recoveryKey,e.recoveryId)}})}};V=k([(0,n.Injectable)(),F("design:paramtypes",[p,D,N])],V);var q=r(64472),G=r(24966),B=r(26290);const H=e=>!0;class W extends((0,n.defineStore)({initialValue:void 0,persist:!1,scope:b.UseCaseScope.Device,storeName:"activation-flow-machine",storeTypeGuard:H})){}var K=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},z=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let $=class{constructor(e,t,r){this.activationMachineStore=t,this.cqrsClient=r;const n=e.create();this.interpreter=q.kJ(n).onTransition((async e=>{e.changed||"xstate.init"===e.event.type||console.warn(`[ARK Activation] State is unchanged. Unexpected transition on ${JSON.stringify(e.value)} with event ${e.event.type} `);try{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.activationMachineStore,e)}catch(e){console.warn("[ARK Activation] Unable to get snapshot",e)}})),this.prepare()}async prepare(){if(this.interpreter)try{const e=await(async e=>{const t=await e.getState();return t?B.ZM.create(JSON.parse(t)):void 0})(this.activationMachineStore);try{this.interpreter.start(e)}catch(e){console.error("[ARK Activation] Unable to reuse the stored state: ",e),this.interpreter.start()}}catch(e){console.error("[ARK Activation] Unable to start machine",e)}}ready(){return new G.X(!0)}continue(e){if(!this.interpreter)throw new Error("Activation flow not started");this.interpreter.send(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}};$=K([(0,n.Injectable)(),z("design:paramtypes",[V,W,n.CqrsClient])],$);var Q,Y=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},J=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let X=Q=class{constructor(e,t,r,n){this.machine=e,this.store=t,this.cqrsClient=r,this.logger=n}getInstance(){return Q.instance||(Q.instance=new $(this.machine,this.store,this.cqrsClient)),Q.instance}};X=Q=Y([(0,n.Injectable)(),J("design:paramtypes",[V,W,n.CqrsClient,n.AppLogger])],X);var Z=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ee=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let te=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.getInstance().continue({type:"GO_TO_NEXT_STEP"}),Promise.resolve((0,a.Vp)(void 0))}};te=Z([(0,n.CommandHandler)(i.GoToNextStepCommand),ee("design:paramtypes",[X])],te);var re=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ne=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let oe=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.getInstance().continue({type:"GO_TO_PREV_STEP"}),Promise.resolve((0,a.Vp)(void 0))}};oe=re([(0,n.CommandHandler)(i.GoToPrevStepCommand),ne("design:paramtypes",[X])],oe);var ie=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ae=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let se=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.getInstance().continue({type:"REQUEST_ACTIVATION"}),Promise.resolve((0,a.Vp)(void 0))}};se=ie([(0,n.CommandHandler)(i.RequestActivationCommand),ae("design:paramtypes",[X])],se);var ce=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ue=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let le=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.getInstance().continue({type:"CANCEL_ACTIVATION"}),Promise.resolve((0,a.Vp)(void 0))}};le=ce([(0,n.CommandHandler)(i.CancelActivationCommand),ue("design:paramtypes",[X])],le);var de=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},pe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let fe=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.getInstance().continue({type:"GO_TO_NEXT_STEP"}),Promise.resolve((0,a.Vp)(void 0))}};fe=de([(0,n.CommandHandler)(i.ConfirmActivationCommand),pe("design:paramtypes",[X])],fe);var he=r(85390),me=r(6136),ye=r(69885),ge=r(6220);const ve=e=>(0,ye.of)((0,a.Vp)(function(e){return e.matches("Starting")||e.matches("InitAccountRecoveryKeyActivation")?{step:i.ActivationFlowViewStep.InitActivation}:e.matches("DisplayAccountRecoveryKey")?{step:i.ActivationFlowViewStep.DisplayKey,recoveryKey:e.context.recoveryKey}:e.matches("ConfirmAccountRecoveryKey")?{step:i.ActivationFlowViewStep.ConfirmKey,recoveryKey:e.context.recoveryKey}:e.matches("AccountRecoveryKeyActivationDone")?{step:i.ActivationFlowViewStep.ActivationDone}:e.matches("AccountRecoveryKeyActivationError")?{step:i.ActivationFlowViewStep.ShowError}:void console.warn("[ARK Activation] - No view associated to state ",e.value)}(e))),be=e=>e.pipe((0,ge.z)(ve));var we=r(52800);var Se=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Re=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ee=class{constructor(e,t){this.activationFlow=e,this.activationFlowMachineStore=t}execute(){return(0,he.a)([(e=this.activationFlowMachineStore,e.state$.pipe((0,y.U)((e=>e?B.ZM.create(JSON.parse(e)):void 0)))),this.activationFlow.getInstance().ready()],((e,t)=>{if(e&&t)return e})).pipe((0,g.h)(Boolean),(0,me.x)(((e,t)=>((e,t)=>{const r=t.matches(e.value),n=(0,we.Z)(e.context,t.context);return r&&n})(e,t))),be);var e}};Ee=Se([(0,n.QueryHandler)(i.ActivationFlowStatusQuery),Re("design:paramtypes",[X,W])],Ee);var Oe=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Ce=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Pe=class{constructor(e){this.accountRecoveryKeyService=e}execute(){return this.accountRecoveryKeyService.updateStatus(),this.accountRecoveryKeyService.getStatus().pipe((0,y.U)((e=>(0,a.Vp)({isEnabled:e}))))}};Pe=Oe([(0,n.QueryHandler)(i.AccountRecoveryKeyStatusQuery),Ce("design:paramtypes",[C])],Pe);var Ae=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let je=class{};je=Ae([(0,n.Module)({api:i.accountRecoveryKeyApi,stores:[W,S],imports:[o.nr,o.Dq],handlers:{commands:{goToNextStep:te,goToPrevStep:oe,requestActivation:se,cancelActivation:le,confirmActivation:fe},events:{},queries:{activationFlowStatus:Ee,accountRecoveryKeyStatus:Pe}},providers:[X,V,p,C,D,N,_]})],je)},23293:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(46942),t)},38835:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.overridesApi=void 0;const n=r(68224),o=r(98329);t.overridesApi=(0,n.defineModuleApi)({name:"overrides",commands:{},events:{},queries:{OverridesQuery:o.OverridesQuery}})},46942:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(38835),t),o(r(98329),t),o(r(58321),t)},57848:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OverridesQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.Device})){}t.OverridesQuery=o},98329:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(57848),t)},58321:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isOverridesFileFormat=void 0;t.isOverridesFileFormat=e=>null!=e&&"object"==typeof e&&Object.values(e).every((e=>Array.isArray(e)&&e.every((e=>(e=>{if(!e||"object"!=typeof e)return!1;const t="type"in e&&void 0!==e.type&&("startsWith"===e.type||"regexp"===e.type),r="value"in e&&void 0!==e.value&&(Array.isArray(e.value)&&e.value.every((e=>"string"==typeof e))||"string"==typeof e.value),n="conditions"in e&&void 0!==e.conditions&&Array.isArray(e.conditions)&&e.conditions.every((e=>(e=>{const t="type"in e&&void 0!==e.type&&("css"===e.type||"xpath"===e.type),r="selector"in e&&void 0!==e.selector&&"string"==typeof e.selector;return t&&r})(e))),o="actions"in e&&void 0!==e.actions&&Array.isArray(e.actions)&&e.actions.every((e=>(e=>{const t="type"in e&&void 0!==e.type&&("set"===e.type||"ignore"===e.type),r="cssSelector"in e&&void 0!==e.cssSelector&&"string"==typeof e.cssSelector;return t&&r})(e)));return t&&r&&n&&o})(e)))))},93653:(e,t,r)=>{"use strict";r.d(t,{x:()=>v});var n=r(27606),o=r(23293),i=r(11103),a=r(68224),s=r(45059);const c=()=>({fileNameToRevision:{"graphene-encrypt-overrides.json":{fileName:"graphene-encrypt-overrides.json",revision:1,buffer:new ArrayBuffer(0),lastDownloadTimestamp:Date.now()}},data:{}});class u extends((0,n.defineStore)({storeName:"OverridesStore",persist:!0,storage:{schemaVersion:1,initialValue:c(),typeGuard:i.Fk},codec:s.Eu,storeTypeGuard:i.Fk,capacity:n.StoreCapacity._010KB,scope:a.UseCaseScope.Device})){}var l=r(87279),d=r(87065),p=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},f=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let h=class{constructor(e){this.rfuClient=e}execute(){return this.rfuClient.streamFileUpdate().pipe((0,d.U)((e=>(0,l.Vp)({overrides:e}))))}};h=p([(0,n.QueryHandler)(o.OverridesQuery),f("design:paramtypes",[i.wB])],h);var m=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},y=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let g=class{constructor(e,t){this.rfuClient=e,this.appLogger=t}onFrameworkInit(){this.rfuClient.initFileObservation()}};g=m([(0,n.FrameworkInit)(),y("design:paramtypes",[i.wB,n.AppLogger])],g);let v=class{};v=m([(0,n.Module)({api:o.overridesApi,providers:[(0,i.uo)({fileName:"graphene-encrypt-overrides.json",storeClass:u,typeguard:o.isOverridesFileFormat})],onFrameworkInit:g,imports:[i.QS],stores:[u],handlers:{commands:{},events:{},queries:{overrides:h}}})],v)},21138:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.authenticationFlowApi=void 0;const n=r(68224),o=r(37773),i=r(31477);t.authenticationFlowApi=(0,n.defineModuleApi)({name:"authenticationFlow",commands:{changeLogin:i.ChangeAccountEmailCommand,changeTwoFactorAuthenticationOtpType:i.ChangeTwoFactorAuthenticationOtpTypeCommand,clearError:i.ClearErrorCommand,resendEmailToken:i.ResendEmailTokenCommand,resendPushNotification:i.ResendPushNotificationCommand,sendAccountEmail:i.SendAccountEmailCommand,sendMasterPassword:i.SendMasterPasswordCommand,submitBackupCode:i.SubmitBackupCodeCommand,submitEmailToken:i.SubmitEmailTokenCommand,submitTotp:i.SubmitTotpCommand,switchToDashlaneAuthenticator:i.SwitchToDashlaneAuthenticatorCommand,switchToEmailToken:i.SwitchToEmailTokenCommand,retryWebAuthnAuthentication:i.RetryWebAuthnAuthenticationCommand,useMasterPassword:i.UseMasterPasswordCommand,webAuthnAuthenticationFail:i.WebAuthnAuthenticationFailCommand,logout:i.LogoutCommand,lockSession:i.LockCommand,loginViaSSO:i.LoginViaSSOCommand,initiateLoginWithSSO:i.InitiateLoginWithSSOCommand,initiateAutologinWithSSOCommand:i.InitiateAutologinWithSSOCommand},queries:{authenticationFlowStatus:o.AuthenticationFlowStatusQuery,getSsoInfoQuery:o.GetSsoInfoQuery},events:{}})},31477:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InitiateAutologinWithSSOCommand=t.InitiateLoginWithSSOCommand=t.LoginViaSSOCommand=t.LockCommand=t.LogoutCommand=t.WebAuthnAuthenticationFailCommand=t.UseMasterPasswordCommand=t.RetryWebAuthnAuthenticationCommand=t.ClearErrorCommand=t.SwitchToEmailTokenCommand=t.ResendPushNotificationCommand=t.SendMasterPasswordCommand=t.ResendEmailTokenCommand=t.ChangeTwoFactorAuthenticationOtpTypeCommand=t.SubmitBackupCodeCommand=t.SubmitTotpCommand=t.SubmitEmailTokenCommand=t.SwitchToDashlaneAuthenticatorCommand=t.ChangeAccountEmailCommand=t.SendAccountEmailCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.SendAccountEmailCommand=o;class i extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.ChangeAccountEmailCommand=i;class a extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.SwitchToDashlaneAuthenticatorCommand=a;class s extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.SubmitEmailTokenCommand=s;class c extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.SubmitTotpCommand=c;class u extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.SubmitBackupCodeCommand=u;class l extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.ChangeTwoFactorAuthenticationOtpTypeCommand=l;class d extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.ResendEmailTokenCommand=d;class p extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.SendMasterPasswordCommand=p;class f extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.ResendPushNotificationCommand=f;class h extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.SwitchToEmailTokenCommand=h;class m extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.ClearErrorCommand=m;class y extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.RetryWebAuthnAuthenticationCommand=y;class g extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.UseMasterPasswordCommand=g;class v extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.WebAuthnAuthenticationFailCommand=v;class b extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.LogoutCommand=b;class w extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.LockCommand=w;class S extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.LoginViaSSOCommand=S;class R extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.InitiateLoginWithSSOCommand=R;class E extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.InitiateAutologinWithSSOCommand=E},37773:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetSsoInfoQuery=t.AuthenticationFlowStatusQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.Device})){}t.AuthenticationFlowStatusQuery=o;class i extends((0,n.defineQuery)({scope:n.UseCaseScope.Device})){}t.GetSsoInfoQuery=i},27549:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SSOMigrationType=t.SsoMigrationServerMethod=void 0,function(e){e.SSO="sso",e.MP="master_password"}(t.SsoMigrationServerMethod||(t.SsoMigrationServerMethod={})),function(e){e[e.MP_TO_SSO=0]="MP_TO_SSO",e[e.MP_TO_SSO_WITH_INFO=1]="MP_TO_SSO_WITH_INFO",e[e.SSO_TO_MP=2]="SSO_TO_MP"}(t.SSOMigrationType||(t.SSOMigrationType={}))},35105:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(21138),t),o(r(31477),t),o(r(37773),t),o(r(27549),t)},42712:(e,t,r)=>{"use strict";r.d(t,{cl:()=>wr,RE:()=>f,Qo:()=>d});var n=r(27606),o=r(60399),i=r(87065),a=r(28489),s=r(87279),c=r(53576),u=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},l=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let d=class{constructor(e){this.cqrsClient=e}getDeviceCredentialsForUser(e){const{queries:{carbonStateList:t}}=this.cqrsClient.getClient(c.carbonLegacyApi);return(0,o.z)(t({paths:["authentication.currentUser.deviceKeys","userSession.account.login"]}).pipe((0,i.U)((e=>{if((0,s.hx)(e))throw new Error("Failed to get credentials from carbon");return(0,s.db)(e)})),(0,i.U)((([t,r])=>{if(!t||r!==e)throw new Error("No user device credentials available for active user");if(!((n=t)&&"object"==typeof n&&(0,a.l$)(n,"accessKey")&&(0,a.l$)(n,"secretKey")&&"string"==typeof n.accessKey&&"string"==typeof n.secretKey))throw new Error("Unexpected user device state shape received from carbon");var n;return{login:e,deviceAccessKey:t.accessKey,deviceSecretKey:t.secretKey}}))))}};d=u([(0,n.Injectable)(),l("design:paramtypes",[n.CqrsClient])],d);var p=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let f=class{};f=p([(0,n.Module)({sharedModuleName:"authentication",providers:[d],exports:[d]})],f);var h=r(35105),m=r(11103),y=r(5331),g=r(31948),v=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},b=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let w=class{constructor(e){this.carbonLegacy=e.getClient(c.carbonLegacyApi)}async executeWithParams({login:e,masterPassword:t,isRememberMeEnabled:r}){try{return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithMasterPassword",arg:[{login:e,password:t,rememberPassword:r,requiredPermissions:void 0}]}),Promise.resolve()}catch(e){}}};w=v([(0,n.Injectable)(),b("design:paramtypes",[n.CqrsClient])],w);var S=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},R=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let E=class{constructor(e){this.carbonLegacy=e.getClient(c.carbonLegacyApi)}async execute(){try{const e=await this.carbonLegacy.commands.carbon({name:"checkDoesLocalRecoveryKeyExist",args:[]});if(!(0,s.d6)(e))throw new Error("Carbon command failed");return{isAccountRecoveryAvailable:e.data.carbonResult.doesExist}}catch(e){return{isAccountRecoveryAvailable:!1}}}};E=S([(0,n.Injectable)(),R("design:paramtypes",[n.CqrsClient])],E);var O=r(30523),C=r(62013),P=r(70027),A=r(26290),j=r(68224);const _=e=>!0;class T extends((0,n.defineStore)({initialValue:void 0,persist:!1,scope:j.UseCaseScope.Device,storeName:"authentication-flow-machine",storeTypeGuard:_})){}var I=r(45059);const D=e=>!(!e||"object"!=typeof e)&&"rememberMeForSSOPreference"in e;class x extends((0,n.defineStore)({codec:I.Eu,persist:!0,storage:{initialValue:{rememberMeForSSOPreference:!0},schemaVersion:1,typeGuard:D},scope:j.UseCaseScope.Device,storeName:"sso-info",storeTypeGuard:D,capacity:n.StoreCapacity._001KB})){}class U{}var M=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},L=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const N=e=>!!e&&"object"==typeof e&&(0,a.l$)(e,"ssoUser")&&(0,a.l$)(e,"serviceProviderUrl");let k=class{constructor(e,t,r){this.ssoInfoStore=t,this.client=e,this.authenticationFlowInfraContext=r}async retrieveSSOInfo(){const e=await(0,o.z)(this.client.getClient(c.carbonLegacyApi).queries.carbonState({path:"userSession.ssoSettings"}).pipe((0,i.U)((e=>{if(!(0,s.d6)(e)||!N(e.data))throw new Error("SsoSettings is not of the expected type");return e.data}))));return{isNitroProvider:e.isNitroProvider??!1,serviceProviderUrl:e.serviceProviderUrl}}async execute(e){const{loginUserWithEnclaveSSO:t}=this.client.getClient(P.enclaveSdkApi).commands,r=await this.retrieveSSOInfo(),{login:n,rememberMeForSSOPreference:o}=e.body;return await this.ssoInfoStore.set({rememberMeForSSOPreference:o}),r.isNitroProvider?await t({userEmailAddress:n}):this.authenticationFlowInfraContext.redirectUserToExternalUrl({externalUrl:r.serviceProviderUrl,tabFocus:!0}),Promise.resolve((0,s.Vp)(void 0))}};k=M([(0,n.CommandHandler)(h.InitiateLoginWithSSOCommand),L("design:paramtypes",[n.CqrsClient,x,U])],k);var F=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},V=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let q=class{constructor(e){this.carbonLegacy=e.getClient(c.carbonLegacyApi)}async retrieveSSOSettings(){return await(0,o.z)(this.carbonLegacy.queries.carbonStateList({paths:["userSession.ssoSettings","userSession.account.isAuthenticated"]}).pipe((0,i.U)((e=>{if(!((t=e)&&"object"==typeof t&&(0,a.l$)(t,"data")&&(0,C.isArray)(t.data)&&N(t.data[0])&&"boolean"==typeof t.data[1]))throw new Error("LoginStatus is not of the expected type");if(e.data[1])return e.data[0];var t})),(0,O.h)((e=>void 0!==e))))}async execute(){try{const e=await this.retrieveSSOSettings();if(N(e))return{serviceProviderRedirectUrl:e.serviceProviderUrl,isNitroProvider:e.isNitroProvider,migration:e.migration};throw new Error("ssoSettings is not of the expected type")}catch(e){return{serviceProviderRedirectUrl:void 0,isNitroProvider:void 0,migration:void 0}}}};q=F([(0,n.Injectable)(),V("design:paramtypes",[n.CqrsClient])],q);var G=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},B=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let H=class{constructor(e,t,r){this.masterPasswordService=t,this.accountRecoveryStatusService=e,this.checkForLoginStatusUpdateService=r}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"CheckingAccountRecoveryStatus",id:"MasterPasswordFlowMachine",context:{isRememberMeEnabled:!1,isAccountRecoveryAvailable:!1},states:{CheckingAccountRecoveryStatus:{invoke:{src:"checkAccountRecoveryStatus",onDone:{target:"WaitingForMasterPassword",actions:["assignAccountRecoveryStatus"]}}},WaitingForMasterPassword:{on:{INPUT_MASTER_PASSWORD:{target:"ValidatingMasterPassword",actions:["assignMasterPassword"]}}},ValidatingMasterPassword:{entry:["authenticateWithMasterPassword"],on:{CARBON_LEGACY_LOGIN_STATUS_CHANGED:[{target:"MigrationNeeded",cond:"shouldTriggerMigration"},{target:"MasterPasswordDone",cond:"isLoggedIn"}],CARBON_LEGACY_ERROR:{target:"WaitingForMasterPassword",actions:["assignError"]},DEVICE_LIMIT_ABORTED:{target:"DeviceLimitAborted"}}},MigrationNeeded:{invoke:{src:"checkForLoginStatusUpdate",onDone:{target:"MPToSSOMigration",actions:["assignSSOMigrationStatus"]}}},MPToSSOMigration:{},DeviceLimitAborted:{type:"final",data:{shouldResetAuthenticationFlow:!0}},MasterPasswordDone:{type:"final",data:{shouldResetAuthenticationFlow:!1}}}},options:{actions:{assignMasterPassword:(0,y.f0)({masterPassword:(e,t)=>t.masterPassword,isRememberMeEnabled:(e,t)=>t.rememberMe}),assignAccountRecoveryStatus:(0,y.f0)({isAccountRecoveryAvailable:(e,t)=>t.data.isAccountRecoveryAvailable}),assignError:(0,y.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),assignSSOMigrationStatus:(0,y.f0)({migration:(e,t)=>t.data.migration,serviceProviderRedirectUrl:(e,t)=>t.data.serviceProviderRedirectUrl,isNitroProvider:(e,t)=>t.data.isNitroProvider}),authenticateWithMasterPassword:e=>{const{login:t,masterPassword:r,isRememberMeEnabled:n}=e;return this.masterPasswordService.executeWithParams({login:t??"",masterPassword:r??"",isRememberMeEnabled:n})}},services:{checkAccountRecoveryStatus:()=>this.accountRecoveryStatusService.execute(),checkForLoginStatusUpdate:()=>this.checkForLoginStatusUpdateService.execute()},guards:{shouldTriggerMigration:(e,t)=>t.needsSSOMigration??!1,isLoggedIn:(e,t)=>t.loggedIn}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};H=G([(0,n.Injectable)(),B("design:paramtypes",[E,w,q])],H);var W=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},K=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let z=class{constructor(e){this.carbonLegacy=e.getClient(c.carbonLegacyApi)}async execute(e){try{return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionResendToken",arg:[{login:e.login??""}]}),Promise.resolve()}catch(e){}}};z=W([(0,n.Injectable)(),K("design:paramtypes",[n.CqrsClient])],z);var $=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Q=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Y=class{constructor(e){this.carbonLegacy=e.getClient(c.carbonLegacyApi)}async execute(e){try{await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithToken",arg:[{login:e.login??"",password:null,token:e.emailToken??"",persistData:!0,deviceName:e.deviceName}]})}catch(e){}}};Y=$([(0,n.Injectable)(),Q("design:paramtypes",[n.CqrsClient])],Y);var J=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},X=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Z=class{constructor(e){this.carbonLegacy=e.getClient(c.carbonLegacyApi)}async requestCodeAgainstServer(){}async execute({login:e}){return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithDashlaneAuthenticator",arg:[{login:e,password:null,persistData:!0,deviceName:""}]}),Promise.resolve()}async cancel(){return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"cancelDashlaneAuthenticatorRegistration",arg:[]}),Promise.resolve()}};Z=J([(0,n.Injectable)(),X("design:paramtypes",[n.CqrsClient])],Z);var ee=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},te=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let re=class{constructor(e,t){this.dashlaneAuthenticatorService=e,this.sendEmailToken=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"AuthenticatorMachine",context:{isDashlaneAuthenticatorAvailable:!1},initial:"RequestingServerPush",states:{RequestingServerPush:{entry:["updateDashlaneAuthenticatorAvailability"],invoke:{src:"authenticateWithDashlaneAuthenticator"},on:{CARBON_LEGACY_ERROR:{actions:["assignError","updateDashlaneAuthenticatorAvailability"]},RESEND_PUSH_NOTIFICATION:{target:"RequestingServerPush",actions:["clearError"]},SWITCH_TO_EMAIL_TOKEN:{actions:["cancelDashlaneAuthenticator","clearError"],target:"EmailTokenRequested"}}},AuthenticatorPushValidated:{type:"final",data:{switchToEmailToken:!1}},EmailTokenRequested:{entry:["sendEmailToken"],type:"final",data:{switchToEmailToken:!0}}}},options:{actions:{clearError:(0,y.f0)({error:()=>{}}),assignError:(0,y.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),switchToEmailToken:(0,y.f0)({switchToEmailToken:()=>!0}),updateDashlaneAuthenticatorAvailability:(0,y.f0)({isDashlaneAuthenticatorAvailable:!0}),cancelDashlaneAuthenticator:()=>{this.dashlaneAuthenticatorService.cancel()},sendEmailToken:e=>{const{login:t}=e;this.sendEmailToken.execute({login:t})}},services:{authenticateWithDashlaneAuthenticator:e=>{const{login:t}=e;return this.dashlaneAuthenticatorService.execute({login:t})}},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};re=ee([(0,n.Injectable)(),te("design:paramtypes",[Z,z])],re);var ne=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},oe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ie=class{constructor(e,t){this.authenticateWithEmailToken=e,this.sendEmailToken=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"EmailTokenMachine",context:{login:"",emailToken:"",deviceName:""},initial:"WaitingForEmailToken",states:{SendEmailToken:{invoke:{src:"sendEmailToken",onError:{target:"WaitingForEmailToken"},onDone:{target:"WaitingForEmailToken"}}},WaitingForEmailToken:{on:{INPUT_EMAIL_TOKEN:{target:"ValidatingEmailToken",actions:["assignEmailToken"]},RESEND_EMAIL_TOKEN:{target:"SendEmailToken",actions:["clearError"]}}},ValidatingEmailToken:{entry:["authenticateWithEmailToken"],on:{CARBON_LEGACY_ERROR:{target:"WaitingForEmailToken",actions:["assignError"]}}},FinishingEmailToken:{type:"final",data:{switchToDashlaneAuthenticator:!1}},DashlaneAuthenticatorRequested:{type:"final",data:{switchToDashlaneAuthenticator:!0}}},on:{SWITCH_TO_DASHLANE_AUTHENTICATOR:{target:".DashlaneAuthenticatorRequested",internal:!0,actions:["clearError"]}}},options:{actions:{clearError:(0,y.f0)({error:()=>{}}),assignError:(0,y.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),assignEmailToken:(0,y.f0)({emailToken:(e,t)=>t.emailToken}),authenticateWithEmailToken:e=>{const{deviceName:t,emailToken:r,login:n}=e;return this.authenticateWithEmailToken.execute({deviceName:t,emailToken:r,login:n})}},services:{sendEmailToken:e=>{const{login:t}=e;return this.sendEmailToken.execute({login:t})}},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};ie=ne([(0,n.Injectable)(),oe("design:paramtypes",[Y,z])],ie);const ae=e=>({initial:e.initial,states:e.states,on:e.on??{}});var se=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ce=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ue=class{constructor(e,t){this.authenticatorMachine=e,this.emailTokenMachine=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{},guards:{}},id:"DeviceRegistrationMachine",context:{...this.authenticatorMachine.desc().config.context,...this.emailTokenMachine.desc().config.context,registrationMethod:void 0},initial:"StartDeviceRegistration",states:{StartDeviceRegistration:{always:[{target:"EmailToken",cond:"isRegistrationMethodEmailToken"},{target:"DashlaneAuthenticator",cond:"isRegistrationMethodAuthenticator"},{target:"TwoFactorAuthentication",cond:"isRegistrationMethodOTP"}]},DashlaneAuthenticator:{...ae(this.authenticatorMachine.desc().config),onDone:[{target:"EmailToken",cond:"shouldSwitchToEmailToken"},{target:"DeviceRegistrationDone"}]},EmailToken:{...ae(this.emailTokenMachine.desc().config),onDone:[{target:"DashlaneAuthenticator",cond:"shouldSwitchToAuthenticator"},{target:"DeviceRegistrationDone"}]},TwoFactorAuthentication:{onDone:{target:"DeviceRegistrationDone"}},DeviceRegistrationDone:{type:"final"}}},options:{actions:{...this.authenticatorMachine.desc().options.actions,...this.emailTokenMachine.desc().options.actions,assignUnknownDeviceRegistrationError:(0,y.f0)({error:()=>({code:"unknown_error",data:{message:"Unknown device registration error"}})})},services:{...this.authenticatorMachine.desc().options.services,...this.emailTokenMachine.desc().options.services},guards:{...this.authenticatorMachine.desc().options.guards,...this.emailTokenMachine.desc().options.guards,isRegistrationMethodEmailToken:e=>"email_token"===e.registrationMethod,isRegistrationMethodOTP:e=>"otp"===e.registrationMethod,isRegistrationMethodAuthenticator:e=>"dashlane_authenticator"===e.registrationMethod,shouldSwitchToEmailToken:(e,t)=>t.data.switchToEmailToken,shouldSwitchToAuthenticator:(e,t)=>t.data.switchToDashlaneAuthenticator}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};ue=se([(0,n.Injectable)(),ce("design:paramtypes",[re,ie])],ue);var le=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let de=class{desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"WebAuthnMachine",context:{},initial:"InitWebAuthnAuthentication",states:{InitWebAuthnAuthentication:{on:{WEBAUTHN_AUTHENTICATION_FAIL:{target:"WebAuthnAuthenticationFailed",actions:["assignWebAuthnError"]}}},WebAuthnAuthenticationFailed:{on:{RETRY_WEBAUTHN_AUTHENTICATION:{target:"InitWebAuthnAuthentication",actions:["clearError"]}}},WebAuthnAuthenticationDone:{type:"final",data:{switchToMasterPassword:!1}},MasterPasswordRequested:{type:"final",data:{switchToMasterPassword:!0}}},on:{USE_MASTER_PASSWORD:{actions:["clearError"],target:".MasterPasswordRequested",internal:!0}}},options:{actions:{clearError:(0,y.f0)({error:()=>{}}),assignWebAuthnError:(0,y.f0)({error:(e,t)=>t.error})},services:{},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};de=le([(0,n.Injectable)()],de);var pe=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},fe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let he=class{constructor(e){this.carbonLegacy=e.getClient(c.carbonLegacyApi)}executeWithParams({login:e,masterPassword:t,otp:r,twoFactorAuthenticationOtpType:n,otpVerificationMode:o,deviceName:i}){const a={login:e,password:t??null,otp:r,withBackupCode:"backupCode"===n,persistData:!0};try{"otp2"===o?this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithOTP",arg:[{...a,deviceName:i}]}):"otp1"===o&&this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithOTPForNewDevice",arg:[a]})}catch(e){}return Promise.resolve()}};he=pe([(0,n.Injectable)(),fe("design:paramtypes",[n.CqrsClient])],he);var me=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ye=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ge=class{constructor(e){this.twoFactorAuthenticationService=e}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"WebAuthnMachine",context:{twoFactorAuthenticationOtpType:"totp"},initial:"WaitingForTotp",states:{WaitingForTotp:{on:{INPUT_TOTP:{target:"ValidatingTwoFactorAuthenticationOtp",actions:["assignTwoFactorAuthenticationOtpValue"]},SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE:{target:"WaitingForBackupCode",actions:["assignTwoFactorAuthenticationOtpType","clearError"]}}},WaitingForBackupCode:{on:{INPUT_BACKUP_CODE:{target:"ValidatingTwoFactorAuthenticationOtp",actions:["assignTwoFactorAuthenticationOtpValue"]},SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE:{target:"WaitingForTotp",actions:["assignTwoFactorAuthenticationOtpType","clearError"]}}},ValidatingTwoFactorAuthenticationOtp:{entry:["authenticateWithTwoFactorAuthentication"],on:{CARBON_LEGACY_ERROR:[{target:"WaitingForBackupCode",cond:"isBackupCode",actions:["assignError"]},{target:"WaitingForTotp",actions:["assignError"]}]}},TwoFactorAuthenticationDone:{type:"final"}}},options:{actions:{assignError:(0,y.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),clearError:(0,y.f0)({error:()=>{}}),assignTwoFactorAuthenticationOtpValue:(0,y.f0)({twoFactorAuthenticationOtpValue:(e,t)=>t.twoFactorAuthenticationOtpValue}),assignTwoFactorAuthenticationOtpType:(0,y.f0)({twoFactorAuthenticationOtpType:(e,t)=>t.twoFactorAuthenticationOtpType}),authenticateWithTwoFactorAuthentication:e=>{const t={login:e.login??"",masterPassword:e.masterPassword??null,otp:e.twoFactorAuthenticationOtpValue,twoFactorAuthenticationOtpType:e.twoFactorAuthenticationOtpType,persistData:!0,otpVerificationMode:e.otpVerificationMode,deviceName:e.deviceName};this.twoFactorAuthenticationService.executeWithParams(t)}},services:{},guards:{isBackupCode:e=>"backupCode"===e.twoFactorAuthenticationOtpType}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};ge=me([(0,n.Injectable)(),ye("design:paramtypes",[he])],ge);var ve=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},be=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let we=class{constructor(e){this.carbonLegacy=e.getClient(c.carbonLegacyApi)}retrieveLocalAccounts(e){return(0,o.z)(e.queries.carbonState({path:"authentication.localAccounts"}).pipe((0,O.h)(s.d6),(0,O.h)((e=>e.data.accountsListInitialized)),(0,i.U)((e=>e.data.accountsList))))}async execute(){try{const e=await this.retrieveLocalAccounts(this.carbonLegacy),t=e?.find((e=>e.isLastSuccessfulLogin));return{localAccounts:e??[],lastUsedLogin:t?.login??"",shouldAskMasterPassword:t?.shouldAskMasterPassword??!1,shouldAskOTP:t?.hasLoginOtp??!1,rememberMeType:t?.rememberMeType??"disabled"}}catch(e){return Promise.reject(new Error("Unable to retrieve initialization data"))}}};we=ve([(0,n.Injectable)(),be("design:paramtypes",[n.CqrsClient])],we);var Se=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Re=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ee=class{constructor(e){this.carbonLegacy=e.getClient(c.carbonLegacyApi)}async execute(e){try{await this.carbonLegacy.commands.carbon({name:"loginViaSSO",args:[e]})}catch(e){}}};Ee=Se([(0,n.Injectable)(),Re("design:paramtypes",[n.CqrsClient])],Ee);var Oe=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Ce=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Pe=class{constructor(e){this.carbonLegacy=e.getClient(c.carbonLegacyApi)}async execute({login:e}){try{return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSession",arg:[{login:e??""}]}),Promise.resolve()}catch(e){}return Promise.resolve()}};Pe=Oe([(0,n.Injectable)(),Ce("design:paramtypes",[n.CqrsClient])],Pe);var Ae=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},je=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let _e=class{constructor(e,t,r,n,o,i,a){this.deviceRegistrationMachine=e,this.masterPasswordFlowMachine=t,this.initializeMachineService=o,this.loginViaSSOService=i,this.webAuthnMachine=n,this.twoFactorAuthenticationMachine=r,this.requestAuthenticationMethodForLogin=a}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Starting",id:"AuthenticationFlowMachine",context:{...this.deviceRegistrationMachine.desc().config.context,...this.masterPasswordFlowMachine.desc().config.context,...this.twoFactorAuthenticationMachine.desc().config.context,...this.webAuthnMachine.desc().config.context,ready:!1,shouldAskMasterPassword:!1,shouldAskOTP:!1},states:{Starting:{invoke:{src:"initializeMachine",onDone:{actions:["assignInitializationResults"],target:"RememberMeRedirection"}}},RememberMeRedirection:{always:[{target:"MasterPassword",cond:"shouldAskMasterPassword"},{target:"CheckSessionForOtp2",cond:"shouldAskOTP"},{target:"WebAuthn",cond:"rememberMeIsWebAuthn"},{target:"WaitingForEmail"}]},CheckSessionForOtp2:{entry:["requestAuthenticationMethodForLogin"]},WaitingForEmail:{on:{INPUT_ACCOUNT_EMAIL:{target:"ValidatingEmail",actions:["assignAccountEmail","clearError"]}}},ValidatingEmail:{entry:["requestAuthenticationMethodForLogin"],on:{CARBON_LEGACY_ERROR:{target:"WaitingForEmail",actions:["assignError"]}}},DeviceRegistration:{...ae(this.deviceRegistrationMachine.desc().config)},WebAuthn:{...ae(this.webAuthnMachine.desc().config),onDone:[{target:"MasterPassword",cond:"shouldSwitchToMasterPassword"},{target:"AuthenticationDone"}]},TwoFactorAuthentication:{...ae(this.twoFactorAuthenticationMachine.desc().config),onDone:{target:"AuthenticationDone"}},SSORedirectionToIdp:{entry:["assignServiceProviderInfo"]},SSOAuthentication:{entry:["loginViaSSO"]},MasterPassword:{...ae(this.masterPasswordFlowMachine.desc().config),onDone:[{target:"WaitingForEmail",cond:"shouldResetAuthenticationFlow"},{target:"AuthenticationDone"}]},AuthenticationDone:{type:"final"}},on:{CHANGE_ACCOUNT_EMAIL:[{target:"ValidatingEmail",actions:["clearError","assignAccountEmail"],cond:"isAccountLoginAvailable"},{target:"WaitingForEmail",actions:["clearError","clearEmail"]}],CARBON_LEGACY_ASK_MASTER_PASSWORD:{target:"MasterPassword",actions:["clearError"]},CARBON_LEGACY_OPEN_SESSION_TOKEN_SENT:[{target:"DeviceRegistration.EmailToken",actions:["clearError"],cond:"isGrapheneDeviceRegistrationFlow"},{target:"DeviceRegistration.EmailToken",actions:["clearError"]}],CARBON_LEGACY_OPEN_SESSION_DASHLANE_AUTHENTICATOR:{target:"DeviceRegistration.DashlaneAuthenticator",actions:["clearError"]},CARBON_LEGACY_OPEN_SESSION_SSO_REDIRECTION_TO_IDP_REQUIRED:{target:"SSORedirectionToIdp",actions:["clearError"]},CARBON_LEGACY_SSO_LOGIN_BYPASS:{target:"SSOAuthentication",actions:["assignSsoData"]},CARBON_LEGACY_OPEN_SESSION_OTP_SENT:{target:"TwoFactorAuthentication",actions:["assignOtpVerificationMode","clearError"]},CLEAR_ERROR:{actions:["clearError"]}}},options:{actions:{...this.deviceRegistrationMachine.desc().options.actions,...this.masterPasswordFlowMachine.desc().options.actions,...this.twoFactorAuthenticationMachine.desc().options.actions,...this.webAuthnMachine.desc().options.actions,assignInitializationResults:(0,y.f0)({login:(e,t)=>t.data.lastUsedLogin,localAccounts:(e,t)=>t.data.localAccounts,shouldAskMasterPassword:(e,t)=>t.data.shouldAskMasterPassword,shouldAskOTP:(e,t)=>t.data.shouldAskOTP,rememberMeType:(e,t)=>t.data.rememberMeType,ready:()=>!0}),assignAccountEmail:(0,y.f0)({login:(e,t)=>t.login}),assignError:(0,y.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),assignOtpVerificationMode:(0,y.f0)({otpVerificationMode:(e,t)=>t.otpVerificationMode}),assignSsoData:(0,y.f0)({ssoData:(e,t)=>t}),assignServiceProviderInfo:(0,y.f0)({serviceProviderRedirectUrl:(e,t)=>t.serviceProviderRedirectUrl,isNitroProvider:(e,t)=>t.isNitroProvider}),clearEmail:(0,y.f0)({login:void 0}),clearError:(0,y.f0)({error:()=>{}}),loginViaSSO:(e,t)=>this.loginViaSSOService.execute(t),requestAuthenticationMethodForLogin:e=>this.requestAuthenticationMethodForLogin.execute(e)},services:{...this.deviceRegistrationMachine.desc().options.services,...this.masterPasswordFlowMachine.desc().options.services,...this.twoFactorAuthenticationMachine.desc().options.services,...this.webAuthnMachine.desc().options.services,initializeMachine:()=>this.initializeMachineService.execute()},guards:{...this.deviceRegistrationMachine.desc().options.guards,...this.masterPasswordFlowMachine.desc().options.guards,...this.twoFactorAuthenticationMachine.desc().options.guards,...this.webAuthnMachine.desc().options.guards,isAccountLoginAvailable:(e,t)=>Boolean(t.login),shouldAskMasterPassword:e=>!!e.shouldAskMasterPassword&&e.shouldAskMasterPassword,shouldAskOTP:e=>!!e.shouldAskOTP&&e.shouldAskOTP,shouldSwitchToMasterPassword:(e,t)=>t.data.switchToMasterPassword,shouldResetAuthenticationFlow:(e,t)=>t.data.shouldResetAuthenticationFlow,rememberMeIsWebAuthn:e=>void 0!==e.rememberMeType&&"webauthn"===e.rememberMeType,isGrapheneDeviceRegistrationFlow:e=>!!e.login&&e.login.includes("kw_test_newdevice")}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};_e=Ae([(0,n.Injectable)(),je("design:paramtypes",[ue,H,ge,de,we,Ee,Pe])],_e);var Te=r(64472),Ie=r(11746),De=r(24966);class xe{constructor(e,t){this.interpreter=e,this.cqrsClient=t}execute(){try{const{carbonState:e}=this.cqrsClient.getClient(c.carbonLegacyApi).queries;e({path:"userSession.loginDeviceLimitFlow.flow"}).pipe((0,i.U)((e=>{if("success"===e.tag)return e.data}))).subscribe((e=>{Boolean(this.lastDeviceLimitFlowValue)&&!e&&this.interpreter.send({type:"DEVICE_LIMIT_ABORTED"}),this.lastDeviceLimitFlowValue=e}))}catch(e){return Promise.reject(new Error("Unable to subscribe to loginDeviceLimitFlow state"))}}}var Ue=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Me=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Le=class{constructor(e,t,r){this.loginMachineStore=t,this.cqrsClient=r,this.initFlag=new De.X(!1);const n=e.create();this.delayedEvents=[],this.interpreter=Te.kJ(n).onTransition((async e=>{e.changed||"xstate.init"===e.event.type||console.warn(`[Auth] State is unchanged. Unexpected transition on ${JSON.stringify(e.value)} with event ${e.event.type} `);try{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.loginMachineStore,e)}catch(e){console.warn("[Auth] Unable to get snapshot",e)}})),this.abortDeviceLimitEventHandler=new xe(this.interpreter,this.cqrsClient),this.prepare()}async prepare(){if(this.interpreter)try{this.abortDeviceLimitEventHandler.execute();const e=await(async e=>{const t=await e.getState();return t?A.ZM.create(JSON.parse(t)):void 0})(this.loginMachineStore);let t;try{t=this.interpreter.start(e)}catch(e){console.error("[Auth] Unable to reuse the stored state: ",e),t=this.interpreter.start()}await(0,Ie.x)(t,(e=>e.context.ready)),this.interpreter.send(this.delayedEvents),this.delayedEvents=[],this.initFlag.next(!0)}catch(e){console.error("[Auth] Unable to start machine",e)}}ready(){return this.initFlag}continue(e){if(!this.interpreter)throw new Error("Authentication flow not started");this.interpreter.getSnapshot().context.ready?this.interpreter.send(e):this.delayedEvents.push(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}};Le=Ue([(0,n.Injectable)(),Me("design:paramtypes",[_e,T,n.CqrsClient])],Le);var Ne,ke=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Fe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ve=Ne=class{constructor(e,t,r,n){this.machine=e,this.store=t,this.cqrsClient=r,this.logger=n}getInstance(){return Ne.instance||(Ne.instance=new Le(this.machine,this.store,this.cqrsClient)),Ne.instance}};Ve=Ne=ke([(0,n.Injectable)(),Fe("design:paramtypes",[_e,T,n.CqrsClient,n.AppLogger])],Ve);var qe=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Ge=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Be=class{constructor(e){this.authenticationFlow=e}execute(e){const{login:t}=e.body;return this.authenticationFlow.getInstance().continue({type:"CHANGE_ACCOUNT_EMAIL",login:t}),Promise.resolve((0,s.Vp)(void 0))}};Be=qe([(0,n.CommandHandler)(h.ChangeAccountEmailCommand),Ge("design:paramtypes",[Ve])],Be);var He=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},We=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ke=class{constructor(e){this.authenticationFlow=e}execute(e){const{twoFactorAuthenticationOtpType:t}=e.body;return this.authenticationFlow.getInstance().continue({type:"SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE",twoFactorAuthenticationOtpType:t}),Promise.resolve((0,s.Vp)(void 0))}};Ke=He([(0,n.CommandHandler)(h.ChangeTwoFactorAuthenticationOtpTypeCommand),We("design:paramtypes",[Ve])],Ke);var ze=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},$e=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Qe=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.getInstance().continue({type:"CLEAR_ERROR"}),Promise.resolve((0,s.Vp)(void 0))}};Qe=ze([(0,n.CommandHandler)(h.ClearErrorCommand),$e("design:paramtypes",[Ve])],Qe);var Ye=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Je=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Xe=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.getInstance().continue({type:"RESEND_EMAIL_TOKEN"}),Promise.resolve((0,s.Vp)(void 0))}};Xe=Ye([(0,n.CommandHandler)(h.ResendEmailTokenCommand),Je("design:paramtypes",[Ve])],Xe);var Ze=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},et=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let tt=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.getInstance().continue({type:"RESEND_PUSH_NOTIFICATION"}),Promise.resolve((0,s.Vp)(void 0))}};tt=Ze([(0,n.CommandHandler)(h.ResendPushNotificationCommand),et("design:paramtypes",[Ve])],tt);var rt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},nt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ot=class{constructor(e){this.authenticationFlow=e}execute(e){const{login:t}=e.body;return this.authenticationFlow.getInstance().continue({type:"INPUT_ACCOUNT_EMAIL",login:t}),Promise.resolve((0,s.Vp)(void 0))}};ot=rt([(0,n.CommandHandler)(h.SendAccountEmailCommand),nt("design:paramtypes",[Ve])],ot);var it=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},at=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let st=class{constructor(e){this.authenticationFlow=e}execute(e){const{masterPassword:t,rememberMe:r}=e.body;return this.authenticationFlow.getInstance().continue({type:"INPUT_MASTER_PASSWORD",masterPassword:t,rememberMe:r}),Promise.resolve((0,s.Vp)(void 0))}};st=it([(0,n.CommandHandler)(h.SendMasterPasswordCommand),at("design:paramtypes",[Ve])],st);var ct=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ut=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let lt=class{constructor(e){this.authenticationFlow=e}execute(e){const{twoFactorAuthenticationOtpValue:t}=e.body;return this.authenticationFlow.getInstance().continue({type:"INPUT_BACKUP_CODE",twoFactorAuthenticationOtpValue:t}),Promise.resolve((0,s.Vp)(void 0))}};lt=ct([(0,n.CommandHandler)(h.SubmitBackupCodeCommand),ut("design:paramtypes",[Ve])],lt);var dt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},pt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ft=class{constructor(e){this.authenticationFlow=e}execute(e){const{emailToken:t,deviceName:r}=e.body;return this.authenticationFlow.getInstance().continue({type:"INPUT_EMAIL_TOKEN",emailToken:t,deviceName:r}),Promise.resolve((0,s.Vp)(void 0))}};ft=dt([(0,n.CommandHandler)(h.SubmitEmailTokenCommand),pt("design:paramtypes",[Ve])],ft);var ht=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},mt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let yt=class{constructor(e){this.authenticationFlow=e}execute(e){const{twoFactorAuthenticationOtpValue:t}=e.body;return this.authenticationFlow.getInstance().continue({type:"INPUT_TOTP",twoFactorAuthenticationOtpValue:t}),Promise.resolve((0,s.Vp)(void 0))}};yt=ht([(0,n.CommandHandler)(h.SubmitTotpCommand),mt("design:paramtypes",[Ve])],yt);var gt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},vt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let bt=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.getInstance().continue({type:"SWITCH_TO_DASHLANE_AUTHENTICATOR"}),Promise.resolve((0,s.Vp)(void 0))}};bt=gt([(0,n.CommandHandler)(h.SwitchToDashlaneAuthenticatorCommand),vt("design:paramtypes",[Ve])],bt);var wt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},St=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Rt=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.getInstance().continue({type:"SWITCH_TO_EMAIL_TOKEN"}),Promise.resolve((0,s.Vp)(void 0))}};Rt=wt([(0,n.CommandHandler)(h.SwitchToEmailTokenCommand),St("design:paramtypes",[Ve])],Rt);var Et=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Ot=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ct=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.getInstance().continue({type:"RETRY_WEBAUTHN_AUTHENTICATION"}),Promise.resolve((0,s.Vp)(void 0))}};Ct=Et([(0,n.CommandHandler)(h.RetryWebAuthnAuthenticationCommand),Ot("design:paramtypes",[Ve])],Ct);var Pt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},At=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let jt=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.getInstance().continue({type:"USE_MASTER_PASSWORD"}),Promise.resolve((0,s.Vp)(void 0))}};jt=Pt([(0,n.CommandHandler)(h.UseMasterPasswordCommand),At("design:paramtypes",[Ve])],jt);var _t=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Tt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let It=class{constructor(e){this.authenticationFlow=e}execute(e){const{webAuthnError:t}=e.body;return this.authenticationFlow.getInstance().continue({type:"WEBAUTHN_AUTHENTICATION_FAIL",error:t}),Promise.resolve((0,s.Vp)(void 0))}};It=_t([(0,n.CommandHandler)(h.WebAuthnAuthenticationFailCommand),Tt("design:paramtypes",[Ve])],It);var Dt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},xt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ut=class{constructor(e,t){this.carbonLegacy=e.getClient(c.carbonLegacyApi),this.logger=t}async execute(){try{await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"closeSession",arg:[{}]})}catch(e){this.logger.trace("Logout Command error :"+e)}return Promise.resolve((0,s.Vp)(void 0))}};Ut=Dt([(0,n.CommandHandler)(h.LogoutCommand),xt("design:paramtypes",[n.CqrsClient,n.AppLogger])],Ut);var Mt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Lt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Nt=class{constructor(e){this.authenticationFlow=e}execute(e){return this.authenticationFlow.getInstance().continue({type:"CARBON_LEGACY_SSO_LOGIN_BYPASS",...e.body}),Promise.resolve((0,s.Vp)(void 0))}};Nt=Mt([(0,n.CommandHandler)(h.LoginViaSSOCommand),Lt("design:paramtypes",[Ve])],Nt);var kt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Ft=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Vt=class{constructor(e,t){this.carbonLegacy=e.getClient(c.carbonLegacyApi),this.logger=t}async execute(){try{await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"lockSession",arg:[{}]})}catch(e){this.logger.trace("LockSession command handler: "+e)}return Promise.resolve((0,s.Vp)(void 0))}};Vt=kt([(0,n.CommandHandler)(h.LockCommand),Ft("design:paramtypes",[n.CqrsClient,n.AppLogger])],Vt);var qt=r(74081),Gt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Bt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const Ht=e=>!!e&&"object"==typeof e&&(0,a.l$)(e,"type")&&"sso"===e.type;let Wt=class{constructor(e,t,r){this.client=e,this.authenticationFlowInfraContext=t,this.serverApiClient=r}getDeviceAccessKeys(e){return this.client.getClient(c.carbonLegacyApi).queries.carbonState({path:"authentication.localUsers"}).pipe((0,O.h)(s.d6),(0,i.U)((t=>t.data[e])))}async checkSSOInfo(e){const t=(await(0,o.z)(this.getDeviceAccessKeys(e).pipe((0,i.U)((t=>this.serverApiClient.v1.authentication.getAuthenticationMethodsForLogin({login:e,deviceAccessKey:t.deviceAccessKey,methods:["email_token","totp","duo_push","dashlane_authenticator"]}))),(0,qt.J)(),(0,O.h)(s.d6),(0,i.U)((e=>e.data.data))))).verifications.find(Ht);if(t){const e=t.ssoInfo;return{isNitroProvider:e.isNitroProvider,serviceProviderUrl:e.serviceProviderUrl}}throw new Error("No SSO authentication available for the user")}async execute(e){const{login:t}=e.body,{loginUserWithEnclaveSSO:r}=this.client.getClient(P.enclaveSdkApi).commands;try{const e=await this.checkSSOInfo(t);e.isNitroProvider?await r({userEmailAddress:t}):this.authenticationFlowInfraContext.redirectUserToExternalUrl({externalUrl:e.serviceProviderUrl,tabFocus:!1})}catch(e){}return Promise.resolve((0,s.Vp)(void 0))}};Wt=Gt([(0,n.CommandHandler)(h.InitiateAutologinWithSSOCommand),Bt("design:paramtypes",[n.CqrsClient,U,m.lX])],Wt);var Kt=r(82991),zt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},$t=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Qt=class{constructor(e,t,r){this.authenticationFlow=e,this.logger=t,this.ssoInfoStore=r}async handle(e){if(!(0,Kt.isMv3Environment)())return Promise.resolve();switch(e.body.eventName){case"openSessionTokenSent":this.authenticationFlow.getInstance().continue({type:"CARBON_LEGACY_OPEN_SESSION_TOKEN_SENT"});break;case"openSessionAskMasterPassword":this.authenticationFlow.getInstance().continue({type:"CARBON_LEGACY_ASK_MASTER_PASSWORD"});break;case"openSessionDashlaneAuthenticator":this.authenticationFlow.getInstance().continue({type:"CARBON_LEGACY_OPEN_SESSION_DASHLANE_AUTHENTICATOR"});break;case"openSessionOTPSent":case"openSessionOTPForNewDeviceRequired":this.authenticationFlow.getInstance().continue({type:"CARBON_LEGACY_OPEN_SESSION_OTP_SENT",otpVerificationMode:"openSessionOTPSent"===e.body.eventName?"otp2":"otp1"});break;case"openSessionSsoRedirectionToIdpRequired":{const t=e.body.eventData,{rememberMeForSSOPreference:r}=await this.ssoInfoStore.getState();this.authenticationFlow.getInstance().continue({type:"CARBON_LEGACY_OPEN_SESSION_SSO_REDIRECTION_TO_IDP_REQUIRED",serviceProviderRedirectUrl:t.serviceProviderRedirectUrl,isNitroProvider:t.isNitroProvider,rememberMeForSSOPreference:r})}break;case"openSessionFailed":{const t=e.body.eventData;this.authenticationFlow.getInstance().continue({type:"CARBON_LEGACY_ERROR",error:t.errorCode})}break;case"loginStatusChanged":{const t=e.body.eventData;this.authenticationFlow.getInstance().continue({type:"CARBON_LEGACY_LOGIN_STATUS_CHANGED",loggedIn:t.loggedIn,needsSSOMigration:t.needsSSOMigration})}}return Promise.resolve()}};Qt=zt([(0,n.EventHandler)(c.CarbonLegacyEvent),$t("design:paramtypes",[Ve,n.AppLogger,x])],Qt);var Yt=r(85390),Jt=r(6136),Xt=r(69885),Zt=r(6220);const er=e=>({step:"EmailStep",loginEmail:e.context.login,localAccounts:e.context.localAccounts??[],isLoading:e.matches("ValidatingEmail")&&!e.context.error,error:e.context.error?.data?.message}),tr=e=>({step:"EmailTokenStep",localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,isLoading:e.matches({DeviceRegistration:{EmailToken:"ValidatingEmailToken"}})&&!e.context.error,error:e.context.error?.data?.message,emailToken:e.context.emailToken,isDashlaneAuthenticatorAvailable:e.context.isDashlaneAuthenticatorAvailable}),rr=e=>({step:"DashlaneAuthenticatorStep",localAccounts:e.context.localAccounts??[],isLoading:e.matches({DeviceRegistration:{DashlaneAuthenticator:"RequestingServerPush"}})&&!e.context.error,error:e.context.error?.data?.message}),nr=e=>({step:"TwoFactorAuthenticationOtpStep",localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,isLoading:e.matches({TwoFactorAuthentication:"ValidatingTwoFactorAuthenticationOtp"})&&!e.context.error,error:e.context.error?.data?.message,twoFactorAuthenticationOtpValue:e.context.twoFactorAuthenticationOtpValue,twoFactorAuthenticationOtpType:e.context.twoFactorAuthenticationOtpType}),or=e=>({step:"WebAuthnStep",localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,isLoading:e.matches({WebAuthn:"InitWebAuthnAuthentication"})&&!e.context.error,error:e.context.error?.data?.message}),ir=e=>({step:"SSORedirectionToIdpStep",loginEmail:e.context.login,serviceProviderRedirectUrl:e.context.serviceProviderRedirectUrl??"",isNitroProvider:e.context.isNitroProvider??!1,rememberMeForSSOPreference:e.context.rememberMeForSSOPreference,isLoading:e.matches({SSORedirectionToIdp:"InitSSOAuthentication"})&&!e.context.error,error:e.context.error?.data?.message,localAccounts:e.context.localAccounts??[]}),ar=e=>({step:"MasterPasswordStep",loginEmail:e.context.login??"",localAccounts:e.context.localAccounts??[],isLoading:(e.matches({MasterPassword:"ValidatingMasterPassword"})||e.matches({MasterPassword:"MigrationNeeded"})||e.matches({MasterPassword:"MPToSSOMigration"})||e.matches("AuthenticationDone"))&&!e.context.error,isAccountRecoveryAvailable:e.context.isAccountRecoveryAvailable,error:e.context.error?.data?.message,serviceProviderRedirectUrl:e.context.serviceProviderRedirectUrl,isNitroProvider:e.context.isNitroProvider??!1,migration:e.context.migration}),sr=e=>({step:"StartingStep",localAccounts:e.context.localAccounts??[]});const cr=e=>(0,Xt.of)((0,s.Vp)(function(e){return e.matches("Starting")?sr(e):e.matches("WaitingForEmail")||e.matches("ValidatingEmail")?er(e):e.matches({DeviceRegistration:{EmailToken:"SendEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"WaitingForEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"ValidatingEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"FinishingEmailToken"}})?tr(e):e.matches({DeviceRegistration:{DashlaneAuthenticator:"RequestingServerPush"}})||e.matches({DeviceRegistration:{DashlaneAuthenticator:"AuthenticatorPushFailed"}})||e.matches({DeviceRegistration:{DashlaneAuthenticator:"AuthenticatorPushValidated"}})?rr(e):e.matches({TwoFactorAuthentication:"WaitingForTotp"})||e.matches({TwoFactorAuthentication:"WaitingForBackupCode"})||e.matches({TwoFactorAuthentication:"ValidatingTwoFactorAuthenticationOtp"})||e.matches({TwoFactorAuthentication:"FinishingTwoFactorAuthenticationOtp"})?nr(e):e.matches({WebAuthn:"InitWebAuthnAuthentication"})||e.matches({WebAuthn:"WebAuthnAuthenticationFailed"})||e.matches({WebAuthn:"WebAuthnAuthenticationValidated"})?or(e):e.matches("SSORedirectionToIdp")?ir(e):e.matches({MasterPassword:"CheckingAccountRecoveryStatus"})||e.matches({MasterPassword:"WaitingForMasterPassword"})||e.matches({MasterPassword:"ValidatingMasterPassword"})||e.matches({MasterPassword:"MigrationNeeded"})||e.matches({MasterPassword:"MPToSSOMigration"})||e.matches("AuthenticationDone")?ar(e):void console.warn("[Auth] - No view associated to state ",JSON.stringify(e.value))}(e))),ur=e=>e.pipe((0,Zt.z)(cr));var lr=r(30045);var dr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},pr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let fr=class{constructor(e,t){this.authenticationFlow=e,this.loginMachineStore=t}execute(){return(0,Yt.a)([(e=this.loginMachineStore,e.state$.pipe((0,i.U)((e=>e?A.ZM.create(JSON.parse(e)):void 0)))),this.authenticationFlow.getInstance().ready()],((e,t)=>{if(e&&t)return e})).pipe((0,O.h)(Boolean),(0,Jt.x)(((e,t)=>((e,t)=>{const r=t.matches(e.value),n=(0,lr.Z)(e.context,t.context);return r&&n})(e,t))),ur);var e}};fr=dr([(0,n.QueryHandler)(h.AuthenticationFlowStatusQuery),pr("design:paramtypes",[Ve,T])],fr);var hr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},mr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let yr=class{constructor(e){this.ssoInfoStore=e}execute(){return this.ssoInfoStore.state$.pipe((0,i.U)((e=>(0,s.Vp)({rememberMeForSSOPreference:e.rememberMeForSSOPreference}))))}};yr=hr([(0,n.QueryHandler)(h.GetSsoInfoQuery),mr("design:paramtypes",[x])],yr);const gr=e=>!0;class vr extends((0,n.defineStore)({initialValue:void 0,persist:!1,scope:j.UseCaseScope.Device,storeName:"device-registration-flow-store",storeTypeGuard:gr})){}var br=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let wr=class{};wr=br([(0,n.Module)({api:h.authenticationFlowApi,handlers:{commands:{changeLogin:Be,changeTwoFactorAuthenticationOtpType:Ke,clearError:Qe,resendEmailToken:Xe,resendPushNotification:tt,sendAccountEmail:ot,sendMasterPassword:st,submitBackupCode:lt,submitEmailToken:ft,submitTotp:yt,switchToDashlaneAuthenticator:bt,switchToEmailToken:Rt,retryWebAuthnAuthentication:Ct,useMasterPassword:jt,webAuthnAuthenticationFail:It,logout:Ut,lockSession:Vt,loginViaSSO:Nt,initiateLoginWithSSO:k,initiateAutologinWithSSO:Wt},events:{...(0,n.useEventsOfModule)(c.carbonLegacyApi,{carbonLegacy:Qt})},queries:{authenticationFlowStatus:fr,getSsoInfo:yr}},configurations:{authenticationFlowContextInfrastructure:{token:U}},providers:[re,ue,ie,de,H,ge,Ve,_e,we,Ee,E,q,Z,Y,w,he,Pe,z],stores:[T,vr,x],imports:[m.nr,m.iT]})],wr)},17556:(e,t,r)=>{"use strict";r.d(t,{e:()=>n});class n{redirectUserToExternalUrl(e){chrome.tabs.create({url:e.externalUrl,active:e.tabFocus})}}},80552:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.autofillDataApi=void 0;const n=r(68224);t.autofillDataApi=(0,n.defineModuleApi)({name:"autofillData",commands:{},events:{},queries:{}})},34947:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(80552),t)},62301:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isArrayOfAutofillableDataModel=t.isAutofillableDataModel=t.CREDENTIAL_DATA_MODELS=t.FORM_DATA_MODELS=void 0,t.FORM_DATA_MODELS=["KWAddress","KWBankStatement","KWCompany","KWDriverLicence","KWEmail","KWFiscalStatement","KWIDCard","KWIdentity","KWMerchand","KWPassport","KWPaymentMean_creditCard","KWPaymentMean_paypal","KWPersonalWebsite","KWPhone","KWSecureNote","KWSecureNoteCategory","KWSocialSecurityStatement"],t.CREDENTIAL_DATA_MODELS=["KWAuthentifiant","KWGeneratedPassword","KWPasskey"];const r=[...t.FORM_DATA_MODELS,...t.CREDENTIAL_DATA_MODELS];t.isAutofillableDataModel=e=>!!e&&"string"==typeof e&&r.includes(e);t.isArrayOfAutofillableDataModel=e=>!!e&&"object"==typeof e&&Array.isArray(e)&&e.every(t.isAutofillableDataModel)},53354:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(391),t),o(r(53644),t),o(r(19215),t),o(r(62301),t),o(r(86302),t)},86302:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDashlaneDisabledPermanently=t.isArrayOfUserAutofillCorrections=void 0;t.isArrayOfUserAutofillCorrections=e=>e instanceof Array&&!e.find((e=>{return!("object"==typeof(t=e)&&null!==t&&"id"in t&&"fieldIdentifier"in t&&"domain"in t);var t}));t.isDashlaneDisabledPermanently=e=>"none"===e.correctedDataSource},391:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},53644:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isVaultSourceType=t.isOtherSourceType=t.OtherSourceType=void 0;const n=r(19215);var o;!function(e){e.NewPassword="newPassword",e.SubmitButton="submitButton",e.WebauthnConditionalUI="WebauthnConditionalUI"}(o=t.OtherSourceType||(t.OtherSourceType={}));t.isOtherSourceType=e=>Object.values(o).includes(e);t.isVaultSourceType=e=>e in n.VaultSourceType},19215:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VaultSourceType=void 0,function(e){e.Address="Address",e.BankAccount="BankAccount",e.Company="Company",e.Credential="Credential",e.CredentialCategory="CredentialCategory",e.DriverLicense="DriverLicense",e.Email="Email",e.FiscalId="FiscalId",e.GeneratedPassword="GeneratedPassword",e.IdCard="IdCard",e.Identity="Identity",e.NoteCategory="NoteCategory",e.Note="Note",e.Passport="Passport",e.Passkey="Passkey",e.PaymentCard="PaymentCard",e.PersonalWebsite="PersonalWebsite",e.Phone="Phone",e.SocialSecurityId="SocialSecurityId"}(t.VaultSourceType||(t.VaultSourceType={}))},24979:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(88709),t),o(r(53354),t),o(r(34947),t)},37513:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.autofillSettingsApi=void 0;const n=r(68224),o=r(61375),i=r(54345),a=r(11639),s=r(34),c=r(50030);t.autofillSettingsApi=(0,n.defineModuleApi)({name:"autofillSettings",commands:{toggleDashlane:a.ToggleDashlaneCommand,enableAnalysis:c.EnableAnalysisCommand,enableAutofillOnForms:c.EnableAutofillOnFormsCommand,enableAutofillOnLogins:c.EnableAutofillOnLoginsCommand,enableFollowUpNotification:c.EnableFollowUpNotificationCommand,disableAnalysis:c.DisableAnalysisCommand,disableAutofillOnForms:c.DisableAutofillOnFormsCommand,disableAutofillOnLogins:c.DisableAutofillOnLoginsCommand,disableFollowUpNotification:c.DisableFollowUpNotificationCommand,addDisabledSourceTypes:i.AddDisabledSourceTypesCommand,removeDisabledSourceTypes:o.RemoveDisabledSourceTypesCommand,setUserAutofillCorrections:c.SetUserAutofillCorrectionsCommand},events:{},queries:{getAnalysisStatusOnUrl:s.GetAnalysisStatusOnUrlQuery,getAutofillSettings:s.GetAutofillSettingsQuery,getUserAutofillCorrections:s.GetUserAutofillCorrectionsQuery}})},54345:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AddDisabledSourceTypesCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.AddDisabledSourceTypesCommand=o},55943:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisableAnalysisCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.DisableAnalysisCommand=o},22351:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisableAutofillOnFormsCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.DisableAutofillOnFormsCommand=o},71113:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisableAutofillOnLoginsCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.DisableAutofillOnLoginsCommand=o},16037:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisableFollowUpNotificationCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.DisableFollowUpNotificationCommand=o},88735:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnableAnalysisCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.EnableAnalysisCommand=o},35332:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnableAutofillOnFormsCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.EnableAutofillOnFormsCommand=o},32956:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnableAutofillOnLoginsCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.EnableAutofillOnLoginsCommand=o},68762:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnableFollowUpNotificationCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.EnableFollowUpNotificationCommand=o},50030:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(54345),t),o(r(55943),t),o(r(22351),t),o(r(71113),t),o(r(16037),t),o(r(88735),t),o(r(35332),t),o(r(32956),t),o(r(68762),t),o(r(61375),t),o(r(11639),t),o(r(64231),t)},61375:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoveDisabledSourceTypesCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.RemoveDisabledSourceTypesCommand=o},64231:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SetUserAutofillCorrectionsCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.SetUserAutofillCorrectionsCommand=o},11639:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ToggleDashlaneCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.ToggleDashlaneCommand=o},88709:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(37513),t),o(r(34),t),o(r(50030),t)},67258:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetAnalysisStatusOnUrlQuery=t.AnalysisStatus=void 0;const n=r(68224);!function(e){e.ANALYSIS_ENABLED="ANALYSIS_ENABLED",e.ANALYSIS_DISABLED_BY_USER="ANALYSIS_DISABLED_BY_USER",e.ANALYSIS_DISABLED_BY_B2B_ADMIN="ANALYSIS_DISABLED_BY_B2B_ADMIN",e.ANALYSIS_DISABLED_BY_KILLSWITCH="ANALYSIS_DISABLED_BY_KILLSWITCH",e.ANALYSIS_DISABLED_BY_2FA_ENFORCEMENT="ANALYSIS_DISABLED_BY_2FA_ENFORCEMENT"}(t.AnalysisStatus||(t.AnalysisStatus={}));class o extends((0,n.defineQuery)({scope:n.UseCaseScope.Device})){}t.GetAnalysisStatusOnUrlQuery=o},31270:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetAutofillSettingsQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.GetAutofillSettingsQuery=o},31027:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetUserAutofillCorrectionsQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.GetUserAutofillCorrectionsQuery=o},34:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(67258),t),o(r(31270),t),o(r(31027),t)},26180:(e,t,r)=>{"use strict";r.d(t,{U:()=>Pe,P:()=>Oe});var n,o=r(27606),i=r(24979);!function(e){e.NewUrlParserDev="platform_web_new_url_parser_dev",e.NewUrlParser="platform_web_new_url_parser",e.AdminSubdomainsDev="autofill_web_tac_subdomains_dev",e.AdminSubdomains="autofill_web_tac_subdomains"}(n||(n={}));var a=r(87279),s=r(53576),c=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},u=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let l=class{constructor(e){this.cqrsClient=e}async execute({body:e}){const{isAutofillEnabled:t,url:r}=e,{carbon:n}=this.cqrsClient.getClient(s.carbonLegacyApi).commands,o=await n({name:"toggleDashlane",args:[{where:"site",autofill:t,autologin:t,url:r}]});if((0,a.hx)(o))throw new Error("Toggle Dashlane command from core-autofill failed");return(0,a.Vp)(void 0)}};l=c([(0,o.CommandHandler)(i.ToggleDashlaneCommand),u("design:paramtypes",[o.CqrsClient])],l);var d=r(87065),p=r(85390),f=r(43978),h=r(92210),m=r(17509),y=r(28489);var g,v,b;!function(e){e[e.UNKNOWN_ERROR=0]="UNKNOWN_ERROR"}(g||(g={})),function(e){e.EMAIL_TOKEN="email_token",e.DEVICE_REGISTRATION="totp_device_registration",e.LOGIN="totp_login",e.SSO="sso"}(v||(v={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.PENDING=1]="PENDING",e[e.ERROR=2]="ERROR",e[e.READY=3]="READY"}(b||(b={}));const w=e=>{if(!(t=e)||"object"!=typeof t||!(0,y.l$)(t,"status")||"number"!=typeof t.status)throw new Error("twoFactorAuthentication is not of the expected type");var t;return e.status===b.READY&&e.shouldEnforceTwoFactorAuthentication},S=e=>!!e&&"object"==typeof e&&Array.isArray(e)&&e.every((e=>"string"==typeof e));var R=r(60399),E=r(68224);const O=async(e,t)=>{const{userFeatureFlips:r}=e.getClient(E.requestContextApi).queries,n=await(0,R.z)(r({requiredFeatureFlips:t}));return(0,a.d6)(n)&&t.some((e=>n.data[e]))};var C=r(97280);var P=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},A=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let j=class{constructor(e){this.cqrsClient=e}get isAutofillDisabled(){return{get$:this._getIsAutofillDisabled$,set:this._setIsAutofillDisabled.bind(this)}}get disabledDomains(){return{get$:this._getDisabledDomains$,set:this._setDisabledDomains.bind(this),add:this._addDisabledDomains.bind(this),remove:this._removeDisabledDomains.bind(this)}}get disabledSourceTypes(){return{get$:this._getDisabledSourceTypes$,set:this._setDisabledSourceTypes.bind(this),add:this._addDisabledSourceTypes.bind(this),remove:this._removeDisabledSourceTypes.bind(this)}}get isFollowUpNotificationEnabled(){return{get$:this._getIsFollowUpNotificationEnabled$,set:this._setIsFollowUpNotificationEnabled.bind(this)}}async _updateSettings(e){const t=e.isAutofillDisabled??await(0,R.z)(this._getIsAutofillDisabled$),r=e.disabledDomains??await(0,R.z)(this._getDisabledDomains$),n=e.disabledSourceTypes??await(0,R.z)(this._getDisabledSourceTypes$),o=e.isFollowUpNotificationEnabled??await(0,R.z)(this._getIsFollowUpNotificationEnabled$),i=await this.cqrsClient.getClient(s.carbonLegacyApi).commands.carbon({name:"updateAutofillSettings",args:[{AutofillSettings:{disabledDomains:r,disabledSourceTypes:n,isAutofillDisabled:t,isFollowUpNotificationEnabled:o}}]});if((0,a.hx)(i))throw new Error("Error when updating autofill settings using updateAutofillSettings query from Carbon")}get _getAutofillSettings$(){const{carbonState:e}=this.cqrsClient.getClient(s.carbonLegacyApi).queries;return e({path:"userSession.personalSettings.AutofillSettings"}).pipe((0,d.U)((e=>{if(!(0,a.d6)(e)||!(e=>!!e&&"object"==typeof e&&(0,y.l$)(e,"isAutofillDisabled")&&"boolean"==typeof e.isAutofillDisabled&&(0,y.l$)(e,"disabledSourceTypes")&&(0,i.isArrayOfAutofillableDataModel)(e.disabledSourceTypes)&&(0,y.l$)(e,"disabledDomains")&&Array.isArray(e.disabledDomains)&&e.disabledDomains.every((e=>"string"==typeof e))&&(0,y.l$)(e,"isFollowUpNotificationEnabled")&&"boolean"==typeof e.isFollowUpNotificationEnabled)(e.data))throw new Error("AutofillSettings is not of the expected type");return e.data})),(0,C.d)(1))}get _getIsAutofillDisabled$(){return this._getAutofillSettings$.pipe((0,d.U)((({isAutofillDisabled:e})=>e)))}_setIsAutofillDisabled(e){return this._updateSettings({isAutofillDisabled:e})}_setIsFollowUpNotificationEnabled(e){return this._updateSettings({isFollowUpNotificationEnabled:e})}get _getDisabledDomains$(){return this._getAutofillSettings$.pipe((0,d.U)((({disabledDomains:e})=>e)))}_setDisabledDomains(e){return this._updateSettings({disabledDomains:e})}async _addDisabledDomains(e){const t=await(0,R.z)(this._getDisabledDomains$);return this._setDisabledDomains([...new Set([...t,...e])])}async _removeDisabledDomains(e){const t=await(0,R.z)(this._getDisabledDomains$);return this._setDisabledDomains(t.filter((t=>!e.includes(t))))}get _getDisabledSourceTypes$(){return this._getAutofillSettings$.pipe((0,d.U)((({disabledSourceTypes:e})=>e)))}_setDisabledSourceTypes(e){return this._updateSettings({disabledSourceTypes:e})}async _addDisabledSourceTypes(e){const t=await(0,R.z)(this._getDisabledSourceTypes$);return this._setDisabledSourceTypes([...new Set([...t,...e])])}async _removeDisabledSourceTypes(e){const t=await(0,R.z)(this._getDisabledSourceTypes$);return this._setDisabledSourceTypes(t.filter((t=>!e.includes(t))))}get _getIsFollowUpNotificationEnabled$(){return this._getAutofillSettings$.pipe((0,d.U)((({isFollowUpNotificationEnabled:e})=>e)))}};j=P([(0,o.Injectable)(),A("design:paramtypes",[o.CqrsClient])],j);var _=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},T=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let I=class{constructor(e,t){this.cqrsClient=e,this.settings=t}execute({body:{url:e}}){const{carbonState:t}=this.cqrsClient.getClient(s.carbonLegacyApi).queries,r=()=>O(this.cqrsClient,[n.NewUrlParser,n.NewUrlParserDev]),o=()=>O(this.cqrsClient,[n.AdminSubdomains,n.AdminSubdomainsDev]),c=r().then((t=>t?new h.ParsedURL(e).getRootDomain():(0,m.extractRootDomain)(e))),u=r().then((t=>t?new h.ParsedURL(e).getHostname():(0,m.extractFullDomain)(e))),l=t({path:"userSession.killswitch.disableAutofill"}).pipe((0,d.U)((e=>{if(!(0,a.d6)(e)||!(e=>"boolean"==typeof e)(e.data))throw new Error("Error when fetching killswitch.disableAutofill");return e.data}))),g=(0,p.a)({isAutofillDisabled:this.settings.isAutofillDisabled.get$,disabledDomains:this.settings.disabledDomains.get$}).pipe((0,f.w)((async({isAutofillDisabled:e,disabledDomains:t})=>e||t.includes(await c)))),v=t({path:"userSession.spaceData.spaces"}).pipe((0,f.w)((async e=>{if(!(0,a.d6)(e)||!(e=>!!e&&"object"==typeof e&&Array.isArray(e)&&e.every((e=>(0,y.l$)(e,"details")&&(0,y.l$)(e.details,"info"))))(e.data))throw new Error("Error when fetching spaceData.spaces");const t=e.data.reduce(((e,t)=>{const r=t.details.info.autologinDomainDisabledArray;return[...e,...S(r)?r:[]]}),[]),r=await c,n=await u;return await o()?t.some((e=>e===r||e===n||n.endsWith(`.${e}`))):t.includes(r)}))),b=t({path:"authentication.twoFactorAuthentication"}).pipe((0,d.U)((e=>{if(!(0,a.d6)(e))throw new Error("Error when fetching authentication.twoFactorAuthentication");return w(e.data)})));return(0,p.a)({isAutofillDisabledByB2BAdmin:v,isAutofillDisabledByKillswitch:l,isAutofillDisabledByUser:g,isAutofillDisabledBy2FAEnforcement:b}).pipe((0,d.U)((({isAutofillDisabledBy2FAEnforcement:e,isAutofillDisabledByB2BAdmin:t,isAutofillDisabledByKillswitch:r,isAutofillDisabledByUser:n})=>{let o=i.AnalysisStatus.ANALYSIS_ENABLED;return r?o=i.AnalysisStatus.ANALYSIS_DISABLED_BY_KILLSWITCH:t?o=i.AnalysisStatus.ANALYSIS_DISABLED_BY_B2B_ADMIN:n?o=i.AnalysisStatus.ANALYSIS_DISABLED_BY_USER:e&&(o=i.AnalysisStatus.ANALYSIS_DISABLED_BY_2FA_ENFORCEMENT),(0,a.Vp)({analysisStatus:o})})))}};I=_([(0,o.QueryHandler)(i.GetAnalysisStatusOnUrlQuery),T("design:paramtypes",[o.CqrsClient,j])],I);var D=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},x=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let U=class{constructor(e){this.settings=e}execute(){return(0,p.a)({disabledDomains:this.settings.disabledDomains.get$,disabledSourceTypes:this.settings.disabledSourceTypes.get$,isAutofillDisabled:this.settings.isAutofillDisabled.get$,isFollowUpNotificationEnabled:this.settings.isFollowUpNotificationEnabled.get$}).pipe((0,d.U)(a.Vp))}};U=D([(0,o.QueryHandler)(i.GetAutofillSettingsQuery),x("design:paramtypes",[j])],U);var M=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},L=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let N=class{constructor(e){this.settings=e}async execute({body:{sourceTypes:e}}){return await this.settings.disabledSourceTypes.add(e),(0,a.Vp)(void 0)}};N=M([(0,o.CommandHandler)(i.AddDisabledSourceTypesCommand),L("design:paramtypes",[j])],N);var k=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},F=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let V=class{constructor(e){this.settings=e}async execute({body:{sourceTypes:e}}){return await this.settings.disabledSourceTypes.remove(e),(0,a.Vp)(void 0)}};V=k([(0,o.CommandHandler)(i.RemoveDisabledSourceTypesCommand),F("design:paramtypes",[j])],V);var q=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},G=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let B=class{constructor(e){this.settings=e}async execute(){return await this.settings.isAutofillDisabled.set(!1),(0,a.Vp)(void 0)}};B=q([(0,o.CommandHandler)(i.EnableAnalysisCommand),G("design:paramtypes",[j])],B);var H=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},W=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let K=class{constructor(e){this.settings=e}async execute(){return await this.settings.isAutofillDisabled.set(!0),(0,a.Vp)(void 0)}};K=H([(0,o.CommandHandler)(i.DisableAnalysisCommand),W("design:paramtypes",[j])],K);var z=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},$=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Q=class{constructor(e){this.settings=e}async execute(){return await this.settings.disabledSourceTypes.remove([...i.FORM_DATA_MODELS]),(0,a.Vp)(void 0)}};Q=z([(0,o.CommandHandler)(i.EnableAutofillOnFormsCommand),$("design:paramtypes",[j])],Q);var Y=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},J=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let X=class{constructor(e){this.settings=e}async execute(){return await this.settings.disabledSourceTypes.remove([...i.CREDENTIAL_DATA_MODELS]),(0,a.Vp)(void 0)}};X=Y([(0,o.CommandHandler)(i.EnableAutofillOnLoginsCommand),J("design:paramtypes",[j])],X);var Z=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ee=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let te=class{constructor(e){this.settings=e}async execute(){return await this.settings.isFollowUpNotificationEnabled.set(!0),(0,a.Vp)(void 0)}};te=Z([(0,o.CommandHandler)(i.EnableFollowUpNotificationCommand),ee("design:paramtypes",[j])],te);var re=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ne=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let oe=class{constructor(e){this.settings=e}async execute(){return await this.settings.disabledSourceTypes.add([...i.FORM_DATA_MODELS]),(0,a.Vp)(void 0)}};oe=re([(0,o.CommandHandler)(i.DisableAutofillOnFormsCommand),ne("design:paramtypes",[j])],oe);var ie=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ae=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let se=class{constructor(e){this.settings=e}async execute(){return await this.settings.disabledSourceTypes.add([...i.CREDENTIAL_DATA_MODELS]),(0,a.Vp)(void 0)}};se=ie([(0,o.CommandHandler)(i.DisableAutofillOnLoginsCommand),ae("design:paramtypes",[j])],se);var ce=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ue=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let le=class{constructor(e){this.settings=e}async execute(){return await this.settings.isFollowUpNotificationEnabled.set(!1),(0,a.Vp)(void 0)}};le=ce([(0,o.CommandHandler)(i.DisableFollowUpNotificationCommand),ue("design:paramtypes",[j])],le);var de=r(45059);const pe=e=>!!e&&(0,i.isArrayOfUserAutofillCorrections)(e);class fe extends((0,o.defineStore)({persist:!0,storage:{initialValue:[],typeGuard:pe,schemaVersion:1},scope:E.UseCaseScope.Device,storeName:"user-autofill-corrections",capacity:o.StoreCapacity._100KB,codec:de.Eu})){}var he=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},me=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ye=class{constructor(e){this.store=e}get userAutofillCorrections(){return{get$:this._getUserAutofillCorrections$,set:this._setUserAutofillCorrections.bind(this)}}get _getUserAutofillCorrections$(){return this.store.state$}async _setUserAutofillCorrections(e){try{await this.store.set(e)}catch{throw new Error("SetUserAutofillCorrections command from core-autofill failed")}}};ye=he([(0,o.Injectable)(),me("design:paramtypes",[fe])],ye);var ge=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ve=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let be=class{constructor(e){this.settings=e}execute(){return this.settings.userAutofillCorrections.get$.pipe((0,d.U)(a.Vp))}};be=ge([(0,o.QueryHandler)(i.GetUserAutofillCorrectionsQuery),ve("design:paramtypes",[ye])],be);var we=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Se=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Re=class{constructor(e){this.correctionsRepository=e}async execute({body:e}){const{corrections:t}=e;return await this.correctionsRepository.userAutofillCorrections.set(t),(0,a.Vp)(void 0)}};Re=we([(0,o.CommandHandler)(i.SetUserAutofillCorrectionsCommand),Se("design:paramtypes",[ye])],Re);var Ee=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let Oe=class{};Oe=Ee([(0,o.Module)({api:i.autofillSettingsApi,handlers:{commands:{toggleDashlane:l,enableAnalysis:B,enableAutofillOnForms:Q,enableAutofillOnLogins:X,enableFollowUpNotification:te,disableAnalysis:K,disableAutofillOnForms:oe,disableAutofillOnLogins:se,disableFollowUpNotification:le,addDisabledSourceTypes:N,removeDisabledSourceTypes:V,setUserAutofillCorrections:Re},events:{},queries:{getAnalysisStatusOnUrl:I,getAutofillSettings:U,getUserAutofillCorrections:be}},stores:[fe],providers:[j,ye],requiredFeatureFlips:Object.values(n)})],Oe);var Ce=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let Pe=class{};Pe=Ce([(0,o.Module)({api:i.autofillDataApi,handlers:{commands:{},events:{},queries:{}}})],Pe)},14258:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.auditLogsApi=void 0;const n=r(68224),o=r(12524);t.auditLogsApi=(0,n.defineModuleApi)({name:"auditLogs",commands:{storeAuditLogs:o.StoreAuditLogsCommand},events:{},queries:{}})},17033:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(12524),t)},12524:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StoreAuditLogsCommand=t.StoreAuditLogsInvalidLogsError=void 0;const n=r(68224);!function(e){e.AUDIT_LOG_MISSING_JSON_SCHEMA="AUDIT_LOG_MISSING_JSON_SCHEMA",e.AUDIT_LOG_INVALID_JSON_FOR_JSON_SCHEMA="AUDIT_LOG_INVALID_JSON_FOR_JSON_SCHEMA",e.AUDIT_LOG_INVALID_LOG_SCHEMA_TYPE_OR_VERSION="AUDIT_LOG_INVALID_LOG_SCHEMA_TYPE_OR_VERSION",e.AUDIT_LOG_ERROR_READING_JSON_SCHEMA="AUDIT_LOG_ERROR_READING_JSON_SCHEMA",e.STORING_SENSITIVE_AUDIT_LOGS_NOT_ALLOWED="STORING_SENSITIVE_AUDIT_LOGS_NOT_ALLOWED"}(t.StoreAuditLogsInvalidLogsError||(t.StoreAuditLogsInvalidLogsError={}));class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.StoreAuditLogsCommand=o},61899:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(14258),t),o(r(17033),t),o(r(75711),t)},20676:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},28279:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AuditLogCategory=t.AuditLogType=void 0,function(e){e.UserInvited="user_invited",e.UserReinvited="user_reinvited",e.UserRemoved="user_removed",e.TeamCaptainAdded="team_captain_added",e.TeamCaptainRemoved="team_captain_removed",e.GroupManagerAdded="group_manager_added",e.GroupManagerRemoved="group_manager_removed",e.MasterPasswordResetAccepted="master_password_reset_accepted",e.MasterPasswordResetRefused="master_password_reset_refused",e.BillingAdminAdded="billing_admin_added",e.BillingAdminRemoved="billing_admin_removed",e.UserGroupCreated="user_group_created",e.UserGroupRenamed="user_group_renamed",e.UserGroupDeleted="user_group_deleted",e.UserJoinedUserGroup="user_joined_user_group",e.UserLeftUserGroup="user_left_user_group",e.UserInvitedToUserGroup="user_invited_to_user_group",e.UserDeclinedInviteToUserGroup="user_declined_invite_to_user_group",e.UserRemovedFromUserGroup="user_removed_from_user_group",e.DomainRequested="domain_requested",e.DomainValidated="domain_validated",e.SensitiveLogsEnabled="collect_sensitive_data_audit_logs_enabled",e.SensitiveLogsDisabled="collect_sensitive_data_audit_logs_disabled",e.SsoIdpMetadataSet="sso_idp_metadata_set",e.SsoServiceProviderUrlSet="sso_service_provider_url_set",e.SsoEnabled="sso_enabled",e.SsoDisabled="sso_disabled",e.TeamNameChanged="team_name_changed",e.NewBillingPeriodCreated="new_billing_period_created",e.SeatsAdded="seats_added",e.ContactEmailChanged="contact_email_changed",e.MasterPasswordMobileResetEnabled="master_password_mobile_reset_enabled",e.MasterPasswordMobileResetDisabled="master_password_mobile_reset_disabled",e.MasterPasswordMobileReset="master_password_mobile_reset",e.MasterPasswordChanged="master_password_changed",e.MpToViewPasswordsEnabled="mp_to_view_passwords_enabled",e.MpToViewPasswordsDisabled="mp_to_view_passwords_disabled",e.TwoFactorAuthenticationLoginMethodAdded="two_factor_authentication_login_method_added",e.TwoFactorAuthenticationLoginMethodRemoved="two_factor_authentication_login_method_removed",e.BiometricSignInDisabled="biometric_sign_in_disabled",e.DWMEmailAdded="dwm_email_added",e.DWMEmailRemoved="dwm_email_removed",e.DWMAlertReceived="dwm_alert_received",e.UserDeviceAdded="user_device_added",e.UserDeviceRemoved="user_device_removed",e.UserDeviceLogin="user_device_login",e.MasterPasswordReset="master_password_reset",e.RequestedAccountRecovery="requested_account_recovery",e.CompletedAccountRecovery="completed_account_recovery",e.UserSharedCredentialWithGroup="user_shared_credential_with_group",e.UserSharedCredentialWithEmail="user_shared_credential_with_email",e.UserSharedCredentialWithExternal="user_shared_credential_with_external",e.UserSharedSecureNoteWithGroup="user_shared_secure_note_with_group",e.UserSharedSecureNoteWithEmail="user_shared_secure_note_with_email",e.UserSharedSecureNoteWithExternal="user_shared_secure_note_with_external",e.UserRevokedSharedCredentialGroup="user_revoked_shared_credential_group",e.UserRevokedSharedCredentialEmail="user_revoked_shared_credential_email",e.UserRevokedSharedCredentialExternal="user_revoked_shared_credential_external",e.UserRevokedSharedSecureNoteGroup="user_revoked_shared_secure_note_group",e.UserRevokedSharedSecureNoteEmail="user_revoked_shared_secure_note_email",e.UserRevokedSharedSecureNoteExternal="user_revoked_shared_secure_note_external",e.UserAcceptedSharingInviteSecureNote="user_accepted_sharing_invite_secure_note",e.UserRejectedSharingInviteSecureNote="user_rejected_sharing_invite_secure_note",e.UserAcceptedSharingInviteCredential="user_accepted_sharing_invite_credential",e.UserRejectedSharingInviteCredential="user_rejected_sharing_invite_credential",e.UserCreatedCredential="user_created_credential",e.UserModifiedCredential="user_modified_credential",e.UserDeletedCredential="user_deleted_credential",e.UserImportedCredentials="user_imported_credentials",e.UserCreatedSecureNote="user_created_secure_note",e.UserModifiedSecureNote="user_modified_secure_note",e.UserDeletedSecureNote="user_deleted_secure_note"}(t.AuditLogType||(t.AuditLogType={})),function(e){e.Account="account",e.Authentication="authentication",e.DarkWebMonitoring="dark_web_monitoring",e.Groups="groups",e.ImportExport="import_export",e.TeamSettings="team_settings",e.TeamSettingsActiveDirectory="team_settings_activedirectory",e.TeamSettingsPolicies="team_settings_policies",e.TeamSettingsSAMLProvisioning="team_settings_samlprovisioning",e.TeamSettingsSCIM="team_settings_scim",e.TeamSettingsSSO="team_settings_sso",e.Sharing="sharing",e.UserSettings="user_settings",e.UserSettingsAccountRecovery="user_settings_accountrecovery",e.Users="users",e.VaultIDs="vault_ids",e.VaultPasswords="vault_passwords",e.VaultPayments="vault_payments",e.VaultPersonalInfo="vault_personalinfo",e.VaultSecureNotes="vault_securenotes"}(t.AuditLogCategory||(t.AuditLogCategory={}))},8132:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},35484:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},95312:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},69767:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},75711:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(28279),t),o(r(20676),t),o(r(8132),t),o(r(95312),t),o(r(69767),t),o(r(17098),t),o(r(45665),t),o(r(45491),t),o(r(37564),t),o(r(66767),t),o(r(35484),t)},17098:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},45665:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},45491:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},37564:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},66767:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},50990:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(61899),t)},82210:(e,t,r)=>{"use strict";r.d(t,{g:()=>R});var n=r(27606),o=r(11103),i=r(50990),a=r(87279),s=r(60399),c=r(87065),u=r(48844),l=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},d=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let p=class{constructor(e){this.serverApiClient=e}async sendLogs(e){try{return await(0,s.z)(this.serverApiClient.v1.teams.storeAuditLogs({auditLogs:e}).pipe((0,u.DZ)((()=>(0,a.Rn)("Unknown HTTP error occurred."))),(0,u.lk)((e=>e.data.invalidAuditLogs.length?(0,a.Vp)(this.serverToTechnicalSchemaErrorsMapper(e.data.invalidAuditLogs)):(0,a.Vp)(void 0)))))}catch(e){return e instanceof n.BadStatus&&400===e.response.status?(0,a.Rn)({tag:"failure",error:"A request_malformed error occurred."}):(0,a.Rn)({tag:"failure",error:"Unknown HTTP error occurred."})}}serverToTechnicalSchemaErrorsMapper(e){return{invalidAuditLogs:e.map((e=>({uuid:e.uuid,error:i.StoreAuditLogsInvalidLogsError[e.error]})))}}};p=l([(0,n.Injectable)(),d("design:paramtypes",[o.lX])],p);var f=r(53576),h=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},m=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let y=class{constructor(e){this.client=e}get(){const{queries:{carbonState:e}}=this.client.getClient(f.carbonLegacyApi);return e({path:"state.userSession.spaceData.spaces"}).pipe((0,u.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t?.teamId&&"object"==typeof t?.details&&"string"==typeof t?.details.status}))))(e))throw new Error("Bad space item format");const t=e.find((e=>"accepted"===e.details.status)),r=t?.details.info.collectSensitiveDataAuditLogsEnabled;return Boolean(r)})))}};y=h([(0,n.Injectable)(),m("design:paramtypes",[n.CqrsClient])],y);var g=r(68224),v=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},b=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let w=class{constructor(e,t,r){this.client=e,this.auditLogsService=t,this.sensitiveLogsEnabledGetter=r}async execute({body:{auditLogs:e}}){const{queries:{userFeatureFlips:t}}=this.client.getClient(g.requestContextApi);if(!(await(0,s.z)(t({requiredFeatureFlips:["send_activity_log"]}).pipe((0,c.U)((e=>{if((0,a.d6)(e))return(0,a.db)(e);throw new Error("Failed to retrieve user featureFlips")}))))).send_activity_log)return(0,a.Vp)(void 0);const r=await(0,s.z)(this.sensitiveLogsEnabledGetter.get());if(!(0,a.d6)(r))throw new Error("Error while getting sensitive logs enabled data");const n=e.filter((e=>!e.is_sensitive||r.data));return n.length&&await this.auditLogsService.sendLogs(n),Promise.resolve((0,a.Vp)(void 0))}};w=v([(0,n.CommandHandler)(i.StoreAuditLogsCommand),b("design:paramtypes",[n.CqrsClient,p,y])],w);var S=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let R=class{};R=S([(0,n.Module)({api:i.auditLogsApi,imports:[o.nr],providers:[p,y],handlers:{commands:{storeAuditLogs:w},events:{},queries:{}},requiredFeatureFlips:["send_activity_log"]})],R)},26938:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(99314),t)},62884:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sessionApi=void 0;const n=r(68224),o=r(25885),i=r(54148),a=r(78049);t.sessionApi=(0,n.defineModuleApi)({name:"session",commands:{SampleCommand:o.SampleCommand},events:{SampleEvent:i.SampleEvent},queries:{SampleQuery:a.SampleQuery}})},25885:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(12114),t)},12114:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SampleCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.SampleCommand=o},54148:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(8323),t)},8323:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SampleEvent=void 0;const n=r(68224);class o extends((0,n.defineEvent)({scope:n.UseCaseScope.User})){}t.SampleEvent=o},99314:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(62884),t),o(r(25885),t),o(r(54148),t),o(r(78049),t)},78049:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(83062),t)},83062:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SampleQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.SampleQuery=o},45979:(e,t,r)=>{"use strict";r.d(t,{R:()=>d});var n=r(60399),o=r(53576),i=r(27606),a=r(11103),s=r(54066),c=r(48844),u=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},l=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let d=class{constructor(e,t){this.cqrsClient=e,this.flexibleDecryptor=t}async decrypt(e){const{carbonState:t}=this.cqrsClient.getClient(o.carbonLegacyApi).queries,r=t({path:"userSession.session.localKey"}).pipe((0,c.nb)({success:e=>{if("string"!=typeof e)throw new Error("Local key not a string");return e},failure:()=>{throw new Error("Failure getting local key")}})),i=await(0,n.z)(r);return this.flexibleDecryptor.decrypt((0,s.u)(i),e)}};d=u([(0,i.Injectable)(),l("design:paramtypes",[i.CqrsClient,a.ah])],d)},13043:(e,t,r)=>{"use strict";r.d(t,{g:()=>c});var n=r(27606),o=r(45979),i=r(33267),a=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},s=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let c=class{constructor(e,t){this.localKeyDecryptor=e,this.localKeyEncryptor=t}encode(e){return this.localKeyEncryptor.encrypt(e)}decode(e){return this.localKeyDecryptor.decrypt(e)}};c=a([(0,n.Injectable)(),s("design:paramtypes",[o.R,i.X])],c)},33267:(e,t,r)=>{"use strict";r.d(t,{X:()=>p});var n=r(60399),o=r(27606),i=r(11103),a=r(53576),s=r(48844),c=r(45059),u=r(54066),l=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},d=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let p=class{constructor(e,t){this.cqrsClient=e,this.flexibleEncryptor=t}async encrypt(e){const{carbonState:t}=this.cqrsClient.getClient(a.carbonLegacyApi).queries,r=t({path:"userSession.session.localKey"}).pipe((0,s.nb)({success:e=>{if("string"!=typeof e)throw new Error("Local key not a string");return e},failure:()=>{throw new Error("Failure getting state list")}})),o=await(0,n.z)(r);return this.flexibleEncryptor.encrypt((0,u.u)(o),e,c.oo,c.gO)}};p=l([(0,o.Injectable)(),d("design:paramtypes",[o.CqrsClient,i._M])],p)},99290:(e,t,r)=>{"use strict";r.d(t,{_:()=>N});var n=r(27606),o=r(26938),i=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let a=class{execute(){throw new Error("To be implemented")}};a=i([(0,n.CommandHandler)(o.SampleCommand)],a);var s=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let c=class{execute(){throw new Error("Not yet implemented")}};c=s([(0,n.QueryHandler)(o.SampleQuery)],c);var u=r(68224);class l extends((0,n.defineStore)({initialValue:{},storeName:"session-key-store",scope:u.UseCaseScope.Device,capacity:n.StoreCapacity._010KB,persist:!1})){}var d=r(11103),p=r(45979),f=r(33267),h=r(13043),m=r(53576),y=r(60399),g=r(87065),v=r(87279),b=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},w=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let S=class{constructor(e,t,r){this.cqrsClient=e,this.flexibleDecryptor=t,this.sessionKeyStore=r}async decrypt(e){const{carbonState:t}=this.cqrsClient.getClient(m.carbonLegacyApi).queries,r=await(0,y.z)(t({path:"state.userSession.account.login"}).pipe((0,g.U)((e=>{if((0,v.d6)(e)&&"string"==typeof e.data)return e.data;throw new Error("No active login")})))),n=await this.sessionKeyStore.getState();if(!(r in n))throw new Error("No session ciphering data found for active login");const{sessionKey:o}=n[r];return this.flexibleDecryptor.decrypt(o,e)}};S=b([(0,n.Injectable)(),w("design:paramtypes",[n.CqrsClient,d.ah,l])],S);var R=r(45059),E=r(54066),O=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},C=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const P={pbkdf2:R.E1,noderivation:R.oo,argon2d:R.mr};let A=class{constructor(e){this.carbonLegacy=e.getClient(m.carbonLegacyApi)}makeDerivationConfig(e){const[,,t]=e.split("$");return(0,R.b9)(t)?P[t]:R.mr}config(){return this.carbonLegacy.queries.carbonStateList({paths:["state.userSession.personalSettings.CryptoUserPayload","state.userSession.personalSettings.CryptoFixedSalt"]}).pipe((0,g.U)((e=>{if((0,v.d6)(e)){const[t,r]=e.data;return(0,v.Vp)({derivation:"string"==typeof t?this.makeDerivationConfig(t):R.mr,salt:"string"==typeof r?(0,E.u)(r):void 0})}return(0,v.Vp)({derivation:R.mr,salt:void 0})})))}};A=O([(0,n.Injectable)(),C("design:paramtypes",[n.CqrsClient])],A);var j=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},_=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let T=class{constructor(e,t,r,n){this.cqrsClient=e,this.sessionKeyStore=t,this.cipheringSettingsService=r,this.flexibleEncryptor=n}async encrypt(e){const{carbonState:t}=this.cqrsClient.getClient(m.carbonLegacyApi).queries,r=await(0,y.z)(t({path:"state.userSession.account.login"}).pipe((0,g.U)((e=>{if((0,v.d6)(e)&&"string"==typeof e.data)return e.data;throw new Error("No active login")})))),n=await this.sessionKeyStore.getState();if(!(r in n))throw new Error("No session ciphering data found for active login");const o=await(0,y.z)(this.cipheringSettingsService.config());if((0,v.d6)(o)){const{derivation:t,salt:i}=o.data;if(!i)throw new Error("No salt available in the user settings. Unsupported for now");const{algorithm:a}=t;if("noderivation"===a)throw new Error("Session key requires derivation");const{sessionKey:s}=n[r];return this.flexibleEncryptor.encrypt(s,e,t,R.Nw,{salt:i})}throw new Error("Unable to read user crypto settings / salt")}};T=j([(0,n.Injectable)(),_("design:paramtypes",[n.CqrsClient,l,A,d._M])],T);var I=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},D=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let x=class{constructor(e,t){this.sessionEncryptor=e,this.sessionDecryptor=t}async decode(e){return await this.sessionDecryptor.decrypt(e)}async encode(e){return await this.sessionEncryptor.encrypt(e)}};x=I([(0,n.Injectable)(),D("design:paramtypes",[T,S])],x);const U=e=>!(!e||"object"!=typeof e)&&(0===Object.keys(e).length||Object.entries(e).every((([,e])=>"object"==typeof e&&"localKey"in e&&"byteLength"in e.localKey)));class M extends((0,n.defineStore)({storeName:"local-key-store",scope:u.UseCaseScope.Device,capacity:n.StoreCapacity._010KB,persist:!0,storage:{schemaVersion:1,initialValue:{},typeGuard:U,EncryptionCodec:x},codec:R.Eu})){}var L=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let N=class{};N=L([(0,n.Module)({api:o.sessionApi,handlers:{commands:{sample:a},events:{},queries:{sample:c}},providers:[p.R,f.X,h.g,x,S,T,A],exports:[p.R,f.X,h.g],stores:[M,l],imports:[d.Dq]})],N)},43838:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(75696),t),o(r(20985),t),o(r(65408),t)},75676:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sharingCollectionsApi=void 0;const n=r(68224),o=r(40177);t.sharingCollectionsApi=(0,n.defineModuleApi)({name:"sharingCollections",commands:{},events:{},queries:{getSharedCollections:o.GetSharedCollectionsQuery}})},65408:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(75676),t),o(r(40177),t)},60915:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetSharedCollectionsQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.GetSharedCollectionsQuery=o},40177:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(60915),t)},30438:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sharingInvitesApi=void 0;const n=r(68224),o=r(2042),i=r(78044);t.sharingInvitesApi=(0,n.defineModuleApi)({name:"sharingInvites",commands:{RefuseItemGroupInviteCommand:o.RefuseItemGroupInviteCommand,RefuseUserGroupInviteCommand:o.RefuseUserGroupInviteCommand},events:{},queries:{GetInvitesQuery:i.GetInvitesQuery}})},2042:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(89494),t),o(r(42166),t)},89494:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RefuseItemGroupInviteCommand=t.getRefuseItemGroupInviteFunctionalError=t.RefuseItemGroupInviteUserIsNotInPendingStatusError=t.RefuseItemGroupInviteNotEnoughAdminsError=t.RefuseItemGroupInviteInvalidItemGroupRevisionError=t.RefuseItemGroupInviteUserGroupIsNotInItemGroupError=t.RefuseItemGroupInviteUserIsNotInItemGroupError=t.RefuseItemGroupInviteGroupHasInvalidStatusError=t.RefuseItemGroupInviteAuthorHasInvalidStatusError=t.RefuseItemGroupInviteNotFoundError=t.RefuseItemGroupInviteResultErrorCode=void 0;const n=r(68224),o=r(58807);var i;!function(e){e.ItemGroupNotFound="ItemGroupNotFound",e.AuthorHasInvalidStatus="AuthorHasInvalidStatus",e.GroupHasInvalidStatus="GroupHasInvalidStatus",e.UserIsNotInItemGroup="UserIsNotInItemGroup",e.UserGroupIsNotInItemGroup="UserGroupIsNotInItemGroup",e.InvalidItemGroupRevision="InvalidItemGroupRevision",e.NotEnoughAdmins="NotEnoughAdmins",e.UserIsNotInPendingStatus="UserIsNotInPendingStatus"}(i=t.RefuseItemGroupInviteResultErrorCode||(t.RefuseItemGroupInviteResultErrorCode={}));class a extends((0,o.FunctionalError)(i.ItemGroupNotFound,"Item Group not found")){}t.RefuseItemGroupInviteNotFoundError=a;class s extends((0,o.FunctionalError)(i.AuthorHasInvalidStatus,"User is not in accepted/pending status (already refused or revoked)")){}t.RefuseItemGroupInviteAuthorHasInvalidStatusError=s;class c extends((0,o.FunctionalError)(i.GroupHasInvalidStatus,"UserGroup is not in accepted/pending status (already refused or revoked)")){}t.RefuseItemGroupInviteGroupHasInvalidStatusError=c;class u extends((0,o.FunctionalError)(i.UserIsNotInItemGroup,"User is not part of item group")){}t.RefuseItemGroupInviteUserIsNotInItemGroupError=u;class l extends((0,o.FunctionalError)(i.UserGroupIsNotInItemGroup,"User group is not part of item group")){}t.RefuseItemGroupInviteUserGroupIsNotInItemGroupError=l;class d extends((0,o.FunctionalError)(i.InvalidItemGroupRevision,"Item group revision is not valid")){}t.RefuseItemGroupInviteInvalidItemGroupRevisionError=d;class p extends((0,o.FunctionalError)(i.NotEnoughAdmins,"The operation would let the item group with no admin")){}t.RefuseItemGroupInviteNotEnoughAdminsError=p;class f extends((0,o.FunctionalError)(i.UserIsNotInPendingStatus,'User is not in "pending" status or not part of a group')){}t.RefuseItemGroupInviteUserIsNotInPendingStatusError=f,t.getRefuseItemGroupInviteFunctionalError=function(e){switch(e){case"AUTHOR_HAS_INVALID_STATUS":return new s;case"GROUP_HAS_INVALID_STATUS":return new c;case"USER_IS_NOT_IN_ITEM_GROUP":return new u;case"USER_GROUP_IS_NOT_IN_ITEM_GROUP":return new l;case"INVALID_ITEM_GROUP_REVISION":return new d;case"NOT_ENOUGH_ADMINS":return new p;case"USER_IS_NOT_IN_PENDING_STATUS":return new f;default:throw new Error("Unknown server error")}};class h extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.RefuseItemGroupInviteCommand=h},42166:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RefuseUserGroupInviteCommand=t.getRefuseUserGroupInviteFunctionalError=t.RefuseUserGroupInviteAuthorHasInvalidStatusError=t.RefuseUserGroupInviteGroupHasInvalidStatusError=t.RefuseUserGroupInviteUserIsNotInPendingStatusError=t.RefuseUserGroupInviteUserIsNotInUserGroupError=t.RefuseUserGroupInviteInsufficientPrivilegesError=t.RefuseUserGroupInviteUserGroupUpdateConflictError=t.RefuseUserGroupInviteInvalidItemGroupRevisionError=t.RefuseUserGroupInviteUserGroupIsNotFoundError=t.RefuseUserGroupInviteInvalidTeamIdError=t.RefuseUserGroupInviteNotFoundError=t.RefuseUserGroupInviteResultErrorCode=void 0;const n=r(68224),o=r(58807);var i;!function(e){e.UserGroupNotFound="UserGroupNotFound",e.InvalidTeamId="InvalidTeamId",e.UserGroupIsNotFound="UserGroupIsNotFound",e.InvalidItemGroupRevision="InvalidItemGroupRevision",e.UserGroupUpdateConflict="UserGroupUpdateConflict",e.InsufficientPrivileges="InsufficientPrivileges",e.UserIsNotInUserGroup="UserIsNotInUserGroup",e.UserIsNotInPendingStatus="UserIsNotInPendingStatus",e.GroupHasInvalidStatus="GroupHasInvalidStatus",e.AuthorHasInvalidStatus="AuthorHasInvalidStatus"}(i=t.RefuseUserGroupInviteResultErrorCode||(t.RefuseUserGroupInviteResultErrorCode={}));class a extends((0,o.FunctionalError)(i.UserGroupNotFound,"User Group not found")){}t.RefuseUserGroupInviteNotFoundError=a;class s extends((0,o.FunctionalError)(i.InvalidTeamId,"Provided Team ID is not a number")){}t.RefuseUserGroupInviteInvalidTeamIdError=s;class c extends((0,o.FunctionalError)(i.UserGroupIsNotFound,"User group for provided ID does not exist")){}t.RefuseUserGroupInviteUserGroupIsNotFoundError=c;class u extends((0,o.FunctionalError)(i.InvalidItemGroupRevision,"User group revision is not valid")){}t.RefuseUserGroupInviteInvalidItemGroupRevisionError=u;class l extends((0,o.FunctionalError)(i.UserGroupUpdateConflict,"Conflict between users attempting to update the same user group")){}t.RefuseUserGroupInviteUserGroupUpdateConflictError=l;class d extends((0,o.FunctionalError)(i.InsufficientPrivileges,"The user does not have User Group permission to refuse the invitation")){}t.RefuseUserGroupInviteInsufficientPrivilegesError=d;class p extends((0,o.FunctionalError)(i.UserIsNotInUserGroup,"User is not part of a group")){}t.RefuseUserGroupInviteUserIsNotInUserGroupError=p;class f extends((0,o.FunctionalError)(i.UserIsNotInPendingStatus,'User is not in "pending" status or not part of a group')){}t.RefuseUserGroupInviteUserIsNotInPendingStatusError=f;class h extends((0,o.FunctionalError)(i.GroupHasInvalidStatus,'UserGroup is not in "accepted" or "pending" status (already refused or revoked)')){}t.RefuseUserGroupInviteGroupHasInvalidStatusError=h;class m extends((0,o.FunctionalError)(i.AuthorHasInvalidStatus,"User is not in accepted/pending status (already refused or revoked)")){}t.RefuseUserGroupInviteAuthorHasInvalidStatusError=m,t.getRefuseUserGroupInviteFunctionalError=function(e){switch(e){case"INVALID_TEAM_ID":return new s;case"USER_GROUP_IS_NOT_FOUND":return new c;case"INVALID_USER_GROUP_REVISION":return new u;case"USER_GROUP_UPDATE_CONFLICT":return new l;case"INSUFFICIENT_PRIVILEGES":return new d;case"USER_IS_NOT_IN_USER_GROUP":return new p;case"USER_IS_NOT_IN_PENDING_STATUS":return new f;case"GROUP_HAS_INVALID_STATUS":return new h;case"AUTHOR_HAS_INVALID_STATUS":return new m;default:throw new Error("Unknown server error")}};class y extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.RefuseUserGroupInviteCommand=y},20985:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(30438),t),o(r(2042),t),o(r(78044),t)},34173:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetInvitesQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.GetInvitesQuery=o},78044:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(34173),t)},76293:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sharingItemsApi=void 0;const n=r(68224),o=r(61735);t.sharingItemsApi=(0,n.defineModuleApi)({name:"sharingItems",commands:{},events:{},queries:{sharingEnabled:o.SharingEnabledQuery}})},75696:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(76293),t),o(r(61735),t)},61735:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(96732),t)},96732:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SharingEnabledQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.SharingEnabledQuery=o},78489:(e,t,r)=>{"use strict";r.d(t,{a9:()=>H,p6:()=>x,FF:()=>f});var n=r(27606),o=r(43838),i=r(53576),a=r(48844);const s=e=>(e.spaces??[]).filter((e=>"accepted"===e.status));var c=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},u=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const l=e=>{if(!e)return!1;const t=e;if(!(r=t.spaces)||!Array.isArray(r)||0!==r.length&&!(e=>{if(!e)return!1;const t=e;return!!(t.associatedEmail&&t.billingAdmins&&t.color&&t.info&&t.letter&&t.planType&&t.status&&t.teamAdmins&&t.teamId&&t.teamName&&t.tier)})(r[0]))return!0;var r;const n=s(t)[0];return!n?.info?.sharingDisabled};let d=class{constructor(e){this.client=e}execute(){const{queries:{carbonState:e}}=this.client.getClient(i.carbonLegacyApi);return e({path:"userSession.localSettings.premiumStatus"}).pipe((0,a.Qn)((e=>l(e))))}};d=c([(0,n.QueryHandler)(o.SharingEnabledQuery),u("design:paramtypes",[n.CqrsClient])],d);var p=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let f=class{};f=p([(0,n.Module)({api:o.sharingItemsApi,handlers:{commands:{},events:{},queries:{sharingEnabled:d}}})],f);var h=r(11103);var m=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},y=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let g=class{constructor(e){this.client=e}execute(){const{queries:{carbonState:e}}=this.client.getClient(i.carbonLegacyApi);return e({path:"userSession.sharingSync"}).pipe((0,a.Qn)((e=>{if(!(e=>{if(!e)return!1;const t=e;return!!t.pendingItemGroups&&!!t.pendingUserGroups})(e))throw new Error("Bad SharingSync format");return e})))}};g=m([(0,n.QueryHandler)(o.GetInvitesQuery),y("design:paramtypes",[n.CqrsClient])],g);var v=r(60399),b=r(82567),w=r(87279),S=r(10203),R=r(17509);const E=e=>{if(!e||"object"!=typeof e)return!1;const t=e;return r=t.items,!!Array.isArray(r)&&(0===r.length||r.every((e=>{const t=e;return"string"==typeof t.content&&"string"==typeof t.itemId&&"number"==typeof t.timestamp})))&&(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.groupId&&"string"==typeof t.type&&"number"==typeof t.revision}))))(t.itemGroups)&&(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.groupId&&"string"==typeof t.name&&"string"==typeof t.publicKey&&"string"==typeof t.privateKey&&"number"==typeof t.revision}))))(t.userGroups);var r};var O=r(68224),C=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},P=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let A=class{constructor(e,t){this.client=e,this.serverApiClient=t}async execute(e){const{body:{itemGroupId:t}}=e,{queries:{carbonState:r},commands:{carbonLegacyLeeloo:n}}=this.client.getClient(i.carbonLegacyApi),{queries:{getInvites:c}}=this.client.getClient(o.sharingInvitesApi),u=c().pipe((0,a.Qn)((e=>{const r=e.pendingItemGroups.find((e=>e.itemGroupId===t));if(!r)throw new Error(`Pending item group not found for id ${t}`);if(r.items.length<1)throw new Error(`Missing item content for pending item group with id ${t}`);return r.items[0]}))),l=await(0,v.z)(u);if((0,w.hx)(l))throw new Error(`Failed to retrieve item content for pending item group with id ${t}`);const d=l.data,p=r({path:"userSession.sharingData"}).pipe((0,a.Qn)((e=>{if(!E(e))throw new Error("Bad sharingData");return e}))).pipe((0,a.lk)((e=>{const r=e.itemGroups.find((({groupId:e})=>e===t));return(0,w.Vp)(r)}))),f=await(0,v.z)(p);if((0,w.hx)(f))throw new Error(`Failed to retrieve item group for pending item group with id ${t}`);if(void 0===f.data)return(0,w.Rn)(new o.RefuseItemGroupInviteNotFoundError);const h=r({path:"userSession.localSettings.premiumStatus"}).pipe((0,a.Qn)((e=>s(e)[0]))),m=await(0,v.z)(h),{userFeatureFlips:y}=this.client.getClient(O.requestContextApi).queries,g=await(0,v.z)(y({requiredFeatureFlips:["audit_logs_sharing","send_activity_log"]}));if((0,w.hx)(g))throw new Error("Failed to retrieve user features");const C=g.data.audit_logs_sharing&&g.data.send_activity_log&&(0,w.d6)(m)?((e,t)=>{const r=(!!t?.SpaceId&&e?.info.collectSensitiveDataAuditLogsEnabled)??!1,n=t&&(0,i.isCredential)(t),o=n&&t.Url?(0,R.extractRootDomain)(t.Url):"";return r?{captureLog:r,domain:n?o||"":void 0,type:n?"AUTHENTIFIANT":"SECURENOTE"}:void 0})(m.data,d):void 0;return(0,v.z)(this.serverApiClient.v1.sharingUserdevice.refuseItemGroup({groupId:f.data.groupId,revision:f.data.revision,itemsForEmailing:[(P=d,{type:(0,i.isCredential)(P)?"password":"note",name:P.Title})],auditLogDetails:C}).pipe((0,a.DZ)((e=>{if("BusinessError"===e.tag)return(0,o.getRefuseItemGroupInviteFunctionalError)(e.code);throw new Error(e.message)})),(0,a.lk)((e=>{if(void 0===e.data.itemGroupErrors||0===e.data.itemGroupErrors.length)return(0,w.Vp)(void 0);if(e.data.itemGroupErrors.length>0)throw new Error(`Error for item group ${e.data.itemGroupErrors[0].groupId}: ${e.data.itemGroupErrors[0].message}`);throw new Error("Unknown server error")})),(0,b.b)((async e=>{(0,w.d6)(e)&&await n({name:"sessionForceSync",arg:[{trigger:S.Trigger.Sharing}]})}))));var P}};A=C([(0,n.CommandHandler)(o.RefuseItemGroupInviteCommand),P("design:paramtypes",[n.CqrsClient,h.lX])],A);var j=r(1774),_=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},T=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let I=class{constructor(e,t){this.client=e,this.serverApiClient=t}async execute(e){const{body:{userGroupId:t}}=e,{queries:{carbonState:r},commands:{carbonLegacyLeeloo:n}}=this.client.getClient(i.carbonLegacyApi),s=r({path:"userSession.sharingData"}).pipe((0,a.Qn)((e=>{if(!E(e))throw new Error("Bad sharingData");return e}))).pipe((0,a.Qn)((e=>{const r=e.userGroups.find((({groupId:e})=>e===t));if(!r)throw new Error("Could not find userGroup");return r}))),c=await(0,v.z)(s);if((0,w.hx)(c))throw new Error(`Failed to retrieve user group for pending user group with id ${t}`);return await(0,v.z)(this.serverApiClient.v1.sharingUserdevice.refuseUserGroup({groupId:c.data.groupId,revision:c.data.revision,provisioningMethod:j.ET.USER}).pipe((0,a.DZ)((e=>{if("BusinessError"===e.tag)return(0,o.getRefuseUserGroupInviteFunctionalError)(e.code);throw new Error(e.message)})),(0,a.lk)((e=>{if(void 0===e.data.userGroupErrors||0===e.data.userGroupErrors.length)return(0,w.Vp)(void 0);if(e.data.userGroupErrors.length>0)throw new Error(`Error for user group ${e.data.userGroupErrors[0].groupId}: ${e.data.userGroupErrors[0].message}`);throw new Error("Unknown server error")})),(0,b.b)((async e=>{(0,w.d6)(e)&&await n({name:"sessionForceSync",arg:[{trigger:S.Trigger.Sharing}]})}))))}};I=_([(0,n.CommandHandler)(o.RefuseUserGroupInviteCommand),T("design:paramtypes",[n.CqrsClient,h.lX])],I);var D=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let x=class{};x=D([(0,n.Module)({api:o.sharingInvitesApi,handlers:{commands:{refuseItemGroupInvite:A,refuseUserGroupInvite:I},events:{},queries:{getInvites:g}},imports:[h.nr],requiredFeatureFlips:["audit_logs_sharing","send_activity_log"]})],x);var U=r(87065),M=r(7165);const L=M.z.object({collectionId:M.z.string(),collectionKey:M.z.string(),name:M.z.string(),privateKey:M.z.string(),publicKey:M.z.string(),revision:M.z.number()}),N=M.z.object({sharedCollections:M.z.array(L)}),k=e=>N.safeParse(e).success;class F extends((0,n.defineStore)({capacity:n.StoreCapacity._010KB,persist:!1,scope:O.UseCaseScope.User,storeName:"collections-store",storeTypeGuard:k,initialValue:{sharedCollections:[]}})){}var V=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},q=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let G=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,U.U)((e=>(0,w.Vp)(e.sharedCollections))))}};G=V([(0,n.QueryHandler)(o.GetSharedCollectionsQuery),q("design:paramtypes",[F])],G);var B=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let H=class{};H=B([(0,n.Module)({api:o.sharingCollectionsApi,stores:[F],handlers:{commands:{},events:{},queries:{getSharedCollections:G}}})],H)},66179:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(41228),t),o(r(55775),t),o(r(85155),t),o(r(76045),t)},41228:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncApi=void 0;const n=r(68224),o=r(55775),i=r(85155);t.syncApi=(0,n.defineModuleApi)({name:"sync",commands:{SyncCommand:o.SyncCommand},queries:{SyncProgressQuery:i.SyncProgressQuery},events:{}})},55775:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}t.SyncCommand=o},85155:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncProgressQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.Device})){}t.SyncProgressQuery=o},76045:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncStatuses=void 0,function(e){e.READY="ready",e.IN_PROGRESS="in_progress",e.SUCCESS="success",e.FAILURE="failure"}(t.SyncStatuses||(t.SyncStatuses={}))},83329:(e,t,r)=>{"use strict";r.d(t,{R:()=>E});var n=r(27606),o=r(68224),i=r(66179),a=r(87279),s=r(53576),c=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},u=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let l=class{constructor(e,t){this.carbonLegacy=e.getClient(s.carbonLegacyApi),this.logger=t}async sessionSync(e){return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"sessionForceSync",arg:[{trigger:e}]})}getSyncState(){return this.carbonLegacy.queries.carbonState({path:"userSession.sync"})}};l=c([(0,n.Injectable)(),u("design:paramtypes",[n.CqrsClient,n.AppLogger])],l);var d=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},p=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let f=class{constructor(e){this.syncService=e}execute(e){const{trigger:t}=e.body;return this.syncService.sessionSync(t),Promise.resolve((0,a.Vp)(void 0))}};f=d([(0,n.CommandHandler)(i.SyncCommand),p("design:paramtypes",[l])],f);var h=r(48844);var m=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},y=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let g=class{constructor(e){this.syncService=e}execute(){return this.syncService.getSyncState().pipe((0,h.Qn)((e=>{if("object"!=typeof(t=e)||null===t||!("status"in t)||!Object.values(i.SyncStatuses).includes(t.status))throw new Error("Bad sync state format");var t;return{status:e.status}})))}};g=m([(0,n.QueryHandler)(i.SyncProgressQuery),y("design:paramtypes",[l])],g);var v=r(10203),b=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},w=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let S=class{constructor(e){this.syncService=e}async run(){return await this.syncService.sessionSync(v.Trigger.Periodic),Promise.resolve()}};S=b([(0,n.Injectable)(),w("design:paramtypes",[l])],S);var R=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let E=class{};E=R([(0,n.Module)({api:i.syncApi,handlers:{commands:{sync:f},events:{},queries:{syncProgress:g}},crons:[{handler:S,periodInMinutes:5,name:"periodic-sync-cron",scope:o.UseCaseScope.User}],providers:[l]})],E)},2639:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(53784),t)},18232:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.teamMembersApi=void 0;const n=r(68224),o=r(28539);t.teamMembersApi=(0,n.defineModuleApi)({name:"teamMembers",commands:{ProposeMembersCommand:o.ProposeMembersCommand},events:{},queries:{}})},28539:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(46316),t)},46316:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProposeMembersCommand=t.getProposeMembersFunctionalError=t.ProposeMembersCannotAddSeatDuringGracePeriod=t.ProposeMembersNotBillingAdmin=t.ProposeMembersPaymentFailed=t.ProposeMembersUserTeamInviteTokenNotFound=t.ProposeMembersNoFreeSloFreePlan=t.ProposeMembersNoFreeSlot=t.ProposeMembersInvalidOriginError=t.ProposeMembersErrorType=void 0;const n=r(68224),o=r(58807);var i;!function(e){e.InvalidOrigin="InvalidOrigin",e.NoFreeSlot="NoFreeSlot",e.NoFreeSlotFreePlan="NoFreeSlotFreePlan",e.UserTeamInviteTokenNotFound="UserTeamInviteTokenNotFound",e.PaymentFailed="PaymentFailed",e.NotBillingAdmin="NotBillingAdmin",e.CannotAddSeatDuringGracePeriod="CannotAddSeatDuringGracePeriod"}(i=t.ProposeMembersErrorType||(t.ProposeMembersErrorType={}));class a extends((0,o.FunctionalError)(i.InvalidOrigin,"Invalid origin")){}t.ProposeMembersInvalidOriginError=a;class s extends((0,o.FunctionalError)(i.NoFreeSlot,"No free slot")){}t.ProposeMembersNoFreeSlot=s;class c extends((0,o.FunctionalError)(i.NoFreeSlotFreePlan,"No free slot in free plan")){}t.ProposeMembersNoFreeSloFreePlan=c;class u extends((0,o.FunctionalError)(i.UserTeamInviteTokenNotFound,"No invite token to a team available for user")){}t.ProposeMembersUserTeamInviteTokenNotFound=u;class l extends((0,o.FunctionalError)(i.PaymentFailed,"Payment failed")){}t.ProposeMembersPaymentFailed=l;class d extends((0,o.FunctionalError)(i.NotBillingAdmin,"User is not the billing admin")){}t.ProposeMembersNotBillingAdmin=d;class p extends((0,o.FunctionalError)(i.CannotAddSeatDuringGracePeriod,"Seats cannot be added during grace period")){}t.ProposeMembersCannotAddSeatDuringGracePeriod=p,t.getProposeMembersFunctionalError=function(e){switch(e){case"invalid_origin":return new a;case"no_free_slot":return new s;case"no_free_slot_free_plan":return new c;case"USER_TEAM_INVITE_TOKEN_NOT_FOUND":return new u;case"payment_failed":return new l;case"not_billing_admin":return new d;case"cannot_add_seat_during_grace_period":return new p;default:throw new Error("Unknown server error")}};class f extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.ProposeMembersCommand=f},14054:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(24699),t)},24699:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SampleEvent=void 0;const n=r(68224);class o extends((0,n.defineEvent)({scope:n.UseCaseScope.User})){}t.SampleEvent=o},53784:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(18232),t),o(r(28539),t),o(r(14054),t),o(r(8346),t)},8346:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(47438),t)},47438:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SampleQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.SampleQuery=o},92447:(e,t,r)=>{"use strict";r.d(t,{X:()=>y});var n=r(27606),o=r(11103),i=r(2639),a=r(60399),s=r(48844),c=r(87279),u=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},l=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let d=class{constructor(e){this.serverApiClient=e}async callProposeMembers({proposedMemberLogins:e,force:t,origin:r,notificationOptions:n}){try{return await(0,a.z)(this.serverApiClient.v1.teams.proposeMembers({proposedMemberLogins:e,force:t,origin:r,notificationOptions:n}).pipe((0,s.DZ)((e=>{if("BusinessError"===e.tag)return(0,i.getProposeMembersFunctionalError)(e.code);throw new Error(e.message)})),(0,s.lk)((e=>(0,c.Vp)(e.data)))))}catch(e){return(0,c.Rn)({tag:"failure",error:`Propose Members failed - ${e}`})}}};d=u([(0,n.Injectable)(),l("design:paramtypes",[o.lX])],d);var p=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},f=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let h=class{constructor(e){this.proposeMembersService=e}execute({body:{proposedMemberLogins:e,force:t,origin:r,notificationOptions:n}}){return this.proposeMembersService.callProposeMembers({proposedMemberLogins:e,force:t,origin:r,notificationOptions:n})}};h=p([(0,n.CommandHandler)(i.ProposeMembersCommand),f("design:paramtypes",[d])],h);var m=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let y=class{};y=m([(0,n.Module)({api:i.teamMembersApi,imports:[o.nr],providers:[d],handlers:{commands:{proposeMembers:h},events:{},queries:{}}})],y)},16530:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(77704),t),o(r(21028),t)},43541:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vaultItemsCrudApi=void 0;const n=r(68224),o=r(51836),i=r(50154),a=r(24094);t.vaultItemsCrudApi=(0,n.defineModuleApi)({name:"vaultItemsCrud",commands:{createVaultItem:o.CreateVaultItemCommand,deleteVaultItems:o.DeleteVaultItemsCommand,updateVaultItem:o.UpdateVaultItemCommand,emitTemporaryVaultItemEvent:o.EmitTemporaryVaultItemEventCommand},events:{createdEvent:i.CreatedEvent,deletedEvent:i.DeletedEvent,updatedEvent:i.UpdatedEvent},queries:{query:a.VaultItemsQuery}})},8892:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreateVaultItemCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.CreateVaultItemCommand=o},1704:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeleteVaultItemsCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.DeleteVaultItemsCommand=o},29160:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmitTemporaryVaultItemEventCommand=t.EventType=void 0;const n=r(68224);!function(e){e.Deleted="deleted",e.Updated="updated",e.Created="created"}(t.EventType||(t.EventType={}));class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.EmitTemporaryVaultItemEventCommand=o},51836:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(8892),t),o(r(1704),t),o(r(17863),t),o(r(29160),t)},17863:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateVaultItemCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.UpdateVaultItemCommand=o},77911:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseEvent=void 0;const n=r(68224);class o extends((0,n.defineEvent)({scope:n.UseCaseScope.User})){}t.BaseEvent=o},9656:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreatedEvent=void 0;const n=r(77911);class o extends n.BaseEvent{}t.CreatedEvent=o},76962:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeletedEvent=void 0;const n=r(77911);class o extends n.BaseEvent{}t.DeletedEvent=o},50154:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(9656),t),o(r(76962),t),o(r(35713),t)},35713:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdatedEvent=void 0;const n=r(77911);class o extends n.BaseEvent{}t.UpdatedEvent=o},77704:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(43541),t),o(r(51836),t),o(r(50154),t),o(r(24094),t),o(r(33475),t)},24094:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(95859),t)},95859:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VaultItemsQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.VaultItemsQuery=o},76666:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Country=void 0,function(e){e.AD="AD",e.AE="AE",e.AF="AF",e.AG="AG",e.AI="AI",e.AL="AL",e.AM="AM",e.AO="AO",e.AQ="AQ",e.AR="AR",e.AS="AS",e.AT="AT",e.AU="AU",e.AW="AW",e.AX="AX",e.AZ="AZ",e.BA="BA",e.BB="BB",e.BD="BD",e.BE="BE",e.BF="BF",e.BG="BG",e.BH="BH",e.BI="BI",e.BJ="BJ",e.BL="BL",e.BM="BM",e.BN="BN",e.BO="BO",e.BR="BR",e.BS="BS",e.BT="BT",e.BV="BV",e.BW="BW",e.BY="BY",e.BZ="BZ",e.CA="CA",e.CC="CC",e.CD="CD",e.CF="CF",e.CG="CG",e.CH="CH",e.CI="CI",e.CK="CK",e.CL="CL",e.CM="CM",e.CN="CN",e.CO="CO",e.CR="CR",e.CU="CU",e.CV="CV",e.CX="CX",e.CY="CY",e.CZ="CZ",e.DE="DE",e.DJ="DJ",e.DK="DK",e.DM="DM",e.DO="DO",e.DZ="DZ",e.EC="EC",e.EE="EE",e.EG="EG",e.EH="EH",e.ER="ER",e.ES="ES",e.ET="ET",e.FI="FI",e.FJ="FJ",e.FK="FK",e.FM="FM",e.FO="FO",e.FR="FR",e.GA="GA",e.GB="GB",e.GD="GD",e.GE="GE",e.GF="GF",e.GG="GG",e.GH="GH",e.GI="GI",e.GL="GL",e.GM="GM",e.GN="GN",e.GP="GP",e.GQ="GQ",e.GR="GR",e.GS="GS",e.GT="GT",e.GU="GU",e.GW="GW",e.GY="GY",e.HK="HK",e.HM="HM",e.HN="HN",e.HR="HR",e.HT="HT",e.HU="HU",e.ID="ID",e.IE="IE",e.IL="IL",e.IM="IM",e.IN="IN",e.IO="IO",e.IQ="IQ",e.IR="IR",e.IS="IS",e.IT="IT",e.JE="JE",e.JM="JM",e.JO="JO",e.JP="JP",e.KE="KE",e.KG="KG",e.KH="KH",e.KI="KI",e.KM="KM",e.KN="KN",e.KP="KP",e.KR="KR",e.KW="KW",e.KY="KY",e.KZ="KZ",e.LA="LA",e.LB="LB",e.LC="LC",e.LI="LI",e.LK="LK",e.LR="LR",e.LS="LS",e.LT="LT",e.LU="LU",e.LV="LV",e.LY="LY",e.MA="MA",e.MC="MC",e.MD="MD",e.ME="ME",e.MF="MF",e.MG="MG",e.MH="MH",e.MK="MK",e.ML="ML",e.MM="MM",e.MN="MN",e.MO="MO",e.MP="MP",e.MQ="MQ",e.MR="MR",e.MS="MS",e.MT="MT",e.MU="MU",e.MV="MV",e.MW="MW",e.MX="MX",e.MY="MY",e.MZ="MZ",e.NA="NA",e.NC="NC",e.NE="NE",e.NF="NF",e.NG="NG",e.NI="NI",e.NL="NL",e.NO="NO",e.NO_TYPE="NO_TYPE",e.NP="NP",e.NR="NR",e.NU="NU",e.NZ="NZ",e.OM="OM",e.PA="PA",e.PE="PE",e.PF="PF",e.PG="PG",e.PH="PH",e.PK="PK",e.PL="PL",e.PM="PM",e.PN="PN",e.PR="PR",e.PS="PS",e.PT="PT",e.PW="PW",e.PY="PY",e.QA="QA",e.RE="RE",e.RO="RO",e.RS="RS",e.RU="RU",e.RW="RW",e.SA="SA",e.SB="SB",e.SC="SC",e.SD="SD",e.SE="SE",e.SG="SG",e.SH="SH",e.SI="SI",e.SJ="SJ",e.SK="SK",e.SL="SL",e.SM="SM",e.SN="SN",e.SO="SO",e.SR="SR",e.ST="ST",e.SV="SV",e.SY="SY",e.SZ="SZ",e.TC="TC",e.TD="TD",e.TF="TF",e.TG="TG",e.TH="TH",e.TJ="TJ",e.TK="TK",e.TL="TL",e.TM="TM",e.TN="TN",e.TO="TO",e.TR="TR",e.TT="TT",e.TV="TV",e.TW="TW",e.TZ="TZ",e.UA="UA",e.UG="UG",e.UM="UM",e.UNIVERSAL="UNIVERSAL",e.US="US",e.UY="UY",e.UZ="UZ",e.VA="VA",e.VC="VC",e.VE="VE",e.VG="VG",e.VI="VI",e.VN="VN",e.VU="VU",e.WF="WF",e.WS="WS",e.XK="XK",e.YE="YE",e.YT="YT",e.ZA="ZA",e.ZM="ZM",e.ZW="ZW"}(t.Country||(t.Country={}))},32545:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Country=void 0;var n=r(76666);Object.defineProperty(t,"Country",{enumerable:!0,get:function(){return n.Country}})},17484:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},72713:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},98548:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},24603:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},43484:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(72713),t),o(r(98548),t),o(r(24603),t),o(r(42983),t),o(r(89205),t)},42983:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},89205:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},33475:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.Country=void 0;var i=r(32545);Object.defineProperty(t,"Country",{enumerable:!0,get:function(){return i.Country}}),o(r(17484),t),o(r(43484),t),o(r(96394),t),o(r(16988),t),o(r(41126),t),o(r(4720),t)},35018:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},96394:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(35018),t),o(r(93617),t)},93617:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PaymentCardType=t.PaymentCardColorType=void 0,function(e){e.BLACK="BLACK",e.BLUE_1="BLUE_1",e.BLUE_2="BLUE_2",e.GOLD="GOLD",e.GREEN_1="GREEN_1",e.GREEN_2="GREEN_2",e.ORANGE="ORANGE",e.RED="RED",e.SILVER="SILVER",e.WHITE="WHITE"}(t.PaymentCardColorType||(t.PaymentCardColorType={})),function(e){e.PAYMENT_TYPE_AMEX="PAYMENT_TYPE_AMEX",e.PAYMENT_TYPE_DINERSCLUB="PAYMENT_TYPE_DINERSCLUB",e.PAYMENT_TYPE_DISCOVER="PAYMENT_TYPE_DISCOVER",e.PAYMENT_TYPE_JCB="PAYMENT_TYPE_JCB",e.PAYMENT_TYPE_MASTERCARD="PAYMENT_TYPE_MASTERCARD",e.PAYMENT_TYPE_VISA="PAYMENT_TYPE_VISA"}(t.PaymentCardType||(t.PaymentCardType={}))},74590:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},67871:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},95278:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},62647:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},16988:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(74590),t),o(r(67871),t),o(r(95278),t),o(r(62647),t),o(r(20056),t),o(r(64826),t)},20056:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PhoneType=void 0,function(e){e.PHONE_TYPE_ANY="PHONE_TYPE_ANY",e.PHONE_TYPE_FAX="PHONE_TYPE_FAX",e.PHONE_TYPE_LANDLINE="PHONE_TYPE_LANDLINE",e.PHONE_TYPE_MOBILE="PHONE_TYPE_MOBILE",e.PHONE_TYPE_WORK_FAX="PHONE_TYPE_WORK_FAX",e.PHONE_TYPE_WORK_LANDLINE="PHONE_TYPE_WORK_LANDLINE",e.PHONE_TYPE_WORK_MOBILE="PHONE_TYPE_WORK_MOBILE"}(t.PhoneType||(t.PhoneType={}))},64826:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},41126:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoteColors=void 0,function(e){e.BLUE="BLUE",e.BROWN="BROWN",e.GRAY="GRAY",e.GREEN="GREEN",e.ORANGE="ORANGE",e.PINK="PINK",e.PURPLE="PURPLE",e.RED="RED",e.YELLOW="YELLOW"}(t.NoteColors||(t.NoteColors={}))},4720:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VaultItemType=void 0,function(e){e.Address="KWAddress",e.BankAccount="KWBankStatement",e.Company="KWCompany",e.Credential="KWAuthentifiant",e.DriversLicense="KWDriverLicence",e.Email="KWEmail",e.FiscalId="KWFiscalStatement",e.IdCard="KWIDCard",e.Identity="KWIdentity",e.Passport="KWPassport",e.PaymentCard="KWPaymentMean_creditCard",e.Phone="KWPhone",e.SecureNote="KWSecureNote",e.SocialSecurityId="KWSocialSecurityStatement",e.Website="KWPersonalWebsite"}(t.VaultItemType||(t.VaultItemType={}))},24494:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vaultOrganizationApi=void 0;const n=r(68224),o=r(77834),i=r(82824);t.vaultOrganizationApi=(0,n.defineModuleApi)({name:"vaultOrganization",commands:{deleteCollection:o.DeleteCollectionCommand,createCollection:o.CreateCollectionCommand,migrateCategories:o.MigrateCategoriesCommand,updateCollection:o.UpdateCollectionCommand},events:{},queries:{queryCollections:i.CollectionsQuery}})},26424:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreateCollectionCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.CreateCollectionCommand=o},95795:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeleteCollectionCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.DeleteCollectionCommand=o},77834:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(95795),t),o(r(26424),t),o(r(57547),t),o(r(84608),t)},84608:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MigrateCategoriesCommand=void 0;const n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.MigrateCategoriesCommand=o},57547:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateCollectionCommand=t.OperationType=void 0;const n=r(68224);!function(e){e.SUBSTRACT="subtract",e.APPEND="append",e.OVERRIDE="override"}(t.OperationType||(t.OperationType={}));class o extends((0,n.defineCommand)({scope:n.UseCaseScope.User})){}t.UpdateCollectionCommand=o},21028:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(24494),t),o(r(77834),t),o(r(82824),t),o(r(51515),t)},36217:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CollectionsQuery=void 0;const n=r(68224);class o extends((0,n.defineQuery)({scope:n.UseCaseScope.User})){}t.CollectionsQuery=o},82824:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(36217),t)},51515:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},18265:(e,t,r)=>{"use strict";r.d(t,{z:()=>H,H:()=>ge});var n=r(27606),o=r(16530),i=r(87279),a=r(53576),s=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let c=class extends n.BaseEventEmitter{};c=s([(0,n.Injectable)()],c);var u=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},l=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let d=class{constructor(e,t){this.client=e,this.eventEmitter=t}async execute({body:e}){const{vaultItemType:t,content:r}=e,{commands:n}=this.client.getClient(a.carbonLegacyApi),o=await n.carbonLegacyLeeloo({name:"savePersonalDataItem",arg:[{kwType:t,origin:"MANUAL",content:{...r,id:void 0}}]});if((0,i.hx)(o))throw new Error(`Failed to create ${t}`);return this.eventEmitter.sendEvent("created",{ids:[],vaultItemType:t}),Promise.resolve((0,i.Vp)(void 0))}};d=u([(0,n.CommandHandler)(o.CreateVaultItemCommand),l("design:paramtypes",[n.CqrsClient,c])],d);var p=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},f=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let h=class{constructor(e,t){this.client=e,this.eventEmitter=t}async execute({body:e}){const{vaultItemType:t,ids:r}=e,{commands:n}=this.client.getClient(a.carbonLegacyApi),o=[],s=r.map((e=>n.carbonLegacyLeeloo({name:"removePersonalDataItem",arg:[{id:e}]}).then((t=>{(0,i.d6)(t)&&o.push(e)}))));return await Promise.allSettled(s),o.length>0&&this.eventEmitter.sendEvent("deleted",{ids:o,vaultItemType:t}),o.length!==r.length?Promise.resolve((0,i.Rn)({tag:"error",errorMessage:`Error: Failed to delete all ${t}s`,failedDeletionIds:Array.from(new Set(...r,...o))})):Promise.resolve((0,i.Vp)(void 0))}};h=p([(0,n.CommandHandler)(o.DeleteVaultItemsCommand),f("design:paramtypes",[n.CqrsClient,c])],h);var m=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},y=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let g=class{constructor(e,t){this.client=e,this.eventEmitter=t}async execute({body:e}){const{content:t,id:r,vaultItemType:n}=e,{commands:o}=this.client.getClient(a.carbonLegacyApi),s=await o.carbonLegacyLeeloo({name:"savePersonalDataItem",arg:[{kwType:n,origin:"MANUAL",content:{...t,id:r}}]});if((0,i.hx)(s))throw new Error(`Failed to update ${n}`);return this.eventEmitter.sendEvent("updated",{ids:[r],vaultItemType:n}),Promise.resolve((0,i.Vp)(void 0))}};g=m([(0,n.CommandHandler)(o.UpdateVaultItemCommand),y("design:paramtypes",[n.CqrsClient,c])],g);var v=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},b=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let w=class{constructor(e){this.eventEmitter=e}execute({body:e}){const{ids:t,eventType:r}=e;return this.eventEmitter.sendEvent(r,{ids:t,vaultItemType:o.VaultItemType.Credential}),Promise.resolve((0,i.Vp)(void 0))}};w=v([(0,n.CommandHandler)(o.EmitTemporaryVaultItemEventCommand),b("design:paramtypes",[c])],w);var S=r(85390),R=r(87065),E=r(48844);function O(e,t){if(!Array.isArray(e))return!1;if(0===e.length)return!0;const r=e[0];for(let e=0;e<t.length;e++)if(!Object.prototype.hasOwnProperty.call(r,t[e]))return!1;return!0}const C=e=>O(e,["AddressName"]),P=e=>O(e,["Name"]),A=e=>O(e,["Email"]),j=e=>O(e,["FirstName","LastName"]),_=e=>O(e,["Number"]),T=e=>O(e,["Website"]),I=e=>O(e,["BankAccountIBAN","BankAccountBIC","BankAccountName"]),D=e=>O(e,["Id","Email","Login"]),x=e=>O(e,["State"]),U=e=>O(e,["FiscalNumber"]),M=e=>O(e,[]),L=e=>O(e,["DeliveryPlace"]),N=e=>O(e,["SocialSecurityNumber"]),k=e=>O(e,["CardNumber"]),F=e=>O(e,["Content","Title"]);var V=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},q=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let G=class{constructor(e){this.client=e,this.getVaultItemsTypeDictionary={[o.VaultItemType.Address]:this.getVaultItems("addresses",C),[o.VaultItemType.BankAccount]:this.getVaultItems("bankAccounts",I),[o.VaultItemType.Company]:this.getVaultItems("companies",P),[o.VaultItemType.Credential]:this.getVaultItems("credentials",D),[o.VaultItemType.DriversLicense]:this.getVaultItems("driversLicenses",x,"driverLicenses"),[o.VaultItemType.Email]:this.getVaultItems("emails",A),[o.VaultItemType.FiscalId]:this.getVaultItems("fiscalIds",U),[o.VaultItemType.IdCard]:this.getVaultItems("idCards",M),[o.VaultItemType.Identity]:this.getVaultItems("identities",j),[o.VaultItemType.Passport]:this.getVaultItems("passports",L),[o.VaultItemType.PaymentCard]:this.getVaultItems("paymentCards",k),[o.VaultItemType.Phone]:this.getVaultItems("phones",_),[o.VaultItemType.SecureNote]:this.getVaultItems("secureNotes",F,"notes"),[o.VaultItemType.SocialSecurityId]:this.getVaultItems("socialSecurityIds",N),[o.VaultItemType.Website]:this.getVaultItems("websites",T,"personalWebsites")}}execute({body:e}){const{vaultItemTypes:t}=e;return(0,S.a)(t.map((e=>this.getVaultItemsTypeDictionary[e]))).pipe((0,R.U)((e=>{const t={};return e.forEach((e=>{if("failure"===e.tag)throw new Error("Error while fetching vault items");Object.assign(t,e.data)})),(0,i.Vp)(t)})))}getVaultItems(e,t,r){r=r??e;const{queries:{carbonState:n}}=this.client.getClient(a.carbonLegacyApi);return n({path:`userSession.personalData.${r}`}).pipe((0,E.Qn)((r=>{if(!t(r))throw new Error(`Bad ${e} format`);return{[e]:r}})))}};G=V([(0,n.QueryHandler)(o.VaultItemsQuery),q("design:paramtypes",[n.CqrsClient])],G);var B=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let H=class{};H=B([(0,n.Module)({api:o.vaultItemsCrudApi,handlers:{commands:{createVaultItem:d,deleteVaultItems:h,updateVaultItem:g,emitTemporaryVaultItemEvent:w},events:{},queries:{query:G}},providers:[c]})],H);var W=r(10203);async function K(e,t,r,n){const o=new W.UserUpdateCollectionEvent({collectionId:r,action:t,itemCount:n,isShared:!1});await e.commands.carbon({name:"logEvent",args:[{event:o}]})}var z=r(28489);var $=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Q=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Y=class{constructor(e){this.carbonLegacy=e.getClient(a.carbonLegacyApi)}async execute({body:e}){const{content:{name:t,spaceId:r="",vaultItems:n=[]}}=e,o=await this.carbonLegacy.commands.carbon({name:"addCollection",args:[{name:t,spaceId:r,vaultItems:n}]});if((0,i.hx)(o))throw new Error(`Failed to create collection: ${o.error}`);if("object"!=typeof(a=o.data.carbonResult)||null===a||!(0,z.l$)(a,"id")||"string"!=typeof a.id||!(0,z.l$)(a,"success")||"boolean"!=typeof a.success)throw new Error("Failed to find created collection id");var a;return await K(this.carbonLegacy,W.CollectionAction.Add,o.data.carbonResult.id,1),await K(this.carbonLegacy,W.CollectionAction.AddCredential,o.data.carbonResult.id,1),(0,i.Vp)({id:o.data.id})}};Y=$([(0,n.CommandHandler)(o.CreateCollectionCommand),Q("design:paramtypes",[n.CqrsClient])],Y);var J=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},X=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Z=class{constructor(e){this.client=e}async execute({body:e}){const{id:t}=e,r=await this.client.getClient(a.carbonLegacyApi).commands.carbon({name:"deleteCollection",args:[{id:t}]});if((0,i.hx)(r))throw new Error(`Failed to delete collection: ${r.error}`);return await K(this.client.getClient(a.carbonLegacyApi),W.CollectionAction.DeleteCredential,t,1),Promise.resolve((0,i.Vp)(void 0))}};Z=J([(0,n.CommandHandler)(o.DeleteCollectionCommand),X("design:paramtypes",[n.CqrsClient])],Z);var ee=r(60399);const te=e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.Id&&"string"==typeof t.Name&&Array.isArray(t.VaultItems)})));function re(e,t){const{queries:{carbonState:r}}=e.getClient(a.carbonLegacyApi);return r({path:"userSession.personalData.collections"}).pipe((0,E.Qn)((e=>{if(!te(e))throw new Error("Collection array has a wrong format");return{collections:(t&&t.length>0?e.filter((e=>t.includes(e.Id))):e).map((e=>({id:e.Id,name:e.Name,spaceId:e.SpaceId,vaultItems:e.VaultItems.map((e=>({id:e.Id,type:e.Type})))})))}})))}var ne=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},oe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ie=class{constructor(e){this.client=e}async execute({body:e}){const{id:t,collection:r,operationType:n=o.OperationType.APPEND}=e,s=await(0,ee.z)(re(this.client,[t]));if((0,i.hx)(s))throw new Error(`Failed to fetch additional collection info: ${s.error}`);const c=s.data.collections[0];r.vaultItems&&(c.vaultItems=this.mutateCollectionVaultItems(c,n,r.vaultItems));const u=await this.client.getClient(a.carbonLegacyApi).commands.carbon({name:"updateCollection",args:[{id:c.id,name:r.name??c.name,spaceId:r.spaceId??c.spaceId,vaultItems:c.vaultItems}]});if((0,i.hx)(u))throw new Error(`Failed to update collection: ${u.error}`);return n!==o.OperationType.OVERRIDE&&await K(this.client.getClient(a.carbonLegacyApi),n===o.OperationType.APPEND?W.CollectionAction.AddCredential:W.CollectionAction.DeleteCredential,t,r.vaultItems?.length??1),Promise.resolve((0,i.Vp)(void 0))}getDeduplicatedList(e){return[...new Map(e.map((e=>[e.id,e]))).values()]}mutateCollectionVaultItems(e,t,r){return t===o.OperationType.OVERRIDE?this.getDeduplicatedList(r):t===o.OperationType.SUBSTRACT?e.vaultItems.filter((e=>!r.some((t=>t.id===e.id)))):this.getDeduplicatedList([...e.vaultItems,...r])}};ie=ne([(0,n.CommandHandler)(o.UpdateCollectionCommand),oe("design:paramtypes",[n.CqrsClient])],ie);var ae=r(68224),se=r(45059);const ce=e=>!0;class ue extends((0,n.defineStore)({persist:!0,scope:ae.UseCaseScope.Device,storeName:"collections-store",storeTypeGuard:ce,capacity:n.StoreCapacity._001KB,codec:se.Eu,storage:{schemaVersion:3,initialValue:{isCredentialCategoriesMigrated:{}},typeGuard:ce,migrateStorageSchema:()=>({isCredentialCategoriesMigrated:{}})}})){}var le=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},de=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let pe=class{constructor(e,t){this.client=e,this.store=t}updateCollection(e,t){const{commands:r}=this.client.getClient(o.vaultOrganizationApi);return r.updateCollection({id:e,collection:t})}createCollection(e){const{commands:t}=this.client.getClient(o.vaultOrganizationApi);return t.createCollection({content:e})}fetchCategories(){const{queries:{carbonState:e}}=this.client.getClient(a.carbonLegacyApi);return e({path:"userSession.personalData.credentialCategories"}).pipe((0,E.Qn)((e=>e)))}async fetchCredentials(){const{queries:{carbonState:e}}=this.client.getClient(a.carbonLegacyApi),t=await(0,ee.z)(this.fetchCategories());if((0,i.hx)(t))throw new Error("Failed to fetch categories");const r=t.data;return e({path:"userSession.personalData.credentials"}).pipe((0,E.Qn)((e=>{if(t=e,!Array.isArray(t))throw new Error("Bad credential format");var t;return e.map((e=>{const t=r.find((t=>t.Id===e.Category))?.CategoryName;return{...e,CategoryName:t}}))})))}async finalizeMigration(e,t){return t.isCredentialCategoriesMigrated[e]=!0,await this.store.set(t),Promise.resolve((0,i.Vp)(void 0))}async execute({body:e}){const t=e;if(!t)throw new Error("Failed to fetch username");const r=await this.store.getState();if(r.isCredentialCategoriesMigrated[t])return Promise.resolve((0,i.Vp)(void 0));const n=await(0,ee.z)(await this.fetchCredentials());if((0,i.hx)(n))throw new Error("Failed to fetch credentials");const o=n.data;if(0===o.length)return this.finalizeMigration(t,r);const a=await(0,ee.z)(re(this.client));if((0,i.hx)(a))throw new Error("Failed to fetch collections");const s=a.data.collections;s.forEach((e=>{"string"!=typeof e.spaceId&&(e.spaceId="")}));const c=[];for(let e=0;e<o.length;e++){const t=o[e];if(!t.CategoryName)continue;const r=t.CategoryName,n=t.SpaceId??"",i=s.find((e=>e.name===r&&e.spaceId===n));if(i){i.vaultItems.push({id:t.Id,type:"KWAuthentifiant"});continue}const a=c.find((e=>e.name===r&&e.spaceId===n));a?a.vaultItems.push({id:t.Id,type:"KWAuthentifiant"}):c.push({name:r,spaceId:n,vaultItems:[{id:t.Id,type:"KWAuthentifiant"}]})}for(const e of s)await this.updateCollection(e.id,e);for(const e of c)await this.createCollection(e);return this.finalizeMigration(t,r)}};pe=le([(0,n.CommandHandler)(o.MigrateCategoriesCommand),de("design:paramtypes",[n.CqrsClient,ue])],pe);var fe=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},he=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let me=class{constructor(e){this.client=e}execute({body:e}){const{ids:t}=e;return re(this.client,t)}};me=fe([(0,n.QueryHandler)(o.CollectionsQuery),he("design:paramtypes",[n.CqrsClient])],me);var ye=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let ge=class{};ge=ye([(0,n.Module)({api:o.vaultOrganizationApi,stores:[ue],handlers:{commands:{deleteCollection:Z,createCollection:Y,migrateCategories:pe,updateCollection:ie},events:{},queries:{queryCollections:me}}})],ge)},27606:(e,t,r)=>{"use strict";var n;function o(e){return{type:n.VALUE_PROVIDER,useValue:e}}function i(e){return{type:n.CLASS_PROVIDER,useClass:e}}r.r(t),r.d(t,{AcknowledgedChannel:()=>Ce,AllowedToFail:()=>jt,AppLifeCycle:()=>O,AppLogger:()=>C,AppTimers:()=>Xe,BadStatus:()=>u.RV,BaseEventEmitter:()=>Ve,ChannelMessageBroker:()=>ie,ChannelState:()=>J,CommandHandler:()=>Rr,CommandRefresherFactory:()=>ot,ContextLessCqrsClient:()=>ge,ContextlessBaseEventEmitter:()=>qe,CqrsBroker:()=>se,CqrsClient:()=>ye,CqrsCommandRefresher:()=>nt,CronLowLevelSource:()=>qt,DefaultEncryptionCodecForDeviceData:()=>x,DefaultEncryptionCodecForUserData:()=>U,EventHandler:()=>Fr,FeatureFlipsServiceAbstract:()=>or,FrameworkInit:()=>le,Global:()=>ce,HttpClient:()=>br,HttpHeaders:()=>u.WM,HttpModule:()=>Sr,HttpParams:()=>u.LE,HttpRequest:()=>u.aW,HttpResponse:()=>u.Zn,HttpStatusCode:()=>u.WE,Injectable:()=>ue,JsonApplicationResourceFetcher:()=>Rt,JsonApplicationResourceLoader:()=>At,KeyValueStorageFactory:()=>L,KeyValueStorageInfrastructure:()=>f,LoadingState:()=>ut,ManualTriggeredTimers:()=>Ze,MemoryChannel:()=>oe,MemoryKeyValueStorageInfrastructure:()=>ct,MemoryStoreInfrastructureFactory:()=>_,MockFeatureFlipsService:()=>sr,MockJsonApplicationResourceFetcher:()=>Et,MockedFeatureFlipsEnum:()=>ir,Module:()=>fr,NetworkError:()=>u.F7,NoDynamicChannels:()=>be,NodeConfiguration:()=>de,NodeEventBroker:()=>De,NodeToModuleEventBroker:()=>Le,ParameterProviderType:()=>n,QueryHandler:()=>kr,RequestContext:()=>l,RequestContextModule:()=>tn,SingleNodeAppBuilder:()=>nr,StoreCapacity:()=>St,StoreInfrastructureFactory:()=>j,TaskTrackingModule:()=>Nr,TimedOut:()=>u.PL,TimerBasedCronSource:()=>Gt,createApplicationClient:()=>Be,createClientFactory:()=>Ge,createCqrsClient:()=>pe,createCqrsClients:()=>fe,defineApplication:()=>rr,defineBatchExecutor:()=>an,defineStore:()=>wt,deviceScopedSingletonProvider:()=>mr,getQueryValue:()=>We,getStoresProviders:()=>dr,isLazyState:()=>lt,isSendMessageRequest:()=>Ae,isVersionedData:()=>p,mockStore:()=>ft,provideClass:()=>i,provideValue:()=>o,refresherCreationToken:()=>rt,scopedSingleton:()=>yr,sendMessageRequest:()=>Pe,startApplicationNode:()=>er,startSingleApplicationNode:()=>tr,useEventsOfModule:()=>pr,userScopedSingletonProvider:()=>hr}),function(e){e.VALUE_PROVIDER="value_provider",e.CLASS_PROVIDER="class_provider"}(n||(n={}));r(60171);const a="dl-module";var s=r(32875);const c="frameworkModuleName";var u=r(45059);class l{constructor(e){this.useCaseId=e.useCaseId,this.userName=e.userName,this.featureFlips=e.featureFlips,this.requiredFeatureFlips=e.requiredFeatureFlips}}var d=r(28489);function p(e,t){return null!==e&&"object"==typeof e&&(0,d.l$)(e,"version")&&(0,d.l$)(e,"content")&&t(e.content)}class f{}var h=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},m=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=function(e,t){return function(r,n){t(r,n,e)}};const g=new u.bL,v=new u.z;let b=class{constructor(e,t,r){this.kv=e,this.prefix=`batch-storage.${r}.${t.userName}`}async getBatchState(e){const t=await this.kv.get(`${this.prefix}.${e}`);return t?this.stringToState(t):{queue:[]}}async setBatchState(e,t){const r=this.stateToString(t);return await this.kv.set(`${this.prefix}.${e}`,r)}stateToString(e){const t=g.encode(e);return v.encode(t)}stringToState(e){const t=v.decode(e);return g.decode(t)}};b=h([y(2,(0,s.Inject)(c)),m("design:paramtypes",[f,l,String])],b);class w{getProviders(e){if(!e.length)return[];return[...e.map((e=>({provide:e,inject:[b,e.Definition.chunkProcessor],useFactory:(t,r)=>new e(t,r)}))),...e.map((({Definition:{chunkProcessor:e}})=>e)),b]}}var S=r(68224),R=r(52273),E=r(43978);class O{constructor(){this.shutdownHooks=[],this.externalComponentReadyConditions=[],this.appReadyHooks=[]}addExternalComponentReadyCondition(e){this.externalComponentReadyConditions.push(e)}addAppReadyHook(e){this.appReadyHooks.push(e)}addShutdownHook(e){this.shutdownHooks.push(e)}startup(){const e=this.waitAndTriggerAppReady();if(!this.externalComponentReadyConditions.length)return e;this.addShutdownHook((async()=>await e))}async shutDown(){for(;this.shutdownHooks.length>0;){const e=this.shutdownHooks.pop();e&&await e()}}async waitAndTriggerAppReady(){await Promise.all(this.externalComponentReadyConditions.map((e=>e()))),await this.executeStartupHooks(this.appReadyHooks)}async executeStartupHooks(e){for(;e.length>0;){const t=e.shift();if(t){const e=await t();e&&this.addShutdownHook(e)}}}}class C{}var P=r(24966);class A{constructor(e){this.state$=new P.X(e)}get(){return Promise.resolve(this.state$.getValue())}set(e){return this.state$.next(e),Promise.resolve()}init(e){return this.state$.next(e),Promise.resolve()}stop(){this.state$.complete()}}class j{}class _ extends j{createUserScopedInfrastructure(){return new A({timestamp:void 0})}createDeviceScopedInfrastructure(){return new A({timestamp:void 0})}}var T=r(69183),I=r(70695),D=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let x=class{};x=D([(0,s.Injectable)()],x);let U=class{};U=D([(0,s.Injectable)()],U);class M{constructor(e,t,r){this.storage=e,this.baseKey=t,this.initialValueFactory=r}async read(){const e=await this.storage.get(this.baseKey);return!e&&this.initialValueFactory?await this.initialValueFactory():e}async write(e){await this.storage.set(this.baseKey,e)}}class L{constructor(e){this.storage=e}createBackend(e,t,r,n){const o=r?`${e}.${t}.${r}`:`${e}.${t}`;return new M(this.storage,o,n)}}var N=r(30523),k=r(60399),F=r(6220);var V=r(73201),q=r(162),G=r(87065),B=r(17350),H=r(95087);const W=e=>"response"===e.type,K=(e,t,r,n)=>Object.keys(e).reduce(((o,i)=>{const{commandMailbox:a,queryMailbox:s}=(o=>{const{main:i,queryOnly:a}=e[o],s={type:"local",onMessage:n};if(i===t)return{commandMailbox:s,queryMailbox:s};const c={type:"remote",channel:r[i]};return{commandMailbox:c,queryMailbox:t&&a.includes(t)?s:c}})(i);return o[`command-${i}`]=a,o[`query-${i}`]=s,o}),(0,d.Ay)({}));var z=r(2049),$=r(59891);const Q=e=>{if(!e||"object"!=typeof e)return!1;return"unSubscription"===e.type},Y=(e,t,r)=>{const n=new Set(r),o=new Map,i=t.receivedMessages$.pipe((0,N.h)(Q)).subscribe((e=>{const t=o.get(e.id);t?.unsubscribe(),o.delete(e.id)})),a=t.receivedMessages$.pipe((0,N.h)((e=>{return!(!(t=e)||"object"!=typeof t)&&"start"===t.type&&n.has(e.definition.destination)&&!o.has(e.definition.id);var t})),(0,F.z)((e=>(0,q.D)((async e=>(o.set(e.definition.id,{unsubscribe:()=>{}}),await t.send({type:"initial-acknowledgement",id:e.definition.id}),e))(e))))).subscribe((r=>{const n=r.definition.destination,i=e(n,r.definition.content,r.metadata),a={type:"end",id:r.definition.id},s=i.pipe((0,G.U)((e=>({id:r.definition.id,data:e,type:"data"}))),(0,$.l)(a),(0,F.z)((e=>(0,q.D)(t.send(e))))).subscribe();o.set(r.definition.id,{unsubscribe:()=>{s.unsubscribe()}})}));return{unsubscribe:()=>{a.unsubscribe(),i.unsubscribe();for(const e of o.values())e.unsubscribe()}}};var J,X=r(58376),Z=r(85390),ee=r(15023),te=r(6136),re=r(42946),ne=r(98187);!function(e){e.Connected="Connected",e.Disconnected="Disconnected"}(J||(J={}));class oe{constructor(){this.autoConnects=!1,this.sentMessages$=new ne.x,this.receivedMessagesSubject$=new ne.x,this.channelStateSubject$=new P.X(J.Disconnected)}send(e){if(this.channelStateSubject$.value!==J.Connected)throw new Error("Channel is not connected");return this.sentMessages$.next(e),Promise.resolve()}get receivedMessages$(){return this.receivedMessagesSubject$}get channelState$(){return this.channelStateSubject$}stop(){this.receivedMessages$.complete()}connect(e){if(this.channelStateSubject$.value===J.Connected)return{disconnect:()=>{}};const t=this.sentMessages$.subscribe((t=>{e.receivedMessages$.next(t)}));return this.channelState$.next(J.Connected),{disconnect:()=>{this.channelState$.next(J.Disconnected),t.unsubscribe()}}}}class ie{constructor(e){this.stopped$=new P.X(!1);const t={routes:(0,d.Ay)({})};this.routes=(()=>{const{routes:r}=Object.keys(e).reduce(((t,r)=>{const n=e[r];if("local"===n.type&&(t.routes[r]={send:n.onMessage,trySend:async(...e)=>(await(0,z.n)(n.onMessage(...e)),!0)}),"remote"===n.type){const e=((e,t)=>{const r=(r,n,o)=>{const i={content:n,destination:String(r),id:(0,T.Z)()};return new X.y((r=>{let n={type:"start",definition:i,metadata:o};const a=(0,Z.a)({message:e.receivedMessages$,stopped:t}).pipe((0,ee.o)((({stopped:e})=>!e)),(0,G.U)((({message:e})=>e))).subscribe((e=>{var t;(t=e)&&"object"==typeof t&&"initial-acknowledgement"===t.type&&e.id===i.id?n={...n,metadata:{...n.metadata,isReminder:!0}}:(e=>!(!e||"object"!=typeof e)&&"data"===e.type)(e)&&e.id===i.id?r.next(e.data):(e=>!(!e||"object"!=typeof e)&&"end"===e.type)(e)&&e.id===i.id&&r.complete()})),s=(0,Z.a)({sendTimes:e.channelState$.pipe((0,te.x)(),(0,N.h)((t=>t===J.Connected||e.autoConnects))),stopped:t}).pipe((0,ee.o)((({stopped:e})=>!e)),(0,re.z)((()=>(0,q.D)(e.send(n))))).subscribe();return()=>{e.send({type:"unSubscription",id:i.id}),s.unsubscribe(),a.unsubscribe()}}))};return{send:r,trySend:async(t,n,o)=>!(!e.autoConnects&&await(0,k.z)(e.channelState$)!==J.Connected)&&(await(0,z.n)(r(t,n,o)),!0)}})(n.channel,this.stopped$);t.routes[r]=e}return t}),t);return r})()}connect(e,t){let r=!1;return{start:()=>{if(r)throw new Error("Already started");r=!0;const n=e=>Y(((e,t,r)=>this.routes[e].send(e,t,r)),e,Object.keys(this.routes)),o=e.map(n),i=new Map,a=t.connectedChannels$.subscribe((e=>{const t=[...i.entries()].filter((([t])=>!(t in e))),r=Object.keys(e).filter((e=>!i.has(e)));t.forEach((([e,t])=>{i.delete(e),t.unsubscribe()})),r.forEach((t=>{const r=e[t],o=n(r);i.set(t,o)}))}));return Promise.resolve({stop:()=>([...o,a,...i.values()].forEach((e=>e.unsubscribe())),this.stopped$.next(!0),Promise.resolve())})}}}sendMessage(e,t){return this.routes[e].send(e,t,{isReminder:!1})}trySendMessage(e,t){return this.routes[e].trySend(e,t,{isReminder:!1})}}const ae=()=>(0,q.D)([]);class se{constructor(e){this.config=e}async sendCommand(e,t,r,n){if(!this.broker)throw new Error("call connect() first");return await(0,k.z)(this.broker.sendMessage(`command-${e}`,{type:"command",module:e,commandName:String(t),command:r,context:n}).pipe((0,N.h)(W),(0,G.U)((e=>e.response))))}sendQuery(e,t,r,n){if(!this.broker)throw new Error("call connect() first");return this.broker.sendMessage(`query-${e}`,{type:"query",module:e,queryName:String(t),query:r,context:n}).pipe((0,N.h)(W),(0,G.U)((e=>e.response)))}connect(e){const t=e?(t,r,n)=>{switch(r.type){case"response":return B.E;case"command":return(0,q.D)(e.onCommand(r.module,r.commandName,r.command,r.context,{isReminder:n.isReminder})).pipe((0,G.U)((e=>({type:"response",response:e}))));case"query":return(0,q.D)(e.onQuery(r.module,r.queryName,r.query,r.context)).pipe((0,G.U)((e=>({type:"response",response:e}))))}(0,H.U)(r)}:ae,r=K(this.config.appDefinition,this.config.currentNode,this.config.channels,t);return this.broker=new ie(r),this.broker.connect(Object.values(this.config.channels),this.config.channelsListener)}}function ce(){return(0,s.Global)()}function ue(e){return(0,s.Injectable)({scope:e?.neverReuseInstance?s.Scope.TRANSIENT:s.Scope.DEFAULT})}const le=()=>ue();class de{constructor(e){this.appDefinition=e.appDefinition,this.currentNode=e.currentNode,this.channels=e.channels,this.subscriptions=e.subscriptions,this.channelsListener=e.channelsListener}getNodeList(){return this.currentNode?[...this.getRemoteNodeList(),this.currentNode]:this.getRemoteNodeList()}getRemoteNodeList(){return Object.keys(this.channels)}getModuleNames(){return Object.keys(this.appDefinition)}}const pe=(e,t,r,n)=>({commands:Object.keys(e[r].api.commands).reduce(((e,o)=>(e[o]=e=>{const i=n??new l({useCaseId:(0,T.Z)()});return t.sendCommand(r,o,e,i)},e)),(0,d.Ay)({})),queries:Object.keys(e[r].api.queries).reduce(((e,o)=>(e[o]=e=>{const i=n??new l({useCaseId:(0,T.Z)()});return t.sendQuery(r,o,e,i)},e)),(0,d.Ay)({}))}),fe=(e,t,r)=>{const n=n=>Object.keys(e[n].api.commands).reduce(((e,o)=>(e[o]=e=>{const i=r??new l({useCaseId:(0,T.Z)()});return t.sendCommand(n,o,e,i)},e)),(0,d.Ay)({})),o=n=>Object.keys(e[n].api.queries).reduce(((e,o)=>(e[o]=e=>{const i=r??new l({useCaseId:(0,T.Z)()});return t.sendQuery(n,o,e,i)},e)),(0,d.Ay)({}));return Object.keys(e).map((e=>e)).reduce(((e,t)=>(e[t]={commands:n(t),queries:o(t)},e)),{})};var he=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},me=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ye=class{constructor(e,t,r){this.broker=e,this.configuration=t,this.context=r}getClient(e){return pe(this.configuration.appDefinition,this.broker,e.name,this.context)}};ye=he([ue(),me("design:paramtypes",[se,de,l])],ye);let ge=class{constructor(e,t){this.configuration=e,this.broker=t}getClient(e){return pe(this.configuration.appDefinition,this.broker,e.name)}};ge=he([ue(),me("design:paramtypes",[de,se])],ge);var ve=r(69885);const be={connectedChannels$:new P.X({})};var we=r(16433),Se=r(89618),Re=r(37182),Ee=r(97280),Oe=r(7074);class Ce{constructor(e,t=3e4){this.autoConnects=e.autoConnects;const r=e.status$.pipe((0,te.x)());let n=!1;const o=new ne.x,i=o.pipe((0,F.z)((async o=>{const i=(0,T.Z)();let a=!1;const s=e.messages$.pipe((0,ee.o)((()=>!n)),(0,N.h)((e=>"acknowledgement"===e.type&&e.id===i)),(0,we.q)(1),(0,Se.V)(t),(0,Re.K)((()=>B.E)),(0,Ee.d)(1)),c=s.subscribe((()=>{a=!0,c.unsubscribe()})),u=r.pipe((0,ee.o)((()=>!a&&!n)),(0,re.z)((()=>(0,q.D)(e.sendMessage({type:"send",id:i,message:o.message}))))).subscribe();try{await(0,z.n)(s),u.unsubscribe(),o.resolve()}catch(e){u.unsubscribe(),o.reject(e)}}))).subscribe();this.stop=()=>(n=!0,i.unsubscribe(),e.stop()),this.send=e=>new Promise(((t,r)=>{const n={message:e,resolve:t,reject:r};o.next(n)})),this.channelState$=e.status$,this.receivedMessages$=e.messages$.pipe((0,N.h)((e=>"send"===e.type)),(0,F.z)((async t=>{if("send"===t.type)return await e.sendMessage({type:"acknowledgement",id:t.id}),t.message})),(0,Oe.B)())}}const Pe=({channelName:e,message:t})=>({channelName:e,message:t,type:"graphene-message"}),Ae=e=>{if(!e||"object"!=typeof e)return!1;return"graphene-message"===e.type},je={type:"ask"},_e={type:"eventResponse"};var Te=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Ie=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let De=class{constructor(e){this.regenerateReverseSubscriptionMap=()=>{const{configuration:e,subscriberToEvent:t}=this,r=e.getModuleNames().reduce(((e,t)=>({...e,[t]:new Map})),{});return e.getNodeList().reduce(((e,r)=>{const n=t[r];return Object.entries(n).forEach((([t,n])=>{const o=e[t];n.forEach((e=>{const t=[...o.get(e)??[],r];o.set(e,t)}))})),e}),r)},this.configuration=e;const t=Object.entries(e.appDefinition).reduce(((e,[t,r])=>(e[t]=Object.keys(r.api.events),e)),{});this.subscriberToEvent=this.configuration.getNodeList().reduce(((e,r)=>(e[r]={...t},e)),{}),this.eventToSubscriber=this.regenerateReverseSubscriptionMap()}async publishEvent(e,t,r,n){const{broker:o,eventToSubscriber:i}=this;if(!o)throw new Error("Not started");const a=(i[e].get(t)??[]).map((o=>({type:"event",context:n,event:r,eventName:t,moduleSource:e,nodeDestination:o})));await Promise.all(a.map((async e=>{await o.trySendMessage(`event-${e.nodeDestination}`,e)})))}connect(e){const{configuration:t}=this,r=Object.keys(t.subscriptions).reduce(((e,r)=>({...e,...t.subscriptions[r]})),(0,d.Ay)({})),n={type:"subscriptions",nodeName:t.currentNode,subscribesTo:r},o=((e,t)=>e.getNodeList().reduce(((r,n)=>(n===e.currentNode?r[`event-${n}`]={type:"local",onMessage:t}:r[`event-${n}`]={type:"remote",channel:e.channels[n]},r)),(0,d.Ay)({})))(this.configuration,((t,r,o)=>{switch(r.type){case"event":return(0,q.D)(e.onLocalEvent(r.moduleSource,r.nodeDestination,r.eventName,r.event,r.context,o)).pipe((0,G.U)((()=>_e)));case"eventResponse":return B.E;case"subscriptions":return this.subscriberToEvent[r.nodeName]=r.subscribesTo,this.eventToSubscriber=this.regenerateReverseSubscriptionMap(),(0,ve.of)(_e);case"ask":return(0,ve.of)(n)}})),i=new ie(o);return t.getNodeList().map((async e=>{await i.trySendMessage(`event-${e}`,n),await i.trySendMessage(`event-${e}`,je)})),this.broker=i,i.connect(Object.values(t.channels),t.channelsListener)}};var xe;De=Te([ue(),Ie("design:paramtypes",[de])],De),function(e){e.Command="command",e.Query="query",e.Event="event",e.Init="init",e.Cron="cron"}(xe||(xe={}));const Ue=e=>{if(!e||"object"!=typeof e)return!1;const t=e;return!!t.error&&!!t.isError};var Me=r(87279);class Le{constructor(e){this.publishEvent=(e,t,r,n)=>this.broker.publishEvent(e,t,r,n),this.broker=new De(e);const t=e.getModuleNames().reduce(((t,r)=>({...t,[r]:Object.keys(e.appDefinition[r].api.events).reduce(((e,t)=>(e[t]=[],e)),(0,d.Ay)({}))})),(0,d.Ay)({}));this.localSubscribersMap=Object.keys(e.subscriptions).map((e=>e)).reduce(((t,r)=>{const n=e.subscriptions[r];return Object.keys(n).map((e=>e)).forEach((e=>{const o=n[e]??[],i=t[e];o.forEach((e=>{i[e].push(r)}))})),t}),t)}connect(e){const{localSubscribersMap:t,broker:r}=this;return r.connect({onLocalEvent:async(r,n,o,i,a,s)=>{const c=t[r][o];await Promise.all(c.map((async t=>{await e.onEvent(r,t,o,i,a,s)})))}})}}var Ne=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ke=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Fe=function(e,t){return function(r,n){t(r,n,e)}};let Ve=class{constructor(e,t,r){this.apiName=e,this.broker=t,this.context=r}sendEvent(e,t){return this.broker.publishEvent(this.apiName,e,t,this.context)}};Ve=Ne([ue(),Fe(0,(0,s.Inject)(c)),ke("design:paramtypes",[Object,De,l])],Ve);let qe=class{constructor(e,t){this.apiName=e,this.broker=t}sendEvent(e,t,r){return this.broker.publishEvent(this.apiName,e,t,r??new l({useCaseId:(0,T.Z)()}))}};qe=Ne([ue(),Fe(0,(0,s.Inject)(c)),ke("design:paramtypes",[Object,De])],qe);const Ge=()=>{const e=(t,r)=>{const n=new de({appDefinition:t,channels:{},channelsListener:be,currentNode:"",subscriptions:{}}),o=new se(n);let i;const a=()=>{if(i)return i;const e=o.connect({onCommand:(e,t,n)=>{if(!(e in r))throw new Error(`${e} is not mocked`);return r[e].commands[t](n)},onQuery:(e,t,n)=>{if(!(e in r))throw new Error(`${e} is not mocked`);return r[e].queries[t](n)}});return i=e.start(),i};return{buildClient:async e=>{const t=new ye(o,n,e??new l({useCaseId:(0,T.Z)()}));return await a(),t},buildContextlessClient:async()=>{const e=new ge(n,o);return await a(),e},withMock:(n,o)=>{const i={...t,...(0,d.Ay)({[n.name]:{api:n,main:"",queryOnly:[]}})};return e(i,{...r,[n.name]:o})}}};return e({},{})};function Be({appDefinition:e,channels:t,channelsListener:r}){const n=new de({appDefinition:e,channels:t,channelsListener:r,currentNode:null,subscriptions:{}}),o=new se(n),i=()=>{throw new Error("Unexpected request received by detached application client")};return o.connect({onCommand:i,onQuery:i}).start(),fe(e,o)}var He=r(27149);async function We(e,t=1e4){if(!(0,He.b)(e))throw new Error("Error in getQueryValue: the argument is not an observable");try{return await(0,k.z)(e.pipe((0,Se.V)({first:t})))}catch(e){throw new Error("Error in getQueryValue: "+e)}}async function Ke(e){const t=await(0,k.z)(e.getClient(S.requestContextApi).queries.activeUser());if((0,Me.d6)(t)&&t.data.userName)return t.data.userName}var ze=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},$e=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Qe=function(e,t){return function(r,n){t(r,n,e)}};class Ye{constructor(e){this.supportedEventHandlers=e}}let Je=class{constructor(e,t,r,n){this.conf=e,this.config=t,this.moduleRef=r,this.clients=n}async execute(e){const t=I.ContextIdFactory.getByRequest(e),{type:r}=e;try{const n=async()=>e.context.userName??await Ke(this.clients),{appDefinition:o}=this.config;if(!(e.module in o))throw new Error("unknown module "+e.module);const i=o[e.module].api;switch(r){case xe.Query:{const{queries:r}=i;if(e.name in r){const o=r[e.name],i=new o(e.body),a=Reflect.getMetadata("dl-handler",o);if(o.metadata.scope===S.UseCaseScope.User){const t=await n();if(!t&&o.metadata.noUserError)return(0,ve.of)((0,Me.Rn)(o.metadata.noUserError));e.context.userName=t}const s=(await this.moduleRef.resolve(a,t,{strict:!1})).execute(i);return(0,ve.of)(s)}throw new Error("unknown query "+e.name)}case xe.Command:{const{commands:r}=i;if(e.name in r){const o=r[e.name],i=new o(e.body),a=Reflect.getMetadata("dl-handler",o);if(o.metadata.scope===S.UseCaseScope.User){const t=await n();if(!t&&o.metadata.noUserError)return(0,ve.of)((0,Me.Rn)(o.metadata.noUserError));e.context.userName=t}const s=await this.moduleRef.resolve(a,t,{strict:!1}),c=await s.execute(i);return(0,ve.of)(c)}throw new Error("unknown command "+e.name)}case xe.Event:{const{events:r}=i;if(e.name in r){const n=r[e.name],o=new n(e.body),i=Reflect.getMetadata("dl-handlers",n);if(!i)return;const a=await Promise.all(i.filter((e=>this.conf.supportedEventHandlers.has(e))).map((async e=>await this.moduleRef.resolve(e,t,{strict:!1}))));return void await Promise.all(a.map((e=>e.handle(o))))}throw new Error("unknown event "+e.name)}}(0,H.U)(r)}catch(e){return(e=>({error:e,isError:!0}))(e)}}};ze([(0,s.All)(),Qe(0,(0,s.Req)()),$e("design:type",Function),$e("design:paramtypes",[Object]),$e("design:returntype",Promise)],Je.prototype,"execute",null),Je=ze([(0,s.Controller)({scope:s.Scope.REQUEST,durable:!1}),$e("design:paramtypes",[Ye,de,I.ModuleRef,ge])],Je);class Xe{async waitTimeout(e){await(0,k.z)(this.createObservableTimer(e,e))}}class Ze extends Xe{constructor(){super(...arguments),this.subscribers$=new P.X(new Set),this.time=0,this.pendingTimerCount$=this.subscribers$.pipe((0,G.U)((e=>e.size)))}fireTimer(e=1){this.time+=e,[...this.subscribers$.value].forEach((e=>{e.next(this.time)}))}async allSubscribersDisconnected(){await(0,k.z)(this.pendingTimerCount$.pipe((0,N.h)((e=>!e))))}createObservableTimer(){return new X.y((e=>(this.subscribers$.next(new Set([...this.subscribers$.value,e])),()=>{this.subscribers$.next(new Set([...this.subscribers$.value].filter((t=>t!==e))))})))}}var et=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},tt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};function rt(e){return e}class nt{constructor(e,t,{args:r,commandName:n}){const o=t.commands[n];this.refreshObservable$=e.pipe((0,F.z)((async()=>{await o(r)})),(0,Oe.B)({}))}withRefresh(){return e=>new X.y((t=>{const r=this.refreshObservable$.subscribe();return r.add(e.subscribe(t)),r}))}}let ot=class{constructor(e,t){this.timers=e,this.cqrsClient=t,this.map=new WeakMap}getRefresher(e){const t=this.map.get(e);if(t)return t;return new nt(this.timers.createObservableTimer(e.period,e.period),this.cqrsClient.getClient(e.api),e)}};async function it(e,t){const r=await(0,k.z)(e.getClient(S.requestContextApi).queries.userFeatureFlips({requiredFeatureFlips:t}));if(!(0,Me.d6)(r))throw new Error("Couldn't fetch userFeatureFlips from requestContextApi");return(0,Me.db)(r)}ot=et([ue(),tt("design:paramtypes",[Xe,ge])],ot);const at="cron",st=(e,t)=>({provide:l,scope:s.Scope.REQUEST,inject:[ge,I.REQUEST],useFactory:async(r,n)=>{if(n.type===xe.Init)return new l({useCaseId:"init",requiredFeatureFlips:t});if(n.type===xe.Cron){if(n.scope===S.UseCaseScope.Device)return new l({useCaseId:at,requiredFeatureFlips:t});const e=await Ke(r);return new l(e?{useCaseId:at,userName:e,featureFlips:await it(r,t),requiredFeatureFlips:t}:{useCaseId:at,requiredFeatureFlips:t})}const o=n.context.useCaseId||String(I.ContextIdFactory.getByRequest(n).id),i=function(e,t){const{type:r}=e;switch(r){case xe.Query:{const r=t[e.module].api,{queries:n}=r;if(e.name in n)return n[e.name].metadata.scope;throw new Error("unknown query "+e.name)}case xe.Command:{const r=t[e.module].api,{commands:n}=r;if(e.name in n)return n[e.name].metadata.scope;throw new Error("unknown command "+e.name)}case xe.Event:{const r=t[e.module].api,{events:n}=r;if(e.name in n)return n[e.name].metadata.scope;throw new Error("unknown event "+e.name)}case xe.Init:return S.UseCaseScope.Device;case xe.Cron:return e.scope;default:(0,H.U)(r)}}(n,e);if(i===S.UseCaseScope.Device)return new l({useCaseId:o,requiredFeatureFlips:t});const a=n.context.userName??await Ke(r);if(!a)throw new Error(`${n.type} ${n.module}.${n.name} is user-scoped, but no user is logged in.`);const s=await(async()=>n.context.featureFlips??await it(r,t))();return new l({useCaseId:o,requiredFeatureFlips:t,userName:a,featureFlips:s})}});class ct{constructor(){this.memory=new Map}set(e,t){return this.memory.set(e,t),Promise.resolve()}getAllKeys(){return Promise.resolve([...this.memory.keys()])}remove(e){return this.memory.get(e)?(this.memory.delete(e),Promise.resolve()):Promise.resolve()}get(e){return Promise.resolve(this.memory.get(e))}}var ut;!function(e){e.NotLoaded="not_loaded",e.Requested="requested",e.Loaded="loaded"}(ut||(ut={}));const lt=e=>{if(!e||"object"!=typeof e)return!1;return"boolean"==typeof e.loaded},dt=e=>e.loaded,pt=new _;async function ft(e,t){const r=new e("mockedModuleName",e.Definition,pt,"user");return t&&await r.set(t),r}class ht{constructor(e){this.subscribersCount$=new P.X(0),this.stopped$=new P.X(!1),this.store=e,this.state$=new X.y((t=>{this.subscribersCount$.next(this.subscribersCount$.value+1);const r=e.state$.pipe((e=>e.pipe((0,N.h)(dt),(0,G.U)((e=>e.value))))).subscribe(t);return r.add((()=>this.subscribersCount$.next(this.subscribersCount$.value-1))),r.add(this.stopped$.pipe((0,N.h)((e=>!!e))).subscribe((()=>{t.complete()}))),r})),this.loadingState$=(0,Z.a)({stopped:this.stopped$,hasSubscribers:this.subscribersCount$.pipe((0,G.U)((e=>e>0))),isLoaded:this.store.state$.pipe((0,G.U)((e=>e.loaded)))}).pipe((0,ee.o)((({stopped:e})=>!e)),(0,G.U)((({hasSubscribers:e,isLoaded:t})=>t?ut.Loaded:e?ut.Requested:ut.NotLoaded)))}set(e){return this.store.set({loaded:!0,value:e})}init(e){return this.store.init({loaded:!0,value:e})}clear(){return this.store.set({loaded:!1})}stop(){this.store.stop(),this.stopped$.next(!0)}getState(){return(0,k.z)(this.state$)}}class mt{constructor(e){const{infrastructure:t,defaultValue:r}=e;this.infrastructure=t,this.timeGetter=e.timeGetter??(()=>Date.now()),this.localState$=new P.X({timestamp:void 0}),this.mergedState$=(0,Z.a)({infra:t.state$,current:this.localState$}).pipe((0,G.U)((({current:e,infra:t})=>t.timestamp&&(!e.timestamp||t.timestamp>e.timestamp)?t:e))),this.state$=this.mergedState$.pipe((0,G.U)((e=>e.data??r)))}async set(e){const t={data:e,timestamp:this.timeGetter()};this.localState$.next(t),await this.infrastructure.set(t)}init(e){const t={data:e,timestamp:0};return this.localState$.next(t),Promise.resolve()}get(){return(0,k.z)(this.state$)}stop(){this.localState$.complete()}}const yt=e=>{var t;return t=class{constructor(e,t,r,n){this.encryptionCodec=e,this.serializationCodec=t,this.transportStorageCodec=r,this.backend=n}async read(){const t=await this.backend.read();if(!t)return;const r=await this.transportStorageCodec.decode(t),n=await this.encryptionCodec.decode(r),o=await this.serializationCodec.decode(n);if(!p(o,e.typeGuard)){if(!e.typeGuard(o))throw new Error("deserializedObject is not type of TStorage");return await this.write(o),o}if(o.version<e.schemaVersion){if(!e.migrateStorageSchema)throw new Error("migrateStorage is undefined");const t=e.migrateStorageSchema(o);return await this.write(t),t}const i=o.content;if(!e.typeGuard(i))throw new Error("Type guard failed");return i}async write(t){const r={version:e.schemaVersion,content:t},n=await this.serializationCodec.encode(r),o=await this.encryptionCodec.encode(n),i=await this.transportStorageCodec.encode(o);await this.backend.write(i)}},t.Definition=e,t},gt={loaded:!1};class vt extends ht{constructor(e,t,r,n){super(function(e,t,r,n){const o=(()=>{switch(t.scope){case S.UseCaseScope.Device:return r.createDeviceScopedInfrastructure(e,t.storeName,t.storeTypeGuard);case S.UseCaseScope.User:if(!n)throw new Error;return r.createUserScopedInfrastructure(e,t.storeName,n,t.storeTypeGuard)}(0,H.U)(t.scope)})();return new mt({infrastructure:o,defaultValue:gt})}(e,t,r,n)),t.persist||this.init(t.initialValue)}async update(e){const t=await this.getState();await this.set(e(t))}}const bt=e=>e.persist?{persist:!0,codec:e.codec,scope:e.scope,storeName:e.storeName,storeTypeGuard:e.storeTypeGuard,isCache:e.isCache,persistPeriod:e.persistPeriod,storage:yt(e.storage)}:{persist:!1,initialValue:e.initialValue,scope:e.scope,storeName:e.storeName};function wt(e){var t;const r=bt(e),n=((t=class extends vt{constructor(e,t,r,n){super(e,t,r,n)}}).Definition=r,t);return ue()(n),n}var St;!function(e){e._001KB="1KB",e._010KB="10KB",e._100KB="100KB",e.Unlimited="Unlimited"}(St||(St={}));class Rt{}class Et extends Rt{constructor(e){super(),this.files=e}fetch(e){return e in this.files?Promise.resolve(this.files[e]):Promise.reject(new Error("404 not found :"+e))}}var Ot=r(25859),Ct=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Pt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let At=class{constructor(e,t){this.url=e,this.fetcher=t,this.value$=(0,q.D)((0,Ot.P)((()=>this.get())))}async load(){await this.get()}async get(){const{value:e}=this;if(e)return e;const t=await this.fetcher.fetch(this.url),r=await this.loadResource(t);return this.value=r,r}};At=Ct([ue(),Pt("design:paramtypes",[String,Rt])],At);class jt{constructor(e){this.logger=e}async do(...e){return(await Promise.all(e.map((e=>this.doOne(e))))).every((e=>!!e))}async doOne(e){try{const t=await e();if((0,Me.AZ)(t)&&(0,Me.hx)(t))throw new Error("Allowed to fail method has failed");return!0}catch(e){return this.logger.warn(e),!1}}}class _t{static create({brokers:{cqrs:e,event:t},configProviders:r,keyValueStorageInfrastructure:n,lifeCycle:o,logger:i,modules:a,nodeConfiguration:s,requiredFeatureFlips:c,storeInfrastructureFactory:d,timers:p,jsonFetcher:h,eventHandlers:m,defaultDeviceStorageEncryptionCodecProvider:y,defaultUserStorageEncryptionCodecProvider:g}){return{module:_t,providers:[V.ExplorerService,{provide:f,useValue:n},{provide:O,useValue:o},{provide:de,useValue:s},{provide:se,useValue:e},{provide:De,useValue:t},{provide:Rt,useValue:h},ye,ge,...r,{provide:C,useValue:i},st(s.appDefinition,c),{provide:j,useValue:d},{provide:Xe,useValue:p},ot,{provide:L,useValue:new L(n)},u.z,y,g,u.bL,u.Eu,{provide:Ye,useValue:new Ye(new Set(m))},jt],imports:[...a],exports:[O,de,se,De,ye,ge,...r.map((({provide:e})=>e)),C,l,j,Xe,ot,u.z,x,U,u.bL,u.Eu,L,f,Rt,jt],controllers:[Je],global:!0}}}var Tt=r(74081);const It=()=>{},Dt=()=>{throw new Error("Not supported")};class xt{constructor(e,t){this.cqrsBroker=e,this.eventsBroker=t,this.isListening$=new P.X(!1),this.use=Dt,this.get=Dt,this.post=Dt,this.head=Dt,this.delete=Dt,this.put=Dt,this.options=Dt,this.patch=Dt,this.end=Dt,this.applyVersionFilter=Dt,this.disconnect=It,this.close=It,this.status=Dt,this.render=Dt,this.redirect=Dt,this.setHeader=Dt,this.enableCors=Dt,this.initHttpServer=Dt,this.registerParserMiddleware=Dt,this.createMiddlewareFactory=Dt}isHeadersSent(){return!1}bindHandler(e){if(this.cqrsCallbacks||this.eventCallbacks)throw new Error("Handler already registered");this.cqrsCallbacks={onCommand:(t,r,n,o)=>new Promise(((i,a)=>{e({type:xe.Command,module:t,name:r,body:n,context:o},{type:xe.Command,value:(0,Me.Vp)(void 0),reply:e=>{if(Ue(e))return a(e.error);i(e)}})})),onQuery:(t,r,n,o)=>{const i=new Promise(((i,a)=>{e({type:xe.Query,module:t,name:r,body:n,context:o},{type:xe.Query,value:B.E,reply:e=>{if(Ue(e))return a(e.error);i(e)}})}));return(0,q.D)(i).pipe((0,Tt.J)())}},this.eventCallbacks={onLocalEvent:(t,r,n,o,i)=>new Promise(((r,a)=>{e({type:xe.Event,body:o,context:i,name:n,module:t},{type:xe.Event,reply:e=>{if(Ue(e))return a(e.error);r(e)}})}))}}all(e,t){if(!t)throw new Error("Provide a handler");return this.bindHandler(t)}async listen(){if(!this.cqrsCallbacks||!this.eventCallbacks)throw new Error("Please call `all(path, handler)` first");const e=await this.cqrsBroker.connect(this.cqrsCallbacks).start(),t=await this.eventsBroker.connect(this.eventCallbacks).start(),{isListening$:r}=this;this.disconnect=()=>{e.stop(),t.stop(),r.complete()},this.close=this.disconnect,this.isListening$.next(!0)}reply(e,t){e.reply(t)}getInstance(){return this}getHttpServer(){return{once:It,address:()=>"",removeListener:It}}getType(){return"AppCoreNode"}}const Ut=()=>{};class Mt extends I.AbstractHttpAdapter{constructor(e,t){super(new xt(e,t)),this.createMiddlewareFactory=this.instance.createMiddlewareFactory,this.close=this.instance.close,this.reply=this.instance.reply,this.useStaticAssets=Ut,this.setViewEngine=Ut,this.getRequestHostname=Ut,this.status=Ut,this.render=Ut,this.redirect=Ut,this.setNotFoundHandler=Ut,this.setHeader=Ut,this.registerParserMiddleware=Ut,this.enableCors=Ut,this.setErrorHandler=Ut,this.end=Ut,this.isListening$=this.instance.isListening$}initHttpServer(){this.setHttpServer({once:Ut,address:()=>"",removeListener:Ut})}getRequestMethod(){return s.RequestMethod.ALL}getRequestUrl(){return"/"}getType(){return"CoreApp"}isHeadersSent(){return!1}applyVersionFilter(){throw new Error("Versioning not supported")}}var Lt=r(90171);class Nt extends C{log(){}warn(e,...t){return console.warn(e,t)}error(e,...t){return console.error(e,t)}trace(e,...t){return console.trace(e,t)}}class kt extends Xe{get time(){return Date.now()}createObservableTimer(e,t){return(0,Lt.H)(e,t)}}class Ft extends Rt{fetch(){return Promise.reject(new Error("Please add a jsonFetcher to the application. Probably you are seing that in unit tests.\nIf this is the case, please mock whatever service is requiring to fetch the data"))}}const Vt=(e,t)=>t.reduce(((t,r)=>{const n=Reflect.getMetadata(a,r.module);if(!(o=n)||"object"!=typeof o||o.api&&!(o.api.commands&&o.api.events&&o.api.name&&o.api.queries&&o.handlers)||o.exports&&!Array.isArray(o.exports)||o.handlers&&!o.api||o.imports&&!Array.isArray(o.imports)||o.providers&&!Array.isArray(o.providers))return t;var o;n.onFrameworkInit&&t.onFrameworkInits.push(n.onFrameworkInit);const i=n.api?.name??n.sharedModuleName??"unnamed";t.configProviders.push(...function(e,t,r,n){if(!r.configurations)return[];const{configurations:o}=r,i=[];return Object.keys(o).forEach((e=>{const r=o[e].token,a=n.configurations?.[e];if(!a)throw new Error(`Missing '${e}' configuration for '${t}' module`);i.push({...a,provide:r})})),Object.keys(n.configurations??{}).forEach((n=>{r.configurations?.[n]||e.error(`Unknown '${n}' configuration for '${t}' module will be unused`)})),i}(e,i,n,r)),n.api?.name&&t.modulesMetadata.set(n.api.name,n),t.modules.push(r.module);const s=n.requiredFeatureFlips;return t.requiredFeatureFlips.push(...s?s.filter((e=>!t.requiredFeatureFlips.includes(e))):[]),n.crons&&t.crons.push(...n.crons.map((e=>({...e,moduleName:i})))),n.handlers?.events&&t.eventHandlers.push(...Object.values(n.handlers.events).flatMap((e=>Object.values(e.events)))),t}),{configProviders:new Array,modules:new Array,modulesMetadata:new Map,requiredFeatureFlips:(0,d.Ay)([]),onFrameworkInits:new Array,crons:new Array,eventHandlers:new Array});class qt{}class Gt extends qt{constructor(e){super(),this.alarm$=e.createObservableTimer(6e4,6e4)}}var Bt=r(64987);function Ht(e){return!!e&&"object"==typeof e&&(0,d.l$)(e,"entries")&&Array.isArray(e.entries)&&e.entries.every((e=>function(e){return!!e&&"object"==typeof e&&(0,d.l$)(e,"dueTimestamp")&&(0,d.l$)(e,"moduleName")&&(0,d.l$)(e,"name")&&"string"==typeof e.name&&"string"==typeof e.moduleName&&"number"==typeof e.dueTimestamp}(e)))}class Wt{constructor(e,t){this.storage=e,this.storageKey=`crons.${t}`}async setState(e){await this.storage.set(this.storageKey,JSON.stringify(e))}async getState(){const e=await this.storage.get(this.storageKey);if(!e)return{entries:[]};const t=JSON.parse(e);return Ht(t)?t:{entries:[]}}}const Kt=6e4;function zt(e){return Math.ceil(e/Kt)*Kt}function $t(e){return Math.floor(e/Kt)*Kt}class Qt{constructor(e,t){this.infra=e,this.identifiers=t}async init(){const e=zt(this.infra.timers.time),t=await this.infra.repository.getState(),r=this.identifiers.filter((e=>!t.entries.find((t=>t.name===e.name&&t.moduleName===e.moduleName)))).map((e=>this.infra.getCron(e))),n={entries:[...t.entries.filter((e=>this.identifiers.find((t=>t.name===e.name&&t.moduleName===e.moduleName)))),...r.map((t=>({...t.identifier,dueTimestamp:e+t.periodInMs})))]};await this.infra.repository.setState(n)}async runAllCrons(){const e=await this.infra.repository.getState(),t=zt(this.infra.timers.time),r=$t(this.infra.timers.time),n=e.entries.filter((e=>e.dueTimestamp<=t));await Promise.all(n.map((t=>this.runCron(r,e,t))))}async runCron(e,t,r){const n=this.infra.getCron(r);await n.mutex.runExclusive((async()=>{await n.isRunnable()&&(await n.run(),r.dueTimestamp=$t(e+n.periodInMs),await this.infra.repository.setState(t))}))}}const Yt={run:()=>{throw new Error("Should not run")},isRunnable:()=>!1};async function Jt(e,t,r,n,o){const i=new Qt({timers:t,repository:new Wt(n,o),getCron:t=>{const n=(({moduleName:t,name:r})=>{const n=e.find((e=>e.name===r&&e.moduleName===t));if(!n)throw new Error(`No such cron ${r} in ${t}`);return n})(t);let o;const i=async()=>{if(o)return o;const e=await async function(e,t){const r=Object.freeze({id:Math.random()}),n={type:xe.Cron,scope:e.scope};t.registerRequestByContextId(n,r);const o=async()=>await t.resolve(e.handler,r,{strict:!1});return e.scope===S.UseCaseScope.Device||(await t.resolve(l,r,{strict:!1})).userName?o():Yt}(n,r);return o=e,e};return{identifier:t,isRunnable:async()=>{const e=await i();return!e.isRunnable||await e.isRunnable()},mutex:n.mutex??new Bt.WU,periodInMs:60*n.periodInMinutes*1e3,run:async()=>(await i()).run()}}},e);return await i.init(),i}function Xt(e){const{parameterProvider:t,token:r}=e;switch(t.type){case n.CLASS_PROVIDER:return{provide:r,useClass:t.useClass};case n.VALUE_PROVIDER:return{provide:r,useValue:t.useValue};default:(0,H.U)(t)}}var Zt=r(73656);const er=async({appDefinition:e,channels:t,currentNode:r,implementations:o,otherModules:i=[],logger:a=new Nt,storeInfrastructureFactory:s=new _,channelsListener:c=be,timers:p=new kt,keyValueStorageInfrastructure:f=new ct,jsonFetcher:h=new Ft,cronSource:m=new Gt(p),defaultDeviceStorageEncryptionCodec:y={type:n.CLASS_PROVIDER,useClass:u.Eu},defaultUserStorageEncryptionCodec:g={type:n.CLASS_PROVIDER,useClass:u.Eu}})=>{const v=()=>{throw new Error("Aborted")};Zt.abort=v,Zt.exit=v;const b=[...i,...Object.keys(o).map((e=>e)).map((e=>o[e]))],{configProviders:w,modules:S,modulesMetadata:R,requiredFeatureFlips:E,onFrameworkInits:C,crons:P,eventHandlers:A}=Vt(a,b);((e,t,r)=>{const n=new Set([...r.keys()]),o=new Set(Object.values(e).filter((e=>e.main===t||e.queryOnly.includes(t))).map((e=>e.api.name))),i=[...o].filter((e=>!n.has(e))),a=[...n].filter((e=>!o.has(e)));if(i.length>0)throw new Error("These APIs are not implemented "+JSON.stringify(i));if(a.length>0)throw new Error("Some implementations do not have APIS "+JSON.stringify(a))})(e,r,R);const j=(e=>[...e.entries()].reduce(((e,[t,r])=>{const n=r.handlers?.events??{};return e[t]=Object.values(n).reduce(((e,t)=>t.name?(e[t.name]=Object.keys(t.events),e):e),(0,d.Ay)({})),e}),(0,d.Ay)({})))(R),D=new de({appDefinition:e,channels:t,channelsListener:c,currentNode:r,subscriptions:j}),M=new se(D),L=new De(D),V=new Mt(M,L),q=Xt({token:x,parameterProvider:y}),G=Xt({token:U,parameterProvider:g}),B=new O,H=_t.create({nodeConfiguration:D,brokers:{cqrs:M,event:L},modules:S,configProviders:w,logger:a,lifeCycle:B,storeInfrastructureFactory:s,timers:p,requiredFeatureFlips:E,keyValueStorageInfrastructure:f,jsonFetcher:h,eventHandlers:A,defaultDeviceStorageEncryptionCodecProvider:q,defaultUserStorageEncryptionCodecProvider:G}),W=await I.NestFactory.create(H,V,{logger:a}),K=await W.init();await async function(e,t){const r=Object.freeze({id:-1}),n=e.map((async e=>{const n={type:xe.Init};t.registerRequestByContextId(n,r);const o=await t.resolve(e,r,{strict:!1});await o.onFrameworkInit()}));await Promise.all(n)}(C,K),W.listen("");const z=V.isListening$.pipe((0,N.h)((e=>!!e)));return await(0,k.z)(z),B.addAppReadyHook((async()=>{const e=await Jt(P,p,K,f,r),t=m.alarm$.pipe((0,F.z)((async()=>{await e.runAllCrons()}))).subscribe();return()=>{t.unsubscribe()}})),B.addShutdownHook((()=>W.close())),await B.startup(),{stop:()=>B.shutDown(),createClient:()=>fe(e,M),sendEvent:(e,t,r,n)=>L.publishEvent(e,t,r,n??new l({useCaseId:(0,T.Z)()}))}},tr=e=>er({...e,appDefinition:e.appDefinition,channels:{},currentNode:"node"}),rr=(e,t)=>(()=>{const e=t=>({define:()=>t,with:r=>{const n={api:r.module,main:r.on,queryOnly:r.queryOnly??[]},o={[r.module.name]:n};return e({...t,...o})}});return e({})})().with({module:S.requestContextApi,on:e}).with({module:S.taskTrackingApi,on:e}),nr=rr("node",[]);class or{}var ir;!function(e){e.DummyFeatureFlip0="dummyFeatureFlip0",e.DummyFeatureFlip1="dummyFeatureFlip1",e.DummyFeatureFlip2="dummyFeatureFlip2",e.DummyFeatureFlip3="dummyFeatureFlip3",e.DummyFeatureFlip4="dummyFeatureFlip4",e.DummyFeatureFlip5="dummyFeatureFlip5"}(ir||(ir={}));const ar={[ir.DummyFeatureFlip0]:!1,[ir.DummyFeatureFlip1]:!0,[ir.DummyFeatureFlip2]:!0,[ir.DummyFeatureFlip3]:!0,[ir.DummyFeatureFlip4]:!1,[ir.DummyFeatureFlip5]:!0};class sr extends or{async getFeatureFlipsForActiveUser(e){const t=e.reduce(((e,t)=>t in ar?{...e,[t]:ar[t]}:{...e}),{});return await Promise.resolve(t)}}const cr={[S.UseCaseScope.Device]:x,[S.UseCaseScope.User]:U};const ur=1e3;function lr(e){const t=e.Definition.persist?function(e,t,r){const{EncryptionCodec:n=cr[t],SerializationCodec:o=u.bL,TransportStorageCodec:i=u.z,initialValue:a,schemaVersion:s}=r.Definition;class d{constructor(e,t,r,n){this.encryptionCodec=e,this.serializationCodec=t,this.transportStorageCodec=r,this.backend=n}}class p extends r{constructor(e){super(e.encryptionCodec,e.serializationCodec,e.transportStorageCodec,e.backend)}}const f={token:(0,T.Z)(),inject:[d],asyncFactory:e=>Promise.resolve(new p(e))},h={token:d,inject:[c,n,o,i,L,...t===S.UseCaseScope.User?[l]:[]],asyncFactory:async(r,n,o,i,c,u)=>{const l=await c.createBackend(r,e,(t===S.UseCaseScope.User?u?.userName:"")??"",(async()=>{const e={version:s,content:a},t=await o.encode(e),r=await n.encode(t);return await i.encode(r)}));return new d(n,o,i,l)}};return[h,...yr(t,r,f)]}(e.Definition.storeName,e.Definition.scope,e.Definition.storage):[],r={token:(0,T.Z)(),inject:[c,O,C,j,e.Definition.scope===S.UseCaseScope.User?l:I.REQUEST,...e.Definition.persist?[e.Definition.storage,e.Definition.codec]:[]],asyncFactory:async(t,r,n,o,i,a,s)=>await(()=>{const c=new e(t,e.Definition,o,(e.Definition.scope===S.UseCaseScope.User?i.userName:"")??"");r.addShutdownHook((()=>c.stop()));const{Definition:u}=e;return u.persist&&async function(e){const t=e.isCache?await async function(e){try{return await s.decode(await a.read())}catch(t){const r=["Data corrupted on disk. Using initial value for the store",t];return n.warn(...r),await s.decode(e.storage.Definition.initialValue)}}(e):await s.decode(await a.read());await c.set(t);const o=e.persistPeriod??ur,i=(0===e.persistPeriod?c.state$:c.state$.pipe((0,R.b)(o))).pipe((0,E.w)((async e=>{await a.write(await s.encode(e))}))).subscribe();r.addShutdownHook((()=>i.unsubscribe()))}(u),c})()};return[...t,...yr(e.Definition.scope,e,r)]}function dr(...e){return e.flatMap((e=>lr(e)))}const pr=(e,t)=>({[e.name]:{name:e.name,events:t}});function fr(e){const{exports:t=[],imports:r=[],handlers:n={commands:{},events:{},queries:{}},providers:o=[],onFrameworkInit:i,stores:u,batchExecutors:l,crons:d}=e,p=e.api?.name??e.sharedModuleName,f=p?dr(...u??[]):[],h=p?(new w).getProviders(l??[]):[],m=[...o,...(d??[]).map((e=>e.handler)),...f,...h,...Object.values(n.commands),...Object.values(n.queries),...Object.values(n.events).map((e=>Object.values(e.events))).reduce(((e,t)=>[...e,...t]),new Array),...i?[i]:[],{provide:c,useValue:p}],{asyncProviders:y,basicClassProviders:g}=m.reduce(((e,t)=>{return"object"==typeof(r=t)&&"token"in r&&"asyncFactory"in r&&"function"==typeof r.asyncFactory?{asyncProviders:[...e.asyncProviders,t],basicClassProviders:e.basicClassProviders}:{asyncProviders:e.asyncProviders,basicClassProviders:[...e.basicClassProviders,t]};var r}),{asyncProviders:new Array,basicClassProviders:new Array}),v=[...g,...y.map((e=>({provide:e.token,useFactory:e.asyncFactory,inject:e.inject})))],b=(0,s.Module)({exports:t,imports:r,providers:v});return t=>(Reflect.defineMetadata(a,e,t),b(t))}const hr=(e,t)=>{const r=t.token??(0,T.Z)();class n{constructor(){this.instances=new Map}}const o=n,i={token:e,inject:[n,l,I.ModuleRef,I.REQUEST],asyncFactory:async(t,{userName:n},o,i)=>{const a=I.ContextIdFactory.getByRequest(i);if(!n)throw new Error(`Provider ${e} is a user-scoped singleton but there is no user`);const s=t.instances.get(n);if(s)return Promise.resolve(s);const c=await o.resolve(r,a);return t.instances.set(n,c),c}};return[{token:r,asyncFactory:t.asyncFactory,inject:[...t.inject??[],l]},o,i]},mr=(e,t)=>{const r=t.token??(0,T.Z)();class n{}ue()(n);const o=n,i={token:e,inject:[n,I.ModuleRef,I.REQUEST],asyncFactory:async(e,t,n)=>{const o=I.ContextIdFactory.getByRequest(n),i=e.instance;if(i)return Promise.resolve(i);const a=await t.resolve(r,o);return e.instance=a,a}};return[{...t,token:r},o,i]},yr=(e,t,r)=>{switch(e){case S.UseCaseScope.Device:return mr(t,r);case S.UseCaseScope.User:return hr(t,r);default:(0,H.U)(e)}};var gr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},vr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let br=class extends u.eN{constructor(e){super(e)}};br=gr([ue(),vr("design:paramtypes",[u.jN])],br);var wr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let Sr=class{};function Rr(e){const t=ue();return r=>{Reflect.defineMetadata("dl-handler",r,e),t(r)}}Sr=wr([fr({providers:[br],configurations:{infrastructure:{token:u.jN}},exports:[br],sharedModuleName:"http"})],Sr);const Er=e=>"object"==typeof e&&null!==e&&(0,d.l$)(e,"swStartTime")&&(0,d.l$)(e,"taskTrackingList")&&"string"==typeof e.swStartTime&&"object"==typeof e.taskTrackingList;class Or extends(wt({persist:!1,initialValue:{swStartTime:"",taskTrackingList:{}},scope:S.UseCaseScope.Device,storeName:"task-tracking",storeTypeGuard:Er,capacity:St._001KB})){}var Cr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Pr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ar=class{constructor(e){this.store=e}async execute({body:e}){const t=(new Date).toISOString(),{taskName:r,feature:n,businessDomain:o}=e,i={taskName:r,feature:n,businessDomain:o,startTime:t,serviceWorkerInterruptionCount:0},a=await this.store.getState();return await this.store.set({...a,taskTrackingList:{...a.taskTrackingList,[t]:i}}),Promise.resolve((0,Me.Vp)({id:t}))}};Ar=Cr([Rr(S.StartTaskTrackingCommand),Pr("design:paramtypes",[Or])],Ar);var jr=r(53576),_r=r(10203),Tr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Ir=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Dr=class{constructor(e,t,r){this.store=e,this.cqrsClient=t,this.appLifecycle=r}onFrameworkInit(){this.appLifecycle.addAppReadyHook((async()=>{const e=await this.store.getState(),t={...e.taskTrackingList},r=Object.keys(e.taskTrackingList).map((async r=>{const{taskName:n,feature:o,businessDomain:i,startTime:a}=e.taskTrackingList[r],s=new _r.UserMv3ExtensionTaskInterruptionEvent({businessDomain:i,feature:o,taskName:n,taskStartDateTime:a,serviceWorkerStartDateTime:e.swStartTime}),c=this.cqrsClient.getClient(jr.carbonLegacyApi);await c.commands.carbon({name:"logEvent",args:[{event:s}]}),delete t[r]}));await Promise.all(r),await this.store.set({swStartTime:(new Date).toISOString(),taskTrackingList:t})}))}};Dr=Tr([le(),Ir("design:paramtypes",[Or,ye,O])],Dr);var xr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Ur=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Mr=class{constructor(e,t,r){this.store=e,this.cqrsClient=t,this.logger=r}async execute({body:e}){const{taskTrackingId:t}=e,r=await this.store.getState(),n=r.taskTrackingList[t];if(!n)return this.logger.trace("Trying to track a task that does not exist"),(0,Me.Vp)(void 0);const{taskName:o,feature:i,businessDomain:a,startTime:s,serviceWorkerInterruptionCount:c}=n,u=new _r.UserMv3ExtensionTaskReportEvent({businessDomain:a,feature:i,serviceWorkerInterruptionCount:c,serviceWorkerStartDateTime:r.swStartTime,taskName:o,taskStartDateTime:s,taskEndDateTime:(new Date).toISOString()}),l=this.cqrsClient.getClient(jr.carbonLegacyApi);await l.commands.carbon({name:"logEvent",args:[{event:u}]});const d={...r.taskTrackingList};return delete d[t],await this.store.set({swStartTime:r.swStartTime,taskTrackingList:d}),(0,Me.Vp)(void 0)}};Mr=xr([Rr(S.TerminateTaskTrackingCommand),Ur("design:paramtypes",[Or,ye,C])],Mr);var Lr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let Nr=class{};function kr(e){const t=ue();return r=>{Reflect.defineMetadata("dl-handler",r,e),t(r)}}function Fr(e){const t=ue();return r=>{if(Reflect.hasMetadata("dl-handlers",e)){const t=Reflect.getMetadata("dl-handlers",e);Reflect.defineMetadata("dl-handlers",[...t,r],e)}else Reflect.defineMetadata("dl-handlers",[r],e);t(r)}}Nr=Lr([fr({api:S.taskTrackingApi,handlers:{commands:{startTaskTracking:Ar,terminateTaskTracking:Mr},events:{},queries:{}},stores:[Or],onFrameworkInit:Dr,providers:[]})],Nr);const Vr=e=>!(!e||"object"!=typeof e)&&"userName"in e,qr=e=>!(!e||"object"!=typeof e)&&"featureFlips"in e;class Gr extends(wt({initialValue:{userName:void 0},persist:!1,scope:S.UseCaseScope.Device,storeName:"active-user-store",storeTypeGuard:Vr,capacity:St._001KB})){}class Br extends(wt({persist:!0,scope:S.UseCaseScope.Device,storeName:"feature-flip-store",capacity:St._001KB,codec:u.Eu,storage:{initialValue:{featureFlips:{}},schemaVersion:1,typeGuard:qr}})){}var Hr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let Wr=class extends Ve{};Wr=Hr([ue()],Wr);var Kr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},zr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};async function $r(e,t){await t.set({featureFlips:{...e}})}let Qr=class{constructor(e){this.activeUserStore=e}execute(){return this.activeUserStore.state$.pipe((0,G.U)((e=>e.userName)),(0,te.x)(),(0,G.U)((e=>(0,Me.Vp)({userName:e}))))}};Qr=Kr([kr(S.ActiveUserQuery),zr("design:paramtypes",[Gr])],Qr);let Yr=class{constructor(e,t){this.featureFlipsStore=e,this.config=t,this.retrieveFeatureFlips=async e=>{if(0===e.length)return Promise.resolve({});const t=await(async e=>{const t=await this.featureFlipsStore.getState();return e.reduce(((e,r)=>{if(r in t.featureFlips){const n={};return n[r]=t.featureFlips[r],{...e,...n}}return e}),{})})(e),r=e.filter((e=>!(e in t)));if(0===r.length)return t;const n=await(async e=>await this.config.getFeatureFlipsForActiveUser(e))(r);return{...t,...n}}}execute(e){return(0,q.D)(this.retrieveFeatureFlips(e.body.requiredFeatureFlips)).pipe((0,E.w)((async e=>{if(Object.keys(e).length>0){return{retrievedFf:e,cachedFf:(await this.featureFlipsStore.getState()).featureFlips}}return{retrievedFf:e}})),(0,G.U)((({retrievedFf:e,cachedFf:t})=>(t&&$r({...t,...e},this.featureFlipsStore),(0,Me.Vp)(e)))))}};Yr=Kr([kr(S.UserFeatureFlipsQuery),zr("design:paramtypes",[Br,or])],Yr);let Jr=class{constructor(e){this.featureFlipsStore=e}execute(){return(0,q.D)(this.featureFlipsStore.state$.pipe((0,G.U)((e=>(0,Me.Vp)({cachedFeatureFlips:Object.keys(e.featureFlips)})))))}};Jr=Kr([kr(S.GetCachedFeatureFlipsListQuery),zr("design:paramtypes",[Br])],Jr);let Xr=class{constructor(e){this.featureFlipsStore=e}async execute({body:{featureFlips:e}}){return await $r(e,this.featureFlipsStore),(0,Me.Vp)(void 0)}};Xr=Kr([Rr(S.SetFeatureFlipsInStoreCommand),zr("design:paramtypes",[Br])],Xr);let Zr=class{constructor(e,t){this.activeUserStore=e,this.eventEmitter=t}async execute({body:{userName:e}}){return await this.activeUserStore.set({userName:e}),this.eventEmitter.sendEvent("activeUserChanged",null),(0,Me.Vp)(void 0)}};Zr=Kr([Rr(S.SetActiveUserCommand),zr("design:paramtypes",[Gr,Wr])],Zr);var en=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let tn=class{};tn=en([fr({api:S.requestContextApi,handlers:{commands:{setActiveUser:Zr,setFeatureFlipsInStore:Xr},events:{},queries:{activeUser:Qr,userFeatureFlips:Yr,getCachedFeatureFlipsList:Jr}},stores:[Gr,Br],configurations:{featureFlipsConf:{token:or}},providers:[Wr]})],tn);const rn=16,nn=.5,on=1.3;function an(e){var t;const{chunkControl:{decrement:r=nn,increment:n=on,initialSize:o=rn}={decrement:nn,increment:on,initialSize:rn}}=e;const i=new Bt.WU;return(t=class{constructor(e,t){this.repository=e,this.processor=t}async dispatchBatch(e){await i.runExclusive((async()=>{const t=await this.pushItemsInQueue(e);for(;t.queue.length>0;)await this.processOneChunkFromQueue(t)}))}async pushItemsInQueue(t){const r=await this.repository.getBatchState(e.name),n=t.filter((e=>!r.queue.find((t=>t===e))));return n.length&&(r.queue.push(...n),await this.repository.setBatchState(e.name,r)),r}async processOneChunkFromQueue(t){const i=function(e){const{lastStartedChunkFirstId:t,lastStartedChunkSize:i=o}=e;if(!t)return o;const a=!e.queue.find((e=>e===t));return Math.max(1,a?Math.ceil(i*n):Math.floor(i*r))}(t),a=Math.min(i,t.queue.length);if(!a)throw new Error("Should have something to process");await this.repository.setBatchState(e.name,{...t,lastStartedChunkSize:a,lastStartedChunkFirstId:t.queue[0]});const s=t.queue.splice(0,a);await this.processor.processChunk(s),await this.repository.setBatchState(e.name,t)}}).Definition=e,t}},68224:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ActiveUserChangedEvent:()=>R,ActiveUserQuery:()=>g,CommandMessage:()=>a,EMPTY_QUERY_RESULT:()=>u,EventMessage:()=>m,FilterOperationName:()=>i,GetCachedFeatureFlipsListQuery:()=>b,PAGINATION_START_PAGE_INDEX:()=>c,QueryMessage:()=>s,SetActiveUserCommand:()=>w,SetFeatureFlipsInStoreCommand:()=>S,StartTaskTrackingCommand:()=>C,TerminateTaskTrackingCommand:()=>P,UseCaseScope:()=>o,UserFeatureFlipsQuery:()=>v,appClientMockBuilder:()=>j,defineCarbonCommand:()=>p,defineCommand:()=>d,defineEvent:()=>y,defineModuleApi:()=>h,defineQuery:()=>l,featureFlipsApi:()=>O,requestContextApi:()=>E,taskTrackingApi:()=>A});class n{}var o,i;!function(e){e.User="user",e.Device="device"}(o||(o={}));class a extends n{constructor(e){super(),this.body=e}}class s extends n{constructor(e){super(),this.body=e}}!function(e){e.Equals="equals",e.Differs="differs",e.Matches="matches",e.In="in",e.Contains="contains"}(i||(i={}));const c=1,u={items:[],itemCount:0,page:c,pageCount:1},l=(e={scope:o.User})=>{var t;return(t=class extends s{}).metadata=e,t},d=(...[e={scope:o.User}])=>{var t;return(t=class extends a{}).metadata=e,t},p=(e={scope:o.User})=>{var t;return(t=class extends a{}).metadata=e,t},f=(e,t)=>Object.entries(e).reduce(((e,[r,n])=>(e[((e,t)=>e.endsWith(t)?e.charAt(0).toLowerCase()+e.substring(1,e.length-t.length):e)(r,t)]=n,e)),{}),h=e=>({name:e.name,commands:f(e.commands,"Command"),queries:f(e.queries,"Query"),events:f(e.events,"Event"),requiredFeatureFlips:e.requiredFeatureFlips||[]});class m{constructor(e){this.body=e}}const y=(e={scope:o.User})=>{var t;return(t=class extends m{}).metadata=e,t};class g extends(l({scope:o.Device})){}class v extends(l({scope:o.Device})){}class b extends(l({scope:o.Device})){}class w extends(d({scope:o.Device})){}class S extends(d({scope:o.Device})){}class R extends(y({scope:o.Device})){}const E=h({commands:{SetActiveUserCommand:w,SetFeatureFlipsInStoreCommand:S},events:{activeUserChanged:R},name:"requestContext",queries:{ActiveUserQuery:g,UserFeatureFlipsQuery:v,GetCachedFeatureFlipsListQuery:b}}),O=h({commands:{},events:{},name:"featureFlips",queries:{}});class C extends(d({scope:o.Device})){}class P extends(d({scope:o.Device})){}const A=h({name:"taskTracking",commands:{startTaskTracking:C,terminateTaskTracking:P},events:{},queries:{}}),j=()=>{const e=new Map,t={withModule:(r,n)=>{const o="string"==typeof r?r:r.name;return e.set(o,n),t},build:()=>Array.from(e.keys()).reduce(((t,r)=>({...t,[r]:e.get(r)})),{})};return t}},11103:(e,t,r)=>{"use strict";r.d(t,{Ip:()=>v,yQ:()=>O,i3:()=>S,Dq:()=>Re,kC:()=>Bt,SW:()=>kt,ah:()=>T,_M:()=>x,qn:()=>L,nY:()=>re,iT:()=>xe,tu:()=>Ie,wB:()=>Xt,cQ:()=>fr,PM:()=>ur,QS:()=>Sr,Uy:()=>yr,lX:()=>Tt,$y:()=>yt,ft:()=>we,nr:()=>Mt,Yu:()=>a,uo:()=>Zt,Fk:()=>Rr});var n=r(68224);class o extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}class i extends((0,n.defineCommand)({scope:n.UseCaseScope.Device})){}const a=(0,n.defineModuleApi)({commands:{LogEventCommand:o,LogPageViewCommand:i},events:{},name:"analytics",queries:{}});var s=r(27606),c=r(87279),u=r(53576),l=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},d=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let p=class{constructor(e){this.cqrsClient=e}async logEvent(e){const{carbon:t}=this.cqrsClient.getClient(u.carbonLegacyApi).commands,r=await t({name:"logEvent",args:[{event:e}]});if((0,c.hx)(r))throw new Error("LogEvent from carbon failed")}async logPageView(e,t){const{carbon:r}=this.cqrsClient.getClient(u.carbonLegacyApi).commands,n=await r({name:"logPageView",args:[{pageView:e,browseComponent:t}]});if((0,c.hx)(n))throw new Error("LogPageView from carbon failed")}};p=l([(0,s.Injectable)(),d("design:paramtypes",[s.CqrsClient])],p);var f=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},h=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let m=class{constructor(e){this.analyticsService=e}async execute({body:{event:e}}){return await this.analyticsService.logEvent(e),(0,c.Vp)(void 0)}};m=f([(0,s.CommandHandler)(o),h("design:paramtypes",[p])],m);let y=class{constructor(e){this.analyticsService=e}async execute({body:{pageView:e,browseComponent:t}}){return await this.analyticsService.logPageView(e,t),(0,c.Vp)(void 0)}};y=f([(0,s.CommandHandler)(i),h("design:paramtypes",[p])],y);var g=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let v=class{};v=g([(0,s.Module)({api:a,providers:[p],handlers:{commands:{logEvent:m,logPageView:y},events:{},queries:{}}})],v);var b=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},w=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let S=class{constructor(e){this.crypto=e}};S=b([(0,s.Injectable)(),w("design:paramtypes",[Object])],S);var R=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},E=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let O=class{constructor(e){this.config=e}async derive(e,t,r){const{deriveKeyArgon2d:n}=this.config.crypto;return await n(e,t,r)}};O=R([(0,s.Injectable)(),E("design:paramtypes",[S])],O);var C=r(45059),P=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let A=class extends C.SD{};A=P([(0,s.Injectable)()],A);var j=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},_=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let T=class{constructor(e,t){this.config=e,this.derivationCache=t}decrypt(e,t){return(0,C.FO)(e,this.config.crypto,this.derivationCache,t)}};T=j([(0,s.Injectable)(),_("design:paramtypes",[S,A])],T);var I=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},D=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let x=class{constructor(e,t){this.config=e,this.derivationCache=t}async encrypt(e,t,r,n,o){return await(0,C.gi)(e,this.config.crypto,r,this.derivationCache,n,t,o)}};x=I([(0,s.Injectable)(),D("design:paramtypes",[S,A])],x);var U=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},M=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let L=class{constructor(e){this.config=e}async sign(e,t,r=C.x4){const{signHmacSha:n}=this.config.crypto;return await n(e,t,r)}};L=U([(0,s.Injectable)(),M("design:paramtypes",[S])],L);var N=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},k=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let F=class{constructor(e){this.config=e}async verify(e,t,r,n=C.x4){const{verifyHmacSha:o}=this.config.crypto;return await o(e,t,r,n)}};F=N([(0,s.Injectable)(),k("design:paramtypes",[S])],F);var V=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},q=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let G=class{constructor(e){this.config=e}generate(){const{generateKeyAes256:e}=this.config.crypto;return e()}};G=V([(0,s.Injectable)(),q("design:paramtypes",[S])],G);var B=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},H=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let W=class{constructor(e){this.config=e}encrypt(e,t){const{getRandomValues:r}=this.config.crypto,n={padding:r(C.BU.padding)};return(0,C.yL)(e,this.config.crypto,C.oo,C.BU,t,n)}};function K(){return new Uint32Array([57920321,977424202,1999259334,3390546403,3917439743,16505144,3027631148,3235565160,2643335823,1420105356,998514539,2704347781,1011257802,823882961,790991339,3929284516]).buffer}W=B([(0,s.Injectable)(),H("design:paramtypes",[S])],W);var z=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},$=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Q=class{constructor(e){this.flexibleDecryptor=e}async decrypt(e){const t=K();return await this.flexibleDecryptor.decrypt(t,e)}};Q=z([(0,s.Injectable)(),$("design:paramtypes",[T])],Q);var Y=r(89685),J=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},X=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Z=class{constructor(e){this.flexibleEncryptor=e}async encrypt(e){const t=K();return await this.flexibleEncryptor.encrypt(t,e,C.oo,C.gO)}};Z=J([(0,s.Injectable)(),X("design:paramtypes",[x])],Z);var ee=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},te=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let re=class{constructor(e,t){this.obfuscationKeyDecryptor=e,this.obfuscationKeyEncryptor=t}async encode(e){return await this.obfuscationKeyEncryptor.encrypt(e)}async decode(e){return(0,Y.v)(e).startsWith("$1$noderivation$aes256$cbchmac64$16$")?await this.obfuscationKeyDecryptor.decrypt(e):e}};re=ee([(0,s.Injectable)(),te("design:paramtypes",[Q,Z])],re);var ne=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},oe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ie=class{constructor(e){this.config=e}decrypt(e,t,r="SHA-256"){const{decryptRsaOaep:n}=this.config.crypto;return n(e,t,r)}};ie=ne([(0,s.Injectable)(),oe("design:paramtypes",[S])],ie);var ae=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},se=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ce=class{constructor(e){this.config=e}encrypt(e,t,r="SHA-256"){const{encryptRsaOaep:n}=this.config.crypto;return n(e,t,r)}};ce=ae([(0,s.Injectable)(),se("design:paramtypes",[S])],ce);var ue=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},le=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let de=class{constructor(e){this.config=e}generate(e="SHA-256"){const{generateKeyPairRsaOaep:t}=this.config.crypto;return t(e)}};de=ue([(0,s.Injectable)(),le("design:paramtypes",[S])],de);var pe=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},fe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let he=class{constructor(e){this.config=e}async sign(e,t,r="SHA-256"){const{signRsassaPkcs1:n}=this.config.crypto;return await n(e,t,r)}};he=pe([(0,s.Injectable)(),fe("design:paramtypes",[S])],he);var me=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ye=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ge=class{constructor(e){this.config=e}async compute(e,t){const{computeHash:r}=this.config.crypto;return await r(e,t)}};ge=me([(0,s.Injectable)(),ye("design:paramtypes",[S])],ge);var ve=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},be=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let we=class{constructor(e){this.config=e}compute(e){const{unsafeComputeMd5Hash:t}=this.config.crypto;return t(e)}};we=ve([(0,s.Injectable)(),be("design:paramtypes",[S])],we);var Se=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let Re=class{};Re=Se([(0,s.Module)({sharedModuleName:"cryptography",configurations:{infrastructure:{token:S}},providers:[O,A,T,x,L,F,G,W,Q,re,Z,ie,ce,de,he,ge,we],exports:[O,A,T,x,L,F,G,W,Q,re,Z,ie,ce,de,he,ge,we]})],Re);var Ee=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Oe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ce=class{constructor(e,t){this.config=e,this.derivationCache=t}decrypt(e,t){return(0,C.Jo)(e,this.config.crypto,this.derivationCache,t)}};Ce=Ee([(0,s.Injectable)(),Oe("design:paramtypes",[S,A])],Ce);var Pe=r(60399),Ae=r(48844),je=r(28489);var _e=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Te=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ie=class{constructor(e){this.cqrsClient=e}getPlatformInfo(){const{queries:{carbonState:e}}=this.cqrsClient.getClient(u.carbonLegacyApi);return(0,Pe.z)(e({path:"device.platform.info"}).pipe((0,Ae.nb)({success:e=>{if(!function(e){return!(!(e&&"object"==typeof e&&(0,je.l$)(e,"platformName")&&(0,je.l$)(e,"appVersion")&&(0,je.l$)(e,"browser")&&(0,je.l$)(e,"browserVersion")&&(0,je.l$)(e,"country")&&(0,je.l$)(e,"osCountry")&&(0,je.l$)(e,"osVersion")&&(0,je.l$)(e,"os")&&(0,je.l$)(e,"lang"))||(0,je.l$)(e,"anonymousApplicationId")&&"string"!=typeof e.anonymousApplicationId||"string"!=typeof e.platformName||"string"!=typeof e.appVersion||"string"!=typeof e.browser||"string"!=typeof e.browserVersion||"string"!=typeof e.country||"string"!=typeof e.osCountry||"string"!=typeof e.osVersion||"string"!=typeof e.os||"string"!=typeof e.lang)}(e))throw new Error("Invalid platform info received from carbon");return e},failure:()=>{throw new Error("Unexpected error")}})))}};Ie=_e([(0,s.Injectable)(),Te("design:paramtypes",[s.CqrsClient])],Ie);var De=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let xe=class{};xe=De([(0,s.Module)({providers:[Ie],exports:[Ie],sharedModuleName:"platformInfo"})],xe);var Ue=r(34987),Me=r(37182),Le=r(69885),Ne=r(14888),ke=r(87065),Fe=r(18533),Ve=r(64839),qe=r(96168);const Ge=(e,t)=>class extends((0,qe.Hu)(e,t)){constructor(e){super(),this.requestId=e}};class Be extends(Ge("BusinessError","Service responded with a business error")){constructor(e,t,r){super(t),this.code=e,this.businessMessage=r}}class He extends(Ge("RateLimited","Request was throttled by Dashlane API rate limiting setup")){}class We extends(Ge("OutOfBoundsTimestamp","Client clock is not synced with server clock")){}var Ke=r(17509),ze=r(95087),$e=r(30543);const Qe=Math.pow(10,6);var Ye=r(54066),Je=r(96303);function Xe(e){const t=function(e,t=Qe){const r=e.length;if(0===r)return"";let n="",o=0,i=Math.min(o+t,r);for(;i<=r;){const a=e.charCodeAt(i-1);if(a>=55296&&a<=56319){if(i++,i>r)throw new Error("Invalid string provided to utf8ChunkEncode");continue}const s=e.slice(o,i),c=$e.encode(s);if(n=n.concat(c),i===r)break;o=i,i=Math.min(o+t,r)}return n}(e);return(0,Ye.u)(t)}async function Ze(e,t){const r=await e.compute(Xe(t),"SHA-256");return(0,Je.k)(r)}function et(e){return e.replace(/[^A-Za-z0-9_.~\\-]/g,(e=>"%"+e.charCodeAt(0).toString(16).toUpperCase()))}function tt(e,t){return e.localeCompare(t,"en",{numeric:!0})}function rt(e){return e.map((e=>e.toLowerCase()))}class nt{constructor(e){this.secureHasher=e}async canonicalizeRequest(e,t){const{makeCanonicalBody:r,makeCanonicalURI:n,makeCanonicalQueryString:o,makeCanonicalHeadersString:i,makeSignedHeaderNamesString:a}=nt,{body:s,headers:c,method:u,url:l,params:d}=e,p=(0,Ke.getParsedUrl)(l).fullDomain,f=l.indexOf(p),h=l.substring(f+p.length),m=r(s),y=await Ze(this.secureHasher,m),g=t?rt(t):void 0,v=g?(b=rt(c.keys()),(w=g).length?b.filter((e=>!w.includes(e))):b):[];var b,w;const S=c.deleteMultiple(v),R=n(h),E=o(d),O=i(S),C=a(S);return{canonicalRequest:[u,R,E,O,C,y].join("\n"),signedHeaderNames:C}}static makeCanonicalURI(e){return function(e){return e.split("/").map((e=>et(e))).join("/")}(e)}static makeCanonicalQueryStringPair(e,t){const r=et(e),n=Array.isArray(t)?t:[t];return n.sort(tt).map((e=>{return t=(e=>et(e))(e),[r,t];var t}))}static makeCanonicalQueryString(e){return e.keys().map((t=>`${(([e,t])=>nt.makeCanonicalQueryStringPair(e,t))([t,e.getAll(t)??[]]).map((e=>e.join("="))).join("&")}`)).sort(tt).join("&")}static makeCanonicalHeadersString(e){return e.keys().map((t=>{return r=t,n=e.get(t),`${r.toLowerCase()}:${n.trim().replace(/\s+/g," ")}\n`;var r,n})).sort(tt).join("")}static makeSignedHeaderNamesString(e){return e.keys().map((e=>e.toLowerCase())).sort(tt).join(";")}static makeCanonicalBody(e){return e?JSON.stringify(e):""}}const ot="DL1-HMAC-SHA256";class it{constructor(e,t){this.hmacSigner=e,this.secureHasher=t}async signRequest(e,t,r){const n=await Ze(this.secureHasher,e),o=[ot,t,n].join("\n"),i=this.getFinalSecretKey(r),a=(0,Ye.u)(i),s=Xe(o),c=await this.hmacSigner.sign(a,s);return(0,Je.k)(c)}getFinalSecretKey(e){const{appSecretKey:t}=e;switch(e.type){case Ve.d.APP:return t;case Ve.d.USER_DEVICE:{const{deviceSecretKey:r}=e;return`${t}\n${r}`}case Ve.d.SESSION:{const{sessionSecretKey:r}=e;return`${t}\n${r}`}case Ve.d.TEAM_DEVICE:{const{teamDeviceSecretKey:r}=e;return`${t}\n${r}`}case Ve.d.EXTERNAL:{const{tokenSecretKey:r}=e;return`${t}\n${r}`}case Ve.d.BACK_OFFICE:return t;default:(0,ze.U)(e)}}}class at{constructor(e,t,r){this.signatureService=new it(t,e),this.canonicalizationService=new nt(e),this.clockDriftService=r}async prepareRequestForAuthorization(e,t){if(t.type===Ve.d.CUSTOM)throw new Error("Unexpected credentials type provided to standard auth method");const r=this.addHostHeader(e),{canonicalRequest:n,signedHeaderNames:o}=await this.canonicalizationService.canonicalizeRequest(r),i=await this.clockDriftService.getDriftCorrectedTimestamp(),a=await this.signatureService.signRequest(n,i,t),s=this.buildAuthorizationHeader(t,i,o,a);return this.addAuthorizationHeader(e,s)}addHostHeader(e){const t=(0,Ke.extractFullDomain)(e.url),r=e.headers.append("host",t);return e.clone({headers:r})}addAuthorizationHeader(e,t){const r=e.headers.append("authorization",t);return e.clone({headers:r})}buildAuthorizationHeader(e,t,r,n){const{appAccessKey:o}=e;switch(e.type){case Ve.d.APP:return ot+" "+[`AppAccessKey=${o}`,`Timestamp=${t}`,`SignedHeaders=${r}`,`Signature=${n}`].join(",");case Ve.d.USER_DEVICE:{const{login:i,deviceAccessKey:a}=e;return ot+" "+[`Login=${i}`,`AppAccessKey=${o}`,`DeviceAccessKey=${a}`,`Timestamp=${t}`,`SignedHeaders=${r}`,`Signature=${n}`].join(",")}case Ve.d.SESSION:{const{deviceAccessKey:i,login:a,sessionAccessKey:s}=e;return ot+" "+[`Login=${a}`,`AppAccessKey=${o}`,`SessionAccessKey=${s}`,`DeviceAccessKey=${i}`,`Timestamp=${t}`,`SignedHeaders=${r}`,`Signature=${n}`].join(",")}case Ve.d.TEAM_DEVICE:{const{teamDeviceAccessKey:i,teamUuid:a}=e;return ot+" "+[`TeamUuid=${a}`,`AppAccessKey=${o}`,`DeviceAccessKey=${i}`,`Timestamp=${t}`,`SignedHeaders=${r}`,`Signature=${n}`].join(",")}case Ve.d.BACK_OFFICE:return ot+" "+["Backoffice",`AppAccessKey=${o}`,`Timestamp=${t}`,`SignedHeaders=${r}`,`Signature=${n}`].join(",");case Ve.d.EXTERNAL:{const{tokenAccessKey:i}=e;return ot+" "+[`AppAccessKey=${o}`,`TokenAccessKey=${i}`,`Timestamp=${t}`,`SignedHeaders=${r}`,`Signature=${n}`].join(",")}default:(0,ze.U)(e)}}}class st{constructor(e){this.descriptor=e}decode(e){return e}}class ct{constructor(e){this.descriptor=e}decode(e){return e}}class ut{constructor(e,t,r,n,o,i){this.initHttpRequest=e=>{const{method:t,path:r,version:n}=this.descriptor,{baseUrl:o,platformInfo:i}=this.config,a=`${o.endsWith("/")?o:`${o}/`}${n}/${r}`,s=new C.WM({accept:this.descriptor.requestAcceptHeader??"application/json","content-type":"application/json; charset=UTF-8","dashlane-client-agent":JSON.stringify({platform:i.platformName,version:i.version,osversion:i.osversion,language:i.language})});return new C.aW(t,a,e,{headers:s})},this.prepareRequestForAuthorization=e=>async t=>{if(this.descriptor.authType===Ve.d.NONE)return t;let r;if(this.descriptor.authType===Ve.d.CUSTOM){r=new(this.getCustomAuthPreparationClass())}else r=this.standardAuthPreparationService;const n=this.getSigningCredentials(this.descriptor.authType,e);return await r.prepareRequestForAuthorization(t,n)},this.sendHttpRequest=e=>this.httpClient.request(e),this.handleSuccess=async e=>{if("arraybuffer"===this.descriptor.responseType)return(0,c.Vp)(await e.arrayBuffer());if("text"===this.descriptor.responseType)return(0,c.Vp)(await e.text());const t=await e.json(this.successBodyDecoder);return(0,c.Vp)(t)},this.handleFailure=async e=>await(0,Fe.EQ)(e,{BadStatus:this.handleBadStatus,NetworkError:e=>Promise.resolve((0,c.Rn)(e)),TimedOut:e=>Promise.resolve((0,c.Rn)(e))}),this.handleBadStatus=async e=>{const{response:t}=e;if(t.status===C.WE.BadRequest){const{errors:[e],requestId:r}=await t.json(this.failureBodyDecoder);if("business_error"===e.type){const{code:t,message:n}=e;return(0,c.Rn)(new Be(t,r,n))}if("invalid_request_error"===e.type&&"out_of_bounds_timestamp"===e.code)throw new We(r)}throw e},this.notifyWhenClockDriftErrorCompensated=e=>{if(!(e instanceof We))throw e;return this.clockDriftService.refresh().pipe((0,Me.K)((()=>{throw e})))},this.httpClient=e,this.standardAuthPreparationService=new at(t,r,n),this.clockDriftService=n,this.config=o,this.descriptor=i,this.successBodyDecoder=new st(i),this.failureBodyDecoder=new ct(i)}executeRequest(e){const{body:t=null,credentials:r}=e;return(0,Le.of)(this.initHttpRequest(t)).pipe((0,Ue.b)(this.prepareRequestForAuthorization(r)),(0,Ue.b)(this.sendHttpRequest),(0,Ae.RW)({success:this.handleSuccess,failure:this.handleFailure}),(0,ke.U)(this.assertReturnType),(0,Ne.X)({count:1,delay:this.notifyWhenClockDriftErrorCompensated}))}getCustomAuthPreparationClass(){throw new Error("Unsupported custom authorization level")}getSigningCredentials(e,t){if(e===Ve.d.APP||e===Ve.d.BACK_OFFICE){if(t)throw new Error("Superfluous credentials provided");return{type:e,...this.config.appKeys}}if(e===Ve.d.SESSION){if(!t||!function(e){return"object"==typeof e&&"login"in e&&"string"==typeof e.login&&"deviceAccessKey"in e&&"string"==typeof e.deviceAccessKey&&"sessionAccessKey"in e&&"string"==typeof e.sessionAccessKey&&"sessionSecretKey"in e&&"string"==typeof e.sessionSecretKey}(t))throw new Error("Invalid session credentials provided");return{type:e,...this.config.appKeys,...t}}if(e===Ve.d.TEAM_DEVICE){if(!t||!function(e){return"object"==typeof e&&"teamUuid"in e&&"string"==typeof e.teamUuid&&"teamDeviceAccessKey"in e&&"string"==typeof e.teamDeviceAccessKey&&"teamDeviceSecretKey"in e&&"string"==typeof e.teamDeviceSecretKey}(t))throw new Error("Invalid team device credentials provided");return{type:e,...this.config.appKeys,...t}}if(e===Ve.d.USER_DEVICE){if(!t||!function(e){return"object"==typeof e&&"login"in e&&"string"==typeof e.login&&"deviceAccessKey"in e&&"string"==typeof e.deviceAccessKey&&"deviceSecretKey"in e&&"string"==typeof e.deviceSecretKey}(t))throw new Error("Invalid user device credentials provided");return{type:e,...this.config.appKeys,...t}}if(e===Ve.d.EXTERNAL){if(!t||!function(e){return"object"==typeof e&&"tokenAccessKey"in e&&"string"==typeof e.tokenAccessKey&&"tokenSecretKey"in e&&"string"==typeof e.tokenSecretKey}(t))throw new Error("Invalid external credentials provided");return{type:e,...this.config.appKeys,...t}}return{type:e,...t??{},...this.config.appKeys}}assertReturnType(e){return e}}class lt{constructor(e,t,r,n,o){this.httpClient=e,this.clockDriftService=n,this.secureHasher=t,this.hmacSigner=r,this.config=o}createExecutor(e){return new ut(this.httpClient,this.secureHasher,this.hmacSigner,this.clockDriftService,this.config,e)}}class dt{constructor(e,t){this.timeSyncStore=e,this.serverClockService=t}async getDriftCorrectedTimestamp(){const e=await this.timeSyncStore.getServerToClientClockDrift()??0;return Math.round(this.getUnixTimestamp()-e)}refresh(){return this.serverClockService.getServerTime().pipe((0,ke.U)(this.mapServerTimestampToClockDrift),(0,Ue.b)(this.storeUpdatedClockDrift))}mapServerTimestampToClockDrift(e){const{timestamp:t}=e;return this.getUnixTimestamp()-t}async storeUpdatedClockDrift(e){await this.timeSyncStore.storeServerToClientClockDrift(e)}getUnixTimestamp(){return Math.round(Date.now()/1e3)}}var pt=r(73873);class ft{getServerTime(){if(!this.executorFactory)throw new Error("No request executor factory");return new pt.q(this.executorFactory).getRemoteTime({}).pipe((0,Ae.nb)({success:e=>({timestamp:e.data.timestamp}),failure:e=>{throw e}}))}setExecutorFactory(e){this.executorFactory=e}}var ht=r(1774);class mt{constructor(e){this.store=e}async getServerToClientClockDrift(){const{drift:e}=await this.store.getState();return e}storeServerToClientClockDrift(e){return this.store.update((()=>({drift:e})))}}class yt{constructor(e){this.baseUrl=e.baseUrl,this.appKeys=e.appKeys}}class gt{}const vt={drift:null},bt=e=>!(!e||"object"!=typeof e||!(0,je.l$)(e,"drift"))&&(!e.drift||"number"==typeof e.drift);class wt extends((0,s.defineStore)({storeTypeGuard:bt,storeName:"ClockSyncStore",scope:n.UseCaseScope.Device,initialValue:vt,isCache:!1,persist:!1,capacity:s.StoreCapacity._001KB})){}const St={v1:{accountrecovery:ht.uF,authentication:ht.Vy,darkwebmonitoring:ht.Dw,features:ht.AN,file:ht.$B,pwleak:ht.JM,sharingUserdevice:ht.bo,teams:ht.pd,time:ht.qp,useractivity:ht.Vk}};var Rt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Et=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ot=class{constructor(e,t,r,n,o,i){this.serverApiConfig=e,this.httpClient=t,this.store=r,this.hmacSigner=n,this.secureHasher=o,this.platformInfoService=i}async init(){const{serverApiConfig:e,secureHasher:t,httpClient:r,hmacSigner:n,store:o}=this,i=new mt(o),a=await this.platformInfoService.getPlatformInfo(),{appKeys:s,baseUrl:c}=e;this.rawSdk=function(e){const{apis:t,config:r,secureHasher:n,httpClient:o,hmacSigner:i,timeSyncStore:a}=e,s=new ft,c=new dt(a,s),u=new lt(o,n,i,c,r);s.setExecutorFactory(u);const l=Object.keys(t.v1);return{refreshClockDrift:c.refresh,v1:l.reduce(((e,r)=>{const n=t.v1[r];return e[r]=new n(u),e}),{})}}({secureHasher:t,httpClient:r,timeSyncStore:i,hmacSigner:n,apis:St,config:{appKeys:s,baseUrl:c,platformInfo:{platformName:a.platformName,version:a.appVersion,osversion:a.osVersion,language:a.lang}}})}get sdk(){if(!this.rawSdk)throw new Error("ConfiguredServerSdk not initialized");return this.rawSdk}};Ot=Rt([(0,s.Injectable)(),Et("design:paramtypes",[yt,s.HttpClient,wt,L,ge,Ie])],Ot);var Ct=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Pt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let At=class{constructor(e,t){this.cqrsClient=e,this.infra=t}getActiveUserDeviceCredentials(){const{queries:{activeUser:e}}=this.cqrsClient.getClient(n.requestContextApi);return e().pipe((0,ke.U)((e=>{if((0,c.d6)(e))return(0,c.db)(e);throw new Error("Failed to get active user")})),(0,Ue.b)((({userName:e})=>{if(!e)throw new Error("No active user available");return this.infra.getDeviceCredentialsForUser(e)})))}};At=Ct([(0,s.Injectable)(),Pt("design:paramtypes",[s.CqrsClient,gt])],At);var jt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},_t=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Tt=class{constructor(e,t){this.appliedV1Services=this.buildInjectedServices("v1",e.sdk),this.credentialsService=t}get v1(){return this.appliedV1Services}buildInjectedServices(e,t){return Object.keys(t[e]).reduce(((r,n)=>({...r,[n]:this.buildInjectedApiServices(e,t,n)})),{})}buildInjectedApiServices(e,t,r){return Object.getOwnPropertyNames(Object.getPrototypeOf(t.v1[r])).filter((e=>"constructor"!==e)).reduce(((n,o)=>({...n,[o]:this.buildInjectedRouteService(t,e,r,o)})),{})}buildInjectedRouteService(e,t,r,n){const o=ht.tA[r][n];if(!o)throw new Error("Unable to find endpoint descriptor");const{authType:i}=o;return(...o)=>{const a=e[t][r],s=a[n].bind(a);if(i===Ve.d.USER_DEVICE)return this.credentialsService.getActiveUserDeviceCredentials().pipe((0,Ue.b)((e=>s(e,...o))));if([Ve.d.NONE,Ve.d.APP].includes(i))return s(...o);throw new Error("Not supported")}}};Tt=jt([(0,s.Injectable)(),_t("design:paramtypes",[Ot,At])],Tt);var It=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Dt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let xt=class{constructor(e){this.configuredServerSdk=e}get v1(){return this.configuredServerSdk.sdk.v1}};xt=It([(0,s.Injectable)(),Dt("design:paramtypes",[Ot])],xt);var Ut=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let Mt=class{};Mt=Ut([(0,s.Module)({providers:[xt,Tt,At,{token:Ot,asyncFactory:async(e,t,r,n,o,i)=>{const a=new Ot(e,t,r,n,o,i);return await a.init(),a},inject:[yt,s.HttpClient,wt,L,ge,Ie]}],exports:[xt,Tt],configurations:{serverApi:{token:yt},serverApiInfrastructure:{token:gt}},stores:[wt],sharedModuleName:"webServices",imports:[Re,s.HttpModule,xe]})],Mt);var Lt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Nt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let kt=class extends s.FeatureFlipsServiceAbstract{constructor(e){super(),this.serverApiClient=e}getFeatureFlipsForActiveUser(e){return(0,Pe.z)(this.serverApiClient.v1.features.getAndEvaluateForUser({features:e}).pipe((0,Ae.nb)({success:t=>{const r=new Set(t.data.enabledFeatures);return e.reduce(((e,t)=>({...e,[t]:r.has(t)})),{})},failure:()=>({})})))}cleanOutDeletedFeatureFlips(e){return(0,Pe.z)(this.serverApiClient.v1.features.listAvailableFeatureFlips({}).pipe((0,Ae.nb)({success:t=>{const r=Object.fromEntries(t.data.features.map((e=>[e.name,e.archived])));return Array.from(e.reduce(((e,t)=>(t in r&&e.add(t),e)),new Set))},failure:()=>e})))}};kt=Lt([(0,s.Injectable)(),Nt("design:paramtypes",[Tt])],kt);var Ft=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Vt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let qt=class{constructor(e,t,r){this.getCachedFeatureFlipsList=async()=>{const e=await(0,Pe.z)(this.requestContextApi.queries.getCachedFeatureFlipsList());return(0,c.d6)(e)?e.data.cachedFeatureFlips:[]},this.featureFlipsService=e,this.requestContextApi=t.getClient(n.requestContextApi),this.requestContext=r}async handle(){const e=this.requestContext.requiredFeatureFlips??[],t=await this.getCachedFeatureFlipsList(),r=await this.featureFlipsService.cleanOutDeletedFeatureFlips([...e,...t]),n={...await this.featureFlipsService.getFeatureFlipsForActiveUser(r)};return await this.requestContextApi.commands.setFeatureFlipsInStore({featureFlips:n}),Promise.resolve()}};qt=Ft([(0,s.EventHandler)(n.ActiveUserChangedEvent),Vt("design:paramtypes",[kt,s.ContextLessCqrsClient,s.RequestContext])],qt);var Gt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let Bt=class{};Bt=Gt([(0,s.Module)({api:n.featureFlipsApi,providers:[kt],imports:[Mt],exports:[kt],handlers:{commands:{},queries:{},events:{...(0,s.useEventsOfModule)(n.requestContextApi,{activeUserChanged:qt})}}})],Bt);var Ht=r(25859),Wt=r(6220),Kt=r(30523),zt=r(7537),$t=r(58376),Qt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},Yt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Jt=class{constructor(){this.filesToCheck={},this.publishSubscriber=new zt.t,this.updatedFileStream$=new $t.y((e=>{this.publishSubscriber.next(e),this.publishSubscriber.complete()}))}publish(e){(0,Pe.z)(this.publishSubscriber).then((t=>t.next(e)))}fileSubscription(e){return this.filesToCheck={...this.filesToCheck,...e},this.updatedFileStream$}getFilesToCheck(){return this.filesToCheck}};Jt=Qt([(0,s.Injectable)(),Yt("design:paramtypes",[])],Jt);class Xt{constructor(e,t,r,n){this.settings=e,this.store=t,this.appLogger=r,this.rfuDispatcher=n;const{fileName:o}=e;this.jsonSerializerCodec=new C.bL,this.newlyUpdatedFiles$=(0,Ht.P)((async()=>{const e=(await this.store.getState()).fileNameToRevision[o];return{[o]:e.revision}})).pipe((0,Wt.z)((e=>this.rfuDispatcher.fileSubscription(e))))}initFileObservation(){this.newlyUpdatedFiles$.subscribe(this._handleRFUDownload.bind(this))}streamFileUpdate(){return this.store.state$.pipe((0,ke.U)((e=>e.data)),(0,Kt.h)((e=>this.settings.typeguard(e))))}async _handleRFUDownload(e){const{fileName:t}=this.settings;if(!(t in e))return;const r=await this.store.getState(),n=r.fileNameToRevision[t],o=e[t],i=this.jsonSerializerCodec.decode(o.buffer);this.settings.typeguard(i)&&(await this.store.set({fileNameToRevision:{...r.fileNameToRevision,[t]:{...n,buffer:o.buffer,revision:o.revision,lastDownloadTimestamp:o.lastDownloadTimestamp}},data:i}),this.rfuDispatcher.fileSubscription({[t]:o.revision}))}_isRevisionNumberUpdated(e,t){const{fileName:r}=this.settings,n=e.fileNameToRevision[r],o=t.fileNameToRevision[r];return n.revision===o.revision}}function Zt(e){return{token:Xt,asyncFactory:(t,r,n)=>Promise.resolve(new Xt(e,t,r,n)),inject:[e.storeClass,s.AppLogger,Jt]}}var er=r(10203);class tr{}class rr{}class nr{}const or="update_available",ir=new Set([or,"not_updated","not_found","error_server"]);var ar=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},sr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const cr=e=>e[1].status===or;let ur=class extends tr{constructor(e,t){super(),this.httpClient=e,this.serverApiClient=t}async downloadRemoteFileUpdate(e){const t=await this._getFileMeta(e);return(0,c.hx)(t)?[(0,Le.of)(t)]:this._retrieveFilesFromServer((0,c.db)(t))}_getFileMeta(e){return(0,Pe.z)(this.serverApiClient.v1.file.getFileMeta(e).pipe((0,ke.U)((e=>{if((0,c.hx)(e))return(0,c.Rn)(er.RemoteFileUpdateError.ServerError);const t=(0,c.db)(e);return r=t.data,Object.values(r).every((e=>"object"==typeof e&&void 0!==e.status&&ir.has(e.status)))?(0,c.Vp)(t.data):(0,c.Rn)(er.RemoteFileUpdateError.ServerError);var r}))))}_retrieveFilesFromServer(e){return Object.entries(e).filter(cr).map((([e,t])=>this._getBufferFromURL(e,t)))}_getBufferFromURL(e,t){return this.httpClient.get(t.url,{observe:"body",responseType:"arraybuffer"}).pipe((0,ke.U)((r=>(0,c.d6)(r)?(0,c.Vp)({fileName:e,buffer:(0,c.db)(r),updatedFile:t}):(0,c.Rn)(er.RemoteFileUpdateError.DownloadError))))}};ur=ar([(0,s.Injectable)(),sr("design:paramtypes",[s.HttpClient,Tt])],ur);var lr=r(91501),dr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},pr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let fr=class extends rr{constructor(e,t){super(),this.cqrsClient=e,this.appLogger=t}async decipher(e,t){const{carbon:r}=this.cqrsClient.getClient(u.carbonLegacyApi).commands,n=await r({name:"decipherRemoteFile",args:[{cipheredFileContent:e,fileMetaData:t}]});if((0,c.hx)(n))return(0,c.Rn)(er.RemoteFileUpdateError.DecipherError);const{carbonResult:o}=(0,c.db)(n);return(e=>"object"==typeof e&&null!==e&&Object.entries(e).some((([e,t])=>"decipheredFile"===e&&t instanceof ArrayBuffer)))(o)?(0,c.Vp)(o.decipheredFile):(0,c.Rn)(er.RemoteFileUpdateError.DecipherError)}};fr=dr([(0,s.Injectable)(),pr("design:paramtypes",[s.CqrsClient,s.AppLogger])],fr);var hr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},mr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let yr=class extends nr{constructor(e,t,r){super(),this.appLogger=e,this.rfuDownloaderService=t,this.rfuDecipheringService=r,this._filesToCheck={},this._emitDownloadedFilesUpdate$=new zt.t,this._downloadedFileStream$=new $t.y((e=>{this._emitDownloadedFilesUpdate$.next((t=>{e.next(t)})),this._emitDownloadedFilesUpdate$.complete()}))}observeRemoteFileUpdates(e){return this._filesToCheck={...this._filesToCheck,...e},this._downloadedFileStream$}async downloadAndDecipherRemoteFiles(){const e=(await this.rfuDownloaderService.downloadRemoteFileUpdate(this._filesToCheck)).map((e=>this._downloadAndDecipherSingleFile(e)));(0,lr.D)(e).subscribe((e=>{const t=e.reduce(((e,t)=>{if((0,c.hx)(t))return this._logRemoteFileUpdateError(t),e;const r=(0,c.db)(t);return{...e,[r.fileName]:r}}),{});this._callEmitDownloadedFilesUpdate(t)}))}async _applyDecipheringStep(e){const t=e.updatedFile.key?await this.rfuDecipheringService.decipher(e.buffer,e.updatedFile):(0,c.Vp)(e.buffer);return(0,c.d6)(t)?(0,c.Vp)({...e,buffer:(0,c.db)(t)}):t}_downloadAndDecipherSingleFile(e){return e.pipe((0,Wt.z)((e=>(0,c.d6)(e)?this._applyDecipheringStep((0,c.db)(e)):Promise.resolve(e))),(0,ke.U)((e=>{if((0,c.hx)(e))return e;const{fileName:t,updatedFile:r,buffer:n}=(0,c.db)(e);return(0,c.Vp)({fileName:t,revision:r.revision,buffer:n,lastDownloadTimestamp:Date.now()})})))}_callEmitDownloadedFilesUpdate(e){return(0,Pe.z)(this._emitDownloadedFilesUpdate$).then((t=>{t(e)}))}_logRemoteFileUpdateError(e){this.appLogger.error("[RFU] An error has occured: ",(0,c.Yv)(e))}};yr=hr([(0,s.Injectable)(),mr("design:paramtypes",[s.AppLogger,ur,fr])],yr);var gr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},vr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let br=class{constructor(e,t,r,n){this.appLogger=e,this.featureFlipService=t,this.remoteFileUpdateService=r,this.dispatcherService=n}async run(){if(!(await this.featureFlipService.getFeatureFlipsForActiveUser(["coreAnalysis_web_rfuInGraphene_dev"])).coreAnalysis_web_rfuInGraphene_dev)return;const e=this.dispatcherService.getFilesToCheck();this.remoteFileUpdateService.observeRemoteFileUpdates(e).subscribe((e=>{this.dispatcherService.publish(e)})),this.remoteFileUpdateService.downloadAndDecipherRemoteFiles()}};br=gr([(0,s.Injectable)(),vr("design:paramtypes",[s.AppLogger,kt,yr,Jt])],br);var wr=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};let Sr=class{};Sr=wr([(0,s.Module)({sharedModuleName:"RemoteFileUpdateModule",configurations:{remoteFileUpdateInfrastructure:{token:nr},remoteFileUpdateDownloaderInfrastructure:{token:tr},decipherInfrastructure:{token:rr}},crons:[{handler:br,periodInMinutes:1,name:"cron",scope:n.UseCaseScope.User}],providers:[yr,fr,ur,Jt],imports:[Bt,s.HttpModule,Mt],exports:[yr,fr,ur,Jt],requiredFeatureFlips:["coreAnalysis_web_rfuInGraphene_dev"]})],Sr);const Rr=e=>!("object"!=typeof e||null===e)&&("fileNameToRevision"in e&&null!==e.fileNameToRevision&&void 0!==e.fileNameToRevision&&Object.values(e.fileNameToRevision).every((e=>(e=>{if("object"!=typeof e||null===e)return!1;const t="revision"in e&&"number"==typeof e.revision,r="lastDownloadTimestamp"in e&&"number"==typeof e.lastDownloadTimestamp,n="fileName"in e&&"string"==typeof e.fileName;return t&&r&&n&&"buffer"in e})(e))))},89685:(e,t,r)=>{"use strict";r.d(t,{b:()=>o,v:()=>i});const n=Math.pow(2,14)-1;function o(e){const t=new Uint16Array(e),r=t.length;let o="",i=n;for(let e=0;e<r;e+=i){e+i>r&&(i=r-e);const n=t.subarray(e,e+i);o+=String.fromCharCode(...n)}return o}function i(e){return o(new Uint8Array(e))}},7502:(e,t,r)=>{"use strict";r.d(t,{R:()=>i});var n=r(46041);const o=new Uint8Array(256);for(let e=0;e<n.U.length;e++)o[n.U.charCodeAt(e)]=e;function i(e){let t=.75*e.length;const r=e.length;let n,i,a,s,c,u=0;e.endsWith("=")&&(t--,"="===e[e.length-2]&&t--);const l=new ArrayBuffer(t),d=new Uint8Array(l);for(n=0;n<r;n+=4)i=o[e.charCodeAt(n)],a=o[e.charCodeAt(n+1)],s=o[e.charCodeAt(n+2)],c=o[e.charCodeAt(n+3)],d[u++]=i<<2|a>>4,d[u++]=(15&a)<<4|s>>2,d[u++]=(3&s)<<6|63&c;return l}},96303:(e,t,r)=>{"use strict";function n(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")}r.d(t,{k:()=>n})},46041:(e,t,r)=>{"use strict";r.d(t,{U:()=>o,V:()=>n});const n=Math.pow(10,6),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"},54066:(e,t,r)=>{"use strict";function n(e){const t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let t=0;t<e.length;++t)r[t]=e.charCodeAt(t);return t}r.d(t,{u:()=>n})},82991:(e,t,r)=>{"use strict";r.r(t),r.d(t,{BrowserCronSource:()=>tt,BrowserPortConnector:()=>bt,BrowserPortListener:()=>yt,BrowserPortListenerChannel:()=>Rt,ExtensionCronSource:()=>ct,ExtensionLocalStorageInfrastructure:()=>Xe,HttpFetchBackend:()=>B,IndexDbKeyValueStorage:()=>et,IndexDbStorage:()=>Ze,JsonExtensionResourceFetcher:()=>a,JsonWebAppResourceFetcher:()=>o,PageToWorkerChannel:()=>pt,computeHash:()=>p,cookieRemoveByDomain:()=>ue,decryptAes256:()=>m,decryptAesEcb256:()=>g,decryptRsaOaep:()=>v,deriveKeyArgon2d:()=>S,deriveKeyPbkdf2:()=>R,disableBrowserNativeAutofill:()=>ee,enablePrivacyService:()=>Z,encryptAes256:()=>E,encryptRsaOaep:()=>O,generateKeyAes256:()=>C,generateKeyPairRsaOaep:()=>A,getLanguage:()=>$,getRandomValues:()=>j,getShortcutValues:()=>we,isMv3Environment:()=>ut,makeStoreInfrastructure:()=>Qe,signHmacSha:()=>T,signRsassaPkcs1:()=>I,storageLocalItemExists:()=>Ee,unsafeComputeMd5Hash:()=>U,updateToolbarIcon:()=>ie,verifyHmacSha:()=>M,verifyRsassaPkcs1:()=>L,webappClose:()=>Me,webappOpen:()=>xe});var n=r(27606);class o extends n.JsonApplicationResourceFetcher{constructor(e){super(),this.publicPath=e}async fetch(e){return(await fetch(new URL(e.replace(/^\/*/,""),this.publicPath).href)).json()}}var i=r(92204);class a extends n.JsonApplicationResourceFetcher{async fetch(e){const t=(0,i.A)(e);return(await fetch(t)).json()}}var s=r(34064),c=r.n(s),u=r(96785);function l(e){const t=new Uint8Array(e),r=[];for(let e=0;e<t.byteLength;e++)r[e>>>2]|=t[e]<<24-e%4*8;return u.lib.WordArray.create(r,t.byteLength)}function d(e){const{sigBytes:t,words:r}=e,n=new Uint8Array(t);let o=0,i=0;for(;o!==t;){const e=r[i++];if(n[o++]=(4278190080&e)>>>24,o===t)break;if(n[o++]=(16711680&e)>>>16,o===t)break;if(n[o++]=(65280&e)>>>8,o===t)break;n[o++]=255&e}return n.buffer}function p(e,t){if(self.crypto.subtle)return self.crypto.subtle.digest({name:t},e);if("SHA-1"===t){const t=l(e),r=d(c()(t));return Promise.resolve(r)}return Promise.reject(new Error("Unsupported hash method"))}var f=r(45059);function h(e){return self.crypto.subtle.importKey("raw",e,f.zW,!1,["encrypt","decrypt"])}async function m(e,t,r){const n=await h(e);return self.crypto.subtle.decrypt({name:f.zW,iv:t},n,r)}var y=r(89685);function g(e,t){const r=(0,y.v)(t),n=l(e);return d(CryptoJS.AES.decrypt(r,n,{mode:CryptoJS.mode.ECB}))}async function v(e,t,r){const n={name:f.$k,hash:{name:r}},o=await self.crypto.subtle.importKey("pkcs8",e,n,!1,["decrypt"]);return self.crypto.subtle.decrypt(n,o,t)}var b=r(35558),w=r.n(b);async function S(e,t,r){const{tCost:n,mCost:o,parallelism:i}=r,{hash:a}=await w().hash({pass:new Uint8Array(e),salt:new Uint8Array(t),time:n,mem:o,hashLen:32,parallelism:i,type:b.ArgonType.Argon2d});return a.buffer}async function R(e,t,r){const n=await self.crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveKey"]),o={name:f.zW,length:256},{iterations:i,hashType:a}=r,s={name:"PBKDF2",salt:t,iterations:i,hash:{name:a}},c=await self.crypto.subtle.deriveKey(s,n,o,!0,["encrypt","decrypt"]);return self.crypto.subtle.exportKey("raw",c)}async function E(e,t,r){const n=await h(e);return self.crypto.subtle.encrypt({name:f.zW,iv:t},n,r)}async function O(e,t,r){const n={name:f.$k,hash:{name:r}},o=await self.crypto.subtle.importKey("spki",e,n,!1,["encrypt"]);return self.crypto.subtle.encrypt(n,o,t)}async function C(){const e=await self.crypto.subtle.generateKey({name:f.zW,length:f.N2},!0,["encrypt","decrypt"]);return self.crypto.subtle.exportKey("raw",e)}const P=new Uint8Array([1,0,1]);async function A(e){const t=await self.crypto.subtle.generateKey({name:f.$k,modulusLength:2048,publicExponent:P,hash:{name:e}},!0,["encrypt","decrypt"]),{privateKey:r,publicKey:n}=t;return{privateKey:await self.crypto.subtle.exportKey("pkcs8",r),publicKey:await self.crypto.subtle.exportKey("spki",n)}}function j(e){const t=new Uint8Array(e);return self.crypto.getRandomValues(t)}function _(e,t){return self.crypto.subtle.importKey("raw",e,{name:"HMAC",hash:{name:t}},!0,["sign","verify"])}async function T(e,t,r=f.x4){const n=await _(e,r);return self.crypto.subtle.sign({name:"HMAC",hash:{name:r}},n,t)}async function I(e,t,r){const n={name:f.xJ,hash:{name:r}},o=await self.crypto.subtle.importKey("pkcs8",e,n,!1,["sign"]);return self.crypto.subtle.sign(n,o,t)}var D=r(81968),x=r.n(D);function U(e){const t=l(e);return d(x()(t))}async function M(e,t,r,n=f.x4){const o=await _(e,n);return self.crypto.subtle.verify({name:"HMAC",hash:{name:n}},o,t,r)}async function L(e,t,r,n){const o={name:f.xJ,hash:{name:n}},i=await self.crypto.subtle.importKey("spki",e,o,!1,["verify"]);return self.crypto.subtle.verify(o,i,t,r)}var N=r(87065),k=r(93192),F=r(90171),V=r(47968),q=r(51992),G=r(87279);class B{constructor(){this.toHttpResult=e=>e.ok?(0,G.Vp)(e):(0,G.Rn)(new f.RV(e)),this.toHttpResponse=e=>new f.Zn({body:e.body,url:e.url,status:e.status,statusText:e.statusText,headers:this.mapToHttpHeaders(e.headers)})}handle(e){const t=this.getTimeout$(e.timeout),r=this.doFetch(e).pipe((0,N.U)(this.toHttpResponse),(0,N.U)(this.toHttpResult));return(0,k.S)(t,r)}getTimeout$(e){return e?(0,F.H)(e).pipe((0,N.U)((()=>(0,G.Rn)(new f.PL)))):V.C}doFetch(e){return(0,q.U)(e.url,{method:e.method,body:e.serializeBody(),headers:this.getHeaders(e),credentials:e.withCredentials?"include":"omit",mode:e.mode})}mapToHttpHeaders(e){const t=new f.WM;return e.forEach(((e,r)=>t.set(r,e))),t}getHeaders(e){return e.headers.keys().reduce(((t,r)=>({...t,[r]:e.headers.get(r)})),{})}}const H=new Set(["en","fr","es","ja","de","pt","it","ko","zh","nl","sv"]),W="en";function K(e){return e.substr(0,2)}function z(e){const t=K(e);return H.has(t)}function $(){const e=[navigator.language].concat(navigator.languages).find(z);if(!e)return W;if(!e.includes("-"))return e;return K(e)}var Q=r(30754),Y=r(82324),J=r(81805);const X=" ";async function Z(e,t){try{const{levelOfControl:t}=await(0,Q.U)(e);if("controllable_by_this_extension"!==t&&"controlled_by_this_extension"!==t){const r=[`Impossible to change browser setting: ${e}.`,`Extension prevented from changing: ${t}`].join(X);throw new Error(r)}}catch(t){if((0,Y.b)(t)){throw new Error(`Browser setting not supported: ${e}`)}if((0,Y.I)(t))throw t.runtimeError;throw t}try{await(0,J.t)(e,t)}catch(e){throw(0,Y.I)(e)?e.runtimeError:e}}async function ee(){const e=["autofillAddressEnabled","autofillCreditCardEnabled","passwordSavingEnabled"].map((e=>Z(e,!1)));await Promise.all(e)}var te=r(84318),re=r(16241);const ne={nightly:"icon_nightly_auth",mv2:"icon_auth",mv3:"icon_mv3_auth"},oe="icon_not_auth";async function ie({isUserAuthenticated:e}){const t=`icons/action/${e?function(){const e=(0,te.W)();return e.name.includes("Nightly")?ne.nightly:e.name.includes("Beta")||3===e.manifest_version?ne.mv3:ne.mv2}():oe}`,r={16:`${t}.png`,32:`${t}@2x.png`};await(0,re.B)(r)}var ae=r(329),se=r(98641);function ce(e){return`${"http"+(e.secure?"s":"")}://${e.domain.startsWith(".")?e.domain.substring(1):e.domain}${e.path}`}async function ue(e){const t=await(0,ae.g)({domain:e});return Promise.all(t.map((e=>(0,se.O)({url:ce(e),name:e.name}))))}var le=r(57323),de=r(839);const pe=/^_execute(_browser){0,1}_action$/,fe="+";var he;function me(e){return pe.test(e.name??"")}function ye(e){const t=e.toUpperCase();switch(t){case"":case"CTRL":return le.os.isMacOS()?he.Command:he.Ctrl;case"SHIFT":case"":return he.Shift;case"COMMAND":case"":return he.Command;case"MACCTRL":return he.MacCtrl;default:return t}}function ge(e){const t=Object.values(he),r=t.indexOf(e);return-1===r?t.length:r}function ve(e,t){return ge(e)-ge(t)}function be(e){switch(e){case he.Ctrl:case he.MacCtrl:return"Ctrl";case he.Shift:return"";case he.Command:return"";default:return e}}async function we(){const e=await new Promise(((e,t)=>{(0,de.Ez)("commands.getAll")?chrome.commands.getAll((r=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",r=new Error(`commands/getAll: ${e}`);t(r)}else e(r)})):t(new Error("No commands.getAll support"))})),t=e.find(me)?.shortcut;if(!t)return;const r=function(e){return e.split(e.includes(fe)?fe:"")}(t);return r.map(ye).sort(ve).map(be)}!function(e){e.Command="Command",e.Ctrl="Ctrl",e.MacCtrl="MacCtrl",e.Shift="Shift"}(he||(he={}));var Se=r(39680),Re=r(41808);async function Ee(e){if((0,Se.G)()){return await(0,Se.y)(e)>0}const t=await(0,Re.U)(e),r=void 0===t[e],n=null===t[e];return!r&&!n}var Oe=r(24715),Ce=r(72733),Pe=r(57306),Ae=r(31460),je=r(61222);async function _e(){const e=await(0,je.I)({}),t=(0,i.A)("");return e.filter((e=>"string"==typeof e.url&&e.url.startsWith(t))).filter((e=>""!==e.url))}const Te="index.html";function Ie(){return`${(0,i.A)("")}${Te}`}function De({identifier:e,queryInfo:t,name:r}){const n=Ie();if(!r)return n;const o=e?`#${r}/${e}`:`#${r}`,i=t?`?${function(e){return Object.keys(e).map((t=>`${t}=${e[t]}`)).join("&")}(t)}`:"";return encodeURI(`${n}${o}${i}`)}async function xe({id:e,query:t,route:r}){const n=De({identifier:e,queryInfo:t,name:r}),o=await _e();o.length?await async function({path:e,tabs:t}){const r=await(0,Ce.T)(),n=function({existingTabs:e,focusedWindow:t}){const r=e.filter((e=>e.active)),n=r.find((e=>e.windowId===t.id)),o=r.pop(),i=e.pop();return n??o??i}({existingTabs:t,focusedWindow:r});if(!n)return;if(n.windowId!==r.id&&(0,Pe.V)(n.windowId,{focused:!0}),!n.id)return;const o={active:!0,...e===Ie()?{}:{url:e}};await(0,Ae.V)(n.id,o)}({path:n,tabs:o}):await async function(e){const t={url:e};await(0,Oe.U)(t)}(n)}var Ue=r(49259);async function Me(){const e=await _e();if(!e.length)return;const t=chrome.tabs.TAB_ID_NONE,r=e.map((e=>e.id)).filter((e=>"number"==typeof e&&e!==t));await(0,Ue.O)(r)}var Le=r(32012),Ne=r(24966),ke=r(58376),Fe=r(85390),Ve=r(15023),qe=r(28489);const Ge={addListener:function(e){if(!(0,de.qX)(["storage"]))throw new Error("No storage.session.onChanged.addListener support, permission is missing");if(!(0,de.Ez)("storage.session.onChanged.addListener"))throw new Error("No storage.session.onChanged.addListener support");const t=t=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`storage/session/onChanged: ${e}`)}return e(t)};return chrome.storage.session.onChanged.addListener(t),t},removeListener:function(e){if(!(0,de.qX)(["storage"]))throw new Error("No storage.session.onChanged.removeListener support, permission is missing");if(!(0,de.Ez)("storage.session.onChanged.removeListener"))throw new Error("No storage.session.onChanged.removeListener support");chrome.storage.session.onChanged.removeListener(e)}};var Be=r(56847),He=r(52477),We=r(15026);function Ke(e){return JSON.parse(JSON.stringify(e))}class ze{constructor(e,t){this.stopped$=new Ne.X(!1),this.key=e,this.typeGuard=t??(e=>!0);const r=new ke.y((t=>{this.get().then((e=>{t.next(e)}));const r=r=>{if(e in r){const{newValue:n}=r[e];return t.next(this.asDataWithTimestamp(n))}};return Ge.addListener(r),()=>Ge.removeListener(r)}));this.state$=(0,Fe.a)({state:r,isStopped:this.stopped$}).pipe((0,Ve.o)((({isStopped:e})=>!e),!1),(0,N.U)((({state:e})=>e)))}set(e){return(0,Be.t)(Ke({[this.key]:e}))}init(e){return(0,Be.t)(Ke({[this.key]:e}))}clear(){return(0,He.O)(this.key)}stop(){this.stopped$.next(!0)}async get(){const e=(await(0,We.U)(this.key))[this.key];return this.asDataWithTimestamp(e)}asDataWithTimestamp(e){return e&&"object"==typeof e&&(0,qe.l$)(e,"timestamp")&&"number"==typeof e.timestamp&&e.timestamp&&(0,qe.l$)(e,"data")&&(0,n.isLazyState)(e.data)?e.data.loaded?this.typeGuard(e.data.value)?{timestamp:e.timestamp,data:{loaded:!0,value:e.data.value}}:{timestamp:void 0}:{timestamp:e.timestamp,data:{loaded:!1}}:{timestamp:void 0}}}class $e extends n.StoreInfrastructureFactory{createUserScopedInfrastructure(e,t,r,n){return new ze(`graphene.${e}.${t}.${r}`,n)}createDeviceScopedInfrastructure(e,t,r){return new ze(`graphene.${e}.${t}`,r)}}function Qe(){return(0,Le.G)()?new $e:new n.MemoryStoreInfrastructureFactory}var Ye=r(9244),Je=r(45441);class Xe{async getAllKeys(){return Object.keys(await(0,Re.U)(null))}async get(e){const t=(await(0,Re.U)([e]))[e];if(t){if("string"!=typeof t)throw new Error(`[ChromeLocalStorage] - cannot read content of ${e} properly. Type is\n        ${typeof t} but should be 'string'`);return t}}async set(e,t){await(0,Ye.t)({[e]:t})}async remove(e){await(0,Je.O)([e])}}class Ze{constructor(e,t,r){this.DB_STORE_NAME=e,this.DB_VERSION=t,this.DB_OBJECT_STORE_NAME=r}getIndexedDB(){return new Promise(((e,t)=>{const r=self.indexedDB;if(!r)return t(new Error("indexedDB is not supported in this environment"));const n=r.open(this.DB_STORE_NAME,this.DB_VERSION);n.onerror=function(){t(n.error)},n.onupgradeneeded=()=>{n.result.objectStoreNames.contains(this.DB_OBJECT_STORE_NAME)||n.result.createObjectStore(this.DB_OBJECT_STORE_NAME)},n.onsuccess=function(){n.onsuccess=null,e(n.result)}}))}async getStore(e="readwrite"){return(await this.getIndexedDB()).transaction([this.DB_OBJECT_STORE_NAME],e).objectStore(this.DB_OBJECT_STORE_NAME)}async readItem(e){const t=await this.getStore("readonly");return new Promise((r=>{const n=t.get(e);n.onsuccess=()=>{n.onsuccess=null,r(n.result)}}))}async getAllKeys(){const e=await this.getStore("readonly");return new Promise((t=>{const r=e.getAllKeys();r.onsuccess=()=>{t(r.result.map((e=>String(e))))}}))}async removeItem(e){const t=await this.getStore("readwrite");return new Promise((r=>{const n=t.delete(e);n.onsuccess=()=>{n.onsuccess=null,r()}}))}async writeItem(e,t){const r=await this.getStore("readwrite");return new Promise((n=>{const o=r.put(t,e);o.onsuccess=()=>{o.onsuccess=null,n()}}))}async itemExists(e){const t=await this.readItem(e);return null!=t}}class et{constructor(){this.storageLayer=new Ze("dashlane-ng",1,"module-data")}getAllKeys(){return this.storageLayer.getAllKeys()}async set(e,t){return await this.storageLayer.writeItem(e,t)}remove(e){return this.storageLayer.removeItem(e)}async get(e){return await this.storageLayer.readItem(e)??void 0}}class tt extends n.CronLowLevelSource{constructor(){super(...arguments),this.alarm$=new ke.y((e=>{const t=self.setInterval((()=>{e.next()}),6e4);return()=>{self.clearInterval(t)}}))}}var rt=r(97280);const nt=e=>{if(!(0,de.qX)(["alarms"]))throw new Error("No alarms.onAlarm.addListener support, permission is missing");if(!(0,de.Ez)("alarms.onAlarm.addListener"))throw new Error("No alarms.onAlarm.addListener support");chrome.alarms.onAlarm.addListener(e);const t=chrome.runtime.lastError?.message;if(t)throw new Error("alarms/onAlarm error:"+t)},ot=e=>{if(!(0,de.qX)(["alarms"]))throw new Error("No alarms.onAlarm.removeListener support, permission is missing");if(!(0,de.Ez)("alarms.onAlarm.removeListener"))throw new Error("No alarms.onAlarm.removeListener support");chrome.alarms.onAlarm.removeListener(e);const t=chrome.runtime.lastError?.message;if(t)throw new Error("alarms/onAlarm error:"+t)};const it="cron-source",at=()=>new ke.y((e=>{const t=t=>{t.name===it&&e.next()};return((e,t)=>{if(!(0,de.qX)(["alarms"]))throw new Error("No alarms.create support, permission is missing");if(!(0,de.Ez)("alarms.create"))throw new Error("No alarms.create support");chrome.alarms.create(e,t)})(it,{delayInMinutes:1,periodInMinutes:1}),nt(t),()=>{ot(t)}})),st=()=>(0,de.Ez)("alarms.clear")&&(0,de.qX)(["alarms"])?at():new ke.y((e=>{const t=self.setInterval((()=>{e.next()}),6e4);return()=>{self.clearInterval(t)}}));class ct extends n.CronLowLevelSource{constructor(){super(...arguments),this.alarm$=st().pipe((0,rt.d)(1)),this.subscription=this.alarm$.subscribe()}stop(){this.subscription.unsubscribe()}}function ut(){return"undefined"!=typeof chrome&&void 0!==chrome.runtime&&void 0!==chrome.runtime.getManifest&&3===(0,te.W)().manifest_version}var lt=r(69885),dt=r(7074);class pt{constructor(e,t){this.worker=e,this.channelName=t,this.autoConnects=!1,this.status$=(0,lt.of)(n.ChannelState.Connected),this.messages$=new ke.y((t=>{const r=e=>{(0,n.isSendMessageRequest)(e.data)&&!e.origin&&t.next(e.data.message)};return e.addEventListener("message",r),()=>{e.removeEventListener("message",r)}})).pipe((0,dt.B)())}async sendMessage(e){this.worker.postMessage((0,n.sendMessageRequest)({channelName:this.channelName,message:e}))}stop(){return Promise.resolve()}}var ft=r(69183),ht=r(20500);class mt{constructor(e,t){this.source=e,this.filter=t;let r=[];const n=new Set;this.listener=(e,t)=>{if(!this.filter(e,t))return!1;n.size?n.forEach((r=>r.next([e,t]))):r.push([e,t])},this.events$=new ke.y((e=>(n.size||(r.forEach((t=>e.next(t))),r=[]),n.add(e),()=>{n.delete(e)}))),this.source.addListener(this.listener)}stop(){this.source.removeListener(this.listener)}}class yt{constructor(e){this.connectedChannels$=new Ne.X({});const t=new ke.y((t=>{const r={},o=o=>{const i=(0,ft.Z)();if(o.name!==e)return;const a=new mt({addListener:e=>o.onMessage.addListener(e),removeListener:e=>o.onMessage.removeListener(e)},(t=>(0,n.isSendMessageRequest)(t)&&t.channelName===e)),s=new Promise((e=>{const t=()=>{o.onDisconnect.removeListener(t),e(null)};o.onDisconnect.addListener(t)})),c=new Ne.X(n.ChannelState.Connected);s.then((()=>{a.stop(),c.next(n.ChannelState.Disconnected),delete r[i],t.next(r)}));const u={autoConnects:!1,messages$:a.events$.pipe((0,N.U)((([e])=>e.message))),sendMessage:t=>(o.postMessage((0,n.sendMessageRequest)({channelName:e,message:t})),Promise.resolve()),stop:()=>(o.disconnect(),Promise.resolve()),status$:c},l=new n.AcknowledgedChannel(u);r[i]=l,t.next(r)};return ht.b.addListener(o),()=>{ht.b.removeListener(o)}}));this.subscription=t.subscribe((e=>this.connectedChannels$.next(e)))}stop(){this.subscription.unsubscribe()}}var gt=r(6220),vt=r(60399);class bt{constructor(e){this.autoConnects=!0,this.status$=new Ne.X(n.ChannelState.Connected),this.port$=new ke.y((t=>{let r;function n(){r?.onDisconnect.removeListener(n);const o=function(e){if(!(0,de.Ez)("runtime.connect"))throw new Error("No runtime.connect support");return chrome.runtime.connect(e)}({name:e});o.onDisconnect.addListener(n),t.next(o),r=o}return n(),()=>{r?.onDisconnect.removeListener(n),r?.disconnect()}})).pipe((0,rt.d)(1)),this.portSubscription=this.port$.subscribe(),this.messages$=this.port$.pipe((0,gt.z)((t=>new ke.y((r=>{const o=t=>{(0,n.isSendMessageRequest)(t)&&t.channelName===e&&r.next(t.message)};return t.onMessage.addListener(o),()=>{t.onMessage.removeListener(o)}})))))}async sendMessage(e){const t=await(0,vt.z)(this.port$);t.postMessage((0,n.sendMessageRequest)({channelName:t.name,message:e}))}stop(){return this.portSubscription.unsubscribe(),this.status$.next(n.ChannelState.Disconnected),Promise.resolve()}}var wt=r(43978),St=r(17350);class Rt{constructor(e){this.autoConnects=!1,this.listener=new yt(e),this.channel$=this.listener.connectedChannels$.pipe((0,N.U)((e=>{const t=Object.values(e);if(t.length)return t[0]})),(0,rt.d)(1)),this.receivedMessages$=this.channel$.pipe((0,wt.w)((e=>e?e.receivedMessages$:St.E))),this.channelState$=this.channel$.pipe((0,N.U)((e=>e?n.ChannelState.Connected:n.ChannelState.Disconnected)))}async send(e){const t=await(0,vt.z)(this.channel$);if(!t)throw new Error("Channel is not connected");await t.send(e)}stop(){this.listener.stop()}}},45059:(e,t,r)=>{"use strict";r.d(t,{zW:()=>je,N2:()=>_e,RV:()=>Ye,z:()=>p,gO:()=>h,Nw:()=>f,mr:()=>S,E1:()=>R,x4:()=>Te,oo:()=>E,SD:()=>ce,jN:()=>xe,eN:()=>Ge,WM:()=>ke,LE:()=>Ve,aW:()=>qe,Zn:()=>$e,WE:()=>He,bL:()=>i,BU:()=>m,F7:()=>Je,Eu:()=>s,xJ:()=>De,$k:()=>Ie,PL:()=>Xe,FO:()=>Se,Jo:()=>Ce,gi:()=>Pe,yL:()=>Ae,b9:()=>C});var n=r(89685),o=r(54066);class i{decode(e){return JSON.parse((0,n.v)(e))}encode(e){return(0,o.u)(JSON.stringify(e))}}const a=e=>e;class s{constructor(){this.encode=a,this.decode=a}}var c=r(7502),u=r(46041);function l(e){const t=e.length,r=[];for(let n=0;n<t;n+=3)r.push(u.U[e[n]>>2]),r.push(u.U[(3&e[n])<<4|e[n+1]>>4]),r.push(u.U[(15&e[n+1])<<2|e[n+2]>>6]),r.push(u.U[63&e[n+2]]);return r.join("")}function d(e,t=u.V){const r=new Uint8Array(e),n=r.length,o=t%3,i=0===o?t:t+(3-o),a=Math.ceil(n/i);let s="",c=-1;for(;c++<a;){const e=c*i,t=c===a-1?n:(c+1)*i,o=l(r.slice(e,t));s=s.concat(o)}return n%3==2?s.substring(0,s.length-1)+"=":n%3==1?s.substring(0,s.length-2)+"==":s}class p{decode(e){return(0,c.R)(e)}encode(e){return d(e)}}const f={algorithm:"aes256",mode:"cbchmac",ivLength:16},h={algorithm:"aes256",mode:"cbchmac64",ivLength:16},m={algorithm:"aes256",mode:"cbchmac",ivLength:16,padding:16,bytesToKey:0,reuseSalt:!1},y={algorithm:"aes256",mode:"cbc",ivLength:16,saltLength:32,padding:0,bytesToKey:{algorithm:"sha1",iterations:3,keyLength:32}};var g=r(7165);const v=g.z.object({algorithm:g.z.literal("aes256"),mode:g.z.literal("cbchmac"),ivLength:g.z.literal(16)}),b=g.z.object({algorithm:g.z.literal("aes256"),mode:g.z.literal("cbchmac64"),ivLength:g.z.literal(16)}),w=g.z.union([v,b]),S={algorithm:"argon2d",saltLength:16,tCost:3,mCost:32768,parallelism:2},R={algorithm:"pbkdf2",saltLength:16,iterations:2e5,hashAlgorithm:"sha256"},E={algorithm:"noderivation"},O={algorithm:"pbkdf2",saltLength:32,iterations:10204,hashAlgorithm:"sha1"};function C(e){return["argon2d","pbkdf2","noderivation"].some((t=>t===e))}const P=g.z.object({algorithm:g.z.literal("argon2d"),saltLength:g.z.literal(16),tCost:g.z.number(),mCost:g.z.number(),parallelism:g.z.number()}),A=g.z.object({algorithm:g.z.literal("pbkdf2"),saltLength:g.z.union([g.z.literal(16),g.z.literal(32)]),iterations:g.z.number(),hashAlgorithm:g.z.enum(["sha1","sha256"])}),j=g.z.object({algorithm:g.z.literal("noderivation")});var _=r(95087);function T({transportableData:e,marker:t,metadata:r}){const n=t.length+r.length;return e.substring(n)}function I({encipheredContents:e,marker:t,metadata:r}){const{derivation:n,cipher:i,type:a,version:s}=t,{iv:c,salt:u,signature:l}=r;return{type:a,version:s,derivationConfig:n,cipherConfig:i,salt:(0,o.u)(u),signature:(0,o.u)(l),iv:(0,o.u)(c),encipheredContents:(0,o.u)(e)}}function D({str:e,substr:t,occurrence:r}){if(r<1)return-1;let n=0,o=-1;for(;n<r;){if(o=e.indexOf(t,o+1),o<0)return o;n++}return o}const x="$",U=1;function M({transportableData:e,makeMarker:t,schema:r}){const n=r.count+1,o=D({str:e,substr:x,occurrence:n}),i=e.substring(1,o).split(x);if(i.length!==r.count)throw new Error("Marker and schema length mismatch");return t({bytes:o+1,markerSchema:r,values:i})}const L=g.z.literal("flexible"),N=g.z.object({version:g.z.literal(1),type:L,length:g.z.number(),derivation:P,cipher:v});function k({bytes:e,markerSchema:t,values:r}){const{version:n,derivation:o,saltLength:i,tCost:a,mCost:s,parallelism:c,cipher:u,mode:l,ivLength:d}=t.index,p=N.safeParse({version:Number(r[n]),type:"flexible",length:e,derivation:{algorithm:r[o],saltLength:Number(r[i]),tCost:Number(r[a]),mCost:Number(r[s]),parallelism:Number(r[c])},cipher:{algorithm:r[u],mode:r[l],ivLength:Number(r[d])}});if(!p.success)throw new Error(p.error.message);return p.data}const F={count:9,index:{version:0,derivation:1,saltLength:2,tCost:3,mCost:4,parallelism:5,cipher:6,mode:7,ivLength:8}},V={count:8,index:{version:0,derivation:1,saltLength:2,iterations:3,hashAlgorithm:4,cipher:5,mode:6,ivLength:7}},q={count:5,index:{version:0,derivation:1,cipher:2,mode:3,ivLength:4}},G=32;function B({transportableData:e,marker:t}){const{length:r,derivation:n,cipher:o}=t,i=n.saltLength,{ivLength:a}=o,s=r+0,c=s+i,u=c+a;return{iv:e.substring(c,c+a),length:i+a+G,salt:e.substring(s,s+i),signature:e.substring(u,u+G)}}const H=g.z.object({version:g.z.literal(1),type:L,length:g.z.number(),derivation:j,cipher:w});function W({bytes:e,markerSchema:t,values:r}){const{version:n,cipher:o,mode:i,ivLength:a}=t.index,s=H.safeParse({version:Number(r[n]),type:"flexible",length:e,derivation:{algorithm:"noderivation"},cipher:{algorithm:r[o],mode:r[i],ivLength:Number(r[a])}});if(!s.success)throw new Error(s.error.message);return s.data}function K(){return e=>{const t=M({transportableData:e,makeMarker:W,schema:q}),r=function({transportableData:e,marker:t}){const{length:r,cipher:n}=t,{ivLength:o}=n,i=r+0,a=i+o;return{iv:e.substring(i,i+o),length:o+G,signature:e.substring(a,a+G)}}({transportableData:e,marker:t});return function({encipheredContents:e,marker:t,metadata:r}){const{derivation:n,cipher:i,type:a,version:s}=t,{iv:c,signature:u}=r;return{type:a,version:s,derivationConfig:n,cipherConfig:i,signature:(0,o.u)(u),iv:(0,o.u)(c),encipheredContents:(0,o.u)(e)}}({encipheredContents:T({transportableData:e,marker:t,metadata:r}),marker:t,metadata:r})}}const z=g.z.object({version:g.z.literal(1),type:L,length:g.z.number(),derivation:A,cipher:v});function $({bytes:e,markerSchema:t,values:r}){const{version:n,derivation:o,saltLength:i,iterations:a,hashAlgorithm:s,cipher:c,mode:u,ivLength:l}=t.index,d=z.safeParse({version:Number(r[n]),type:"flexible",length:e,derivation:{algorithm:r[o],saltLength:Number(r[i]),iterations:Number(r[a]),hashAlgorithm:r[s]},cipher:{algorithm:r[c],mode:r[u],ivLength:Number(r[l])}});if(!d.success)throw new Error(d.error.message);return d.data}function Q({transportableData:e,index:t}){const r=t+1,n=D({str:e,substr:x,occurrence:r}),o=D({str:e,substr:x,occurrence:r+1});if(-1===n||-1===o)throw new Error("Marker info indices not found");return e.substring(n+1,o)}const Y=0,J=1;function X(e){switch(e){case"argon2d":return e=>{const t=M({transportableData:e,makeMarker:k,schema:F}),r=B({transportableData:e,marker:t});return I({encipheredContents:T({transportableData:e,marker:t,metadata:r}),marker:t,metadata:r})};case"pbkdf2":return e=>{const t=M({transportableData:e,makeMarker:$,schema:V}),r=B({transportableData:e,marker:t});return I({encipheredContents:T({transportableData:e,marker:t,metadata:r}),marker:t,metadata:r})};case"noderivation":return K();default:(0,_.U)(e)}}function Z(...e){const t=e.reduce(((e,t)=>e+t.byteLength),0),r=new Uint8Array(t);return e.reduce(((e,t)=>(r.set(new Uint8Array(t),e),e+t.byteLength)),0),r.buffer}function ee(e){const t=x+e.join(x)+x;return(0,o.u)(t)}function te({cipher:e,derivation:t}){const{algorithm:r}=t;switch(r){case"argon2d":return function({cipher:e,derivation:t}){const{count:r,index:n}=F,o=new Array(r);return o[n.version]=U,o[n.derivation]=t.algorithm,o[n.saltLength]=t.saltLength,o[n.tCost]=t.tCost,o[n.mCost]=t.mCost,o[n.parallelism]=t.parallelism,o[n.cipher]=e.algorithm,o[n.mode]=e.mode,o[n.ivLength]=e.ivLength,ee(o)}({cipher:e,derivation:t});case"pbkdf2":return function({cipher:e,derivation:t}){const{count:r,index:n}=V,o=new Array(r);return o[n.version]=U,o[n.derivation]=t.algorithm,o[n.saltLength]=t.saltLength,o[n.iterations]=t.iterations,o[n.hashAlgorithm]=t.hashAlgorithm,o[n.cipher]=e.algorithm,o[n.mode]=e.mode,o[n.ivLength]=e.ivLength,ee(o)}({cipher:e,derivation:t});case"noderivation":return function({cipher:e,derivation:t}){const{count:r,index:n}=q,o=new Array(r);return o[n.version]=U,o[n.derivation]=t.algorithm,o[n.cipher]=e.algorithm,o[n.mode]=e.mode,o[n.ivLength]=e.ivLength,ee(o)}({cipher:e,derivation:t});default:(0,_.U)(r)}}const re="KWC5",ne=16,oe=32,ie=0,ae={type:"KWC5",derivation:E,cipher:m};function se(e){const t=function({transportableData:e,marker:t}){const{cipher:r,type:n}=t,{ivLength:o}=r,i=ie+o+ne+n.length,a=i+oe;return{iv:e.slice(ie,ie+o),signature:e.slice(i,i+oe),encipheredContents:e.slice(a)}}({transportableData:e,marker:ae});return{iv:t.iv,type:re,signature:t.signature,encipheredContents:t.encipheredContents,derivationConfig:E,cipherConfig:m}}class ce{constructor(){this.derivateKeyCache=new Map}getCacheKey(...e){return d(e.reduce(((e,t)=>Z(e,t)),new ArrayBuffer(0)))}getCachedDerivation(e){return this.derivateKeyCache.get(e)}setCachedDerivation({cacheKey:e,data:t}){this.getCachedDerivation(e)||this.derivateKeyCache.set(e,t)}}const ue="flexible",le="KWC3",de=0,pe=32,fe=4;function he(e){const t=e.slice(pe,pe+fe),r=(0,n.v)(t);if([le,re].includes(r))return r}function me(e){const t=he(e);return t||(function(e){const t=new Uint8Array(e).slice(0,1);return(0,n.v)(t.buffer)===x}(e)?ue:void 0)}const ye="SHA-512";async function ge(e,t){const r=await t(e,ye),n=new Uint8Array(r),o=r.byteLength/2,i=n.slice(0,o),a=n.slice(o,r.byteLength);return{encryptionKey:i.buffer,signatureKey:a.buffer}}function ve(e){const t=new Uint8Array(e),r=e.byteLength/2,n=t.slice(0,r),o=t.slice(r);return Promise.resolve({encryptionKey:n.buffer,signatureKey:o.buffer})}async function be(e,t,r,n,i){const a=(0,o.u)(Object.values(r).join("")),s=t.getCacheKey(n,i,a),c=t.getCachedDerivation(s);if(c)return c;const u=function(e){switch(e){case"sha1":return"SHA-1";case"sha256":return"SHA-256";case"sha384":return"SHA-384";case"sha512":return"SHA-512";default:(0,_.U)(e)}}(r.hashAlgorithm),l=await e(n,i,{iterations:r.iterations,hashType:u});return t.setCachedDerivation({cacheKey:s,data:l}),l}function we(e,t,r,n,i,a){return"pbkdf2"===i.algorithm?be(r,a,i,e,t):async function(e,t,r,n,i){const{tCost:a,mCost:s,parallelism:c}=r,u=(0,o.u)(Object.values(r).join("")),l=t.getCacheKey(n,i,u),d=t.getCachedDerivation(l);if(d)return d;const p={tCost:a,mCost:s,parallelism:c},f=await e(n,i,p);return t.setCachedDerivation({cacheKey:l,data:f}),f}(n,a,i,e,t)}async function Se(e,t,r,o){const i=function(e){const t=(0,n.v)(e),r=Q({transportableData:t,index:Y});if(Number(r)!==U)throw new Error("Marker version not supported");const o=Q({transportableData:t,index:J});if(!C(o))throw new Error("Derivation algorithm not supported");return X(o)(t)}(o),{deriveKeyArgon2d:a,deriveKeyPbkdf2:s}=t,{derivationConfig:c,salt:u}=i,{algorithm:l}=c,d="pbkdf2"===l||"argon2d"===l;if(d&&!u)throw new Error("Need salt for derivation");const p=d&&u?await we(e,u,s,a,c,r):e,{mode:f}=i.cipherConfig,{computeHash:h}=t,{encryptionKey:m,signatureKey:y}="cbchmac64"===f?await ve(p):await ge(p,h),{iv:g,encipheredContents:v}=i,b=Z(g,v),{verifyHmacSha:w}=t,{signature:S}=i;if(!await w(y,S,b))throw new Error("Signature cannot be verified");const{decryptAes256:R}=t;return R(m,g,v)}const Re={type:le,derivation:O,cipher:y};function Ee(e){const t=function({transportableData:e,marker:t}){const{derivation:r,type:n}=t,{saltLength:o}=r,i=de+o+n.length;return{salt:e.slice(de,de+o),encipheredContents:e.slice(i)}}({transportableData:e,marker:Re});return{salt:t.salt,type:le,encipheredContents:t.encipheredContents,derivationConfig:O,cipherConfig:y}}async function Oe(e,t,r,n){const o=Ee(n),{deriveKeyPbkdf2:i}=t,{derivationConfig:a,salt:s}=o,c=await be(i,r,a,e,s),{computeHash:u}=t,{cipherConfig:{ivLength:l,bytesToKey:{iterations:d,keyLength:p}}}=o,f=await async function(e,t,r,n,o,i){const a=Z(t,i.slice(0,8));let s=a,c=new ArrayBuffer(0);for(let t=0;t<r;t++){const t=await e(s,"SHA-1");c=Z(c,t),s=Z(t,a)}const u=o+n;return Promise.resolve(c.slice(o,u))}(u,c,d,l,p,s),{decryptAes256:h}=t,{encipheredContents:m}=o;return h(c,f,m)}async function Ce(e,t,r,n){const o=me(n);if(!o)throw new Error("Cannot find marker type");switch(o){case le:return await Oe(e,t,r,n);case re:return await async function(e,t,r){const n=se(r),{computeHash:o}=t,{encryptionKey:i,signatureKey:a}=await ge(e,o),{iv:s,encipheredContents:c}=n,u=Z(s,c),{verifyHmacSha:l}=t,{signature:d}=n;if(!await l(a,d,u))throw new Error("Signature cannot be verified");const{decryptAes256:p}=t;return p(i,s,c)}(e,t,n);case ue:return Se(e,t,r,n);default:(0,_.U)(o)}}async function Pe(e,t,r,n,o,i,a){const{algorithm:s}=r,c="pbkdf2"===s||"argon2d"===s;if(c&&!a?.salt)throw new Error("Need salt for derivation");const{deriveKeyArgon2d:u,deriveKeyPbkdf2:l}=t,d=c&&a?.salt?await we(e,a.salt,l,u,r,n):e,{mode:p}=o,{computeHash:f}=t,{encryptionKey:h,signatureKey:m}="cbchmac64"===p?await ve(d):await ge(d,f),{getRandomValues:y}=t,g=y(o.ivLength),{encryptAes256:v}=t,b=await v(h,g,i),{signHmacSha:w}=t,S=Z(g,b),R=await w(m,S);return function(e){const{encipheredContents:t,cipherConfig:r,derivationConfig:n,salt:o,signature:i,iv:a}=e,s=te({cipher:r,derivation:n});return o&&"noderivation"!==n.algorithm?Z(s,o,a,i,t):Z(s,a,i,t)}({type:"flexible",version:1,derivationConfig:r,cipherConfig:o,salt:a?.salt,iv:g,signature:R,encipheredContents:b})}async function Ae(e,t,r,n,i,a){const{computeHash:s}=t,{encryptionKey:c,signatureKey:u}=await ge(e,s),{getRandomValues:l}=t,{ivLength:d}=n,p=l(d),{encryptAes256:f}=t,h=await f(c,p,i),{signHmacSha:m}=t,y=Z(p,h),g={type:"KWC5",derivationConfig:r,cipherConfig:n,iv:p,signature:await m(u,y),encipheredContents:h},{padding:v}=a;return function({secureData:e,randomValues:t}){if(t.byteLength!==ne)throw new Error("Encoding kwc5 requires 16 random bytes");const{encipheredContents:r,iv:n,type:i,signature:a}=e;return Z(n,t,(0,o.u)(i),a,r)}({secureData:g,randomValues:v})}const je="AES-CBC",_e=256,Te="SHA-256",Ie="RSA-OAEP",De="RSASSA-PKCS1-v1_5";class xe{}var Ue=r(69885),Me=r(34987),Le=r(48844);class Ne{constructor(e){this.chain=null,this.backend=e}handle(e){return this.backend.handle(e)}}class ke{constructor(e){this.headers=new Map,this.normalizedNames=new Map,"string"==typeof e?this.initFromString(e):e&&this.initFromObject(e)}has(e){return this.headers.has(e.toLowerCase())}get(e){const t=this.headers.get(e.toLowerCase());return t?.[0]??null}keys(){return Array.from(this.normalizedNames.values())}getAll(e){return this.headers.get(e.toLowerCase())??null}append(e,t){return this.clone({name:e,value:t,op:0})}set(e,t){return this.clone({name:e,value:t,op:1})}delete(e,t){return this.clone({name:e,value:t,op:2})}deleteMultiple(e){return this.clone({names:e,op:3})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}clone(e){const t=new ke;return t.initFromOther(this),t.applyUpdate(e),t}applyUpdate(e){switch(e.op){case 0:case 1:{const t=e.name.toLowerCase();let r=e.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(e.name,t);const n=(0===e.op?this.headers.get(t):void 0)??[];n.push(...r),this.headers.set(t,n)}break;case 2:{const t=e.name.toLowerCase(),r=e.value;if(r){let e=this.headers.get(t);if(!e)return;const n=Array.isArray(r)?r:[r];e=e.filter((e=>!n.includes(e))),0===e.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,e)}else this.headers.delete(t),this.normalizedNames.delete(t)}break;case 3:e.names.forEach((e=>{const t=e.toLowerCase();this.headers.delete(t),this.normalizedNames.delete(t)}))}}initFromOther(e){Array.from(e.headers.keys()).forEach((t=>{this.headers.set(t,[...e.headers.get(t)]),this.normalizedNames.set(t,e.normalizedNames.get(t))}))}initFromObject(e){Object.keys(e).forEach((t=>{let r=e[t];const n=t.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(n,r),this.maybeSetNormalizedName(t,n))}))}initFromString(e){e.split("\n").forEach((e=>{const t=e.indexOf(":");if(t>0){const r=e.slice(0,t),n=r.toLowerCase(),o=e.slice(t+1).trim();this.maybeSetNormalizedName(r,n),this.headers.has(n)?this.headers.get(n).push(o):this.headers.set(n,[o])}}))}}class Fe{encodeKey(e){return this.standardEncoding(e)}encodeValue(e){return this.standardEncoding(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}standardEncoding(e){return encodeURIComponent(e).replace(Fe.STANDARD_ENCODING_REGEX,((e,t)=>Fe.STANDARD_ENCODING_REPLACEMENTS[t]??e))}}Fe.STANDARD_ENCODING_REGEX=/%(\d[a-f0-9])/gi,Fe.STANDARD_ENCODING_REPLACEMENTS={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};class Ve{constructor(e={},t={}){this.map=new Map,this.encoder=t.encoder??new Fe,"string"==typeof e?this.initFromString(e):this.initFromObject(e)}has(e){return this.map.has(e)}get(e){const t=this.map.get(e);return t?.[0]??null}getAll(e){return this.map.get(e)??null}keys(){return Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:0})}appendAll(e){const t=[];return Object.keys(e).forEach((r=>{const n=e[r];Array.isArray(n)?n.forEach((e=>{t.push({param:r,value:e,op:0})})):t.push({param:r,value:n,op:0})})),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:1})}delete(e,t){return this.clone({param:e,value:t,op:2})}toString(){return this.keys().map((e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map((e=>t+"="+this.encoder.encodeValue(e))).join("&")})).filter((e=>""!==e)).join("&")}clone(e){const t=new Ve({},{encoder:this.encoder});return t.initFromOther(this),t.applyUpdates(Array.isArray(e)?e:[e]),t}initFromOther(e){e.keys().forEach((t=>this.map.set(t,[...e.map.get(t)])))}initFromObject(e){Object.keys(e).forEach((t=>{const r=e[t],n=Ve.isValueArray(r)?r.map(Ve.valueToString):[Ve.valueToString(r)];this.map.set(t,n)}))}initFromString(e){const{encoder:t}=this;if(e.length>0){e.replace(/^\?/,"").split("&").forEach((e=>{const r=e.indexOf("="),[n,o]=-1===r?[t.decodeKey(e),""]:[t.decodeKey(e.slice(0,r)),t.decodeValue(e.slice(r+1))],i=this.map.get(n)??[];i.push(o),this.map.set(n,i)}))}}applyUpdates(e){e.forEach((e=>{switch(e.op){case 0:case 1:{const t=(0===e.op?this.map.get(e.param):void 0)??[];t.push(Ve.valueToString(e.value)),this.map.set(e.param,t);break}case 2:if(void 0===e.value){this.map.delete(e.param);break}{const t=this.map.get(e.param)??[],r=t.indexOf(Ve.valueToString(e.value));-1!==r&&t.splice(r,1),t.length>0?this.map.set(e.param,t):this.map.delete(e.param)}}}))}static valueToString(e){return`${e}`}static isValueArray(e){return Array.isArray(e)}}class qe{constructor(e,t,r,n){this.body=null,this.headers=new ke,this.withCredentials=!1,this.timeout=void 0,this.responseType="json",this.params=new Ve({}),this.url=t,this.method=e,qe.mightHaveBody(this.method)&&(this.body=r??null),n&&(this.withCredentials=Boolean(n.withCredentials),n.responseType&&(this.responseType=n.responseType),n.headers&&(this.headers=this.getHeadersFromOptions(n.headers)),n.params&&(this.params=this.getParamsFromOptions(n.params)),n.timeout&&n.timeout>0&&(this.timeout=n.timeout),n.mode&&(this.mode=n.mode)),this.urlWithParams=this.initUrlWithParams()}serializeBody(){return null===this.body?null:qe.isArrayBuffer(this.body)||"string"==typeof this.body?this.body:this.body instanceof Ve?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||qe.isArrayBuffer(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Ve?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){const t=e.method??this.method,r=e.url??this.url,n=e.responseType??this.responseType,o=void 0!==e.body?e.body:this.body,i=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,a=void 0!==e.timeout?e.timeout:this.timeout,s=e.mode??this.mode;let c=e.headers?this.getHeadersFromOptions(e.headers):this.headers,u=e.params?this.getParamsFromOptions(e.params):this.params;const l=e.setHeaders;l&&(c=Object.keys(l).reduce(((e,t)=>e.set(t,l[t])),c));const d=e.setParams;return d&&(u=Object.keys(d).reduce(((e,t)=>e.set(t,d[t])),u)),new qe(t,r,o,{params:u,headers:c,responseType:n,withCredentials:i,timeout:a,mode:s})}getHeadersFromOptions(e){return e instanceof ke?e:new ke(e)}getParamsFromOptions(e){return e instanceof Ve?e:new Ve(e)}initUrlWithParams(){const e=this.params.toString();if(0===e.length)return this.url;const t=this.url.indexOf("?"),r=-1===t?"?":t<this.url.length-1?"&":"";return this.url+r+e}static mightHaveBody(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":return!1;default:return!0}}static isArrayBuffer(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}}class Ge{constructor(e){this.handler=new Ne(e)}request(...e){return this.makeRequest(...e)}delete(e,t){return this.makeRequest("DELETE",e,t)}get(e,t){return this.makeRequest("GET",e,t)}head(e,t){return this.makeRequest("HEAD",e,t)}options(e,t){return this.makeRequest("OPTIONS",e,t)}patch(e,t,r){return this.makeRequest("PATCH",e,{body:t,...r})}post(e,t,r){return this.makeRequest("POST",e,{body:t,...r})}put(e,t,r){return this.makeRequest("PUT",e,{body:t,...r})}makeRequest(...e){let t,r,n;if(1===e.length)t=e[0],r="response";else{const[o,i,a]=e;t=new qe(o,i,void 0!==a.body?a.body:null,{headers:a.headers,params:a.params,responseType:a.responseType??"json",withCredentials:a.withCredentials}),r=a.observe??"body","json"===a.responseType&&"body"===a.observe&&(n=a.responseBodyDecoder)}const o=(0,Ue.of)(this.addContentTypeRequestHeader(t)).pipe((0,Me.b)((e=>this.handler.handle(e))));switch(r){case"body":switch(t.responseType){case"arraybuffer":return o.pipe((0,Le.Gx)((e=>e.arrayBuffer())));case"text":return o.pipe((0,Le.Gx)((e=>e.text())));case"json":return o.pipe((0,Le.Gx)((e=>e.json(n))));default:(0,_.U)(t.responseType)}break;case"response":return o;default:(0,_.U)(r)}}addContentTypeRequestHeader(e){if(!e.headers.has("content-type")){const t=e.detectContentTypeHeader();if(t)return e.clone({headers:e.headers.set("content-type",t)})}return e}}class Be{constructor(e){this.values=e}matches(e){return(!this.values?.method||this.values.method===e.method)&&((void 0===this.values?.url||this.values.url===e.url)&&((void 0===this.values?.body||JSON.stringify(this.values.body)===JSON.stringify(e.body))&&(!(void 0!==this.values?.headers&&!Object.keys(this.values.headers).reduce(((t,r)=>{const n=this.values.headers[r],o=Array.isArray(n)?n:[n],i=e.headers.getAll(r).every((e=>o.includes(e)));return t&&i}),!0))&&(void 0===this.values?.params&&((void 0===this.values?.responseType||this.values.responseType===e.responseType)&&((void 0===this.values?.withCredentials||this.values.withCredentials===e.withCredentials)&&((void 0===this.values?.timeout||this.values.timeout===e.timeout)&&(void 0===this.values?.mode||this.values.mode===e.mode))))))))}}"undefined"!=typeof expect&&expect.extend({toMatchHttpRequest(e,t){const r=new Be(t).matches(e);return{message:()=>r?"Passed":"Failed",pass:r}}});var He,We=r(225);async function Ke(e){const t=e.getReader();let r=new Uint8Array(0),n=await t.read();for(;!n.done;){const e=new Uint8Array(r.byteLength+n.value.byteLength);e.set(r,0),e.set(n.value,r.byteLength),r=e,n=await t.read()}return r}!function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Processing=102]="Processing",e[e.EarlyHints=103]="EarlyHints",e[e.Ok=200]="Ok",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultiStatus=207]="MultiStatus",e[e.AlreadyReported=208]="AlreadyReported",e[e.ImUsed=226]="ImUsed",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.Unused=306]="Unused",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.PayloadTooLarge=413]="PayloadTooLarge",e[e.UriTooLong=414]="UriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RangeNotSatisfiable=416]="RangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.ImATeapot=418]="ImATeapot",e[e.MisdirectedRequest=421]="MisdirectedRequest",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.Locked=423]="Locked",e[e.FailedDependency=424]="FailedDependency",e[e.TooEarly=425]="TooEarly",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.PreconditionRequired=428]="PreconditionRequired",e[e.TooManyRequests=429]="TooManyRequests",e[e.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",e[e.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported",e[e.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",e[e.InsufficientStorage=507]="InsufficientStorage",e[e.LoopDetected=508]="LoopDetected",e[e.NotExtended=510]="NotExtended",e[e.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired"}(He||(He={}));class ze{constructor(e){this.bytesRead=0,this.data=e}pull(e){const{bytesRead:t,data:r}=this;if(t>=r.byteLength)return void e.close();const n=Math.min(r.byteLength-t,e.desiredSize??1/0);if(n>0){const o=new Uint8Array(r,t,n);e.enqueue(o),this.bytesRead+=n}t>=r.byteLength&&e.close()}}class $e{constructor(e={},t=He.Ok,r="OK"){this.headers=e.headers??new ke,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText??r,this.url=e.url??null,this.ok=this.status>=200&&this.status<300,this.body=void 0!==e.body?e.body:null}clone(e={}){return new $e({body:void 0!==e.body?e.body:null===this.body?null:this.body instanceof We.Pz?this.body.tee()[0]:this.body,headers:e.headers??this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText??this.statusText,url:e.url??this.url??void 0})}async arrayBuffer(){if(null===this.body)throw new Error("Empty response body");if("object"==typeof this.body&&"ReadableStream"===this.body.constructor.name){return(await Ke(this.body)).buffer}if(!(this.body instanceof ArrayBuffer))throw new Error("Unexpected body type, not an ArrayBuffer");return this.body}async text(){if(null===this.body)throw new Error("Empty response body");if("object"==typeof this.body&&"ReadableStream"===this.body.constructor.name){const e=await Ke(this.body);return(0,n.b)(e)}if("string"!=typeof this.body)throw new Error("Unexpected body type, not a string");return this.body}async json(e){if(null===this.body)throw new Error("Empty response body");if("object"==typeof this.body&&"ReadableStream"===this.body.constructor.name){const t=await Ke(this.body),r=(0,n.b)(t);try{const t=JSON.parse(r);return e.decode(t)}catch(e){throw new Error("Failed to parse response body JSON")}}if(this.body instanceof ArrayBuffer||"string"==typeof this.body)throw new Error("Unexpected body type");return e.decode(this.body)}bodyStream(){if(null===this.body)throw new Error("Empty response body");if("object"==typeof this.body&&"ReadableStream"===this.body.constructor.name)return this.body;if("string"==typeof this.body)return new We.Pz(new ze((0,o.u)(this.body)));if(this.body instanceof ArrayBuffer)return new We.Pz(new ze(this.body));const e=JSON.stringify(this.body);return new We.Pz(new ze((0,o.u)(e)))}}var Qe=r(96168);class Ye extends((0,Qe.Hu)("BadStatus","The HTTP response has a non-successful status code (not 2XX)")){constructor(e){super(),this.response=e}}class Je extends((0,Qe.Hu)("NetworkError","The HTTP request request failed due to a network error")){}class Xe extends((0,Qe.Hu)("TimedOut","The HTTP request timed out")){}},96168:(e,t,r)=>{"use strict";r.d(t,{As:()=>o,BU:()=>i,Hu:()=>n});const n=(e,t)=>class extends Error{constructor(){super(t),this.tag=e}};function o(e,t){return t.includes(e.tag)}const i=e=>e.tag},58807:(e,t,r)=>{"use strict";r.r(t),r.d(t,{FunctionalError:()=>n.Hu,assertUnreachable:()=>i.U,concatMapFailure:()=>c.Tc,concatMapSuccess:()=>c.Gx,concatMatchResult:()=>c.RW,createMatchable:()=>a.H6,failure:()=>s.Rn,getBrander:()=>u.zq,getFailure:()=>s.Yv,getSuccess:()=>s.db,hasProperty:()=>u.l$,isFailure:()=>s.hx,isFunctionalErrorOfType:()=>n.As,isMatchable:()=>a.cw,isResult:()=>s.AZ,isSuccess:()=>s.d6,mapFailure:()=>s.SN,mapFailureObservable:()=>c.DZ,mapResultObservable:()=>c.vg,mapSuccess:()=>s.ty,mapSuccessObservable:()=>c.Qn,mapSuccessResultObservable:()=>c.lk,match:()=>a.EQ,matchResultObservable:()=>c.nb,panic:()=>o,safeCast:()=>u.Ay,success:()=>s.Vp,switchMapFailure:()=>c.pr,switchMapSuccess:()=>c.CP,switchMatchResult:()=>c.bM,toFunctionalErrorCode:()=>n.BU});var n=r(96168);function o(e){if(e instanceof Error)throw e;if("string"==typeof e)throw new Error(e);throw new Error(e.tag)}var i=r(95087),a=r(18533),s=r(87279),c=r(48844),u=r(28489)},95087:(e,t,r)=>{"use strict";function n(e,t){throw new Error(t??`Unreachable code detected (${e})`)}r.d(t,{U:()=>n})},18533:(e,t,r)=>{"use strict";r.d(t,{EQ:()=>i,H6:()=>o,cw:()=>a});var n=r(28489);const o=(e,t)=>({tag:e,...t}),i=(e,t)=>{const r=e.tag,n=r in t?t[r]:null;if(!n)throw new Error("Unmatchable case");return n(e)},a=(e,...t)=>{if("object"!=typeof e||!e)return!1;return(0,n.l$)(e,"tag")&&t.includes(e.tag)}},48844:(e,t,r)=>{"use strict";r.d(t,{CP:()=>y,DZ:()=>l,Gx:()=>f,Qn:()=>u,RW:()=>m,Tc:()=>h,bM:()=>v,lk:()=>p,nb:()=>c,pr:()=>g,vg:()=>d});var n=r(87065),o=r(34987),i=r(43978),a=r(87279),s=r(18533);function c(e){return t=>t.pipe((0,n.U)((t=>(0,s.EQ)(t,{success:({data:t})=>e.success(t),failure:({error:t})=>e.failure(t)}))))}function u(e){return t=>t.pipe((0,n.U)((t=>(0,a.hx)(t)?t:(0,a.Vp)(e(t.data)))))}function l(e){return t=>t.pipe((0,n.U)((t=>(0,a.d6)(t)?t:(0,a.Rn)(e(t.error)))))}function d(e,t){return r=>r.pipe((0,n.U)((r=>(0,a.hx)(r)?t?t(r.error):r:e(r.data))))}function p(e){return t=>t.pipe((0,n.U)((t=>(0,a.hx)(t)?t:e(t.data))))}function f(e){return t=>t.pipe((0,o.b)((async t=>(0,a.hx)(t)?t:(0,a.Vp)(await e(t.data)))))}function h(e){return t=>t.pipe((0,o.b)((async t=>(0,a.d6)(t)?t:(0,a.Rn)(await e(t.error)))))}function m(e){return t=>t.pipe((0,o.b)((t=>(0,a.f2)(t,e))))}function y(e){return t=>t.pipe((0,i.w)((async t=>(0,a.hx)(t)?t:(0,a.Vp)(await e(t.data)))))}function g(e){return t=>t.pipe((0,i.w)((async t=>(0,a.d6)(t)?t:(0,a.Rn)(await e(t.error)))))}function v(e){return t=>t.pipe((0,i.w)((t=>(0,a.f2)(t,e))))}},87279:(e,t,r)=>{"use strict";r.d(t,{Rn:()=>s,Yv:()=>f,db:()=>p,hx:()=>l,AZ:()=>d,d6:()=>u,SN:()=>m,ty:()=>h,f2:()=>c,Vp:()=>a});var n=r(18533);const o="success",i="failure",a=e=>(0,n.H6)("success",{data:e}),s=e=>(0,n.H6)("failure",{error:e}),c=(e,t)=>(0,n.EQ)(e,{success:({data:e})=>t.success(e),failure:({error:e})=>t.failure(e)}),u=e=>e.tag===o,l=e=>e.tag===i,d=e=>(0,n.cw)(e,o,i),p=e=>e.data,f=e=>e.error,h=(e,t)=>l(e)?e:a(t(e.data)),m=(e,t)=>u(e)?e:s(t(e.error))},28489:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>o,l$:()=>i,zq:()=>n});const n=e=>t=>Object.assign(t,{brand:e}),o=e=>e;function i(e,t){return t in e}},73873:(e,t,r)=>{"use strict";r.d(t,{i:()=>i,q:()=>a});var n=r(64839),o=r(24982);const i={getRemoteTimeList:{method:"GET",path:"time/GetRemoteTime",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.NONE,version:o.W.V1},getRemoteTime:{method:"POST",path:"time/GetRemoteTime",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.NONE,version:o.W.V1}};class a{constructor(e){this.executorFactory=e}getRemoteTimeList(e){return this.executorFactory.createExecutor(i.getRemoteTimeList).executeRequest({body:e})}getRemoteTime(e){return this.executorFactory.createExecutor(i.getRemoteTime).executeRequest({body:e})}}},1774:(e,t,r)=>{"use strict";r.d(t,{tA:()=>C,uF:()=>a,Vy:()=>c,Dw:()=>l,AN:()=>p,$B:()=>h,ET:()=>A,JM:()=>y,bo:()=>b,pd:()=>S,qp:()=>R.q,Vk:()=>O});var n=r(64839),o=r(24982);const i={confirmActivation:{method:"POST",path:"accountrecovery/ConfirmActivation",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},deactivate:{method:"POST",path:"accountrecovery/Deactivate",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getEncryptedVaultKey:{method:"POST",path:"accountrecovery/GetEncryptedVaultKey",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getStatus:{method:"POST",path:"accountrecovery/GetStatus",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},requestActivation:{method:"POST",path:"accountrecovery/RequestActivation",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1}};class a{constructor(e){this.executorFactory=e}confirmActivation(e,t){return this.executorFactory.createExecutor(i.confirmActivation).executeRequest({credentials:e,body:t})}deactivate(e,t){return this.executorFactory.createExecutor(i.deactivate).executeRequest({credentials:e,body:t})}getEncryptedVaultKey(e,t){return this.executorFactory.createExecutor(i.getEncryptedVaultKey).executeRequest({credentials:e,body:t})}getStatus(e){return this.executorFactory.createExecutor(i.getStatus).executeRequest({body:e})}requestActivation(e,t){return this.executorFactory.createExecutor(i.requestActivation).executeRequest({credentials:e,body:t})}}const s={completeDeviceRegistrationWithAuthTicket:{method:"POST",path:"authentication/CompleteDeviceRegistrationWithAuthTicket",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},completeDeviceRegistrationWithToken:{method:"POST",path:"authentication/CompleteDeviceRegistrationWithToken",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},completeDeviceRegistrationWithTotp:{method:"POST",path:"authentication/CompleteDeviceRegistrationWithTOTP",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},completeExtraDeviceRegistrationWithToken:{method:"POST",path:"authentication/CompleteExtraDeviceRegistrationWithToken",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},completeLoginWithAuthTicket:{method:"POST",path:"authentication/CompleteLoginWithAuthTicket",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},completeLoginWithTotp:{method:"POST",path:"authentication/CompleteLoginWithTOTP",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},completeRememberMeOpenSession:{method:"POST",path:"authentication/CompleteRememberMeOpenSession",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.SESSION,version:o.W.V1},completeRememberMeRegistration:{method:"POST",path:"authentication/CompleteRememberMeRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},completeTotpActivation:{method:"POST",path:"authentication/CompleteTOTPActivation",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},completeWebAuthnAuthenticatorRegistration:{method:"POST",path:"authentication/CompleteWebAuthnAuthenticatorRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},createSamlSession:{method:"POST",path:"authentication/CreateSAMLSession",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},createTokenExtAuth:{method:"POST",path:"authentication/CreateTokenExtAuth",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},deactivateRememberMe:{method:"POST",path:"authentication/DeactivateRememberMe",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},deactivateTotp:{method:"POST",path:"authentication/DeactivateTOTP",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},deactivateU2FDevice:{method:"POST",path:"authentication/DeactivateU2FDevice",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},deactivateWebAuthnAuthenticator:{method:"POST",path:"authentication/DeactivateWebAuthnAuthenticator",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},destroySamlSession:{method:"POST",path:"authentication/DestroySAMLSession",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.BACK_OFFICE,version:o.W.V1},get2FaStatus:{method:"POST",path:"authentication/Get2FAStatus",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},get2FaStatusUnauthenticated:{method:"POST",path:"authentication/Get2FAStatusUnauthenticated",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getAuthenticationMethodsForDevice:{method:"POST",path:"authentication/GetAuthenticationMethodsForDevice",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getAuthenticationMethodsForLogin:{method:"POST",path:"authentication/GetAuthenticationMethodsForLogin",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getAvailableWebAuthnAuthenticators:{method:"POST",path:"authentication/GetAvailableWebAuthnAuthenticators",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.SESSION,version:o.W.V1},getMasterPasswordCipheringKey:{method:"POST",path:"authentication/GetMasterPasswordCipheringKey",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.SESSION,version:o.W.V1},getRecoveryPhoneNumber:{method:"POST",path:"authentication/GetRecoveryPhoneNumber",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getTokensList:{method:"GET",path:"authentication/GetTokens",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getTokens:{method:"POST",path:"authentication/GetTokens",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getU2FDevices:{method:"POST",path:"authentication/GetU2FDevices",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getUnauthorizedProfiles:{method:"POST",path:"authentication/GetUnauthorizedProfiles",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getUserSsoInfo:{method:"POST",path:"authentication/GetUserSSOInfo",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.TEAM_DEVICE,version:o.W.V1},getWebAuthnAuthenticators:{method:"POST",path:"authentication/GetWebAuthnAuthenticators",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},initRememberMasterPassword:{method:"POST",path:"authentication/InitRememberMasterPassword",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},performDashlaneAuthenticatorVerification:{method:"POST",path:"authentication/PerformDashlaneAuthenticatorVerification",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},performDuoPushVerification:{method:"POST",path:"authentication/PerformDuoPushVerification",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},performEmailTokenVerification:{method:"POST",path:"authentication/PerformEmailTokenVerification",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},performExtraDeviceVerification:{method:"POST",path:"authentication/PerformExtraDeviceVerification",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},performSsoVerification:{method:"POST",path:"authentication/PerformSsoVerification",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},performTotpVerification:{method:"POST",path:"authentication/PerformTotpVerification",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},performU2FVerification:{method:"POST",path:"authentication/PerformU2FVerification",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},renameWebAuthnAuthenticator:{method:"POST",path:"authentication/RenameWebAuthnAuthenticator",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},requestDeviceRegistration:{method:"POST",path:"authentication/RequestDeviceRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},requestEmailTokenVerification:{method:"POST",path:"authentication/RequestEmailTokenVerification",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},requestExtraDeviceRegistration:{method:"POST",path:"authentication/RequestExtraDeviceRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},requestLogin:{method:"POST",path:"authentication/RequestLogin",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},requestPushNotificationToken:{method:"POST",path:"authentication/RequestPushNotificationToken",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},requestTotpActivation:{method:"POST",path:"authentication/RequestTOTPActivation",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},requestWebauthnOpenSession:{method:"POST",path:"authentication/RequestWebauthnOpenSession",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.SESSION,version:o.W.V1},requestWebauthnRegistration:{method:"POST",path:"authentication/RequestWebauthnRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},resetBlockedToken:{method:"POST",path:"authentication/ResetBlockedToken",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},updateRecoveryPhoneNumber:{method:"POST",path:"authentication/UpdateRecoveryPhoneNumber",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1}};class c{constructor(e){this.executorFactory=e}completeDeviceRegistrationWithAuthTicket(e){return this.executorFactory.createExecutor(s.completeDeviceRegistrationWithAuthTicket).executeRequest({body:e})}completeDeviceRegistrationWithToken(e){return this.executorFactory.createExecutor(s.completeDeviceRegistrationWithToken).executeRequest({body:e})}completeDeviceRegistrationWithTotp(e){return this.executorFactory.createExecutor(s.completeDeviceRegistrationWithTotp).executeRequest({body:e})}completeExtraDeviceRegistrationWithToken(e){return this.executorFactory.createExecutor(s.completeExtraDeviceRegistrationWithToken).executeRequest({body:e})}completeLoginWithAuthTicket(e){return this.executorFactory.createExecutor(s.completeLoginWithAuthTicket).executeRequest({body:e})}completeLoginWithTotp(e){return this.executorFactory.createExecutor(s.completeLoginWithTotp).executeRequest({body:e})}completeRememberMeOpenSession(e,t){return this.executorFactory.createExecutor(s.completeRememberMeOpenSession).executeRequest({credentials:e,body:t})}completeRememberMeRegistration(e,t){return this.executorFactory.createExecutor(s.completeRememberMeRegistration).executeRequest({credentials:e,body:t})}completeTotpActivation(e,t){return this.executorFactory.createExecutor(s.completeTotpActivation).executeRequest({credentials:e,body:t})}completeWebAuthnAuthenticatorRegistration(e,t){return this.executorFactory.createExecutor(s.completeWebAuthnAuthenticatorRegistration).executeRequest({credentials:e,body:t})}createSamlSession(e){return this.executorFactory.createExecutor(s.createSamlSession).executeRequest({body:e})}createTokenExtAuth(e){return this.executorFactory.createExecutor(s.createTokenExtAuth).executeRequest({credentials:e})}deactivateRememberMe(e,t){return this.executorFactory.createExecutor(s.deactivateRememberMe).executeRequest({credentials:e,body:t})}deactivateTotp(e,t){return this.executorFactory.createExecutor(s.deactivateTotp).executeRequest({credentials:e,body:t})}deactivateU2FDevice(e,t){return this.executorFactory.createExecutor(s.deactivateU2FDevice).executeRequest({credentials:e,body:t})}deactivateWebAuthnAuthenticator(e,t){return this.executorFactory.createExecutor(s.deactivateWebAuthnAuthenticator).executeRequest({credentials:e,body:t})}destroySamlSession(){return this.executorFactory.createExecutor(s.destroySamlSession).executeRequest({})}get2FaStatus(e){return this.executorFactory.createExecutor(s.get2FaStatus).executeRequest({credentials:e})}get2FaStatusUnauthenticated(e){return this.executorFactory.createExecutor(s.get2FaStatusUnauthenticated).executeRequest({body:e})}getAuthenticationMethodsForDevice(e){return this.executorFactory.createExecutor(s.getAuthenticationMethodsForDevice).executeRequest({body:e})}getAuthenticationMethodsForLogin(e){return this.executorFactory.createExecutor(s.getAuthenticationMethodsForLogin).executeRequest({body:e})}getAvailableWebAuthnAuthenticators(e){return this.executorFactory.createExecutor(s.getAvailableWebAuthnAuthenticators).executeRequest({credentials:e})}getMasterPasswordCipheringKey(e){return this.executorFactory.createExecutor(s.getMasterPasswordCipheringKey).executeRequest({credentials:e})}getRecoveryPhoneNumber(e){return this.executorFactory.createExecutor(s.getRecoveryPhoneNumber).executeRequest({credentials:e})}getTokensList(){return this.executorFactory.createExecutor(s.getTokensList).executeRequest({})}getTokens(){return this.executorFactory.createExecutor(s.getTokens).executeRequest({})}getU2FDevices(e){return this.executorFactory.createExecutor(s.getU2FDevices).executeRequest({credentials:e})}getUnauthorizedProfiles(e){return this.executorFactory.createExecutor(s.getUnauthorizedProfiles).executeRequest({body:e})}getUserSsoInfo(e,t){return this.executorFactory.createExecutor(s.getUserSsoInfo).executeRequest({credentials:e,body:t})}getWebAuthnAuthenticators(e){return this.executorFactory.createExecutor(s.getWebAuthnAuthenticators).executeRequest({credentials:e})}initRememberMasterPassword(e,t){return this.executorFactory.createExecutor(s.initRememberMasterPassword).executeRequest({credentials:e,body:t})}performDashlaneAuthenticatorVerification(e){return this.executorFactory.createExecutor(s.performDashlaneAuthenticatorVerification).executeRequest({body:e})}performDuoPushVerification(e){return this.executorFactory.createExecutor(s.performDuoPushVerification).executeRequest({body:e})}performEmailTokenVerification(e){return this.executorFactory.createExecutor(s.performEmailTokenVerification).executeRequest({body:e})}performExtraDeviceVerification(e){return this.executorFactory.createExecutor(s.performExtraDeviceVerification).executeRequest({body:e})}performSsoVerification(e){return this.executorFactory.createExecutor(s.performSsoVerification).executeRequest({body:e})}performTotpVerification(e){return this.executorFactory.createExecutor(s.performTotpVerification).executeRequest({body:e})}performU2FVerification(e){return this.executorFactory.createExecutor(s.performU2FVerification).executeRequest({body:e})}renameWebAuthnAuthenticator(e,t){return this.executorFactory.createExecutor(s.renameWebAuthnAuthenticator).executeRequest({credentials:e,body:t})}requestDeviceRegistration(e){return this.executorFactory.createExecutor(s.requestDeviceRegistration).executeRequest({body:e})}requestEmailTokenVerification(e){return this.executorFactory.createExecutor(s.requestEmailTokenVerification).executeRequest({body:e})}requestExtraDeviceRegistration(e,t){return this.executorFactory.createExecutor(s.requestExtraDeviceRegistration).executeRequest({credentials:e,body:t})}requestLogin(e){return this.executorFactory.createExecutor(s.requestLogin).executeRequest({body:e})}requestPushNotificationToken(e){return this.executorFactory.createExecutor(s.requestPushNotificationToken).executeRequest({credentials:e})}requestTotpActivation(e,t){return this.executorFactory.createExecutor(s.requestTotpActivation).executeRequest({credentials:e,body:t})}requestWebauthnOpenSession(e){return this.executorFactory.createExecutor(s.requestWebauthnOpenSession).executeRequest({credentials:e})}requestWebauthnRegistration(e){return this.executorFactory.createExecutor(s.requestWebauthnRegistration).executeRequest({credentials:e})}resetBlockedToken(e){return this.executorFactory.createExecutor(s.resetBlockedToken).executeRequest({body:e})}updateRecoveryPhoneNumber(e,t){return this.executorFactory.createExecutor(s.updateRecoveryPhoneNumber).executeRequest({credentials:e,body:t})}}const u={confirmRegistration:{method:"POST",path:"darkwebmonitoring/ConfirmRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},deregisterEmail:{method:"POST",path:"darkwebmonitoring/DeregisterEmail",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},listLeaks:{method:"POST",path:"darkwebmonitoring/ListLeaks",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},listRegistrations:{method:"POST",path:"darkwebmonitoring/ListRegistrations",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},registerEmail:{method:"POST",path:"darkwebmonitoring/RegisterEmail",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1}};class l{constructor(e){this.executorFactory=e}confirmRegistration(e){return this.executorFactory.createExecutor(u.confirmRegistration).executeRequest({body:e})}deregisterEmail(e,t){return this.executorFactory.createExecutor(u.deregisterEmail).executeRequest({credentials:e,body:t})}listLeaks(e,t){return this.executorFactory.createExecutor(u.listLeaks).executeRequest({credentials:e,body:t})}listRegistrations(e){return this.executorFactory.createExecutor(u.listRegistrations).executeRequest({credentials:e})}registerEmail(e,t){return this.executorFactory.createExecutor(u.registerEmail).executeRequest({credentials:e,body:t})}}const d={getAndEvaluateForUser:{method:"POST",path:"features/GetAndEvaluateForUser",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},listAvailableFeatureFlips:{method:"POST",path:"features/ListAvailableFeatureFlips",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1}};class p{constructor(e){this.executorFactory=e}getAndEvaluateForUser(e,t){return this.executorFactory.createExecutor(d.getAndEvaluateForUser).executeRequest({credentials:e,body:t})}listAvailableFeatureFlips(){return this.executorFactory.createExecutor(d.listAvailableFeatureFlips).executeRequest({})}}const f={getFileMeta:{method:"POST",path:"file/GetFileMeta",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},updatedFile:{method:"POST",path:"file/UpdatedFile",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1}};class h{constructor(e){this.executorFactory=e}getFileMeta(e,t){return this.executorFactory.createExecutor(f.getFileMeta).executeRequest({credentials:e,body:t})}updatedFile(e){return this.executorFactory.createExecutor(f.updatedFile).executeRequest({body:e})}}const m={getHashes:{method:"POST",path:"pwleak/GetHashes",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getLastUpdate:{method:"POST",path:"pwleak/GetLastUpdate",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1}};class y{constructor(e){this.executorFactory=e}getHashes(e){return this.executorFactory.createExecutor(m.getHashes).executeRequest({body:e})}getLastUpdate(){return this.executorFactory.createExecutor(m.getLastUpdate).executeRequest({})}}const g={deleteSecureFile:{method:"POST",path:"securefile/DeleteSecureFile",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1}};const v={acceptCollection:{method:"POST",path:"sharing-userdevice/AcceptCollection",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},acceptItemGroup:{method:"POST",path:"sharing-userdevice/AcceptItemGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},acceptUserGroup:{method:"POST",path:"sharing-userdevice/AcceptUserGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},addItemGroupsToCollection:{method:"POST",path:"sharing-userdevice/AddItemGroupsToCollection",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},addItems:{method:"POST",path:"sharing-userdevice/AddItems",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},createCollection:{method:"POST",path:"sharing-userdevice/CreateCollection",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},createItemGroup:{method:"POST",path:"sharing-userdevice/CreateItemGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},createTeamAdminsUserGroup:{method:"POST",path:"sharing-userdevice/CreateTeamAdminsUserGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},createUserGroup:{method:"POST",path:"sharing-userdevice/CreateUserGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},createUserGroupsItemGroup:{method:"POST",path:"sharing-userdevice/CreateUserGroupsItemGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},deleteItemGroup:{method:"POST",path:"sharing-userdevice/DeleteItemGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},deleteUserGroup:{method:"POST",path:"sharing-userdevice/DeleteUserGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},postSharingUserdevice:{method:"POST",path:"sharing-userdevice/Get",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getUsersPublicKey:{method:"POST",path:"sharing-userdevice/GetUsersPublicKey",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},inviteCollectionMembers:{method:"POST",path:"sharing-userdevice/InviteCollectionMembers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},inviteItemGroupMembers:{method:"POST",path:"sharing-userdevice/InviteItemGroupMembers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},inviteUserGroupUsers:{method:"POST",path:"sharing-userdevice/InviteUserGroupUsers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},refuseCollection:{method:"POST",path:"sharing-userdevice/RefuseCollection",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},refuseItemGroup:{method:"POST",path:"sharing-userdevice/RefuseItemGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},refuseUserGroup:{method:"POST",path:"sharing-userdevice/RefuseUserGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},removeItemGroupsFromCollection:{method:"POST",path:"sharing-userdevice/RemoveItemGroupsFromCollection",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},removeItems:{method:"POST",path:"sharing-userdevice/RemoveItems",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},renameUserGroup:{method:"POST",path:"sharing-userdevice/RenameUserGroup",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},resendItemGroupInvites:{method:"POST",path:"sharing-userdevice/ResendItemGroupInvites",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},revokeItemGroupMembers:{method:"POST",path:"sharing-userdevice/RevokeItemGroupMembers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},revokeUserGroupUsers:{method:"POST",path:"sharing-userdevice/RevokeUserGroupUsers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},updateItem:{method:"POST",path:"sharing-userdevice/UpdateItem",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},updateItemGroupMembers:{method:"POST",path:"sharing-userdevice/UpdateItemGroupMembers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},updateUserGroupUsers:{method:"POST",path:"sharing-userdevice/UpdateUserGroupUsers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1}};class b{constructor(e){this.executorFactory=e}acceptCollection(e,t){return this.executorFactory.createExecutor(v.acceptCollection).executeRequest({credentials:e,body:t})}acceptItemGroup(e,t){return this.executorFactory.createExecutor(v.acceptItemGroup).executeRequest({credentials:e,body:t})}acceptUserGroup(e,t){return this.executorFactory.createExecutor(v.acceptUserGroup).executeRequest({credentials:e,body:t})}addItemGroupsToCollection(e,t){return this.executorFactory.createExecutor(v.addItemGroupsToCollection).executeRequest({credentials:e,body:t})}addItems(e,t){return this.executorFactory.createExecutor(v.addItems).executeRequest({credentials:e,body:t})}createCollection(e,t){return this.executorFactory.createExecutor(v.createCollection).executeRequest({credentials:e,body:t})}createItemGroup(e,t){return this.executorFactory.createExecutor(v.createItemGroup).executeRequest({credentials:e,body:t})}createTeamAdminsUserGroup(e,t){return this.executorFactory.createExecutor(v.createTeamAdminsUserGroup).executeRequest({credentials:e,body:t})}createUserGroup(e,t){return this.executorFactory.createExecutor(v.createUserGroup).executeRequest({credentials:e,body:t})}createUserGroupsItemGroup(e,t){return this.executorFactory.createExecutor(v.createUserGroupsItemGroup).executeRequest({credentials:e,body:t})}deleteItemGroup(e,t){return this.executorFactory.createExecutor(v.deleteItemGroup).executeRequest({credentials:e,body:t})}deleteUserGroup(e,t){return this.executorFactory.createExecutor(v.deleteUserGroup).executeRequest({credentials:e,body:t})}postSharingUserdevice(e,t){return this.executorFactory.createExecutor(v.postSharingUserdevice).executeRequest({credentials:e,body:t})}getUsersPublicKey(e,t){return this.executorFactory.createExecutor(v.getUsersPublicKey).executeRequest({credentials:e,body:t})}inviteCollectionMembers(e,t){return this.executorFactory.createExecutor(v.inviteCollectionMembers).executeRequest({credentials:e,body:t})}inviteItemGroupMembers(e,t){return this.executorFactory.createExecutor(v.inviteItemGroupMembers).executeRequest({credentials:e,body:t})}inviteUserGroupUsers(e,t){return this.executorFactory.createExecutor(v.inviteUserGroupUsers).executeRequest({credentials:e,body:t})}refuseCollection(e,t){return this.executorFactory.createExecutor(v.refuseCollection).executeRequest({credentials:e,body:t})}refuseItemGroup(e,t){return this.executorFactory.createExecutor(v.refuseItemGroup).executeRequest({credentials:e,body:t})}refuseUserGroup(e,t){return this.executorFactory.createExecutor(v.refuseUserGroup).executeRequest({credentials:e,body:t})}removeItemGroupsFromCollection(e,t){return this.executorFactory.createExecutor(v.removeItemGroupsFromCollection).executeRequest({credentials:e,body:t})}removeItems(e,t){return this.executorFactory.createExecutor(v.removeItems).executeRequest({credentials:e,body:t})}renameUserGroup(e,t){return this.executorFactory.createExecutor(v.renameUserGroup).executeRequest({credentials:e,body:t})}resendItemGroupInvites(e,t){return this.executorFactory.createExecutor(v.resendItemGroupInvites).executeRequest({credentials:e,body:t})}revokeItemGroupMembers(e,t){return this.executorFactory.createExecutor(v.revokeItemGroupMembers).executeRequest({credentials:e,body:t})}revokeUserGroupUsers(e,t){return this.executorFactory.createExecutor(v.revokeUserGroupUsers).executeRequest({credentials:e,body:t})}updateItem(e,t){return this.executorFactory.createExecutor(v.updateItem).executeRequest({credentials:e,body:t})}updateItemGroupMembers(e,t){return this.executorFactory.createExecutor(v.updateItemGroupMembers).executeRequest({credentials:e,body:t})}updateUserGroupUsers(e,t){return this.executorFactory.createExecutor(v.updateUserGroupUsers).executeRequest({credentials:e,body:t})}}const w={accessibleTeamOffers:{method:"POST",path:"teams/AccessibleTeamOffers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},activateSsoForUsers:{method:"POST",path:"teams/ActivateSsoForUsers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},addGroupManager:{method:"POST",path:"teams/AddGroupManager",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},addSeats:{method:"POST",path:"teams/AddSeats",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},addTeamCaptain:{method:"POST",path:"teams/AddTeamCaptain",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},changeTeamKeyTeamSignUpPage:{method:"POST",path:"teams/ChangeTeamKeyTeamSignUpPage",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},changeTierMidCycle:{method:"POST",path:"teams/ChangeTierMidCycle",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},completeDomainsRegistration:{method:"POST",path:"teams/CompleteDomainsRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},computePlanPricing:{method:"POST",path:"teams/ComputePlanPricing",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},createTeamDeviceAccount:{method:"POST",path:"teams/CreateTeamDeviceAccount",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},createTeamSignUpPage:{method:"POST",path:"teams/CreateTeamSignUpPage",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},deactivateDomain:{method:"POST",path:"teams/DeactivateDomain",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},deactivateSsoForUsers:{method:"POST",path:"teams/DeactivateSsoForUsers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},deactivateTeamDevice:{method:"POST",path:"teams/DeactivateTeamDevice",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getAllMemberDeviceInformation:{method:"POST",path:"teams/GetAllMemberDeviceInformation",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getAuditLogQueryResults:{method:"POST",path:"teams/GetAuditLogQueryResults",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getAuditLogs:{method:"POST",path:"teams/GetAuditLogs",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getDarkWebInsightsReportDetails:{method:"POST",path:"teams/GetDarkWebInsightsReportDetails",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getDarkWebInsightsSummary:{method:"POST",path:"teams/GetDarkWebInsightsSummary",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getExpectedTaxInformation:{method:"POST",path:"teams/GetExpectedTaxInformation",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getExpectedTaxInformationApp:{method:"POST",path:"teams/GetExpectedTaxInformationApp",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getMidCycleTierUpgradePrice:{method:"POST",path:"teams/GetMidCycleTierUpgradePrice",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getRecoveryCodesAsTeamCaptain:{method:"POST",path:"teams/GetRecoveryCodesAsTeamCaptain",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getTeamDevice:{method:"POST",path:"teams/GetTeamDevice",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getTeamDeviceEncryptedConfiguration:{method:"POST",path:"teams/GetTeamDeviceEncryptedConfiguration",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getTeamLastUpdateTs:{method:"POST",path:"teams/GetTeamLastUpdateTs",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getTeamMembers:{method:"POST",path:"teams/GetTeamMembers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getTeamOffers:{method:"POST",path:"teams/GetTeamOffers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getTeamReceipts:{method:"POST",path:"teams/GetTeamReceipts",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getTeamSignUpPage:{method:"POST",path:"teams/GetTeamSignUpPage",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},getTeamSignUpPageForAdmin:{method:"POST",path:"teams/GetTeamSignUpPageForAdmin",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},getUserPermissions:{method:"POST",path:"teams/GetUserPermissions",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},invoiceTeamCreate:{method:"POST",path:"teams/InvoiceTeamCreate",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},invoiceTeamUpgrade:{method:"POST",path:"teams/InvoiceTeamUpgrade",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},lastAdSyncDate:{method:"POST",path:"teams/LastADSyncDate",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},listDomains:{method:"POST",path:"teams/ListDomains",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},listTeamDevices:{method:"POST",path:"teams/ListTeamDevices",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},proposeMembers:{method:"POST",path:"teams/ProposeMembers",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},registerFreeTrial:{method:"POST",path:"teams/RegisterFreeTrial",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},registerFreeTrialOptionalFields:{method:"POST",path:"teams/RegisterFreeTrialOptionalFields",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},registerTeamDevice:{method:"POST",path:"teams/RegisterTeamDevice",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},removeGroupManager:{method:"POST",path:"teams/RemoveGroupManager",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},report:{method:"POST",path:"teams/Report",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},reportTeamDeviceError:{method:"POST",path:"teams/ReportTeamDeviceError",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.TEAM_DEVICE,version:o.W.V1},requestDomainRegistration:{method:"POST",path:"teams/RequestDomainRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},requestTeamInviteToken:{method:"POST",path:"teams/RequestTeamInviteToken",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.APP,version:o.W.V1},startAuditLogsQuery:{method:"POST",path:"teams/StartAuditLogsQuery",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},storeActivityLogs:{method:"POST",path:"teams/StoreActivityLogs",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},storeAuditLogs:{method:"POST",path:"teams/StoreAuditLogs",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},teamStatus:{method:"POST",path:"teams/TeamStatus",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},toggleTeamSignUpPage:{method:"POST",path:"teams/ToggleTeamSignUpPage",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1},updateTeamDeviceEncryptedConfiguration:{method:"POST",path:"teams/UpdateTeamDeviceEncryptedConfiguration",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1}};class S{constructor(e){this.executorFactory=e}accessibleTeamOffers(e){return this.executorFactory.createExecutor(w.accessibleTeamOffers).executeRequest({body:e})}activateSsoForUsers(e,t){return this.executorFactory.createExecutor(w.activateSsoForUsers).executeRequest({credentials:e,body:t})}addGroupManager(e,t){return this.executorFactory.createExecutor(w.addGroupManager).executeRequest({credentials:e,body:t})}addSeats(e,t){return this.executorFactory.createExecutor(w.addSeats).executeRequest({credentials:e,body:t})}addTeamCaptain(e,t){return this.executorFactory.createExecutor(w.addTeamCaptain).executeRequest({credentials:e,body:t})}changeTeamKeyTeamSignUpPage(e){return this.executorFactory.createExecutor(w.changeTeamKeyTeamSignUpPage).executeRequest({credentials:e})}changeTierMidCycle(e,t){return this.executorFactory.createExecutor(w.changeTierMidCycle).executeRequest({credentials:e,body:t})}completeDomainsRegistration(e){return this.executorFactory.createExecutor(w.completeDomainsRegistration).executeRequest({credentials:e})}computePlanPricing(e,t){return this.executorFactory.createExecutor(w.computePlanPricing).executeRequest({credentials:e,body:t})}createTeamDeviceAccount(e,t){return this.executorFactory.createExecutor(w.createTeamDeviceAccount).executeRequest({credentials:e,body:t})}createTeamSignUpPage(e,t){return this.executorFactory.createExecutor(w.createTeamSignUpPage).executeRequest({credentials:e,body:t})}deactivateDomain(e,t){return this.executorFactory.createExecutor(w.deactivateDomain).executeRequest({credentials:e,body:t})}deactivateSsoForUsers(e,t){return this.executorFactory.createExecutor(w.deactivateSsoForUsers).executeRequest({credentials:e,body:t})}deactivateTeamDevice(e,t){return this.executorFactory.createExecutor(w.deactivateTeamDevice).executeRequest({credentials:e,body:t})}getAllMemberDeviceInformation(e){return this.executorFactory.createExecutor(w.getAllMemberDeviceInformation).executeRequest({credentials:e})}getAuditLogQueryResults(e,t){return this.executorFactory.createExecutor(w.getAuditLogQueryResults).executeRequest({credentials:e,body:t})}getAuditLogs(e,t){return this.executorFactory.createExecutor(w.getAuditLogs).executeRequest({credentials:e,body:t})}getDarkWebInsightsReportDetails(e,t){return this.executorFactory.createExecutor(w.getDarkWebInsightsReportDetails).executeRequest({credentials:e,body:t})}getDarkWebInsightsSummary(e,t){return this.executorFactory.createExecutor(w.getDarkWebInsightsSummary).executeRequest({credentials:e,body:t})}getExpectedTaxInformation(e,t){return this.executorFactory.createExecutor(w.getExpectedTaxInformation).executeRequest({credentials:e,body:t})}getExpectedTaxInformationApp(e){return this.executorFactory.createExecutor(w.getExpectedTaxInformationApp).executeRequest({body:e})}getMidCycleTierUpgradePrice(e,t){return this.executorFactory.createExecutor(w.getMidCycleTierUpgradePrice).executeRequest({credentials:e,body:t})}getRecoveryCodesAsTeamCaptain(e,t){return this.executorFactory.createExecutor(w.getRecoveryCodesAsTeamCaptain).executeRequest({credentials:e,body:t})}getTeamDevice(e,t){return this.executorFactory.createExecutor(w.getTeamDevice).executeRequest({credentials:e,body:t})}getTeamDeviceEncryptedConfiguration(e,t){return this.executorFactory.createExecutor(w.getTeamDeviceEncryptedConfiguration).executeRequest({credentials:e,body:t})}getTeamLastUpdateTs(e,t){return this.executorFactory.createExecutor(w.getTeamLastUpdateTs).executeRequest({credentials:e,body:t})}getTeamMembers(e,t){return this.executorFactory.createExecutor(w.getTeamMembers).executeRequest({credentials:e,body:t})}getTeamOffers(e,t){return this.executorFactory.createExecutor(w.getTeamOffers).executeRequest({credentials:e,body:t})}getTeamReceipts(e,t){return this.executorFactory.createExecutor(w.getTeamReceipts).executeRequest({credentials:e,body:t})}getTeamSignUpPage(e){return this.executorFactory.createExecutor(w.getTeamSignUpPage).executeRequest({body:e})}getTeamSignUpPageForAdmin(e){return this.executorFactory.createExecutor(w.getTeamSignUpPageForAdmin).executeRequest({credentials:e})}getUserPermissions(e){return this.executorFactory.createExecutor(w.getUserPermissions).executeRequest({credentials:e})}invoiceTeamCreate(e){return this.executorFactory.createExecutor(w.invoiceTeamCreate).executeRequest({body:e})}invoiceTeamUpgrade(e){return this.executorFactory.createExecutor(w.invoiceTeamUpgrade).executeRequest({body:e})}lastAdSyncDate(e){return this.executorFactory.createExecutor(w.lastAdSyncDate).executeRequest({credentials:e})}listDomains(e){return this.executorFactory.createExecutor(w.listDomains).executeRequest({credentials:e})}listTeamDevices(e){return this.executorFactory.createExecutor(w.listTeamDevices).executeRequest({credentials:e})}proposeMembers(e,t){return this.executorFactory.createExecutor(w.proposeMembers).executeRequest({credentials:e,body:t})}registerFreeTrial(e){return this.executorFactory.createExecutor(w.registerFreeTrial).executeRequest({body:e})}registerFreeTrialOptionalFields(e){return this.executorFactory.createExecutor(w.registerFreeTrialOptionalFields).executeRequest({body:e})}registerTeamDevice(e,t){return this.executorFactory.createExecutor(w.registerTeamDevice).executeRequest({credentials:e,body:t})}removeGroupManager(e,t){return this.executorFactory.createExecutor(w.removeGroupManager).executeRequest({credentials:e,body:t})}report(e,t){return this.executorFactory.createExecutor(w.report).executeRequest({credentials:e,body:t})}reportTeamDeviceError(e,t){return this.executorFactory.createExecutor(w.reportTeamDeviceError).executeRequest({credentials:e,body:t})}requestDomainRegistration(e,t){return this.executorFactory.createExecutor(w.requestDomainRegistration).executeRequest({credentials:e,body:t})}requestTeamInviteToken(e){return this.executorFactory.createExecutor(w.requestTeamInviteToken).executeRequest({body:e})}startAuditLogsQuery(e,t){return this.executorFactory.createExecutor(w.startAuditLogsQuery).executeRequest({credentials:e,body:t})}storeActivityLogs(e,t){return this.executorFactory.createExecutor(w.storeActivityLogs).executeRequest({credentials:e,body:t})}storeAuditLogs(e,t){return this.executorFactory.createExecutor(w.storeAuditLogs).executeRequest({credentials:e,body:t})}teamStatus(e){return this.executorFactory.createExecutor(w.teamStatus).executeRequest({credentials:e})}toggleTeamSignUpPage(e,t){return this.executorFactory.createExecutor(w.toggleTeamSignUpPage).executeRequest({credentials:e,body:t})}updateTeamDeviceEncryptedConfiguration(e,t){return this.executorFactory.createExecutor(w.updateTeamDeviceEncryptedConfiguration).executeRequest({credentials:e,body:t})}}var R=r(73873);const E={create:{method:"POST",path:"useractivity/Create",requestAcceptHeader:"application/json",responseType:"json",authType:n.d.USER_DEVICE,version:o.W.V1}};class O{constructor(e){this.executorFactory=e}create(e,t){return this.executorFactory.createExecutor(E.create).executeRequest({credentials:e,body:t})}}const C={accountrecovery:i,authentication:s,darkwebmonitoring:u,features:d,file:f,pwleak:m,securefile:g,sharingUserdevice:v,teams:w,time:R.i,useractivity:E};R.q;var P,A,j;!function(e){e.Admin="admin",e.Limited="limited"}(P||(P={})),function(e){e.USER="USER",e.TAC="TAC",e.AD="AD",e.SCIM="SCIM"}(A||(A={})),function(e){e.Pending="pending",e.Accepted="accepted",e.Refused="refused",e.Revoked="revoked"}(j||(j={}))},64839:(e,t,r)=>{"use strict";var n;r.d(t,{d:()=>n}),function(e){e.NONE="NONE",e.APP="App",e.USER_DEVICE="UserDevice",e.SESSION="Session",e.TEAM_DEVICE="TeamDevice",e.BACK_OFFICE="Backoffice",e.EXTERNAL="External",e.CUSTOM="Custom"}(n||(n={}))},24982:(e,t,r)=>{"use strict";var n;r.d(t,{W:()=>n}),function(e){e.V1="v1"}(n||(n={}))},96873:(e,t,r)=>{"use strict";r.d(t,{_:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{if(!(0,n.Ez)("action.setBadgeBackgroundColor")&&!(0,n.Ez)("browserAction.setBadgeBackgroundColor"))return void r(new Error("No setBadgeBackgroundColor support"));(chrome.action?.setBadgeBackgroundColor??chrome.browserAction.setBadgeBackgroundColor)(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`action/setBadgeBackgroundColor: ${e}`);r(t)}else t()}))}))}},86554:(e,t,r)=>{"use strict";r.d(t,{d:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{if(!(0,n.Ez)("action.setBadgeText")&&!(0,n.Ez)("browserAction.setBadgeText"))return void r(new Error("No setBadgeText support"));(chrome.action?.setBadgeText??chrome.browserAction.setBadgeText)(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`action/setBadgeText: ${e}`);r(t)}else t()}))}))}},16241:(e,t,r)=>{"use strict";r.d(t,{B:()=>o});var n=r(839);function o(e,t){return new Promise(((r,o)=>{if(!(0,n.Ez)("action.setIcon")&&!(0,n.Ez)("browserAction.setIcon"))return void o(new Error("No action.setIcon support"));(chrome.action?.setIcon??chrome.browserAction.setIcon)({path:e,tabId:t},(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`action/setIcon: ${e}`);o(t)}else r()}))}))}},329:(e,t,r)=>{"use strict";r.d(t,{g:()=>o});var n=r(839);function o(e={}){return new Promise(((t,r)=>{(0,n.qX)(["cookies"])?(0,n.Ez)("cookies.getAll")?chrome.cookies.getAll(e,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`cookies/getAll: ${e}`);r(t)}else t(e)})):r(new Error("No cookies.getAll support")):r(new Error("No cookies.getAll support, permission is missing"))}))}},98641:(e,t,r)=>{"use strict";r.d(t,{O:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.qX)(["cookies"])?(0,n.Ez)("cookies.remove")?chrome.cookies.remove(e,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`cookies/remove: ${e}`);r(t)}else t(e)})):r(new Error("No cookies.remove support")):r(new Error("No cookies.remove support, permission is missing"))}))}},6212:(e,t,r)=>{"use strict";r.d(t,{z:()=>o});var n=r(839);function o(){return new Promise(((e,t)=>{(0,n.qX)(["declarativeNetRequest"])?(0,n.Ez)("declarativeNetRequest.getDynamicRules")?chrome.declarativeNetRequest.getDynamicRules((r=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",r=new Error(`declarativeNetRequest/getDynamicRules: ${e}`);t(r)}else e(r)})):t(new Error("No declarativeNetRequest.getDynamicRules support")):t(new Error("No declarativeNetRequest.getDynamicRules support, permission is missing"))}))}},25417:(e,t,r)=>{"use strict";r.d(t,{G:()=>o});var n=r(839);function o(){return(0,n.Ez)("declarativeNetRequest")&&(0,n.qX)(["declarativeNetRequest"])}},84867:(e,t,r)=>{"use strict";r.d(t,{O:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.qX)(["declarativeNetRequest"])?(0,n.Ez)("declarativeNetRequest.updateDynamicRules")?chrome.declarativeNetRequest.updateDynamicRules(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`declarativeNetRequest/updateDynamicRules: ${e}`);r(t)}else t()})):r(new Error("No declarativeNetRequest.updateDynamicRules support")):r(new Error("No declarativeNetRequest.updateDynamicRules support, permission is missing"))}))}},839:(e,t,r)=>{"use strict";r.d(t,{Ez:()=>i,qX:()=>o});var n=r(84318);function o(e){const t=(0,n.W)().permissions??[];return e.every((e=>t.includes(e)))}function i(e){if("undefined"==typeof chrome)return!1;const t=e.split(".").reduce(((e,t)=>e?.[t]),chrome);return Boolean(t)}},13090:(e,t,r)=>{"use strict";r.d(t,{e:()=>o});var n=r(839);const o={addListener:function(e){if(!(0,n.qX)(["idle"]))throw new Error("No idle.onStateChanged.addListener support, permission is missing");if(!(0,n.Ez)("idle.onStateChanged.addListener"))throw new Error("No idle.onStateChanged.addListener support");const t=t=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`idle/onStateChanged: ${e}`)}return e(t)};return chrome.idle.onStateChanged.addListener(t),t},removeListener:function(e){if(!(0,n.qX)(["idle"]))throw new Error("No idle.onStateChanged.removeListener support, permission is missing");if(!(0,n.Ez)("idle.onStateChanged.removeListener"))throw new Error("No idle.onStateChanged.removeListener support");chrome.idle.onStateChanged.removeListener(e)}}},54422:(e,t,r)=>{"use strict";r.d(t,{X:()=>o});var n=r(839);function o(e){if(!(0,n.qX)(["idle"]))throw new Error("No idle.setDetectionInterval support, permission is missing");if(!(0,n.Ez)("idle.setDetectionInterval"))throw new Error("No idle.setDetectionInterval support");chrome.idle.setDetectionInterval(e)}},82324:(e,t,r)=>{"use strict";r.d(t,{I:()=>i,b:()=>a});var n=r(28489),o=r(74972);function i(e){if("object"!=typeof e||!e)return!1;return!!(0,n.l$)(e,"reason")&&e.reason===o.$.RuntimeError}function a(e){if("object"!=typeof e||!e)return!1;return!!(0,n.l$)(e,"reason")&&e.reason===o.$.SettingNotSupported}},30754:(e,t,r)=>{"use strict";r.d(t,{U:()=>a});var n=r(839),o=r(74972);const i={reason:o.$.SettingNotSupported};function a(e){return new Promise(((t,r)=>{(0,n.qX)(["privacy"])&&(0,n.Ez)(`privacy.services.${e}.get`)?chrome.privacy.services[e].get({},(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t={reason:o.$.RuntimeError,runtimeError:new Error(e)};r(t)}else t(e)})):r(i)}))}},74972:(e,t,r)=>{"use strict";var n;r.d(t,{$:()=>n}),function(e){e.RuntimeError="runtimeError",e.SettingNotSupported="settingNotSupported"}(n||(n={}))},81805:(e,t,r)=>{"use strict";r.d(t,{t:()=>a});var n=r(839),o=r(74972);const i={reason:o.$.SettingNotSupported};function a(e,t){return new Promise(((r,a)=>{(0,n.qX)(["privacy"])&&(0,n.Ez)(`privacy.services.${e}.set`)?chrome.privacy.services[e].set({value:t},(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t={reason:o.$.RuntimeError,runtimeError:new Error(e)};a(t)}else r()})):a(i)}))}},84318:(e,t,r)=>{"use strict";r.d(t,{W:()=>o});var n=r(839);function o(){if(!(0,n.Ez)("runtime.getManifest"))throw new Error("No runtime.getManifest support");return chrome.runtime.getManifest()}},92204:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var n=r(839);function o(e){if(!(0,n.Ez)("runtime.getURL"))throw new Error("No runtime.getURL support");return chrome.runtime.getURL(e)}},20500:(e,t,r)=>{"use strict";r.d(t,{b:()=>o});var n=r(839);const o={addListener:function(e){if(!(0,n.Ez)("runtime.onConnect.addListener"))throw new Error("No runtime.onConnect.addListener support");const t=t=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`runtime/onConnect: ${e}`)}return e(t)};return chrome.runtime.onConnect.addListener(t),t},removeListener:function(e){if(!(0,n.Ez)("runtime.onConnect.removeListener"))throw new Error("No runtime.onConnect.removeListener support");chrome.runtime.onConnect.removeListener(e)}}},23386:(e,t,r)=>{"use strict";r.d(t,{Y:()=>o});var n=r(839);const o={addListener:function(e){if(!(0,n.Ez)("runtime.onInstalled.addListener"))throw new Error("No runtime.onInstalled.addListener support");chrome.runtime.onInstalled.addListener((t=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`runtime/onInstalled: ${e}`)}return e(t)}))}}},56386:(e,t,r)=>{"use strict";r.d(t,{H:()=>o});var n=r(839);function o(){if(!(0,n.Ez)("runtime.reload"))throw new Error("No runtime.reload support");chrome.runtime.reload()}},2927:(e,t,r)=>{"use strict";r.d(t,{S:()=>o});var n=r(839);function o(e){if(!(0,n.Ez)("runtime.setUninstallURL"))throw new Error("No runtime.setUninstallURL support");chrome.runtime.setUninstallURL(e)}},21763:(e,t,r)=>{"use strict";r.d(t,{k:()=>i});var n=r(839);const o=(e,t)=>()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",r=new Error(`scripting/executeScript: ${e}`);t(r)}else e()};function i(e,t){return(0,n.Ez)("scripting.executeScript")?function(e,t){return new Promise(((r,n)=>{const i=t??o(r,n);chrome.scripting.executeScript(e,i)}))}(e,t):(0,n.Ez)("tabs.executeScript")?function(e,t){return new Promise(((r,n)=>{const i=t??o(r,n),a={allFrames:e.target.allFrames,file:void 0,frameId:e.target.frameIds?.[0],runAt:"document_start"};"func"in e?a.code=e.func.toString():a.file=e.files[0],chrome.tabs.executeScript(e.target.tabId,a,i)}))}(e,t):Promise.reject(new Error("No scripting.executeScript support"))}},39680:(e,t,r)=>{"use strict";r.d(t,{G:()=>o,y:()=>i});var n=r(839);function o(){return!!chrome.storage?.local.getBytesInUse}function i(e){return new Promise(((t,r)=>{(0,n.qX)(["storage"])?(0,n.Ez)("storage.local.getBytesInUse")?chrome.storage.local.getBytesInUse(e,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`storage/local/getBytesInUse: ${e}`);r(t)}else t(e)})):r(new Error("No storage.local.getBytesInUse support")):r(new Error("No storage.local.getBytesInUse support, permission is missing"))}))}},41808:(e,t,r)=>{"use strict";r.d(t,{U:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.qX)(["storage"])?(0,n.Ez)("storage.local.get")?chrome.storage.local.get(e,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`storage/local/get: ${e}`);r(t)}else t(e)})):r(new Error("No storage.local.get support")):r(new Error("No storage.local.get support, permission is missing"))}))}},45441:(e,t,r)=>{"use strict";r.d(t,{O:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.qX)(["storage"])?(0,n.Ez)("storage.local.remove")?chrome.storage.local.remove(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`storage/local/remove: ${e}`);r(t)}else t()})):r(new Error("No storage.local.remove support")):r(new Error("No storage.local.remove support, permission is missing"))}))}},9244:(e,t,r)=>{"use strict";r.d(t,{t:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.qX)(["storage"])?(0,n.Ez)("storage.local.set")?chrome.storage.local.set(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`storage/local/set: ${e}`);r(t)}else t()})):r(new Error("No storage.local.set support")):r(new Error("No storage.local.set support, permission is missing"))}))}},15026:(e,t,r)=>{"use strict";r.d(t,{U:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.qX)(["storage"])?(0,n.Ez)("storage.session.get")?chrome.storage.session.get(e,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`storage/session/get: ${e}`);r(t)}t(e)})):r(new Error("No storage.session.get support")):r(new Error("No storage.session.get support, permission is missing"))}))}},32012:(e,t,r)=>{"use strict";r.d(t,{G:()=>o});var n=r(839);function o(){return(0,n.Ez)("storage.session")&&(0,n.qX)(["storage"])}},52477:(e,t,r)=>{"use strict";r.d(t,{O:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.qX)(["storage"])?(0,n.Ez)("storage.session.remove")?chrome.storage.session.remove(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`storage/session/remove: ${e}`);r(t)}t()})):r(new Error("No storage.session.remove support")):r(new Error("No storage.session.remove support, permission is missing"))}))}},56847:(e,t,r)=>{"use strict";r.d(t,{t:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.qX)(["storage"])?(0,n.Ez)("storage.session.set")?chrome.storage.session.set(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`storage/session/set: ${e}`);r(t)}t()})):r(new Error("No storage.session.set support")):r(new Error("No storage.session.set support, permission is missing"))}))}},24715:(e,t,r)=>{"use strict";r.d(t,{U:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.Ez)("tabs.create")?chrome.tabs.create(e,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`tabs/create: ${e}`);r(t)}else t(e)})):r(new Error("No tabs.create support"))}))}},61222:(e,t,r)=>{"use strict";r.d(t,{I:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.qX)(["tabs"])?(0,n.Ez)("tabs.query")?chrome.tabs.query(e,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`tabs/query: ${e}`);r(t)}else t(e)})):r(new Error("No tabs.query support")):r(new Error("No tabs.query support, permission is missing"))}))}},49259:(e,t,r)=>{"use strict";r.d(t,{O:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{(0,n.Ez)("tabs.remove")?chrome.tabs.remove(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`tabs/remove: ${e}`);r(t)}else t()})):r(new Error("No tabs.remove support"))}))}},31460:(e,t,r)=>{"use strict";r.d(t,{V:()=>o});var n=r(839);function o(e,t){return new Promise(((r,o)=>{(0,n.Ez)("tabs.update")?chrome.tabs.update(e,t,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`tabs/update: ${e}`);o(t)}else r(e)})):o(new Error("No tabs.update support"))}))}},48291:(e,t,r)=>{"use strict";r.d(t,{a:()=>i});var n=r(65881),o=r(839);const i={addListener:function(e,t,r){const i=r?.includes(n.X.Blocking)?["webRequest","webRequestBlocking"]:["webRequest"];if(!(0,o.qX)(i))throw new Error("No webRequest.onBeforeRequest.addListener support, permission is missing");if(!(0,o.Ez)("webRequest.onBeforeRequest.addListener"))throw new Error("No webRequest.onBeforeRequest.addListener support");const a=t=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`webRequest/onBeforeRequest: ${e}`)}return e(t)};return chrome.webRequest.onBeforeRequest.addListener(a,t,r),a},hasListener:function(e){if(!(0,o.qX)(["webRequest","webRequestBlocking"]))throw new Error("No webRequest.onBeforeRequest.hasListener support, permission is missing");if(!(0,o.Ez)("webRequest.onBeforeRequest.hasListener"))throw new Error("No webRequest.onBeforeRequest support");return chrome.webRequest.onBeforeRequest.hasListener(e)},removeListener:function(e){if(!(0,o.qX)(["webRequest"]))throw new Error("No webRequest.onBeforeRequest.removeListener support, permission is missing");if(!(0,o.Ez)("webRequest.onBeforeRequest.removeListener"))throw new Error("No webRequest.onBeforeRequest support");chrome.webRequest.onBeforeRequest.removeListener(e)}}},65881:(e,t,r)=>{"use strict";var n;r.d(t,{X:()=>n}),function(e){e.Blocking="blocking",e.RequestBody="requestBody"}(n||(n={}))},72733:(e,t,r)=>{"use strict";r.d(t,{T:()=>o});var n=r(839);function o(e){return new Promise(((t,r)=>{if(!(0,n.Ez)("windows.getCurrent"))return void r(new Error("No windows.getCurrent support"));const o=e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`windows/getCurrent: ${e}`);r(t)}else t(e)};e?chrome.windows.getCurrent(e,o):chrome.windows.getCurrent(o)}))}},57306:(e,t,r)=>{"use strict";r.d(t,{V:()=>o});var n=r(839);function o(e,t){return new Promise(((r,o)=>{(0,n.Ez)("windows.update")?chrome.windows.update(e,t,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`windows/update: ${e}`);o(t)}else r(e)})):o(new Error("No windows.update support"))}))}},34573:()=>{},19381:()=>{},86585:()=>{},1342:()=>{},22324:()=>{},17978:()=>{},98814:()=>{},97961:()=>{},3275:()=>{},63619:()=>{},25387:()=>{},46332:()=>{},48263:()=>{},1973:()=>{},43350:()=>{}}]);